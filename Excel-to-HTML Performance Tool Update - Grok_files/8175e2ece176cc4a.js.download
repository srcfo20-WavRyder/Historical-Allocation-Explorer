
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="8a936c94-3ad1-54c3-b83a-3dd975932e5d")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,115551,e=>{"use strict";e.s(["default",()=>ob],115551);var t=e.i(247276),i=e.i(700585),s=e.i(315366),a=e.i(850821),n=e.i(850421),r=e.i(572848),o=e.i(763578),l=e.i(729009),d=e.i(713087),c=e.i(626205),u=e.i(50636),m=e.i(157695),p=e.i(218946),h=e.i(486492),g=e.i(479268),x=e.i(724499),f=e.i(211959),v=e.i(136783),y=e.i(536459),b=e.i(712548),j=e.i(633918),w=e.i(421593);e.i(18545);var k=e.i(116212),N=e.i(533431),S=e.i(880020),I=e.i(402299),C=e.i(383274);e.i(31157);var E=e.i(171686),M=e.i(938270),T=e.i(489843),_=e.i(72290);e.i(685846);var P=e.i(12465),R=e.i(443696),A=e.i(920958),L=e.i(328788);function D(e){let{className:i,onDismiss:s}=e,{t:a}=(0,k.useTranslation)("chat"),{ACCOUNT_URL:n}=(0,_.useEnvironment)(),r=(0,A.useLogEvent)(),o=(0,L.useMobileSize)();(0,w.useEffect)(()=>{r("connect_x_upsell_impression","",{location:"chat-new"})},[r]);let l=(0,w.useCallback)(()=>{let e=new URL("/account",n);e.searchParams.set("redirect","grok-com"),e.searchParams.set("action","connect-x-account"),r("connect_x_account_click","",{location:"chat-new"}),window.location.href=e.toString()},[n,r]),d=(0,w.useCallback)(e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),l())},[l]),c=(0,w.useCallback)(e=>{e.stopPropagation(),r("connect_x_upsell_dismissed","",{location:"chat-new"}),null==s||s()},[r,s]),u=(0,w.useCallback)(e=>{e.stopPropagation(),l()},[l]);return(0,t.jsx)("div",{role:"button",tabIndex:0,"aria-label":a("connect-x-account.card-label","Connect your ð• account to unlock features"),onClick:l,onKeyDown:d,className:(0,f.cn)("w-full flex justify-center mt-2 px-2 cursor-pointer","animate-in fade-in-0 zoom-in-95 transition-transform duration-150 ease-out","hover:scale-[1.01] active:scale-[0.99]","focus:outline-none",i),children:(0,t.jsxs)("div",{className:(0,f.cn)("relative group flex w-fit sm:w-auto items-center rounded-2xl border border-border","bg-surface-base","px-4 py-3 shadow-sm",o?"gap-3":"gap-6"),children:[(0,t.jsx)(R.Button,{className:(0,f.cn)("absolute scale-50 opacity-0 -top-1.5 -right-1.5 z-10","group-hover:opacity-100 group-hover:scale-100 border border-border-l1 bg-surface-base hover:bg-surface-l2"),variant:"tertiary",size:"xs",shape:"circle","aria-label":a("connect-x-account.close","Close"),onClick:c,children:(0,t.jsx)(P.XIcon,{className:"size-4"})}),(0,t.jsxs)("div",{className:"flex flex-row gap-3",children:[(0,t.jsx)("div",{className:"flex size-10 items-center justify-center rounded-full border border-border-l1 bg-surface-l1",children:(0,t.jsx)("span",{className:"text-2xl leading-none",children:a("connect-x-account.x","ð•")})}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 text-start",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:a("connect-x-account.title","Connect your ð• account")}),(0,t.jsx)("p",{className:"text-xs text-secondary",children:o?a("connect-x-account.description-mobile","Unlock early features."):a("connect-x-account.description","Unlock early features and personalized content.")})]})]}),(0,t.jsx)(R.Button,{variant:"secondary",size:"sm",shape:"pill",className:"shrink-0",onClick:u,children:a("connect-x-account.cta","Connect")})]})})}var z=e.i(186679),B=e.i(111041);let G=(0,B.default)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var F=e.i(731791),O=e.i(723008),V=e.i(153377),U=e.i(258722),q=e.i(133735),H=e.i(555309),W=e.i(676452),K=e.i(398459);function Y(e){let{scrollContainerRef:i}=e,s=(0,U.useRoutingStore)(e=>e.push),{t:a}=(0,k.useTranslation)("chat"),n=(0,u.useFeatureFlags)(),r=(0,A.useLogEvent)(),o=(0,W.useHighlightsStore)(e=>e.stories),l=(0,W.useHighlightsStore)(e=>e.isLoading),d=(0,W.useHighlightsStore)(e=>e.nextCursor),c=(0,W.useHighlightsStore)(e=>e.hasStoryAnimated),m=(0,W.useHighlightsStore)(e=>e.accessDenied),p=(0,w.useRef)(!1),g=(0,w.useRef)(null),[x,f]=(0,w.useState)(new Set),v=(0,w.useCallback)(e=>{f(t=>new Set(t).add(e))},[]),[y,b]=(0,V.useSessionStorage)("highlights-hidden-session",!1),[j,N]=(0,w.useState)(()=>Math.max(window.innerHeight,600)),[S,I]=(0,w.useState)(!1);(0,w.useEffect)(()=>{let e=()=>{N(Math.max(window.innerHeight,600))};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let C=.05*j,E=.5*j,M=(0,w.useMemo)(()=>({pinned:{marginTop:C},hidden:{marginTop:E}}),[C,E]),T=(0,w.useCallback)(e=>{e&&(0,W.useHighlightsStore.getState().markStoryAnimated)(e)},[]),_=(0,w.useCallback)(()=>{var e;I(!0),b(!0),null==(e=i.current)||e.scrollTo({top:0,behavior:"smooth"}),r("highlights_hide_to_bottom",void 0,{location:"highlights-stories-list",storyCount:String(o.length)})},[b,i,r,o.length]),P=(0,w.useCallback)(()=>{var e;I(!0),b(!1),null==(e=i.current)||e.scrollTo({top:0,behavior:"smooth"}),r("highlights_pinned_to_home",void 0,{location:"highlights-stories-list",storyCount:String(o.length)})},[r,o.length,b,i]),L=(0,w.useCallback)(e=>{if(g.current&&g.current.disconnect(),!e)return;let t=i.current;g.current=new IntersectionObserver(e=>{let[t]=e;if(!t)return;let i=W.useHighlightsStore.getState();t.isIntersecting&&!p.current&&i.nextCursor&&!i.isLoading&&(p.current=!0,i.fetchMoreStories().catch((0,h.createLogError)("highlights-stories-list:loadMore")).finally(()=>{p.current=!1}))},{threshold:0,rootMargin:"0px 0px 500px 0px",...t&&{root:t}}),g.current.observe(e)},[i]);(0,w.useEffect)(()=>()=>{g.current&&g.current.disconnect()},[]);let D=(0,w.useCallback)(e=>{i.current&&U.useRoutingStore.getState().saveMainPageScrollPosition(i.current.scrollTop);let t=o.find(t=>t.storyId===e);s({page:(null==t?void 0:t.source)==="HIGHLIGHTS_SOURCE_PHOENIX"?"trends":"highlights",storyId:e})},[s,o,i]);if(m||0===o.length)return null;let B=y?E:C;return(0,t.jsxs)(H.motion.div,{variants:M,initial:{marginTop:B},animate:y?"hidden":"pinned",transition:S?{duration:.3,ease:"easeInOut"}:{duration:0},className:"w-full relative flex flex-col pb-2 max-w-[600px] mx-auto",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-1 ps-4",children:[(0,t.jsx)("h2",{className:"text-primary text-md font-semibold m-0",children:a("highlights-for-you","For You")}),n.ENABLE_HIGHLIGHTS_DISMISS_BUTTON&&(0,t.jsx)(t.Fragment,{children:y?(0,t.jsxs)(R.Button,{variant:"textsecondary",size:"sm",shape:"pill",className:"group rounded",onClick:P,"aria-label":a("highlights-pin-aria","Pin highlights to home"),children:[a("highlights-pin-button","Pin"),(0,t.jsx)(F.ArrowUp,{size:14,className:"absolute -right-1 opacity-0 group-hover:opacity-100 transition-opacity"})]}):(0,t.jsxs)(R.Button,{variant:"textsecondary",size:"sm",shape:"pill",className:"group",onClick:_,"aria-label":a("highlights-hide-aria","Hide highlights below page"),children:[a("highlights-hide-button","Hide"),(0,t.jsx)(G,{size:14,className:"absolute -right-1 opacity-0 group-hover:opacity-100 transition-opacity"})]})})]}),(0,t.jsx)(q.AnimatePresence,{children:o.filter(e=>!e.storyId||!x.has(e.storyId)).map(e=>{let i=e.storyId||"";return(0,t.jsx)("div",{className:"w-full",children:(0,t.jsx)(H.motion.div,{className:"w-full",initial:!c(i)&&{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},onAnimationComplete:()=>T(i),children:(0,t.jsx)(K.HighlightsStoryRow,{story:e,borderless:!0,onClick:D,mode:"minimal",onImageError:v})})},i)})}),(0,t.jsx)("div",{ref:L,className:"w-full h-1","aria-hidden":"true"}),l&&(0,t.jsx)(z.DelayedRender,{children:(0,t.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,t.jsx)(O.Spinner,{size:"sm"})})}),!l&&!d&&o.length>4&&(0,t.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,t.jsxs)(R.Button,{variant:"textsecondary",size:"sm",shape:"pill",onClick:()=>{var e;null==(e=i.current)||e.scrollTo({top:0,behavior:"smooth"})},"aria-label":a("scroll-to-top","Scroll to top"),children:[(0,t.jsx)(F.ArrowUp,{size:14}),a("to-top","Back to Top")]})})]})}var Q=e.i(796066),X=e.i(734317),J=e.i(165475),Z=e.i(511765),$=e.i(516129),ee=e.i(408430);e.i(988687);var et=e.i(605808),ei=e.i(10404);let es=0;function ea(e){let{persistentBanner:i=!1}=e,{user:s}=(0,r.useSession)(),{os:a}=(0,et.useOs)(),n=(0,A.useLogEvent)(),o=(0,L.useMobileSize)(),{push:l}=(0,x.useRouting)(),[d,c]=(0,Z.useLocalStorage)("visited-imagine2",!1),[u,m]=(0,Z.useLocalStorage)("imagine-banner-impressions2",0);(0,w.useEffect)(()=>{!i&&(Date.now()<es||(es=Date.now()+12e4,m(e=>e+1)))},[]);let{resolvedTheme:p}=(0,ee.useTheme)(),h=(0,w.useCallback)(e=>{e.stopPropagation(),n("imagine_banner_clicked","imagine-banner",{location:"imagine-banner"}),l({page:"imagine"})},[l,n]),g=(0,w.useCallback)(e=>{e.stopPropagation(),c(!0),n("imagine_banner_dismissed","imagine-banner",{location:"imagine-banner"})},[c,n]);(0,w.useEffect)(()=>{n("imagine_banner_impression","imagine-banner",{location:"imagine-banner"})},[]);let v=new URLSearchParams({return_to:"/imagine"}).toString(),y=(0,w.useCallback)(e=>{e.stopPropagation(),n("imagine_banner_clicked","imagine-banner",{location:"imagine-banner"}),n("sign_up_redirect",a,{location:"imagine-banner",os:a})},[n,a]),b=(0,w.useCallback)(e=>{e.stopPropagation(),n("imagine_banner_clicked","imagine-banner",{location:"imagine-banner"}),n("sign_in_redirect",a,{location:"imagine-banner",os:a})},[n,a]),{t:j}=(0,k.useTranslation)("imagine");return(0,t.jsxs)("div",{className:(0,f.cn)("relative dark max-w-[480px] w-full m-10",{"m-0 mb-24 mx-2":o}),children:[(0,t.jsxs)("div",{className:(0,f.cn)("flex dark flex-col items-center justify-center w-full rounded-3xl overflow-hidden  cursor-pointer bg-surface-l1 ",{"border-2 border-color-surface-l1":"dark"===p}),onClick:h,children:[(0,t.jsx)("div",{className:"relative w-full h-[110px] overflow-hidden",children:(0,t.jsx)(J.default,{priority:!0,quality:50,src:"/imagine-banner2.jpg",alt:j("imagine.banner.image.alt","Imagine promo banner image"),fetchPriority:"high",loading:"eager",fill:!0,className:"object-cover"})}),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between px-4 pt-0 pb-3 w-full",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,t.jsx)("p",{className:"dark text-primary text-sm font-bold m-0 p-0",children:j("imagine.banner_upgrades.title","Grok Imagine Upgrades")}),(0,t.jsx)(ei.NotificationBlip,{variant:"sm"})]}),(0,t.jsx)("p",{className:"dark text-fg-secondary text-sm m-0 p-0 ",children:j("imagine.banner_upgrades.subtitle","Generate videos with built-in audio - plus enhanced lifelike motion and character consistency")})]}),s&&(0,t.jsx)(R.Button,{variant:"secondary",shape:"pill",size:"md",className:"dark font-bold text-primary",onClick:h,children:j("imagine.banner_upgrades.button","Try Now")})]}),!s&&(0,t.jsxs)("div",{className:"flex flex-row gap-4 items-start justify-start mb-3",children:[(0,t.jsx)(R.Button,{className:"font-semibold text-sm",variant:"primary",size:"sm",shape:"pill",onClick:y,asChild:!0,children:(0,t.jsxs)($.default,{href:"/sign-up?"+v,children:[(0,t.jsx)(X.User,{size:14}),j("Sign up","Sign up")]})}),(0,t.jsx)(R.Button,{className:"font-semibold text-sm",variant:"secondary",size:"sm",shape:"pill",onClick:b,asChild:!0,children:(0,t.jsx)($.default,{href:"/sign-in?"+v,children:j("Sign in","Sign in")})})]})]}),!i&&(0,t.jsx)(R.Button,{variant:"tertiary",shape:"circle",size:"xs",className:"dark font-bold text-primary absolute -top-2 -end-2 bg-surface-l2 hover:bg-surface-l4",onClick:g,"aria-label":"Close",children:(0,t.jsx)(P.XIcon,{className:"size-4"})})]})}var en=e.i(230433),er=e.i(132841),eo=e.i(470753),el=e.i(840580);e.i(690654);var ed=e.i(129876);let ec=e=>{let{height:i,width:s}=e,{i18n:n}=(0,k.useTranslation)("chat"),{isSuperGrokUser:r,isSuperGrokProUser:o,organizationType:l,isEnterpriseUser:d}=(0,en.useSubscriptions)(),{currentTeam:c}=(0,ed.useEnterprise)(),{isSwitchingTeam:u}=(0,ed.useEnterprise)(),m=(0,er.useIsActiveGrokBusinessSession)(),p=(0,eo.useSettingsStore)(j.prop("selectedLanguage")),[h,g]=(0,w.useState)(0),x=(0,w.useMemo)(()=>p||n.languages.find(e=>e in el.supportedLocaleToLanguage)||el.globalLocale,[p,n.languages]),[f,v]=(0,w.useState)({isSuperGrokProUser:o,isSuperGrokUser:r,usingGrokBusiness:m,organizationType:l,isEnterpriseUser:d,currentTeam:c});(0,w.useEffect)(()=>{u||v(e=>(e.usingGrokBusiness!==m&&g(e=>e+1),{isSuperGrokProUser:o,isSuperGrokUser:r,usingGrokBusiness:m,isEnterpriseUser:d,organizationType:l,currentTeam:c}))},[o,r,m,d,l,c,u,v]);let y=(0,a.getLogo)({isSuperGrok:f.isSuperGrokUser,isSuperGrokPro:f.isSuperGrokProUser,isEnterprise:f.isEnterpriseUser,organizationType:f.organizationType,isTeamInSession:!!f.currentTeam,language:x});return(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:(0,t.jsx)(H.motion.div,{initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:(0,t.jsx)(y,{height:i,width:s})},"logo-".concat(h))})};var eu=e.i(559326),em=e.i(858649);let ep={duration:.15,ease:[.4,0,.2,1]},eh=e=>{let{className:i,variant:s,state:a="default",isConnecting:n=!1,onClick:r,onStartUsing:o}=e,{t:l}=(0,k.useTranslation)("base"),d="syncing"===a,c="complete"===a,{title:u,description:m,buttonText:p,buttonAction:h}=d?{title:l("connectors.google-drive.syncing-title","Syncing files..."),description:l("connectors.google-drive.syncing-description","You can start using them with Grok now. Some files may not be available until sync is complete."),buttonText:l("connectors.google-drive.ask-grok","Ask Grok"),buttonAction:o}:c?{title:l("connectors.google-drive.complete-title","Your files are ready!"),description:l("connectors.google-drive.all-complete-description","Grok can now search and reference your team and personal Google Drive files."),buttonText:l("connectors.google-drive.ask-grok","Ask Grok"),buttonAction:o}:"oauth"===s?{title:l("connectors.c.title","Team files are syncing..."),description:l("connectors.drive-oauth.description","Your admin enabled Google Drive to sync team files. \n Connect your Google account to add your personal files."),buttonText:l("connectors.connect","Connect"),buttonAction:r}:{title:l("connectors.google-drive.syncing-title","Syncing files..."),description:l("connectors.google-drive.syncing-description","You can start using your Google Drive files with Grok now. \n Some files may not be available until sync is complete.")};return(0,t.jsxs)(H.motion.div,{initial:{opacity:0,scale:.95,y:8},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-8},transition:{duration:.2,ease:[.4,0,.2,1]},className:(0,f.cn)("bg-surface-l1 border border-border-l1 rounded-2xl flex items-start p-3 pr-4 gap-3 w-full mx-auto max-w-[560px]",{"max-w-[420px]":!h},i),children:[(0,t.jsx)(H.motion.div,{animate:{backgroundColor:c?"rgba(34, 197, 94, 0.1)":"var(--surface-l2)"},transition:ep,className:(0,f.cn)("flex-shrink-0 size-7 rounded-full flex items-center justify-center",d&&!c&&"animate-pulse"),children:(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:c?(0,t.jsx)(H.motion.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.5},transition:ep,children:(0,t.jsx)(eu.Check,{className:"size-5 text-green-500"})},"check"):(0,t.jsx)(H.motion.div,{initial:{opacity:0,scale:.5},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.5},transition:ep,className:"flex items-center justify-center bg-surface/50 rounded-full p-2",children:(0,t.jsx)(em.GDriveIcon,{size:20})},"gdrive")})}),(0,t.jsx)("div",{className:"flex-1 min-w-0 overflow-hidden",children:(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:(0,t.jsxs)(H.motion.div,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},transition:ep,className:"space-y-0.5",children:[(0,t.jsx)("p",{className:"text-fg-primary font-semibold text-sm whitespace-pre-line",children:u}),(0,t.jsx)("p",{className:"text-fg-secondary text-sm whitespace-pre-line",children:m})]},a)})}),h&&(0,t.jsxs)(R.Button,{variant:"primary",size:"sm",shape:"pill",disabled:n,"aria-label":p,onClick:h,className:"relative flex-shrink-0 overflow-hidden self-center",children:[(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:(0,t.jsx)(H.motion.span,{initial:{opacity:0,y:4},animate:{opacity:+!n,y:0},exit:{opacity:0,y:-4},transition:ep,children:p},p)}),n&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)(O.Spinner,{size:"xs"})})]})]},"gdrive-card-".concat(s))};e.i(916390);var eg=e.i(364778);e.i(866166);var ex=e.i(924219);e.i(298616);var ef=e.i(111669),ev=e.i(910503),ey=e.i(534626),eb=e.i(93910),ej=e.i(259473);function ew(e){let{pageSize:t=60,orderBy:i="createTime"}=e,s=(0,r.useSession)(),a=(0,eb.useShareRoute)(),n=s.user,{currentTeam:o,isSwitchingTeam:l}=(0,ed.useEnterprise)(),{ASSET_SERVER_URL:d}=(0,_.useEnvironment)(),{data:c,isLoading:u}=(0,ev.useQuery)({queryKey:["team-members",null==o?void 0:o.teamId],enabled:!!(null==o?void 0:o.teamId),queryFn:async()=>(null==o?void 0:o.teamId)?eg.authMgmtApi.authManagementListUsers({teamId:o.teamId}).then(e=>{var t;return(null==(t=e.members)?void 0:t.filter(e=>{var t;return(null==(t=e.user)?void 0:t.userId)!==(null==n?void 0:n.userId)}))||[]}).catch(e=>((0,h.logError)("share-dialog:fetch-team-members",e),[])):[]}),m=(0,w.useMemo)(()=>{let e=new Map;return null==c||c.forEach(t=>{var i,s,a,n,r,o;e.set((null==(i=t.user)?void 0:i.userId)||"",{userId:(null==(s=t.user)?void 0:s.userId)||"",xUserId:(null==(a=t.user)?void 0:a.xUserId)||"",givenName:(null==(n=t.user)?void 0:n.givenName)||"",familyName:(null==(r=t.user)?void 0:r.familyName)||"",profileImageUrl:(0,ej.getAssetUrl)(d,null==(o=t.user)?void 0:o.profileImage)})}),e},[c,d]),p=(0,w.useRef)(null),g=(0,w.useRef)(null),[x,f]=(0,w.useState)(!1),[v,y]=(0,w.useState)(!1),b=(0,w.useCallback)(async e=>{let{pageParam:s}=e;if(!n)return{shareLinkResults:[],nextPageToken:void 0};let{shareLinks:a,nextPageToken:r}=await eg.chatApi.chatListShareLinks({sharedWithMe:!0,pageToken:"string"==typeof s?s:void 0,pageSize:t.toString(),orderBy:"createTime"===i?ex.ChatListShareLinksOrderByEnum.ListShareLinksOrderByCreateTime:"viewCount"===i?ex.ChatListShareLinksOrderByEnum.ListShareLinksOrderByViewCount:ex.ChatListShareLinksOrderByEnum.ListShareLinksOrderByInvalid});return{shareLinkResults:(null==a?void 0:a.map(e=>{var t;let{sharedLink:i,...s}=e;return{...s,conversation:(null==i?void 0:i.conversation)||null,response:(null==i||null==(t=i.responses)?void 0:t.find(t=>t.responseId===e.responseId))||null}}))||[],nextPageToken:r}},[n,t,i]),{data:j,fetchNextPage:k,hasNextPage:N,isFetchingNextPage:S,isFetching:I,isError:C,isLoading:E,refetch:M}=(0,ef.useInfiniteQuery)({queryKey:["share-links",null==n?void 0:n.userId,t,i],queryFn:b,initialPageParam:void 0,getNextPageParam:e=>e.nextPageToken,enabled:!!n&&!!(null==o?void 0:o.teamId)&&!l,staleTime:6e5,refetchOnWindowFocus:!0}),T=(0,w.useMemo)(()=>{var e;let t=(null==j||null==(e=j.pages.flatMap(e=>e.shareLinkResults))?void 0:e.filter(e=>!!e.shareLinkId))||[],s="createTime"===i?t.sort((e,t)=>new Date((null==t?void 0:t.createTime)||Date.now()).getTime()-new Date((null==e?void 0:e.createTime)||Date.now()).getTime()):t.sort((e,t)=>parseInt(t.viewCount||"0")-parseInt(e.viewCount||"0"));return ey.uniqBy(e=>null==e?void 0:e.shareLinkId,s).map(e=>({...e,user:(null==e?void 0:e.xaiUserId)?m.get(e.xaiUserId):void 0}))},[null==j?void 0:j.pages,m,i]),P=(0,w.useCallback)(e=>{let t=T.find(t=>t.shareLinkId===e);return(null==t?void 0:t.publicId)?a(t.publicId):a(e)},[T,a]),R=(0,w.useCallback)(e=>{window.location.href=P(e)},[P]);return(0,w.useEffect)(()=>{if(!(null==p?void 0:p.current)||!(null==g?void 0:g.current))return;let e=new IntersectionObserver(e=>{let[t]=e;t&&f(t.isIntersecting)},{root:g.current,rootMargin:"300px 0px 300px 0px",threshold:.1}),t=p.current;if(t)return e.observe(t),()=>{e.unobserve(t)}},[null==p?void 0:p.current,null==g?void 0:g.current]),(0,w.useLayoutEffect)(()=>{x&&N&&!S&&n&&!v&&(y(!0),k().catch(e=>(0,h.logError)("intersection-load-more",e)))},[x,N,S,k,n,v]),(0,w.useEffect)(()=>{if(v){let e=setTimeout(()=>{y(!1)},300);return()=>clearTimeout(e)}},[v]),{results:T,refetch:M,loadMoreRef:p,containerRef:g,isLoading:E,isFetching:I,isError:C,isLoadingTeamMembers:u,getShareLinkHref:P,handleNavigateToSharedConversation:R}}var ek=e.i(814248),eN=e.i(450551),eS=e.i(877390);function eI(e){let{children:i,isValidProp:s,...a}=e;s&&(0,eN.loadExternalIsValidProp)(s),(a={...(0,w.useContext)(ek.MotionConfigContext),...a}).isStatic=(0,eS.useConstant)(()=>a.isStatic);let n=(0,w.useMemo)(()=>a,[JSON.stringify(a.transition),a.transformPagePoint,a.reducedMotion]);return(0,t.jsx)(ek.MotionConfigContext.Provider,{value:n,children:i})}var eC=e.i(410289);let eE=e=>{let{className:i}=e,{t:s}=(0,k.useTranslation)("base"),{isSwitchingTeam:a}=(0,ed.useEnterprise)(),{results:n,isFetching:r,isError:o,isLoadingTeamMembers:l,handleNavigateToSharedConversation:d}=ew({pageSize:60,orderBy:"viewCount"}),c=(0,w.useMemo)(()=>r||a,[r,a]);return(0,t.jsx)(eI,{transition:{duration:.2,ease:"easeInOut"},children:(0,t.jsxs)("div",{className:(0,f.cn)("@container/shared-with-me w-full",i),children:[(0,t.jsxs)("div",{className:"px-4 flex justify-between items-center gap-3",children:[(0,t.jsx)("span",{className:"text-xs text-fg-secondary",children:s("team-insights.shared-with-me","Shared with me")}),(0,t.jsx)(x.Link,{route:{page:"history",tab:"shared-with-me"},className:"text-xs text-fg-tertiary hover:text-fg-secondary transition-all",children:s("team-insights.see-all","See all")})]}),o?(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center items-center mx-4 py-6 mt-4 border border-border-l1 rounded-2xl",children:(0,t.jsx)("span",{className:"text-fg-tertiary text-sm",children:s("team-insights.error-loading-data","Could not load data")})},"error"):(0,t.jsx)("div",{className:"px-4 mt-4 grid grid-cols-3 w-full gap-4",children:(0,t.jsx)(q.AnimatePresence,{initial:!1,children:Array.from({length:3}).map((e,i)=>{let s=n[i];return(0,t.jsx)(eM,{shareLink:s,isLoading:c,isLoadingTeamMembers:l,onClick:s?()=>d(s.shareLinkId):void 0},"shared-with-me-".concat(i))})})})]})})},eM=e=>{var i,s,a;let{shareLink:n,isLoading:r,isLoadingTeamMembers:o,onClick:l}=e,d=(0,w.useMemo)(()=>!r&&!n,[r,n]);return(0,t.jsxs)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:l,className:(0,f.cn)("p-3 flex flex-col gap-2 bg-surface-l1 border border-border-l1 rounded-2xl transition-colors relative",{"cursor-pointer hover:bg-surface-l2":!!n&&!r,"bg-transparent":d}),children:[(0,t.jsx)("div",{className:"h-5 flex items-center min-w-0",children:(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:r?(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(eC.Skeleton,{className:"h-2 w-20 rounded-sm"})},"loading"):n&&(0,t.jsx)(H.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-primary truncate",children:(null==(i=n.conversation)?void 0:i.title)||"Untitled Conversation"},"title")})}),(0,t.jsx)("div",{className:"h-4 flex items-center min-w-0 ",children:(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:r||o?(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(eC.Skeleton,{className:"h-2 w-16 rounded-sm"})},"loading-user"):n&&(0,t.jsx)(H.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-fg-secondary text-xs truncate",children:"".concat((null==n||null==(s=n.user)?void 0:s.givenName)||""," ").concat((null==n||null==(a=n.user)?void 0:a.familyName)||"")},"user")})}),(0,t.jsx)(q.AnimatePresence,{initial:!1,children:d&&(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:(0,f.cn)("absolute inset-0 flex justify-center items-center"),children:(0,t.jsx)("div",{className:"w-10 border-b border-border-l1"})},"empty-state")})]})};var eT=e.i(73978),e_=e.i(320738),eP=e.i(944408),eR=e.i(879085),eA=e.i(432286),eL=e.i(738416);function eD(e){return(0,eL.startOfDay)(Date.now(),e)}var ez=e.i(921127),eB=e.i(119470),eG=e.i(495794);function eF(e,t,i){return(0,eG.addMonths)(e,-t,i)}var eO=function(e){return e.PAST_30_DAYS="past-30-days",e.THIS_MONTH="this-month",e.THIS_YEAR="this-year",e.PAST_3_MONTHS="past-3-months",e.PAST_6_MONTHS="past-6-months",e}({});let eV=e=>{let{isError:i,title:s,timeRangeOptions:a,selectedTimeRange:n,onTimeRangeChange:r,children:o}=e,{t:l}=(0,k.useTranslation)("base"),[d,c]=(0,w.useState)(!1),u=(0,w.useCallback)(e=>{switch(e){case"past-30-days":return l("team-insights.time-range.past-30-days","Past 30 days");case"this-month":return l("team-insights.time-range.this-month","This month");case"this-year":return l("team-insights.time-range.this-year","This year");case"past-3-months":return l("team-insights.time-range.past-3-months","Past 3 months");case"past-6-months":return l("team-insights.time-range.past-6-months","Past 6 months")}},[l]),m=(0,w.useMemo)(()=>u(n),[n,u]);return(0,t.jsxs)("div",{className:"h-full flex flex-col",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-xs text-fg-secondary",children:s}),(null==a?void 0:a.length)?(0,t.jsxs)(eR.DropdownMenu,{open:d,onOpenChange:c,children:[(0,t.jsxs)(eR.DropdownMenuTrigger,{tabIndex:-1,"aria-label":l("team-insights.select-time-range","Select time range"),className:"text-xs text-fg-tertiary flex items-center gap-1 focus:outline-none",children:[(0,t.jsx)("span",{className:"whitespace-nowrap",children:m}),(0,t.jsx)(eP.ChevronDownIcon,{className:(0,f.cn)("size-3 text-fg-tertiary transition-transform",{"rotate-180":d})})]}),(0,t.jsx)(eR.DropdownMenuContent,{sideOffset:8,align:"end",className:"min-w-40",children:a.map(e=>(0,t.jsxs)(eR.DropdownMenuItem,{onSelect:()=>null==r?void 0:r(e),className:"flex items-center gap-2 justify-between",children:[(0,t.jsx)("span",{children:u(e)}),e===n&&(0,t.jsx)(e_.CheckIcon,{className:"text-fg-primary size-4"})]},e))})]}):(0,t.jsx)("span",{className:"text-xs text-fg-tertiary",children:m})]}),(0,t.jsx)("div",{className:"flex flex-col justify-between mt-3 w-full h-12",children:i?(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center items-center h-full border border-border-l1 rounded-2xl",children:(0,t.jsx)("span",{className:"text-fg-tertiary text-sm",children:l("team-insights.error-loading-data","Could not load data")})},"error"):o})]})},eU=e=>{switch(e){case"past-30-days":return(0,eB.subDays)(eD(),29).toISOString();case"this-month":return(0,eA.startOfMonth)(eD()).toISOString();case"this-year":return(0,ez.startOfYear)(eD()).toISOString();case"past-3-months":return(0,eA.startOfMonth)(eF(eD(),2)).toISOString();case"past-6-months":return(0,eA.startOfMonth)(eF(eD(),5)).toISOString()}};var eq=e.i(203857);let eH=()=>{let{t:e}=(0,k.useTranslation)("base"),{currentTeam:i,isSwitchingTeam:s}=(0,ed.useEnterprise)(),[a,n]=(0,Z.useLocalStorage)("team-insights.messages-counters-time-range",eO.THIS_MONTH),r=(0,w.useMemo)(()=>eU(a),[a]),{data:o,isFetching:l,isError:d}=(0,ev.useQuery)({queryKey:["team-stats",null==i?void 0:i.teamId,r],queryFn:async()=>eg.grokForTeamsApi.grokForTeamsGetTeamStats({fromTime:r,maxEntries:3}),enabled:!!(null==i?void 0:i.teamId)&&!s,staleTime:1/0}),c=(0,w.useMemo)(()=>l||s,[l,s]),u=(0,eq.useDebouncedValue)(c,300,[c]),m=(0,w.useMemo)(()=>[{count:parseInt(u?"0":(null==o?void 0:o.messageCount)||"0"),label:e("team-insights.you","You")},{count:parseInt(u?"0":(null==o?void 0:o.totalMessages)||"0"),label:e("team-insights.team","Team")}],[o,e,u]);return(0,t.jsx)(eV,{title:e("team-insights.messages","Messages"),timeRangeOptions:[eO.THIS_MONTH,eO.PAST_3_MONTHS,eO.PAST_6_MONTHS,eO.THIS_YEAR],selectedTimeRange:a,onTimeRangeChange:e=>n(e),isError:d,children:m.map((e,i)=>(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,t.jsx)("span",{className:"text-xs text-fg-secondary",children:e.label}),(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:c?(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-6 flex items-center justify-end",children:(0,t.jsx)(eC.Skeleton,{className:(0,f.cn)("h-2 w-10 rounded-sm",{"w-20":1===i})})},"loading"):(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"h-6",children:(0,t.jsx)(eT.default,{value:e.count,className:"text-sm font-semibold"})},"count")})]},e.label))})},eW=()=>{let{t:e}=(0,k.useTranslation)("base"),{currentTeam:i,isSwitchingTeam:s}=(0,ed.useEnterprise)(),[a,n]=(0,Z.useLocalStorage)("team-insights.sharing-leaderboard-time-range",eO.THIS_MONTH),r=(0,w.useMemo)(()=>eU(a),[a]),{data:o,isFetching:l,isError:d}=(0,ev.useQuery)({queryKey:["team-stats",null==i?void 0:i.teamId,r],queryFn:async()=>eg.grokForTeamsApi.grokForTeamsGetTeamStats({fromTime:r,maxEntries:3}),enabled:!!(null==i?void 0:i.teamId)&&!s,staleTime:1/0}),c=(0,w.useMemo)(()=>l||s,[l,s]),u=(0,w.useMemo)(()=>{var e,t;let i=Array.from({length:3}).map(()=>({name:" - ",shareLinkCount:0}));return[...(null==o||null==(t=o.topUsers)||null==(e=t.map(e=>{var t,i;return{name:"".concat(null==(t=e.user)?void 0:t.givenName," ").concat(null==(i=e.user)?void 0:i.familyName),shareLinkCount:parseInt(e.shareLinkCount||"0")}}))?void 0:e.sort((e,t)=>t.shareLinkCount-e.shareLinkCount))||[],...i].slice(0,3)},[o]);return(0,t.jsx)(eV,{title:e("team-insights.top-sharers","Top sharers"),timeRangeOptions:[eO.THIS_MONTH,eO.PAST_3_MONTHS,eO.PAST_6_MONTHS,eO.THIS_YEAR],selectedTimeRange:a,onTimeRangeChange:e=>n(e),isError:d,children:u.map((i,s)=>{let{name:a,shareLinkCount:n}=i;return(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 w-full h-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1 min-w-0",children:[(0,t.jsx)("span",{className:"text-fg-secondary text-[12px] w-3 text-start tabular-nums",children:s+1}),(0,t.jsx)(q.AnimatePresence,{initial:!1,mode:"wait",children:c?(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(eC.Skeleton,{className:"h-2 w-20 rounded-sm"})},"loading"):(0,t.jsx)(H.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-fg-primary text-xs truncate",children:a},"name")})]}),(0,t.jsx)(q.AnimatePresence,{initial:!1,mode:"wait",children:c?(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(eC.Skeleton,{className:"h-2 w-20 rounded-sm"})},"loading"):(0,t.jsx)(H.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-xs text-fg-tertiary whitespace-nowrap",children:e("team-insights.share-count",{count:n,defaultValue_one:"{{count}} shared",defaultValue_other:"{{count}} shared"})},"count")})]},"".concat(s,"-").concat(a))})})};var eK=e.i(355524),eY=e.i(103882);e.i(406151);var eQ=e.i(488842),eX=function(e){return e[e.NONE=0]="NONE",e[e.LOW=1]="LOW",e[e.MEDIUM=2]="MEDIUM",e[e.HIGH=3]="HIGH",e[e.VERY_HIGH=4]="VERY_HIGH",e}(eX||{});let eJ=()=>{let{t:e}=(0,k.useTranslation)("base"),{resolvedTheme:i}=(0,ee.useTheme)(),{currentTeam:s,isSwitchingTeam:a}=(0,ed.useEnterprise)(),n=(0,w.useMemo)(()=>eU(eO.PAST_30_DAYS),[]),{data:r,isLoading:o,isError:l}=(0,ev.useQuery)({queryKey:["team-stats",null==s?void 0:s.teamId,n],queryFn:async()=>eg.grokForTeamsApi.grokForTeamsGetTeamStats({fromTime:n,maxEntries:3}),enabled:!!(null==s?void 0:s.teamId)&&!a,staleTime:1/0}),d=(0,w.useMemo)(()=>{let e=Array.from({length:30}).map((e,t)=>{var i,s,a;let o=new Date(n);return o.setDate(o.getDate()+t),parseInt((null==r||null==(a=r.teamStats)||null==(s=a.stats)||null==(i=s.find(e=>e.startTime&&(0,eY.isSameDay)(e.startTime,o)))?void 0:i.totalMessages)||"0")}),t=e.filter(e=>e>0),i=[0,1,20,50];if(t.length>0){let e=[...t].sort((e,t)=>e-t),s=e[Math.floor(.25*e.length)]||1;i=[0,s,e[Math.floor(.5*e.length)]||1,e[Math.floor(.75*e.length)]||1]}return Array.from({length:30}).map((t,s)=>{let a=new Date(n);a.setDate(a.getDate()+s);let r=e[s]||0,o=0===r?0:r<=i[1]?1:r<=i[2]?2:r<=i[3]?3:4;return{date:a.toISOString(),totalMessages:r,colorLevel:o}})},[n,r]),c=(0,w.useMemo)(()=>o||a,[o,a]);return(0,t.jsx)(eV,{title:e("team-insights.team-usage","Team usage"),selectedTimeRange:eO.PAST_30_DAYS,isError:l,children:(0,t.jsx)("div",{className:"grid grid-cols-12 content-between w-full h-full max-w-[260px] place-items-stretch",children:d.map((s,a)=>(0,t.jsxs)(eK.Tooltip,{disableHoverableContent:!0,delayDuration:0,children:[(0,t.jsx)(eK.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("div",{className:(0,f.cn)("group w-full h-full flex items-center justify-center"),children:(0,t.jsx)("div",{className:(0,f.cn)("duration-200 transition-all",{"group-hover:scale-125":!c}),children:(0,t.jsx)("div",{className:(0,f.cn)("w-3 h-3 border border-border-l1 rounded-[4px] transition-all duration-500",{"animate-pulse":c}),style:{backgroundColor:eZ[i||"dark"][c?0:s.colorLevel],animationDelay:"".concat(.03*a,"s"),animationDuration:"1s"}})})})}),!c&&(0,t.jsx)(eK.TooltipContent,{children:(0,t.jsx)("span",{className:"text-xs",children:s.totalMessages?e("team-insights.day-with-activity",{date:(0,eQ.format)(s.date,"MMMM do"),count:s.totalMessages,defaultValue_one:"{{count}} message on {{date}}",defaultValue_other:"{{count}} messages on {{date}}"}):e("team-insights.day-without-activity","No activity on {{date}}",{date:(0,eQ.format)(s.date,"MMMM do")})})})]},s.date))})})},eZ={dark:{0:"#1D1E20",1:"#242628",2:"#3E3F41",3:"#57595B",4:"#B5B5B5"},light:{0:"#F3F3F1",1:"#BFBEBD",2:"#9F9E9D",3:"#646362",4:"#4B4A48"}},e$=e=>{let{className:i}=e;return(0,t.jsx)(eI,{transition:{duration:.2,ease:"easeInOut"},children:(0,t.jsx)("div",{className:(0,f.cn)("@container/team-insights w-full",i),children:(0,t.jsxs)("div",{className:"grid grid-cols-1 @[500px]/team-insights:grid-cols-2 @[700px]/team-insights:grid-cols-3 w-full",children:[(0,t.jsx)("div",{className:"hidden @[500px]/team-insights:block pl-4 pr-6",children:(0,t.jsx)(eJ,{})}),(0,t.jsxs)("div",{className:"hidden @[700px]/team-insights:block px-6 relative",children:[(0,t.jsx)(eH,{}),(0,t.jsx)("div",{className:"hidden @[500px]/team-insights:block absolute left-0 inset-y-1 border-l border-border-l1"})]}),(0,t.jsxs)("div",{className:"pr-4 pl-6 relative",children:[(0,t.jsx)(eW,{}),(0,t.jsx)("div",{className:"hidden @[500px]/team-insights:block absolute left-0 inset-y-1 border-l border-border-l1"})]})]})})})};var e0=e.i(407725),e1=e.i(815628);e.i(245242);var e2=e.i(127479),e5=e.i(233742),e4=e.i(441517),e3=e.i(969286),e6=e.i(735924),e8=e.i(194693),e9=e.i(840116),e7=e.i(859322),te=e.i(649717);let tt=e=>{let{title:i,description:s,onClick:a}=e,{t:n}=(0,k.useTranslation)("base");return(0,t.jsxs)("div",{className:"py-6 px-3 flex flex-col justify-center items-center gap-4",children:[(0,t.jsx)("div",{className:"size-10 bg-surface-l1 rounded-full flex justify-center items-center",children:(0,t.jsx)(te.TriangleAlert,{className:"size-5 text-fg-tertiary"})}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,t.jsx)("span",{className:"text-fg-primary text-sm font-semibold",children:i}),s&&(0,t.jsx)("span",{className:"text-fg-secondary text-sm",children:s})," "]}),(0,t.jsx)(R.Button,{size:"sm",shape:"rectangle",variant:"secondary",onClick:a,children:n("Retry","Retry")})]})};var ti=e.i(70872);let ts=e=>{let{value:i,onChange:s,isLoading:a,className:n}=e,{t:r}=(0,k.useTranslation)("base");return(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsx)(ti.Input,{autoFocus:!0,value:i,onChange:e=>{var t;s(null==(t=e.target)?void 0:t.value)},className:(0,f.cn)("bg-surface-l1 rounded-full h-11 px-9 text-base",n),placeholder:r("Search","Search")}),(0,t.jsx)(e4.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 size-4 text-fg-secondary"}),(0,t.jsx)(q.AnimatePresence,{children:a&&(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15},className:"absolute right-3 top-1/2 -translate-y-1/2",children:(0,t.jsx)(O.Spinner,{size:"xs"})},"spinner")})]})};var ta=e.i(147437);let tn=()=>{let{t:e}=(0,k.useTranslation)("base"),[i,s]=(0,w.useState)(""),[a,n]=(0,w.useState)(null),r=(0,w.useMemo)(()=>i.trim(),[i]),{results:o,isLoading:l,isDebouncing:d,isFetching:c,isError:u,refetch:m}=(0,e0.useListConversationTemplates)({pageSize:60,orderBy:e2.GrokForTeamsTemplatesListTemplatesOrderByEnum.ListTemplatesOrderByUsageCount,filter:e2.GrokForTeamsTemplatesListTemplatesFilterEnum.ListTemplatesFilterAll,query:r}),{startConversationWithTemplate:p}=(0,e1.useConversationTemplate)({templateId:a||null});return(0,t.jsxs)(ta.Command,{loop:!0,shouldFilter:!1,value:null!=a?a:"",onValueChange:n,className:"flex flex-col gap-2 w-80 h-full",children:[(0,t.jsx)(ta.Command.Input,{asChild:!0,children:(0,t.jsx)(ts,{value:i,onChange:s,isLoading:!!((l||c||d)&&r),className:"text-xs h-9 rounded-xl bg-transparent"})}),(0,t.jsxs)(ta.Command.List,{className:"flex-1 overflow-auto h-[var(--cmdk-list-height)] focus-visible:border-none",style:{scrollPaddingBlockStart:"8px",scrollPaddingBlockEnd:"8px"},children:[(0,t.jsx)(ta.Command.Empty,{className:"h-full flex items-center justify-center w-full py-8",children:u?(0,t.jsx)(tt,{title:e("templates.failed-to-load","Failed to load templates"),onClick:()=>m()}):(0,t.jsx)("div",{className:"p-5 text-center text-sm text-fg-secondary",children:e("templates.no-results","No templates found")})}),o.map(i=>(0,t.jsxs)(ta.Command.Item,{value:i.templateId,onSelect:()=>p(),className:(0,f.cn)("p-2 flex flex-col rounded-2xl transition-colors data-[selected=true]:!bg-surface-l2 cursor-pointer"),children:[(0,t.jsx)("div",{className:"text-sm text-fg-primary font-semibold truncate",children:i.templateName||e("templates.values.name.placeholder","New Template")}),(0,t.jsx)("div",{className:"text-sm text-fg-secondary truncate",children:i.templateDescription||e("templates.values.description.placeholder","Description")})]},i.templateId))]})]})},tr=(0,B.default)("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);var to=e.i(649898),tl=e.i(987916),td=e.i(884712);let tc=(0,B.default)("Megaphone",[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]]);var tu=e.i(25594),tm=e.i(742590),tm=tm,tp=e.i(653607),th=e.i(327877),tg=e.i(674259),tg=tg,tx=e.i(634134);let tf=(0,B.default)("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),tv=(0,B.default)("Earth",[["path",{d:"M21.54 15H17a2 2 0 0 0-2 2v4.54",key:"1djwo0"}],["path",{d:"M7 3.34V5a3 3 0 0 0 3 3a2 2 0 0 1 2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2c0-1.1.9-2 2-2h3.17",key:"1tzkfa"}],["path",{d:"M11 21.95V18a2 2 0 0 0-2-2a2 2 0 0 1-2-2v-1a2 2 0 0 0-2-2H2.05",key:"14pb5j"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),ty=(0,B.default)("Brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]]),tb=(0,B.default)("IdCard",[["path",{d:"M16 10h2",key:"8sgtl7"}],["path",{d:"M16 14h2",key:"epxaof"}],["path",{d:"M6.17 15a3 3 0 0 1 5.66 0",key:"n6f512"}],["circle",{cx:"9",cy:"11",r:"2",key:"yxgjnd"}],["rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",key:"qneu4z"}]]),tj=()=>({library:tw}),tw={sales:{label:"Sales",icon:tl.Briefcase,templates:[{name:"Lead Research & Prospect Profiling",icon:e4.Search,description:"Research a company and its industry to provide key executives, recent news, products/services, competitors, and potential pain points.",systemPrompt:"You are a sales intelligence analyst.\n\nResearch the company and industry provided by the user. Provide:\n\n1. **Key executives** and their roles (e.g., CEO, VP Sales)\n2. **Recent news** or funding rounds\n3. **Main products/services** and competitors\n4. **Potential pain points** based on public data (e.g., from their website, X, or news)\n\n---\n\n*Limit your response to 500 words and cite sources.*",inputGuidance:"Input the **company name** and the **industry**."},{name:"Competitive Analysis",icon:tr,description:"Compare a company's product with a competitor, highlighting features, pricing, strengths/weaknesses, and unique selling points.",systemPrompt:"Compare the company's product with `{competitor name}` for a client.\n\n## Highlight:\n\n1. **Feature-by-feature breakdown**\n2. **Pricing estimates** (if public)\n3. **Strengths and weaknesses** of each\n4. **Three unique selling points** for my product\n\n---\n\n*Use bullet points and base on the latest available data.*",inputGuidance:"Share the **product name**, **company name**, and **competitor name**."},{name:"Cold Email or Outreach Script Generation",icon:tp.Mail,description:"Generate a professional cold email outreach script with a clear CTA and subject line options.",systemPrompt:"Write a cold email outreach to:\n\n- **Prospect:** `[prospect name]`\n- **Title:** `[job title]`\n- **Company:** `[company name]`\n\nReference their recent `[specific event/news, e.g., funding round]`. Pitch my `[product/service]` as solving `[pain point]`.\n\n## Requirements:\n\n- Keep it **under 150 words**\n- Include a **clear CTA**\n- Make it **professional yet conversational**\n- Suggest **two subject line options**",inputGuidance:"Paste the **prospect name**, their **title**, **company name**, and the **product** you are trying to sell."},{name:"Objection Handling",icon:th.MessageCircle,description:"Provide empathetic rebuttals and follow-up questions for common sales objections.",systemPrompt:'As a sales coach, provide responses to these objections for selling the product mentioned by the user in the industry provided:\n\n## Objections to Address:\n\n1. *"It\'s too expensive"*\n2. *"We\'re happy with our current vendor"*\n3. `[Custom objection]`\n\n## For Each Objection, Provide:\n\n- **Empathetic rebuttal**\n- **Evidence** (e.g., ROI stats)\n- **Follow-up question**\n\n---\n\n*Format the output as a script.*',inputGuidance:"Paste the **product name** and your **industry**."}]},finance:{label:"Finance",icon:td.DollarSign,templates:[{name:"Financial Forecasting",icon:tm.default,description:"Forecast the next quarter's budget for a department based on key financial metrics.",systemPrompt:"Act as a financial analyst.\n\nUsing key metrics (e.g., revenue `$X`, expenses `$Y` from last quarter), forecast next quarter's budget for `[department]`.\n\n## Include:\n\n1. **Revenue projections**\n2. **Expense breakdowns**\n3. **Risk factors**\n\n---\n\n*Output results in a table with assumptions.*",inputGuidance:"Input the **company name** and **department name**."},{name:"Compliance & Risk Assessment",icon:tg.default,description:"Assess compliance and provide a gap analysis for a specific financial regulation.",systemPrompt:"Assess compliance for the regulation specified by the user within internal financial reporting.\n\n## Provide:\n\n1. **Key requirements**\n2. **Gap analysis** based on company information\n3. **Mitigation steps** (in a numbered list)",inputGuidance:"Input the **company name** and the **compliance regulation name**."}]},education:{label:"Education",icon:to.Book,templates:[{name:"Lesson Plans for Students",icon:tx.ClipboardList,description:"Create a detailed lesson plan tailored to a specific grade level and topic.",systemPrompt:"Create a lesson plan using this exact format and structure:\n\n## Lesson Specifications\n\n- **Grade Level:** Use the grade level provided by the user\n- **Topic or Objective:** Use the topic or objective provided by the user\n\n---\n\n## Required Output Format\n\n| Section | Description |\n|---------|-------------|\n| **Title** | Create an engaging lesson title |\n| **Objective** | Write a clear objective stating what students will be able to do |\n| **Assessment** | Describe specific assessment methods for evaluating objective achievement |\n| **Key Points** | List 4â€“6 bullet points covering essential concepts students need to learn |\n| **Opening** | Describe a specific hook activity and discussion to engage students |\n| **Introduction to New Material** | Explain how you'll teach the key concepts, provide examples, and address misconceptions |\n| **Guided Practice** | Describe group activities where students practice with teacher support |\n| **Independent Practice** | Describe individual work students will complete to demonstrate understanding |\n| **Closing** | Explain how students will share work and summarize key learning |\n| **Extension Activity** | Provide enrichment activities for early finishers or advanced learners |\n| **Homework** | Describe take-home assignments that reinforce the lesson |\n| **Standards Addressed** | List specific standards with codes and descriptions based on research |\n\n---\n\n## Requirements\n\n- Base all content on **standards research findings**\n- Incorporate any **additional guidance** from the user\n- Make the lesson **developmentally appropriate** for the grade level\n- Include **specific activities, questions, and examples**\n- Address **common misconceptions** identified in research\n- Ensure assessments **directly measure** the stated objective",inputGuidance:"Input the **grade level** and **topic or objective**."}]},hr:{label:"HR",icon:tu.UsersIcon,templates:[{name:"Job Description",icon:tb,description:"Generate a job description with interview questions and a recruitment strategy.",systemPrompt:"Research current market trends for the role in the specified industry.\n\nCreate a **compelling job description** that attracts top talent while highlighting the unique company culture.\n\n## Then:\n\n1. **Generate targeted interview questions** and assessment criteria\n2. **Create a comprehensive recruitment strategy** with sourcing channels and evaluation rubrics",inputGuidance:"Input the **role name**, **industry**, and **company name**."},{name:"Employee Engagement Survey",icon:tf,description:"Generate an employee engagement survey with actionable HR strategies.",systemPrompt:"Generate a new employee engagement survey with the number of questions specified by the user.\n\n## The Survey Should:\n\n- **Identify** satisfaction trends and improvement areas\n- **Include** actionable HR strategies\n- **Outline** implementation timelines (e.g., in a presentation format)",inputGuidance:"Input the **number of questions** and specify for **which roles**."}]},marketing:{label:"Marketing",icon:tc,templates:[{name:"Market Research",icon:tv,description:"Generate a detailed market research report for a specific product and region.",systemPrompt:"Generate a concise market research report in markdown format covering:\n\n## Report Sections\n\n1. **Executive Summary**\n2. **Historical Industry Size** (past timeframe)\n3. **Future Growth Projections** (next timeframe)\n4. **Competitive Landscape**\n5. **Entry Strategies** for the product/service, focusing on the specified aspect in the target market and region\n6. **Riskâ€“Reward Analysis** (use a table for risks vs. rewards)\n7. **Go-to-Market Recommendations**\n\n---\n\n## Guidelines\n\n- Substantiate data with **web searches** for stats/trends from diverse sources\n- Keep it **balanced, actionable, around 1,500 words**\n- End with **KPIs/next steps**",inputGuidance:"Provide **target market**, **region**, **product/service**, **specific aspect**, and **timeframe**."}]},research:{label:"Research",icon:e4.Search,templates:[{name:"Propensity Modeling",icon:ty,description:"Build a churn prediction model using public data and optional integrations.",systemPrompt:"Your objective is to build a highly accurate, robust, and generalizable **churn prediction model** for the customer mentioned.\n\nYou have access to publicly available socioeconomic, firmographic, mobility, and personalization data.\n\n## Steps\n\n1. **Research** the company's business model\n2. **Identify** key data that influence churn probability\n3. **Use data science techniques** to train and evaluate the model\n4. If integrations such as *Gong* already provide churn prediction models, **leverage them** as input scores\n\n---\n\n*Provide a structured explanation of your modeling approach.*",inputGuidance:"Input the **customer name**."}]}};var tk=e.i(575179),tN=e.i(887510),tS=e.i(263484);let tI=e=>{if(!e)return null;let t=(0,tN.getTimeRangeFromTimestamp)(e),i=new Date(e);if("this-year"===t)return i.toLocaleDateString(tk.default.language,{day:"numeric",month:"short"});{if("older"===t)return i.toLocaleDateString(tk.default.language,{day:"numeric",month:"short",year:"numeric"});let s=(0,tS.intlFormatDistance)(e,new Date,{unit:"day",locale:"en"}),a="day";return"today"===s&&(a=void 0),"yesterday"===s&&(a="hour"),(0,tS.intlFormatDistance)(e,new Date,{unit:a,locale:tk.default.language})}},tC=e=>{let{templateCount:i=3,className:s}=e,{t:a}=(0,k.useTranslation)("base"),{push:n}=(0,x.useRouting)(),r=(0,e6.useQueryClient)(),[o,l]=(0,w.useState)(!1),[d,c]=(0,w.useState)(!1),{shouldShow:u,dismiss:m}=(0,e8.useTourGuideTooltip)({tooltipId:"templates"}),{library:p}=tj(),h=(0,w.useMemo)(()=>Object.values(p).flatMap(e=>e.templates),[p]),{results:g,isError:v,isLoading:y}=(0,e0.useListConversationTemplates)({orderBy:e2.GrokForTeamsTemplatesListTemplatesOrderByEnum.ListTemplatesOrderByUsageCount,filter:e2.GrokForTeamsTemplatesListTemplatesFilterEnum.ListTemplatesFilterAll,pageSize:i}),{mutate:b,isPending:j}=(0,e3.useMutation)({mutationFn:e=>eg.grokForTeamsApi.grokForTeamsTemplatesCreateTemplate({body:e})}),S=(0,w.useCallback)(e=>{let{templateName:t,templateDescription:i,inputGuidance:s,systemPrompt:o,assets:l,redirect:d}=e;if(!j)return m(),b({templateName:t||"",templateDescription:i||"",inputGuidance:s||"",systemPrompt:o||"",assets:l||[],sharedWithTeam:!1},{onSuccess:e=>{let{template:t}=e;if(t&&t.templateId)return"start-conversation"===d?n({page:"main",templateId:t.templateId}):"template-form"===d&&n({page:"templates",tab:"personal",templateId:t.templateId}),r.invalidateQueries({queryKey:(0,e0.getConversationTemplatesQueryKey)({})})},onError:()=>{N.toast.error(a("templates.failed-to-create-template","Failed to create template"))}})},[n,b,r,a,j,m]);return(0,t.jsx)(eI,{transition:{duration:.2,ease:"easeInOut"},children:(0,t.jsxs)("div",{className:(0,f.cn)("@container/template-widget w-full",s),children:[(0,t.jsxs)("div",{className:"px-4 flex justify-between items-center gap-3",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,t.jsx)(e9.TourGuideBubble,{shouldShow:u,onDismiss:m,title:a("templates.guide-tooltip.title","Templates"),description:a("templates.guide-tooltip.description","Use templates to turn prompts into reusable starting points, making recurring tasks faster and more consistent."),badgeText:a("templates.guide-tooltip.new","new"),tooltipContentProps:{side:"right",sideOffset:4},children:(0,t.jsx)("div",{className:"text-base font-semibold text-fg-primary",children:a("templates.title","Templates")})}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsxs)(e7.Popover,{open:o,onOpenChange:l,children:[(0,t.jsx)(e7.PopoverTrigger,{asChild:!0,children:(0,t.jsx)(R.Button,{size:"xs",variant:"textsecondary",shape:"circle",tabIndex:0,"aria-label":a("templates.search","Search templates"),className:(0,f.cn)("focus-visible:ring-2 focus-visible:ring-ring",o&&"text-fg-primary"),children:(0,t.jsx)(e4.Search,{size:18})})}),(0,t.jsx)(e7.PopoverContent,{align:"start",side:"bottom",sideOffset:8,className:"p-1.5 h-[340px]",children:(0,t.jsx)(tn,{})})]}),(0,t.jsx)(tM,{open:d,onOpenChange:c,onCustomTemplateSelect:()=>S({redirect:"template-form"}),onPresetTemplateSelect:e=>S({templateName:e.templateName,templateDescription:e.templateDescription,inputGuidance:e.inputGuidance,systemPrompt:e.systemPrompt,redirect:"template-form"}),children:(0,t.jsx)(R.Button,{size:"xs",variant:"textsecondary",shape:"circle","aria-label":a("templates.create","Create template"),className:(0,f.cn)("focus-visible:ring-2 focus-visible:ring-ring",d&&"text-fg-primary"),children:(0,t.jsx)(e5.Plus,{size:18})})})]})]}),(0,t.jsx)(x.Link,{onClick:m,route:{page:"templates",tab:"personal"},className:(0,f.cn)("text-sm text-fg-tertiary font-semibold hover:text-fg-secondary","transition-all outline-none rounded-lg px-2 py-1 -m-2","focus-visible:ring-2 focus-visible:ring-ring"),children:a("templates.see-all","See all")})]}),v?(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center items-center mx-4 py-6 mt-4 border border-border-l1 rounded-2xl",children:(0,t.jsx)("span",{className:"text-fg-tertiary text-sm",children:a("templates.failed-to-load","Failed to load templates")})},"error"):y||g.length?(0,t.jsx)("div",{className:"px-4 mt-4 grid grid-cols-1 @sm/template-widget:grid-cols-3 w-full gap-2",children:(0,t.jsx)(q.AnimatePresence,{initial:!1,children:Array.from({length:i}).map((e,i)=>{let s=g[i];return(0,t.jsx)(tE,{template:s,isLoading:y,onCustomTemplateSelect:()=>S({redirect:"template-form"}),onPresetTemplateSelect:e=>S({templateName:e.templateName,templateDescription:e.templateDescription,inputGuidance:e.inputGuidance,systemPrompt:e.systemPrompt,redirect:"template-form"})},"template-".concat(i))})})}):(0,t.jsxs)("div",{className:"rounded-2xl border border-border-l1 flex flex-col justify-center items-center gap-4 p-6 mt-4",children:[(0,t.jsx)("div",{className:"text-sm text-fg-secondary font-semibold",children:a("templates.try-preset-templates","Try these templates")}),(0,t.jsxs)("div",{className:"flex items-center justify-center flex-wrap gap-3 max-w-lg",children:[h.slice(0,i).map(e=>(0,t.jsx)("button",{onClick:()=>S({templateName:e.name,templateDescription:e.description,inputGuidance:e.inputGuidance,systemPrompt:e.systemPrompt,redirect:"start-conversation"}),className:(0,f.cn)("px-3 py-1.5 rounded-full bg-surface-l1 border border-border-l1","hover:bg-surface-l2 transition-colors cursor-pointer","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"),children:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(e.icon,{size:16,className:"text-fg-secondary"}),(0,t.jsx)("span",{className:"text-fg-primary font-semibold text-sm truncate",children:e.name})]})},e.name)),(0,t.jsxs)(R.Button,{variant:"secondary",size:"sm",shape:"pill",onClick:()=>S({redirect:"template-form"}),children:[(0,t.jsx)(e5.Plus,{size:18,className:"-ml-0.5"}),a("templates.add-new","Add")]})]})]})]})})},tE=e=>{let{template:i,isLoading:s,onCustomTemplateSelect:a,onPresetTemplateSelect:n}=e,{t:o}=(0,k.useTranslation)("base"),{user:l}=(0,r.useSession)(),[d,c]=(0,w.useState)(!1),{startConversationWithTemplate:u}=(0,e1.useConversationTemplate)({templateId:(null==i?void 0:i.templateId)||null}),m=(0,w.useMemo)(()=>!s&&!i,[s,i]),p=(0,w.useCallback)(e=>{m&&c(e)},[m]),h=(0,w.useCallback)(()=>{i&&!s&&u()},[i,s,u]),g=(0,w.useCallback)(e=>{("Enter"===e.key||" "===e.key)&&i&&!s&&(e.preventDefault(),u())},[i,s,u]);return(0,t.jsx)(tM,{open:d,onOpenChange:p,disabled:!m,onCustomTemplateSelect:a,onPresetTemplateSelect:n,children:(0,t.jsxs)(H.motion.button,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:h,onKeyDown:g,"aria-label":i?o("templates.start-conversation-with","Start conversation with {{name}}",{name:i.templateName||o("templates.values.name.placeholder","New Template")}):o("templates.create","Create template"),className:(0,f.cn)("group px-4 py-3 flex flex-col gap-1 bg-surface-l1 border border-border-l1","rounded-2xl transition-colors relative outline-none","focus-visible:ring-2 focus-visible:ring-ring",{"cursor-pointer hover:bg-surface-l2":!s,"bg-transparent":m,"bg-surface-l2":d}),children:[(0,t.jsx)("div",{className:"h-5 flex items-center min-w-0",children:(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:s?(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(eC.Skeleton,{className:"h-3 w-40 rounded-sm"})},"loading-name"):i&&(0,t.jsxs)(eK.Tooltip,{children:[(0,t.jsx)(eK.TooltipTrigger,{asChild:!0,children:(0,t.jsx)(H.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-primary font-semibold truncate",children:i.templateName||o("templates.values.name.placeholder","New Template")},"title")}),(0,t.jsx)(eK.TooltipContent,{side:"top",align:"center",children:i.templateName||o("templates.values.name.placeholder","New Template")})]})})}),(0,t.jsx)("div",{className:"h-4 flex items-center min-w-0 ",children:(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:s?(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,t.jsx)(eC.Skeleton,{className:"h-3 w-24 rounded-sm"})},"loading-description"):i&&(0,t.jsxs)(H.motion.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-fg-secondary text-xs truncate",children:[i.modifyTime&&o("templates.last-edited","Edited {{time}}",{time:tI(i.modifyTime)}),(null==i?void 0:i.userId)&&(null==i?void 0:i.userId)!==(null==l?void 0:l.userId)&&" Â· ".concat(o("templates.shared","Shared"))]},"description")})}),(0,t.jsx)(q.AnimatePresence,{initial:!1,children:m&&(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:(0,f.cn)("absolute inset-0 flex justify-center items-center"),children:(0,t.jsx)(e5.Plus,{size:20,className:(0,f.cn)("opacity-25 group-hover:opacity-50 transition-opacity",{"opacity-50":d})})},"empty-state")}),m&&(0,t.jsx)("span",{className:"sr-only",children:o("templates.values.name.placeholder","New Template")})]})})},tM=e=>{let{children:i,disabled:s,open:a,onOpenChange:n,onCustomTemplateSelect:r,onPresetTemplateSelect:o}=e,{t:l}=(0,k.useTranslation)("templates"),{library:d}=tj(),c=(0,w.useMemo)(()=>Object.values(d).flatMap(e=>e.templates).filter(e=>!!(null==e?void 0:e.name)),[d]);return(0,t.jsxs)(eR.DropdownMenu,{open:a,onOpenChange:n,children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:i}),!s&&(0,t.jsxs)(eR.DropdownMenuContent,{align:"start",sideOffset:8,children:[(0,t.jsxs)(eR.DropdownMenuItem,{className:"flex items-center gap-2",onSelect:r,children:[(0,t.jsx)(e5.Plus,{size:16,className:"text-secondary flex-shrink-0"}),(0,t.jsx)("p",{children:l("templates.custom-template","Custom Template")})]}),c.map(e=>(0,t.jsxs)(eR.DropdownMenuItem,{className:"flex items-center gap-2",onSelect:()=>null==o?void 0:o({templateName:e.name,templateDescription:e.description,inputGuidance:e.inputGuidance,systemPrompt:e.systemPrompt}),children:[(0,t.jsx)(e.icon,{size:16,className:"text-secondary flex-shrink-0"}),(0,t.jsx)("p",{children:e.name})]},e.name))]})]})};var tT=e.i(826921),t_=e.i(655890),tP=e.i(557560),tR=e.i(169683),tA=e.i(493845),tL=e.i(235289),tD=e.i(798045),tz=e.i(371842),tB=e.i(745322),tG=e.i(315302),tF=e.i(660168),tO=e.i(122088),tV=e.i(243634),tU=e.i(334172),tq=e.i(805546);let tH={7:"grok-4-mini-thinking-tahoe",8:"grok-4-1-non-thinking-w-tool"};var tW=e.i(369699),tK=e.i(295451),tY=e.i(688578);e.i(49854);var tQ=e.i(304902),tX=e.i(785239);e.i(410172);var tJ=e.i(248956),tZ=e.i(910901),t$=e.i(246429),t0=e.i(298438),t1=e.i(775175),t2=e.i(333309),t5=e.i(351958),t4=e.i(297473),t3=e.i(137278);function t6(){let e=(0,A.useLogEvent)(),i=(0,t$.useChatPageStore)(e=>e.projectId),s=(0,t$.useChatPageStore)(e=>e.setProjectId),a=(0,t3.useWorkspaceStore)(e=>e.ensureWorkspace),{t:n}=(0,k.useTranslation)("base");(0,w.useEffect)(()=>{a(U.DEEP_SEARCH_PROJECT_ID)},[a]);let r=(0,w.useCallback)(()=>{e("deepsearch_pill_clicked",void 0,{location:"deepsearch-suggestion-pill",target:"chip"}),s(i===U.DEEP_SEARCH_PROJECT_ID?void 0:U.DEEP_SEARCH_PROJECT_ID)},[e,i,s]);return(0,t.jsxs)(R.Button,{variant:"secondary",size:"md",shape:"pill",onClick:r,children:[(0,t.jsx)(t4.DeepSearchIcon,{size:16,strokeWidth:2,className:"text-secondary"}),n("deep-search","DeepSearch")]})}var t8=e.i(979566),t9=e.i(7390),t7=e.i(567488),ie=e.i(338363);function it(){let{exampleProjects:e}=(0,t7.useExampleProjects)(),{t:i}=(0,k.useTranslation)("base"),[s,a]=(0,w.useState)(!1),n=(0,x.useRouting)(),r=function(){let{t:e}=(0,k.useTranslation)("base"),t=(0,u.useFeatureFlags)();return(0,w.useMemo)(()=>{switch(t.TRY_PROJECTS_NAME.value){case"explore-grok":return e("explore-grok","Explore Grok");case"try-demos":return e("try-demos","Try Demos");case"pick-personas":return e("pick-personas","Pick Personas");case"browse-ais":return e("browse-ais","Browse AIs");default:return e("try-projects","Try Projects")}},[t.TRY_PROJECTS_NAME.value,e])}(),o=(0,w.useCallback)(e=>{a(e)},[]),l=(0,w.useCallback)(e=>{a(!1),n.push({page:"workspace",workspaceId:e.workspaceId})},[n]),d=(0,w.useCallback)(()=>{let e=t3.useWorkspaceStore.getState();e.setCreateDialogInitialValues("","",""),e.setCreateDialogIsOpen(!0)},[]),c=(0,w.useCallback)(()=>{n.push({page:"workspaces"})},[n]);return(0,t.jsxs)(eR.DropdownMenu,{open:s,onOpenChange:o,children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(R.Button,{variant:"secondary",size:"md",shape:"pill",children:[(0,t.jsx)(t8.FolderIcon,{size:16,strokeWidth:2,className:"text-secondary"}),r,(0,t.jsx)(eP.ChevronDownIcon,{size:12,strokeWidth:2,className:(0,f.cn)("text-secondary transition-transform duration-200",{"rotate-180":s})})]})}),(0,t.jsxs)(eR.DropdownMenuContent,{children:[e.map(e=>(0,t.jsxs)(eR.DropdownMenuItem,{className:"flex items-center gap-2",onClick:()=>l(e),children:[(0,t.jsx)(ie.WorkspaceIconView,{icon:e.icon}),(0,t.jsx)("p",{children:e.title})]},e.workspaceId)),(0,t.jsxs)(eR.DropdownMenuItem,{onClick:d,children:[(0,t.jsx)(t9.PlusIcon,{size:16,className:"me-2 text-secondary"}),i("create-project","Create Project")]}),(0,t.jsxs)(eR.DropdownMenuItem,{onClick:c,children:[(0,t.jsx)(t8.FolderIcon,{size:16,className:"me-2 text-secondary"}),i("view-all-projects","View All Projects")]})]})]})}function ii(e){let{handleSend:i}=e,s=(0,u.useFeatureFlags)(),{data:{enableImagine:a}={}}=(0,tB.useFeatureControls)(),n=(0,eo.useSettingsStore)(j.prop("isIncognito")),{exampleProjects:r}=(0,t7.useExampleProjects)(),o=r.length>0,l=s.ENABLE_VOICE_MODE;return(0,t.jsx)("div",{className:"flex flex-col gap-2",children:(0,t.jsxs)("div",{className:"flex flex-row flex-wrap w-full gap-2 @sm:gap-2 justify-center items-center",children:[(0,t.jsx)(t6,{}),a&&(0,t.jsx)(is,{}),!n&&!1,o?(0,t.jsx)(it,{}):(0,t.jsx)(tA.LatestNewsPersona,{handleSend:i}),l?(0,t.jsx)(ia,{}):(0,t.jsx)(tA.PersonaPills,{handleSend:i})]})})}function is(){let{push:e}=(0,x.useRouting)(),{t:i}=(0,k.useTranslation)("base");return(0,t.jsxs)(R.Button,{size:"md",variant:"secondary",shape:"pill",onClick:()=>{e({page:"imagine"})},children:[(0,t.jsx)(t5.ImagePlusIcon,{size:16,strokeWidth:2,className:"text-secondary"}),i("create-image","Create Image")]})}function ia(){let{t:e}=(0,k.useTranslation)("chat"),{handleVoiceModeEnter:i}=(0,tD.useVoiceMode)({location:"voice-mode-pill"});return(0,t.jsxs)(R.Button,{size:"md",variant:"secondary",shape:"pill",onClick:i,children:[(0,t.jsx)(t2.AudioLinesIcon,{size:16,strokeWidth:2,className:"text-secondary"}),e("voice-mode-pill.label","Voice")]})}var ir=e.i(257239);let io=(0,B.default)("AlarmClockCheck",[["circle",{cx:"12",cy:"13",r:"8",key:"3y4lt7"}],["path",{d:"M5 3 2 6",key:"18tl5t"}],["path",{d:"m22 6-3-3",key:"1opdir"}],["path",{d:"M6.38 18.7 4 21",key:"17xu3x"}],["path",{d:"M17.64 18.67 20 21",key:"kv2oe2"}],["path",{d:"m9 13 2 2 4-4",key:"6343dt"}]]);var il=e.i(472840),id=e.i(279231),ic=e.i(852640);let iu=e=>{let{onHide:i}=e,s=(0,A.useLogEvent)(),a=(0,L.useMobileSize)(),{t:n}=(0,k.useTranslation)("tasks"),{taskPresets:r}=(0,ir.useTaskPresets)(),l=(0,tX.useTasksStore)(j.prop("setCreateDialogIsOpen")),d=(0,tX.useTasksStore)(j.prop("setTaskToEdit")),[c,u]=(0,w.useState)(ip(r)[0]),m=(0,w.useCallback)(()=>{s("task_preset_clicked",void 0,{location:"PresetTaskPill"}),l(!0),d(c)},[c,l,d,s]),p=(0,w.useCallback)(e=>{s("task_preset_clicked",void 0,{location:"PresetTaskPill"}),l(!0),d(e),u(e)},[l,d,s]);return c?(0,t.jsxs)("div",{className:"flex items-center gap-2 w-full justify-center",children:[(0,t.jsxs)("div",{className:(0,f.cn)("rounded-3xl p-3 bg-surface-l1 border text-xs flex items-center justify-between",{"min-w-[500px]":!a}),children:[(0,t.jsx)(im,{value:c,onValueChange:p}),(0,t.jsxs)(o.Button,{variant:"filledSecondary",size:"sm",rounded:!0,onClick:m,className:"font-semibold",children:[(0,t.jsx)(io,{size:14}),a?n("create-custom-task-dialog.schedule-task-short","Schedule"):n("create-custom-task-dialog.schedule-task","Schedule Task")]})]}),(0,t.jsx)(o.ButtonWithTooltip,{tooltipContent:(0,t.jsx)("p",{children:n("create-custom-task-dialog.schedule-task-hide","Hide")}),tooltipContentProps:{side:"bottom"},variant:"filledSecondary",size:"iconMd",rounded:!0,"aria-label":n("create-custom-task-dialog.schedule-task-hide","Hide"),onClick:i,children:(0,t.jsx)(ic.X,{size:14})})]}):null};function im(e){let{value:i,onValueChange:s}=e,[a,n]=(0,w.useState)(!1),{taskPresets:r}=(0,ir.useTaskPresets)(),{t:l}=(0,k.useTranslation)("tasks"),d=(0,L.useMobileSize)(),c=(0,w.useCallback)(e=>{n(e)},[]);return(0,t.jsxs)(eR.DropdownMenu,{open:a,onOpenChange:c,children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(o.Button,{className:"flex items-center font-semibold",variant:"text","aria-label":l("selected-day.label","Selected day"),size:"sm",children:[i.cta||i.name,(0,t.jsx)(il.ChevronDown,{size:14,className:(0,f.cn)("transition-transform duration-200",{"rotate-180":a})})]})}),(0,t.jsx)(eR.DropdownMenuContent,{side:"bottom",align:"start",sideOffset:20,alignOffset:-12,className:(0,f.cn)({"w-[500px]":!d}),children:ip(r).map(e=>(0,t.jsxs)(eR.DropdownMenuItem,{onSelect:()=>{s(e)},className:"group flex items-center justify-between gap-2",children:[e.name,(0,t.jsx)(id.ChevronRight,{size:14,className:"opacity-0 group-hover:opacity-100"})]},e.name))})]})}function ip(e){for(let t=e.length-1;t>0;t--){let i=Math.floor(Math.random()*(t+1)),s=e[t],a=e[i];if(void 0===s||void 0===a)throw Error("shuffleArray: Unexpected undefined value");e[t]=a,e[i]=s}return e}var ih=e.i(824027),ig=e.i(383783),ig=ig,ix=e.i(895836),iv=e.i(687712);let iy=()=>{let e=(0,u.useFeatureFlags)(),{t:i}=(0,k.useTranslation)("upsell"),s=(0,L.useMobileSize)(),a=e.GROK_HOME_BANNER_ID.get("id"),n=e.GROK_HOME_BANNER_ID.get("video")||void 0,r=e.GROK_HOME_BANNER_ID.get("next_image")||void 0,l=e.GROK_HOME_BANNER_ID.get("image")||void 0,d=e.GROK_HOME_BANNER_ID.get("full_announcement_url")||void 0,c=e.GROK_HOME_BANNER_ID.get("try_now_model")||void 0,[m,p]=(0,Z.useLocalStorage)("grok-promotion-dialog-id".concat(a),!0),[h,g]=(0,w.useState)(!0),{models:x,unavailableModels:v}=(0,tV.useModels)(),y=v.find(e=>e.modelMode===(0,t$.modelModeToModelConfigModelMode)(c)),b=x.find(e=>e.modelMode===(0,t$.modelModeToModelConfigModelMode)(c)),[j,N]=(0,w.useState)(!1);(!b||y)&&(c=void 0);let S=(0,w.useCallback)(()=>{p(!1),g(!1)},[p]);(0,w.useEffect)(()=>{let e=e=>{"Escape"===e.key&&S()},t=e=>{e.target instanceof HTMLElement&&e.target.closest("#grok-home-promotion-dialog-content")||S()};return window.addEventListener("click",t),window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e),window.removeEventListener("click",t)}},[S]);let I={title:i("Introducing Grok 4.1","Introducing Grok 4.1"),description:i("meet-grok-4-1-description","The latest version of Grok delivers more concise and effective answers with improved presentation and intelligence per token."),nextImage:r,image:l,video:n,actions:[d?(0,t.jsxs)(o.Button,{variant:"outline",rounded:!0,"aria-label":i("Read full announcement","Read full announcement"),onClick:e=>{e.stopPropagation(),window.open(d,"_blank")},className:"font-medium",children:[(0,t.jsx)(ix.ExternalLink,{size:16}),i("Read full announcement","Read full announcement")]},"read-announcement"):null,c&&b?(0,t.jsxs)(o.Button,{variant:"primary",rounded:!0,"aria-label":i("Try Now","Try Now"),onClick:()=>{if(c&&b){let e=t$.useChatPageStore.getState();e.setModelMode(c),e.setActiveModelId(b.modelId),S()}},className:"font-semibold",children:[(0,t.jsx)(ig.default,{size:16}),i("Try Now","Try Now")]},"try-grok-4-1"):null]};return(0,t.jsxs)(iv.Dialog,{open:m&&h,children:[(0,t.jsx)(iv.DialogHeader,{children:(0,t.jsx)(iv.DialogTitle,{})}),(0,t.jsxs)(iv.DialogContent,{id:"grok-home-promotion-dialog-content",className:(0,f.cn)("p-3 rounded-3xl border border-border-l1 flex flex-col gap-0 items-center outline-none"),children:[(0,t.jsx)("div",{className:(0,f.cn)("relative overflow-hidden",s?"w-[90vw]":"min-h-[400px] min-w-[900px] h-[80%]"),children:(0,t.jsx)(q.AnimatePresence,{initial:!1,children:(0,t.jsx)(H.motion.div,{initial:"enter",animate:"center",exit:"exit",transition:{x:{type:"spring",stiffness:300,damping:40},opacity:{duration:.2}},className:"rounded-2xl overflow-hidden",children:I.video?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("video",{onWaiting:()=>N(!0),onPlaying:()=>N(!1),onError:()=>N(!1),className:"dark bg-background",src:I.video,autoPlay:!0,loop:!0,muted:!0,style:{contain:"cover",objectFit:"cover",objectPosition:"center",width:"100%",height:"100%"}}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,t.jsx)(O.Spinner,{size:"default",className:(0,f.cn)(j?"block":"hidden")})})]}):I.nextImage?(0,t.jsx)(J.default,{src:I.nextImage,alt:I.title,fill:!0,priority:!0,quality:100}):I.image?(0,t.jsx)("img",{src:I.image,alt:I.title}):null})})}),(0,t.jsxs)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"text-center text-sm mt-4 w-[500px] max-w-[69.23vw] flex flex-col gap-2",children:[(0,t.jsx)("h1",{className:"font-bold text-2xl",children:I.title}),(0,t.jsx)("p",{className:"text-fg-secondary",children:I.description})]}),I.actions.length>0&&(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:(0,f.cn)("flex items-center w-full justify-center gap-3 mt-4"),children:I.actions.map(e=>e)}),(0,t.jsx)("div",{className:(0,f.cn)("absolute -top-2 -right-2",{"-top-2 right-2":s}),children:(0,t.jsx)(o.Button,{variant:"primary",size:"iconXs",rounded:!0,"aria-label":"Close",onClick:S,children:(0,t.jsx)(ic.X,{size:14})})})]})]})};var ib=e.i(389052),ij=e.i(892621);function iw(){let{t:e}=(0,k.useTranslation)("chat"),{isSuperGrokUser:i,isEnterpriseUser:s,isSuperGrokProUser:a,bestSubscription:n,isPending:o}=(0,en.useSubscriptions)(),{data:{enableVoiceMode:l}={}}=(0,tB.useFeatureControls)(),c=(0,r.useSession)().user,m=(0,tX.useTasksStore)(j.prop("initialized")),g=(0,w.useRef)(null),x=(0,U.useRoutingStore)(e=>e.route),v=(0,U.useRoutingStore)(e=>e.mainPageScrollPosition),b=(0,U.useRoutingStore)(e=>e.clearMainPageScrollPosition),N=(0,U.useRoutingStore)(e=>e.mainPageResetOnMount),_=(0,U.useRoutingStore)(e=>e.clearMainPageReset);(0,Q.useLoadHighlights)();let P=(0,w.useRef)(""),{signInWithReturnTo:z}=(0,d.useGrokRouter)(),B=(0,A.useLogEvent)(),G=(0,u.useFeatureFlags)(),{handleVoiceModeEnter:F}=(0,tD.useVoiceMode)({location:"chat-new"}),O=(0,t$.useChatPageStore)(e=>e.establishNewConversation),V=(0,eo.useSettingsStore)(j.prop("isIncognito")),W=(0,t$.useChatPageStore)(j.prop("activeModelId")),K=(0,tK.useCollectionsStore)(e=>e.collectionIdsByConversationId),X=(0,t$.useChatPageStore)(j.prop("defaultAnonModelId")),J=(0,t$.useChatPageStore)(j.prop("defaultFreeModelId")),$=(0,t$.useChatPageStore)(j.prop("defaultProModelId")),ee=(0,t$.useChatPageStore)(j.prop("setDefaultAnonModelId")),et=(0,t$.useChatPageStore)(j.prop("setDefaultFreeModelId")),ei=(0,t$.useChatPageStore)(j.prop("setDefaultProModelId")),es=(0,t$.useChatPageStore)(j.prop("reasoningMode")),el=(0,t$.useChatPageStore)(j.prop("setReasoningMode")),ed=(0,t$.useChatPageStore)(j.prop("conversationId")),eu=(0,t$.useChatPageStore)(j.prop("conversationId"))||"no_conversation_id",em=(0,t$.useChatPageStore)(e=>e.queryByConversationId[eu])||"",ep=(0,L.useContainerSize)(g,768),eg=(0,tO.useMobileUa)(),[ex]=(0,Z.useLocalStorage)("visited-imagine2",!1),[ef]=(0,Z.useLocalStorage)("imagine-banner-impressions2",0),[ev,ey]=(0,Z.useLocalStorage)("connect-x-upsell-dismissed",!1),[eb,ej]=(0,w.useState)(!1);(0,w.useEffect)(()=>{em&&ej(!0)},[em]),(0,w.useEffect)(()=>{t$.useChatPageStore.setState({projectId:void 0})},[]);let ew=ep?e("Ask Grok","Ask Grok"):e("query-bar-placeholder.1","What do you want to know?"),{sessionStartTime:ek,conversationDepth:eN}=(0,ij.useTimeToValueAnalytics)(ed),eS=(0,tY.useFileStore)(j.prop("listByConversationId")),eI=(0,tY.useFileStore)(j.prop("attachListByConversationId")),eC=(0,y.useImageEditorStore)(j.prop("isOpen")),eM=(0,w.useMemo)(()=>eS.no_conversation_id||[],[eS]),eT=(0,w.useMemo)(()=>eI.no_conversation_id||[],[eI]),e_=(0,tV.useForceSignInModels)(),eP=(0,er.useIsActiveGrokBusinessSession)(),eR=(0,tQ.useSuggestionStore)(e=>e.suggestions.length>0),eA=(0,tQ.useSuggestionStore)(e=>e.clearList),eL=(0,tq.useIsFirstTimeUser)(),eD=(0,w.useMemo)(()=>eP&&!V&&(ep||!eR),[eP,eR,V,ep]),ez=!eg&&!ep&&!eP&&ef<=10&&!ex&&0===em.length&&!eb;(0,w.useEffect)(()=>{ez&&B("web_imagine_banner_view","",{location:"chat-new"})},[ez,B]);let eB=ez&&!G.NO_IMAGINE_BANNER,eG=(0,w.useMemo)(()=>G.SHOW_CONNECT_X_UPSELL&&!ev&&!V&&!!c&&!c.xUserId,[G.SHOW_CONNECT_X_UPSELL,ev,V,c]),eF=(0,w.useMemo)(()=>!V&&(eM.length>0&&!!eM.every(e=>e.file.type.includes("image"))||(null==eT?void 0:eT.length)>0&&!!eT.every(e=>e.mimeType.includes("image"))),[eM,eT,V]),eO=(0,w.useMemo)(()=>!V&&(eM.length>0&&!!eM.every(e=>e.metadata&&e.file.type.includes("csv"))||(null==eT?void 0:eT.length)>0&&!!eT.every(e=>e.mimeType.includes("csv"))),[eM,eT,V]),[eV,eU]=(0,w.useState)(!1),eq=(0,w.useCallback)(()=>{var e;let t=null!=(e=window.localStorage.getItem("hideTaskPillCount"))?e:0;window.localStorage.setItem("hideTaskPillCount",String(Number(t)+1)),eU(!1)},[]),{maybeRefreshAnonSession:eH,needRefresh:eW}=(0,C.useAnonRefresher)(),eK=(0,w.useRef)(null),eY=(0,w.useCallback)(()=>{var e;g.current&&g.current.scrollTo({top:0,behavior:"smooth"}),null==(e=eK.current)||e.focus({preventScroll:!0})},[]);(0,T.useHotkeys)(M.KBD_NEW_CHAT,eY,[eY]);let eQ=(0,eo.useSettingsStore)(e=>e.setIsIncognito),eX=(0,w.useCallback)(()=>{c&&(eQ(!0),eY())},[c,eQ,eY]);(0,T.useHotkeys)(M.KBD_NEW_INCOGNITO_CHAT,eX,[eX]);let{handleKeyDown:eJ,consumeCompositionTimeMs:eZ,consumeBackspaceCount:e0,consumeAvgKeystrokeLatency:e1,consumeKeystrokeCount:e2,position:e5,setPosition:e4,consumePosition:e3,consumeTypeaheadReqCount:e6,incrementTypeaheadReqCount:e8,incrementSuggestionsShownCount:e9,consumeSuggestionsShownCount:e7}=(0,tF.useAutocompleteMetrics)(),te=(0,w.useCallback)(e=>{"Escape"===e.key&&eA(),eJ(e)},[eJ,eA]),tt=(0,w.useCallback)(e=>{let{query:t,fileAttachmentIds:i,toolOverrides:s,isPreset:a,workspaceIds:r,persona:o,isIncognitoOverride:l,disableMemory:d,modelIdOverride:u,suggestion:m}=e;if(!t)return Promise.resolve(!1);if(!c&&e_.includes(u||W))return B("sign_in","chat-new",{location:"chat-new"}),z(t,es),Promise.resolve(!1);let p=eo.useSettingsStore.getState(),g=e3(),x=e7(),f=(0,ib.toAnalytics)({activeModelId:u||W,modelMode:u?"":void 0,query:t,fileAttachmentIds:i,location:"chat-new",personalityId:p.userSettings.preferences.selectedSystemPromptId||"",personaId:"",sessionStartTime:ek,conversationDepth:eN,isMobile:ep,bestSubscription:n,user:!!c,compositionTime:eZ(),backspaceCount:e0(),avgKeystrokeLatency:e1(),keystrokeCount:e2(),position:g,typeaheadRequestCount:e6(),suggestionsShownCount:x,workspaceCount:(null==r?void 0:r.length)||0,toolOverrides:s,parentResponseId:"",isFirstTimeUser:eL,suggestion:m});B("send_query","",f);let v=()=>{(0,tW.reportSubmit)(),eA();let e=K[eu]||[];return(0,ih.loadThirdPartyPackages)(),!!O({message:t,fileAttachmentIds:i,toolOverrides:s,temporary:null!=l?l:V,isPreset:a,persona:o,enableRetries:!0,ff:G,workspaceIds:r,disableMemory:d,modelIdOverride:u,collectionIds:e}).catch((0,h.createLogError)("chat-new:establishNewConversation"))};return eW?eH().then(v):Promise.resolve(v())},[c,e_,W,e3,e7,ek,eN,ep,n,eZ,e0,e1,e2,e6,eL,B,eW,z,es,eA,K,eu,O,V,G,eH]),{modelById:ti,defaultAnonModelId:ts,defaultFreeModelId:ta,defaultProModelId:tn,isPending:tr}=(0,tV.useModels)(),to=(0,t$.useChatPageStore)(e=>e.setActiveModelId),tl=(0,t$.useChatPageStore)(e=>e.setModelMode),{shouldOauthGoogleDrive:td,syncGoogleDriveInProgress:tc,syncGoogleDriveSuccess:tu,oauthGoogleDriveSyncing:tm,onClickGoogleDriveSuccess:tp,isPendingConnectors:th}=(0,tz.default)(),tg=(0,p.useRequestErrorToastFn)(),{mutate:tx,isPending:tf}=(0,tG.useGetConnectorsAuthUrl)(),[tv,ty]=(0,w.useState)(!1),tb=(0,tR.usePersonalGoogleDriveConsentContent)(),tj=(0,w.useCallback)(()=>{tf||ty(!0)},[tf]),tw=(0,w.useCallback)(()=>{ty(!1),tx(tJ.ConnectorType.GOOGLE_DRIVE,{onSuccess:e=>{if(!e)return void tg("chat-new:handleConnectGoogleDrive",Error("Failed to get auth url"));window.location.href=e},onError:e=>{tg("chat-new:handleConnectGoogleDrive",e)}})},[tx,tg]),tk=(0,w.useCallback)(()=>{ty(!1)},[]);(0,w.useEffect)(()=>{if(tr||o&&c)return;let e=new URLSearchParams(location.search),t=e.get("q"),n=e.get("reasoningMode"),r=e.get("fileid"),l=tH[Number(e.get("m"))],d=location.hash===t0.INCOGNITO_HASH;if(l&&ti[l])eo.useSettingsStore.getState().fetchSetPreference("useModelModeSelector3",!1).catch((0,h.createLogError)("chat-new:mount:fetchSetPreference:useModelModeSelector3")),to(l);else if($!==tn&&(s||i||a)&&tn&&ti[tn])ei(tn),to(tn);else if(J!==ta&&c&&ta&&ti[ta])et(ta),to(ta);else if(X!==ts&&ts&&ti[ts])ee(ts),to(ts);else if(n){let e=tU.reasoningModeSchema.parse(n);e&&el(e)}t&&!P.current&&(tt({query:t,fileAttachmentIds:r?[r]:void 0,isIncognitoOverride:d,disableMemory:!0,modelIdOverride:l}).catch(e=>{(0,h.logError)("chat-new:mount:handleSend",e)}),P.current="auto-start")},[tr,o]);let tN=(0,w.useCallback)(e=>{let{query:t,suggestion:i}=e,s=t$.useChatPageStore.getState(),a=s.quotedText,n=s.projectId,r=[...eM.map(e=>e.metadata).filter(e=>e&&!(e instanceof Error)).map(e=>e.fileMetadataId),...(null==eT?void 0:eT.map(e=>e.assetId))||[]];tt({query:t,suggestion:i,fileAttachmentIds:r.length>0?r:void 0,parentQuotedText:a,workspaceIds:n?[n]:void 0}).catch(e=>{(0,h.logError)("chat-new:handleClickSuggestionItem",e)})},[tt,eM,eT]),tS=(0,w.useCallback)(t=>{let{query:i,parentQuotedText:s,fileAttachmentIds:a,toolOverrides:n,isPreset:r,persona:o}=t;if(o){let t=(0,tA.mapPersonaToSettings)(o.personaId,e);t.modelMode&&tl(t.modelMode)}tt({query:i,parentQuotedText:s,fileAttachmentIds:a,toolOverrides:n,persona:o,isPreset:r}).catch(e=>{(0,h.logError)("chat-new:handleClickSuggestion",e)})},[tt,tl,e]),tI=(0,w.useCallback)(()=>{let t=[...eM.map(e=>e.metadata).filter(e=>e&&!(e instanceof Error)).map(e=>e.fileMetadataId),...eT.map(e=>e.assetId)];tt({query:e("create-report-prompt","Create a report"),fileAttachmentIds:t}).catch(e=>{(0,h.logError)("chat-new:handleClickCreateReport",e)})},[tt,eM,eT,e]),tE=(0,w.useCallback)(()=>{tt({query:e("search-google-drive","Search my documents for meeting notes")}).then(()=>{tp()}).catch(e=>{(0,h.logError)("chat-new:handleClickTryGoogleDrive",e)})},[tt,e,tp]),tM=(0,w.useCallback)(()=>{t$.useChatPageStore.getState().idsetQueryByConversationId(e("gdrive-prefill-prompt","Search my documents for "),eu),tp()},[e,tp,eu]),t2=td||tc||tu||tm,t5=td||tm?"oauth":"team",t4=tm?"syncing":td?"default":tu?"complete":tc?"syncing":"default",t3=td?tj:tE;(0,w.useEffect)(()=>{(0,tW.reportPageReady)()},[]),(0,w.useEffect)(()=>{"main"===x.page&&null!==v&&!N&&g.current&&setTimeout(()=>{g.current&&(g.current.scrollTop=v),b()},0)},[x.page,v,N,b]),(0,w.useEffect)(()=>{if(N&&"main"===x.page){var e;g.current&&g.current.scrollTo({top:0,behavior:"smooth"}),null==(e=eK.current)||e.focus({preventScroll:!0}),_()}},[N,x.page,_]),(0,w.useEffect)(()=>{let e=()=>{var e;g.current&&g.current.scrollTo({top:0,behavior:"smooth"}),null==(e=eK.current)||e.focus({preventScroll:!0})};return window.addEventListener("grok:main-page-reset",e),()=>window.removeEventListener("grok:main-page-reset",e)},[]);let t6=(()=>{if(!eR){if(eF&&!V)return(0,t.jsx)("div",{className:"bg-background rounded-full",children:(0,t.jsxs)(S.ImageEditorTrigger,{shouldGetFromStore:!0,buttonProps:{variant:"filledSecondary",size:"md",rounded:!0},location:"chat-new-input",children:[(0,t.jsx)(tT.ScanImageIcon,{className:"size-5 text-secondary"}),e("Edit Image","Edit Image")]})},"edit");if(eO&&!V)return(0,t.jsx)(H.motion.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"bg-background rounded-full",children:(0,t.jsxs)(R.Button,{size:"md",variant:"secondary",shape:"pill",onClick:tI,children:[(0,t.jsx)(t_.ScanSearchIcon,{}),(0,t.jsx)("p",{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:e("create-report","Create Report")})]})},"edit");if(eB)return(0,t.jsx)(H.motion.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",transition:{duration:.1},exit:"hidden",className:(0,f.cn)("w-full flex justify-center",{invisible:V}),children:(0,t.jsx)(ea,{})},"imagine-banner");if(m&&!ep&&eV)return(0,t.jsx)(H.motion.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:(0,f.cn)("w-full flex justify-center",{invisible:V}),children:(0,t.jsx)(iu,{onHide:eq})},"task-pill");if(!ep&&!eF&&!eO&&eD)return(0,t.jsxs)(H.motion.div,{variants:{hidden:{opacity:0},visible:{opacity:1}},initial:"hidden",animate:"visible",transition:{duration:.2},className:(0,f.cn)("w-full mb-6",tL.QUERY_BAR_MAX_WIDTH_CLASS),children:[(0,t.jsx)(e$,{className:"w-full mt-7"}),(0,t.jsx)("div",{id:"experiments-container"}),(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:!th&&t2?(0,t.jsx)(eh,{variant:t5,state:t4,isConnecting:tf,className:"mt-14",onClick:t3,onStartUsing:tM}):G.ENABLE_TEMPLATES?(0,t.jsx)(tC,{className:"w-full mt-10"}):(0,t.jsx)(eE,{className:"w-full mt-10"})})]},"teams-ui");if(eG)return(0,t.jsx)(D,{onDismiss:()=>ey(!0)});if(!ep&&!V&&!eP)return(0,t.jsxs)("div",{className:"flex flex-col items-center gap-6 w-full",children:[(0,t.jsx)(ii,{handleSend:tS}),(0,t.jsx)("div",{className:(0,f.cn)(!G.ENABLE_HIGHLIGHTS_DISMISS_BUTTON&&"mt-6","w-full",tL.QUERY_BAR_MAX_WIDTH_CLASS),children:(0,t.jsx)(Y,{scrollContainerRef:g})})]})}})();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{ref:g,className:"flex flex-col items-center w-full h-full p-2 mx-auto justify-center @sm:p-4 @sm:gap-9 isolate mt-16 @sm:mt-0 overflow-scroll",children:[G.SHOW_GROK_HOME_PROMOTION_DIALOG&&(0,t.jsx)(iy,{}),(0,t.jsxs)("div",{className:(0,f.cn)("flex flex-col items-center gap-6 h-[450px] w-full @sm:pt-12 isolate transition-transform",eP&&!ep&&"@sm:-translate-y-20"),children:[(0,t.jsxs)("div",{className:(0,f.cn)("flex flex-col items-center justify-center w-full @sm:px-4 px-2 gap-6 @sm:gap-4 @xl:w-4/5 flex-initial pb-0",tL.QUERY_BAR_MAX_WIDTH_CLASS),children:[(0,t.jsx)(ec,{height:64,width:320}),ep&&(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:eD?(0,t.jsxs)(H.motion.div,{variants:{hidden:{opacity:0},visible:{opacity:1}},initial:"hidden",animate:"visible",transition:{duration:.2},className:(0,f.cn)("w-full",tL.QUERY_BAR_MAX_WIDTH_CLASS),children:[(0,t.jsx)(e$,{className:"w-full my-6"}),(0,t.jsx)("div",{id:"experiments-container-mobile"}),(0,t.jsx)(q.AnimatePresence,{mode:"wait",children:!th&&t2&&(0,t.jsx)(eh,{variant:t5,state:t4,isConnecting:tf,className:"my-6",onClick:t3,onStartUsing:tM})})]},"teams-ui"):eR?null:(0,t.jsx)(ii,{handleSend:tS})})]}),(0,t.jsxs)("div",{className:(0,f.cn)("absolute bottom-0 mx-auto inset-x-0",tL.QUERY_BAR_MAX_WIDTH_CLASS,"@sm:relative flex flex-col items-center w-full gap-1 @sm:gap-5 @sm:bottom-auto @sm:inset-x-auto @sm:max-w-full"),children:[(0,t.jsxs)("div",{className:(0,f.cn)("flex flex-col-reverse items-center justify-between flex-1 w-full gap-0 @sm:gap-3 @sm:flex-col relative","p-2 @sm:p-0"),children:[(0,t.jsx)("div",{className:(0,f.cn)("w-full",!eR||ep?"mb-3":""),children:(0,t.jsx)(I.QueryBar,{className:"mt-2",textAreaClassName:"min-h-14 py-4 my-0 mb-0",placeholder:ew,onQuery:tt,onFrontPage:!eC,ref:eK,isIncognito:V,enableVoiceMode:l,onKeyDown:te,onVoiceModeEnter:F,isShowingSuggestions:eR&&!ep&&!V,onBlur:eA},"query-bar")}),(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:t6}),(0,t.jsx)(t1.ChatAutoCompleteSuggestions,{className:(0,f.cn)("overflow-visible",V&&"invisible",ep?"!mb-1":"-mt-2"),handleSend:tN,position:e5,setPosition:e4,placement:ep?"top":"bottom",incrementTypeaheadReqCount:e8,incrementSuggestionsShownCount:e9}),(0,t.jsx)(E.UpsellSuperGrokSmall,{})]}),c?null:(0,t.jsx)("div",{className:"text-[11px] @sm:text-xs text-secondary text-nowrap",children:(0,t.jsx)(tZ.Trans,{ns:"chat",i18nKey:"clickwrapAgreement",defaults:"By messaging Grok, you agree to our <terms>Terms</terms> and <policy>Privacy Policy</policy>.",components:{terms:(0,t.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/terms-of-service",target:"_blank",rel:"noopener noreferrer"}),policy:(0,t.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/privacy-policy",target:"_blank",rel:"noopener noreferrer"})}})})]})]})]}),(0,t.jsx)(tP.GoogleConsentModal,{open:tv,onClose:tk,onAccept:tw,provider:"GOOGLE_DRIVE",infoItems:tb})]})}var ik=e.i(395395),iN=e.i(211350),iS=e.i(159422),iI=e.i(141769);function iC(e){let{conversationIsLoading:i,conversationError:s,optimisticConversationId:a,conversationId:n,conversation:r,templateId:o}=e,l=(0,p.useRequestErrorToastFn)(),d=(0,t$.useChatPageStore)(j.prop("conversationMode")),{data:{enableVoiceMode:c}={}}=(0,tB.useFeatureControls)(),{conversationIdOrDefault:u}=(0,ik.useConversationIdOrDefault)(),m=(0,tK.useCollectionsStore)(e=>e.collectionIdsByConversationId)[u];return((0,w.useEffect)(()=>{(null==r?void 0:r.conversationId)&&iS.useResponseStore.getState().loadInitialResponses(r.conversationId).then(e=>{var t;let i=t$.useChatPageStore.getState();if(i.conversationId===(null==(t=e[0])?void 0:t.conversationId)){let t=(0,iN.getMostRecentResponse)(e);if(!t)return void i.setLastMessageId(void 0);if("streaming"===t.state||"reconnecting"===t.state){i.setLastMessageId(t.parentResponseId),i.setStreamedMessageId(t.responseId);return}if("optimistic"===t.state){i.setLastMessageId(t.parentResponseId),i.setOptimisticMessageId(t.responseId);return}i.setLastMessageId(t.responseId)}}).catch(e=>{l("chat-page:loadInitialResponses",e)})},[null==r?void 0:r.conversationId]),a)?(0,t.jsx)(iI.ChatInteraction,{conversationId:a,conversation:void 0,isOptimisticConversation:!0,conversationIsLoading:i,conversationError:s,enableVoiceMode:c,templateId:o,collectionIds:m},"voice"===d?"voice-chat-interaction":"chat-interaction"):n?(0,t.jsx)(iI.ChatInteraction,{conversationId:n,conversation:r||void 0,isOptimisticConversation:!1,conversationIsLoading:i,conversationError:s,enableVoiceMode:c,collectionIds:m},"chat-interaction"):null}var iE=e.i(755666);e.i(200942);var iM=e.i(274920);function iT(e){let{conversationId:i,containerRef:s,imageAttachmentsOnly:a=!1}=e,{t:n}=(0,k.useTranslation)("chat"),r=function(e,t,i){let{t:s}=(0,k.useTranslation)("base"),a=(0,t$.useChatPageStore)(j.prop("activeModelId")),{modelById:n}=(0,tV.useModels)(),r=null==n?void 0:n[a],{isAttachDisabled:o}=(0,tV.useModelFeatures)(r),{data:{enableImageUploads:l=!0}={}}=(0,tB.useFeatureControls)(),{attachFiles:d}=(0,iE.useFileAttachments)(),c=(0,A.useLogEvent)(),u=(0,tY.useFileStore)(j.prop("listByConversationId"))[e||"no_conversation_id"]||[];return"hover"===(0,iM.useDropZone)({onDrop:e=>{d(e),e.forEach(e=>{c("upload_file",e.name,{location:"file-drop",mimeType:e.type})})},canDrop:e=>{var t;return!l&&e.files.some(e=>null==e?void 0:e.type.startsWith("image/"))?(N.toast.error(s("feature-controls.enable-image-uploads.forbidden","Image uploads are disabled for your team.")),!1):!o&&!!e.files.length&&(!i||!(e.files.length>1)&&!!(null==(t=e.files[0])?void 0:t.type.startsWith("image/")))&&(!u.length||!u.find(t=>{var i;return t.file.name===(null==(i=e.files[0])?void 0:i.name)}))},ref:t},[u,o,d])}(i,s,a),o=(0,t$.useChatPageStore)(j.prop("activeModelId")),{modelById:l}=(0,tV.useModels)(),d=null==l?void 0:l[o],{isAttachDisabled:c,isThinkSelected:u,isDeepsearchSelected:m}=(0,tV.useModelFeatures)(d);return(0,t.jsx)(q.AnimatePresence,{children:r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-overlay z-50"},"drop-backdrop"),(0,t.jsx)(H.motion.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:20},className:"absolute inset-0 z-50 flex items-center justify-center p-6 pointer-events-none",children:c?(0,t.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,t.jsx)("div",{children:(0,t.jsx)(te.TriangleAlert,{size:32,className:"text-red-400"})}),(0,t.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:n("Attachments are disabled","Attachments are disabled")}),(0,t.jsxs)("p",{className:"text-secondary",children:[n("Attachments are disabled for","Attachments are disabled for")," ",(0,t.jsx)("span",{className:"font-semibold",children:u?"Think":m?"DeepSearch":void 0})]})]}):(0,t.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,t.jsx)("div",{children:(0,t.jsx)(t5.ImagePlusIcon,{size:32,className:"text-secondary"})}),(0,t.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:n("Drop your files here","Drop your files here")}),(0,t.jsx)("p",{className:"text-secondary",children:n("Drop your files here to add them to your conversation","Drop your files here to add them to your conversation")})]})},"drop-modal")]})})}let i_=(0,B.default)("BellRing",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}]]),iP=e=>{let{onDismiss:i}=e,{t:s}=(0,k.useTranslation)("base"),[a,n]=(0,w.useState)("ASK"),r=(0,eo.useSettingsStore)(j.prop("fetchSetPreference")),l=async()=>{if("granted"===Notification.permission||(n("WAIT"),"granted"===await Notification.requestPermission())){n("ALLOWED"),await r("browserNotificationsEnabled",!0);return}n("DENIED")};return((0,w.useEffect)(()=>{if("ASK"===a||"WAIT"===a)return;let e=setTimeout(i,2e3);return()=>clearTimeout(e)},[i,a]),(0,tO.isMobileUa)())?null:"DENIED"===a?(0,t.jsxs)("div",{className:"flex items-center gap-4 min-w-[360px]",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:s("notifications_declined_title","Notifications declined")}),(0,t.jsx)("div",{className:"text-xs text-secondary",children:s("notifications_change_anytime","You can change this anytime in settings.")})]}),(0,t.jsx)(ic.X,{className:"size-5"})]}):"ALLOWED"===a?(0,t.jsxs)("div",{className:"flex items-center gap-4 min-w-[348px]",children:[(0,t.jsx)(eu.Check,{className:"size-5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:s("notifications_enabled_title","Notifications enabled")}),(0,t.jsx)("div",{className:"text-xs text-secondary",children:s("notifications_enabled_subtitle","We'll keep you updated")})]})]}):(0,t.jsxs)("div",{className:"flex justify-between items-center gap-4 relative group min-w-[360px]",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(i_,{className:"size-5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-semibold",children:s("notifications_ask_title","Get notified when Grok finishes answering")}),(0,t.jsx)("div",{className:"text-xs text-secondary",children:s("notifications_ask_subtitle","Enable notifications")})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 -me-2",children:[(0,t.jsx)(o.Button,{className:"rounded-xl px-2 py-2",variant:"secondary",disabled:"WAIT"===a,onClick:l,children:s("notifications_enable","Enable")}),(0,t.jsx)(o.Button,{variant:"textSecondary",size:"iconXs","aria-label":s("notifications-toast-dismiss","Dismiss"),onClick:()=>i(!0),children:(0,t.jsx)(ic.X,{className:"!size-4"})})]})]})};var iR=e.i(659065),iA=e.i(189596),iL=e.i(497985);function iD(e){let{conversationId:i,responseId:s,teamMembersToShare:a,className:n,onClick:r}=e,{t:o}=(0,k.useTranslation)("chat"),l=(0,A.useLogEvent)(),d=(0,h.createLogError)("team-request-share-button"),{mutateAsync:c,isPending:u}=(0,e3.useMutation)({mutationKey:["share-conversation-team",i,s,a,!1],mutationFn:async()=>{var e,t;let n=[...new Set([...(null==(t=(await eg.chatApi.chatListShareLinks({conversationId:i,responseId:s,pageSize:"1"})).shareLinks)||null==(e=t[0])?void 0:e.sharedWithUserIds)||[],...a||[]])];return eg.chatApi.chatShareConversation({conversationId:i,body:{responseId:s,allowIndexing:!1,teamMembersToShare:n,shareWithTeamMembers:!1,sharePublicly:!1}})}}),m=(0,w.useCallback)(async()=>{try{await c(),null==r||r(),l("team_share_response_approved",void 0,{location:"team-request-share-button",conversationId:i,responseId:s,teamMembersToShare:a?JSON.stringify(a):"",shareWithTeamMembers:String(!1)}),N.toast.success(o("team-request-share-button.approve-success","Access granted!"))}catch(e){d(e instanceof Error?e:Error(String(e))),N.toast.error(o("share-button.share-error","Failed to share conversation."))}},[c,l,i,s,a,r,d,o]);return(0,t.jsx)(R.Button,{variant:"primary",size:"md",shape:"rectangle",className:(0,f.cn)(n),onClick:m,disabled:u,children:(0,t.jsx)("span",{className:"font-semibold",children:o("team-request-share-button.button-accept","Accept")})})}var iz=e.i(130568);function iB(e){let{conversationId:i,responseId:s,notificationId:a,open:n}=e,{t:r}=(0,k.useTranslation)("chat"),{route:o,replace:l}=(0,x.useRouting)(),d=(0,L.useMobileSize)(),c=(0,A.useLogEvent)(),u=(0,er.useIsActiveGrokBusinessSession)(),m=(0,iz.useNotificationsStore)(e=>e.byId),p=(0,w.useMemo)(()=>{if("chat"===o.page&&a&&m[a]){var e,t;return null==(t=m[a])||null==(e=t.data)?void 0:e.conversationAccessRequest}},[m,a,o]),g=(0,w.useCallback)(()=>{"chat"===o.page&&l({...o,notificationId:null})},[o,l]),f=(0,w.useCallback)(e=>{e||g()},[g]);(0,w.useEffect)(()=>{n&&c("user_request_share_dialog_opened",void 0,{location:"request-share-dialog"})},[c,l,o,n]);let v=(0,w.useCallback)(()=>{g()},[g]),y=(0,w.useCallback)(()=>{g()},[g]),b=(null==p?void 0:p.requesterName)?(null==p?void 0:p.requesterEmail)?"".concat(p.requesterName," (").concat(p.requesterEmail,")"):p.requesterName:(null==p?void 0:p.requesterEmail)||"",j=u?r("request-share-dialog.team-share-disclaimer","Granting access will allow them to read this conversation, and they will be able to continue the conversation privately."):r("request-share-dialog.public-share-disclaimer","Granting access will allow anyone to read this conversation, and they will be able to continue the conversation privately");if(!i||!s)return(0,h.logError)("request-share-dialog","RequestShareDialog opened with missing conversationId or responseId. This should never happen"),null;let N=(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-base",children:(0,t.jsx)(tZ.Trans,{i18nKey:"request-share-dialog.requester-text",ns:"chat",defaults:"{{requester}} would like to view this conversation",className:"text-sm text-muted-foreground",values:{requester:b}})}),(0,t.jsxs)("div",{className:"flex items-start gap-2 mt-[16px] text-sm text-muted-foreground",children:[(0,t.jsx)(iA.Info,{className:"size-4 mt-0.5 shrink-0"}),(0,t.jsx)("span",{children:j})]}),(0,t.jsxs)("div",{className:"w-full flex items-center gap-2 justify-end mt-8 md:mt-4",children:[(0,t.jsx)(iL.ShareButton,{conversationId:i,responseId:s,variant:u?"secondary":"primary",size:"md",shape:"rectangle",showLabel:!0,onClick:v}),u&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(R.Button,{variant:"secondary",size:"md",shape:"rectangle",onClick:v,children:r("team-request-share-dialog.deny","Deny")}),(0,t.jsx)(iD,{conversationId:i,responseId:s,teamMembersToShare:(null==p?void 0:p.requesterUserId)!=null?[p.requesterUserId]:void 0,onClick:y})]})]})]}),S=(0,t.jsx)(R.Button,{variant:"tertiary",size:"sm",shape:"circle",onClick:v,children:(0,t.jsx)(P.XIcon,{className:"size-5"})}),I=r("request-share-dialog.title","Access requested");return d?(0,t.jsx)(iR.Drawer,{open:n,onOpenChange:f,children:(0,t.jsxs)(iR.DrawerContent,{className:"focus:outline-none bg-surface-l1 pt-1 p-6 mb-2",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("div",{className:"text-lg font-semibold leading-none tracking-tight",children:I}),S]}),N]})}):(0,t.jsx)(iv.Dialog,{open:n,onOpenChange:f,children:(0,t.jsxs)(iv.DialogContent,{className:"w-[500px]  rounded-3xl border border-border-l1 pt-[12px] pb-[12px] ps-[20px] pe-[20px]",children:[(0,t.jsxs)(iv.DialogHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsx)(iv.DialogTitle,{className:"text-xl font-semibold",children:I}),S]}),N]})})}var iG=e.i(794804),iF=e.i(463174);let iO=new Date;function iV(){let{user:e,anonUser:a}=(0,r.useSession)(),o=(0,u.useFeatureFlags)(),S=(0,t$.useChatPageStore)(j.prop("optimisticConversationId")),I=(0,t$.useChatPageStore)(j.prop("lastMessageId")),C=(0,t$.useChatPageStore)(j.prop("conversationMode")),E=(0,v.useConversationStore)(e=>e.fetchGetConversation),{route:M}=(0,x.useRouting)(),{isSwitchingTeam:T}=(0,ed.useEnterprise)(),_=(0,t$.useChatPageStore)(j.prop("conversationId"))||("chat"===M.page&&!M.temporary&&M.conversationId?M.conversationId:void 0);(0,w.useEffect)(()=>{var e;if("chat"===M.page&&M.temporary)return;let t="chat"===M.page&&null!=(e=M.conversationId)?e:void 0;t$.useChatPageStore.setState({conversationId:t})},[M]),(()=>{let{t:e}=(0,k.useTranslation)("base"),[i,s]=(0,w.useState)(""),a=(0,t$.useChatPageStore)(e=>e.lastMessageId),n=(0,t$.useChatPageStore)(e=>e.streamedMessageId),r=(0,iS.useResponseStore)(e=>e.byId),o=r[a||""],l=r[n||""],d=(0,w.useMemo)(()=>{let e=o;for(;e&&"human"!==e.sender;)e=e.parentResponseId?r[e.parentResponseId]:void 0;return null==e?void 0:e.message},[o,r]),[c,u]=(0,Z.useLocalStorage)("notifications-toast-dismiss-count",0),[m,p]=(0,w.useState)(0),h=(0,w.useRef)(new Set),g=(0,eo.useSettingsStore)(e=>e.userSettings.preferences.browserNotificationsEnabled),x=(0,w.useCallback)(()=>{var t,i;if(null==(t=document)?void 0:t.hasFocus())return;let s=null==o||null==(i=o.uiLayout)?void 0:i.reasoningUiLayout;if("HEAVY"!==s&&"UNIFIED"!==s)return;let a="HEAVY"===s?e("notifications-heavy-answer-ready","Grok Heavy answer is ready"):e("notifications-answer-ready","Grok answer is ready"),n=window.matchMedia("(prefers-color-scheme: dark)").matches?"/images/notification-icon-dark.png":"/images/notification-icon-light.png",r=d?{body:e("notifications-check-results-with-message",'Check results for "{{userMessage}}"',{userMessage:d}),icon:n}:{icon:n};try{new Notification(a,r).onclick=()=>{window.focus()}}catch(e){}},[o,d,e]),f=(0,w.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];N.toast.dismiss(i),s(""),e&&u(e=>e+1)},[u,i]),v=!!(null==l?void 0:l.liveThinkingStartTime)||!!(null==l?void 0:l.thinkingStartTime)||!!(null==l?void 0:l.searchingStartTime)||(null==l?void 0:l.steps)&&l.steps.length>0;return(0,w.useEffect)(()=>{if(!g&&l&&v){if((null==l?void 0:l.state)==="streaming")return void p(1e3);(null==o?void 0:o.state)==="closed"&&p(0)}},[l,o,g,v]),(0,w.useEffect)(()=>{if(0===m||g)return;let e=setTimeout(()=>p(e=>e+1e3),1e3);return()=>clearTimeout(e)},[g,m]),(0,w.useEffect)(()=>{let e=m>=3e3&&m<=4e3;!i&&!g&&e&&c<1&&1&&s((0,N.toast)((0,t.jsx)(iP,{onDismiss:f}),{duration:1/0,className:"inset-x-0 mx-auto"}))},[c,f,m,i]),(0,w.useEffect)(()=>{(null==o?void 0:o.liveThinkingStartTime)&&(null==o?void 0:o.state)==="closed"&&(g&&a&&!h.current.has(a)&&(x(),h.current.add(a)),i&&(o.partial?f(!1):setTimeout(()=>f(!1),2e3)))},[g,f,o,x,i,a])})(),function(){let e=(0,b.useSearchParams)(),{t}=(0,k.useTranslation)("chat"),i=(0,b.useRouter)(),s=(0,w.useRef)(!1),a=e.get(l.CONNECT_OAUTH_PROVIDER_SEARCH_PARAM),n=(0,g.usePrettyOauthProvider)(a||"");(0,w.useEffect)(()=>{if(!s.current&&a){setTimeout(()=>N.toast.success(t("oauth.connection.success","Successfully connected {{provider}}!",{provider:n})),0),s.current=!0;let e=new URL(window.location.href);e.searchParams.delete(l.CONNECT_OAUTH_PROVIDER_SEARCH_PARAM),i.replace("".concat(e.pathname).concat(e.search).concat(e.hash,"/"),{scroll:!1})}},[n,a,i,t])}(),function(e){let t=(0,v.useConversationStore)(t=>e?t.byId[e]:void 0);(0,c.useDocumentTitle)(null==t?void 0:t.title)}(_),function(){let e=(0,t$.useChatPageStore)(j.prop("conversationMode")),t=(0,t$.useChatPageStore)(j.prop("voiceConnectionStatus")),i=(0,t$.useChatPageStore)(j.prop("exitVoiceMode")),s=(0,y.useImageEditorStore)(j.prop("isOpen")),{user:a}=(0,r.useSession)(),n=(0,u.useFeatureFlags)(),o=(0,p.useRequestErrorToastFn)(),{route:l,replace:c}=(0,x.useRouting)(),{signInWithReturnTo:m}=(0,d.useGrokRouter)(),{handleVoiceModeEnter:g}=(0,tD.useVoiceMode)({location:"voice-chat-page"}),f=(0,w.useRef)(!1);(0,w.useEffect)(()=>{if("voice"in l&&l.voice&&"voice"!==e){if(!f.current&&(f.current=!0,c({page:"main",voice:!1}),n.ENABLE_VOICE_MODE))if(a)g().catch(e=>(0,h.logError)("chat-page:handleVoiceModeEnter",e));else{(0,h.logEventGlobal)("sign_in","voice-chat-page",{location:"voice-chat-page"}),m(void 0,void 0,!0);return}}else f.current=!1},[l,c,e,g,t,a,m,n]),(0,w.useEffect)(()=>{s&&"voice"===e&&i("navigation").catch(e=>{o("chat-page:exitVoiceMode",e)})},[s,e,i,o])}(),function(){let e=(0,er.useIsActiveGrokBusinessSession)(),t=(0,u.useFeatureFlags)(),{route:i}=(0,x.useRouting)(),s="optimistic_template_conversation";(0,w.useEffect)(()=>{let a=t$.useChatPageStore.getState();if(e&&"main"===i.page&&i.templateId&&t.ENABLE_TEMPLATES&&!a.optimisticConversationId){a.setOptimisticConversationId(void 0),a.setOptimisticMessageId(void 0),a.setConversationId(void 0),a.setSidePanelContent(void 0);let e={...(0,v.createOptimisticConversation)({conversationId:s,temporary:!0})},t=v.useConversationStore.getState();t.upsertAndCacheConversation(e),a.setOptimisticConversationId(e.conversationId);let i=new AbortController;t.idsertAbortControllerById(i,e.conversationId)}if("main"===i.page&&!i.templateId&&a.optimisticConversationId&&a.optimisticConversationId===s){let e=v.useConversationStore.getState();e.removeConversation(s),e.removeAbortControllerById(a.optimisticConversationId),a.setOptimisticConversationId(void 0)}},[e,t.ENABLE_TEMPLATES,i])}();let P=(e||a&&a.expirationDate>iO)&&_&&"chat"===M.page?E(_,M.rid):void 0,{data:R,isLoading:A,error:L}=(0,m.usePromise)(P),{data:{enableFileUploads:D=!0}={}}=(0,tB.useFeatureControls)(),z="chat"===M.page&&L instanceof iF.TeamSwitchNeededError;(0,w.useEffect)(()=>{t$.useChatPageStore.getState().setChatPageLoaded(!0)},[]);let B=(0,t$.useChatPageStore)(j.prop("setQuotePopupData"));(0,w.useEffect)(()=>{let e=e=>{let t=window.getSelection();t&&0!==t.rangeCount&&0!==t.toString().trim().length||B(void 0)},t=e=>{let t=window.getSelection();t&&0!==t.rangeCount&&0!==t.toString().trim().length||B(void 0)};return document.addEventListener("click",e),document.addEventListener("selectionchange",t),()=>{document.removeEventListener("click",e),document.removeEventListener("selectionchange",t)}},[B]);let G=(0,w.useRef)(null),F=(0,w.useMemo)(()=>"main"===M.page&&M.templateId||void 0,[M]),O=(0,w.useMemo)(()=>S&&"main"===M.page||_&&"chat"===M.page,[S,M.page,_]),V=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,[i,s]=(0,w.useState)(e),a=(0,w.useRef)(null);return(0,w.useEffect)(()=>(a.current&&clearTimeout(a.current),e?a.current=setTimeout(()=>{s(!0)},t):s(!1),()=>{a.current&&clearTimeout(a.current)}),[e,t]),i}(null!=_&&null!=I&&"chat"===M.page&&null!=M.notificationId&&!z&&!T,350);return(0,t.jsx)(s.ErrorBoundary,{fallbackRender:()=>(0,t.jsx)(iU,{}),children:(0,t.jsxs)("main",{ref:G,className:(0,f.cn)("h-dvh flex-grow flex-shrink relative selection:bg-highlight w-0","@container isolate","print:h-full print:prose print:max-w-none"),children:[(0,t.jsx)(iB,{responseId:I,conversationId:_,notificationId:"chat"===M.page&&null!=M.notificationId?M.notificationId:void 0,open:V},"request-share-dialog"),(0,t.jsx)(i.TriggeredError,{hidden:!0}),D&&"chat"===C&&!z&&(0,t.jsx)(iT,{conversationId:_,containerRef:G}),z?(0,t.jsx)(iG.TeamSwitchPrompt,{switchToPersonalTeam:L.teamSwitchPrompt.switchToPersonalTeam,teamId:L.teamSwitchPrompt.teamId,attemptAutoSwitch:!0}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(t0.ChatTopNav,{conversationIsLoading:A,conversation:R||void 0,isOptimisticConversation:!!S,chatStarted:!!O},"chat-top-nav"),S&&"main"===M.page||_&&"chat"===M.page?(0,t.jsx)(iC,{optimisticConversationId:S,conversationIsLoading:A,conversationError:L,conversationId:_,conversation:R,templateId:F},"conversation-view"):(0,t.jsx)(iw,{})]}),o.ENABLE_GLOBAL_IMAGE_EDITOR?null:(0,t.jsx)(n.ImageEditorDialog,{})]},"chat-page")})}function iU(){let{t:e}=(0,k.useTranslation)("chat");return(0,t.jsx)("div",{className:"w-full h-dvh flex justify-center items-center align-middle",children:(0,t.jsxs)("div",{className:"w-full max-w-lg text-center",children:[(0,t.jsx)(x.Link,{route:{page:"main"},className:"mb-6 flex justify-center",children:(0,t.jsx)(a.GrokWordLogo,{height:20,width:60,className:"opacity-80 hover:opacity-100 fill-black dark:fill-white"})}),(0,t.jsx)("div",{children:e("There was an error","There was an error")}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsx)(o.Button,{variant:"primary",size:"md",onClick:()=>{window.location.href="/"},children:e("Return to Home","Return to Home")})})]})})}var iq=e.i(290119);e.i(353492);var iH=e.i(69052),iW=e.i(614688),iK=e.i(250950),iY=e.i(956916);let iQ=e=>{let{title:i,description:s,cta:a,onClick:n}=e;return(0,t.jsxs)("div",{className:"py-12 px-3 flex flex-col justify-center items-center gap-4",children:[(0,t.jsx)("div",{className:"size-10 bg-surface-l1 rounded-full flex justify-center items-center",children:(0,t.jsx)(iY.ChatBubblePlusIcon,{className:"size-5 text-fg-tertiary"})}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-1",children:[(0,t.jsx)("span",{className:"text-fg-primary text-sm font-semibold",children:i}),(0,t.jsx)("span",{className:"text-fg-secondary text-sm",children:s})]}),a&&(0,t.jsx)(R.Button,{size:"sm",shape:"rectangle",variant:"secondary",onClick:n,children:a})]})},iX=()=>{let{t:e}=(0,k.useTranslation)("base"),[i,s]=(0,w.useState)(""),[a,n]=(0,w.useState)(null),[r,o]=(0,w.useState)(null),[l,c]=(0,w.useState)(""),[u,m]=(0,w.useState)(null),{routeToConversation:h}=(0,d.useGrokRouter)(),g=(0,A.useLogEvent)(),x=(0,p.useRequestErrorToastFn)(),y=(0,w.useMemo)(()=>{var e;return null!=(e=null==i?void 0:i.trim())?e:""},[i]),{results:b,refetch:j,loadMoreRef:N,historyContainerRef:S,isLoading:I,isFetching:C,isError:E,isDebouncing:M,isFetchingNextPage:T}=(0,iW.useSearchConversations)({query:y}),_=(0,w.useCallback)(e=>{if(a||r)return;h(e,!1,!0);let t=v.useConversationStore.getState().byId[e];g("select_conversation",e,{conversationCreateTime:(null==t?void 0:t.createTime)||"",location:"command-menu"})},[a,r,h,g]),P=(0,w.useCallback)(e=>{var t;let i=b.find(t=>t.conversation.conversationId===e);c((null==i||null==(t=i.conversation)?void 0:t.title)||""),n(e)},[b]),R=(0,w.useCallback)(async e=>{var t;if(a!==e)return;let i=l.trim();if(""===i)return;let s=b.find(t=>t.conversation.conversationId===e);g("update_conversation",e,{location:"search-dialog"}),n(null);let{fetchUpdateConversation:r}=v.useConversationStore.getState();await r(e,{title:i,starred:null==s||null==(t=s.conversation)?void 0:t.starred}).catch(e=>{x("command-menu:handleEditSave",e)}),await j()},[b,x,a,l,j,g]),L=(0,w.useCallback)(async e=>{if(r!==e)return;g("delete_conversation",e,{location:"search-dialog"}),o(null);let{fetchSoftDeleteConversation:t}=v.useConversationStore.getState();await t(e).catch(e=>{x("command-menu:handleDeleteConfirm",e)}),await j()},[r,g,j,x]),D=(0,w.useCallback)(()=>{n(null),o(null),c("")},[]),z=(0,w.useCallback)(async e=>{var t;let i=b.find(t=>t.conversation.conversationId===e);g("favorite_conversation",e,{value:(null==i?void 0:i.conversation.starred)?"true":"false",location:"search-dialog"});let{fetchUpdateConversation:s}=v.useConversationStore.getState();await s(e,{starred:!(null==i||null==(t=i.conversation)?void 0:t.starred)}).catch(e=>{x("command-menu:handleToggleFavorite",e)}),await j()},[b,x,j,g]),{handleMouseEnter:B,handleMouseLeave:G}=(0,iK.useListSelection)({items:b,selectedId:u,setSelectedId:m,onSelect:_,getId:e=>e.conversation.conversationId,enabled:!a&&!r,containerRef:S});return(0,t.jsx)("div",{className:"flex flex-col h-full min-h-0",children:(0,t.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,t.jsx)("div",{className:"px-0.5 pt-0.5 flex-shrink-0 relative z-20",children:(0,t.jsx)(ts,{value:i,onChange:s,isLoading:!!((I||C||M)&&y)})}),(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:E?(0,t.jsx)(H.motion.div,{variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.1},className:"py-6",children:(0,t.jsx)(tt,{title:e("history.failed-to-load-history.title","Failed to load history"),description:e("history.failed-to-load-history.description","We encountered an issue while loading your conversation history"),onClick:()=>j()})},"error"):b.length>0?(0,t.jsxs)("div",{className:"flex-1 overflow-hidden relative",children:[(0,t.jsx)("div",{className:"absolute inset-x-0 bottom-0 h-6 bg-gradient-to-t from-surface-base to-transparent z-10"}),(0,t.jsx)("div",{className:"absolute inset-x-0 top-0 h-6 bg-gradient-to-b from-surface-base to-transparent z-10"}),(0,t.jsxs)("div",{ref:S,style:{scrollPaddingBlock:"1rem"},className:(0,f.cn)("flex flex-col gap-1 h-full overflow-y-auto py-4"),children:[null==b?void 0:b.map(e=>{let{conversation:i,matchedWords:s,matchType:n,highlight:d}=e;return(0,t.jsx)("div",{"data-selected":u===i.conversationId,onMouseEnter:()=>B(i.conversationId),onMouseLeave:G,className:"relative z-0",children:(0,t.jsx)(iJ,{conversation:i,matchedWords:s,matchType:n,highlight:d,isSelected:u===i.conversationId,isEditing:a===i.conversationId,isDeleting:r===i.conversationId,newTitle:l,onNewTitleChange:c,onSelect:_,onEditStart:P,onDeleteStart:o,onToggleFavorite:z,onEditSave:R,onDeleteConfirm:L,onCancel:D})},i.conversationId)}),T&&(0,t.jsxs)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},className:"flex w-full justify-center items-center gap-3 py-2",children:[(0,t.jsx)("p",{className:"text-fg-tertiary text-sm",children:e("history.loading-more","Loading more")}),(0,t.jsx)(O.Spinner,{size:"xs"})]},"loading-more"),(0,t.jsx)("div",{ref:N,className:"h-[1px] flex justify-center !m-0 !p-0"})]})]}):I&&!y?(0,t.jsx)(H.motion.div,{variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.1},className:"flex flex-col gap-1 py-4",children:Array.from({length:3}).map((e,i)=>(0,t.jsx)(eC.Skeleton,{className:"h-[48px] w-full rounded-2xl"},i))},"skeletons"):!I&&!M&&(y?(0,t.jsx)(H.motion.div,{variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.1},className:"flex flex-col gap-1 pt-20",children:(0,t.jsx)("div",{className:"text-center text-fg-secondary px-4",children:e("history.no-conversations-found","No conversations found")})},"no-results"):(0,t.jsx)(H.motion.div,{variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.1},children:(0,t.jsx)(iQ,{title:e("history.empty-history.title","No conversations yet"),description:e("history.empty-history.description","Start a conversation to see your history here"),cta:e("history.empty-history.new-chat","New Chat"),onClick:()=>h()})},"empty"))})]})})},iJ=(0,w.memo)(e=>(0,t.jsx)("div",{className:(0,f.cn)("h-[48px] rounded-2xl grid grid-cols-1 grid-rows-1 flex-shrink-0",e.isSelected&&"bg-button-ghost-hover","MATCH_MESSAGE"===e.matchType&&!!e.highlight&&"h-[64px]"),children:(0,t.jsx)(iH.ConversationShortcut,{...e,isSelected:e.isSelected,isHovered:e.isSelected,isCurrent:!1})}));var iZ=e.i(32293),i$=e.i(548312),i0=e.i(969330);let i1=()=>{let{t:e}=(0,k.useTranslation)("base"),{routeToConversation:i}=(0,d.useGrokRouter)(),s=(0,p.useRequestErrorToastFn)(),[a,n]=(0,w.useState)(null),[r,o]=(0,w.useState)(null),[l,c]=(0,Z.useLocalStorage)("history.shared-with-me.order-by","createTime"),[u,m]=(0,w.useState)(!1),{results:h,isLoading:g,refetch:x,isError:v,containerRef:y,loadMoreRef:b,getShareLinkHref:j,handleNavigateToSharedConversation:N}=ew({pageSize:60,orderBy:l}),{mutate:S,isPending:I}=(0,e3.useMutation)({mutationKey:["cloneConversation"],mutationFn:async e=>eg.chatApi.chatCloneConversation({shareLinkId:e,body:{}}),onSuccess:e=>{e.conversation&&i(e.conversation.conversationId)},onError:e=>{s("history-shared-with-me:cloneConversation",e)},onSettled:()=>{o(null)}}),C=(0,w.useCallback)(async e=>{let t=h.find(t=>t.shareLinkId===e);if((null==t?void 0:t.shareLinkId)&&(null==t?void 0:t.publicId)&&!I)return o(t.shareLinkId),S(t.publicId)},[I,S,h]),E=(0,w.useCallback)(e=>{window.open(j(e),"_blank")},[j]),{handleMouseEnter:M,handleMouseLeave:T}=(0,iK.useListSelection)({items:h,selectedId:a,setSelectedId:n,onSelect:N,containerRef:y,getId:e=>e.shareLinkId});return(0,t.jsx)("div",{className:"flex flex-col h-full min-h-0",children:(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:v?(0,t.jsx)(H.motion.div,{variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.1},className:"py-6",children:(0,t.jsx)(tt,{title:e("history.failed-to-load-shared.title","Failed to load shared conversations"),description:e("history.failed-to-load-shared.description","We encountered an issue while loading your shared conversations"),onClick:()=>x()})},"error"):g||h.length?(0,t.jsxs)("div",{className:"flex flex-col h-full overflow-hidden",children:[(0,t.jsx)("div",{className:"px-0.5 pt-0.5 flex-shrink-0",children:(0,t.jsx)("div",{className:"relative z-20",children:(0,t.jsxs)(eR.DropdownMenu,{open:u,onOpenChange:m,children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(R.Button,{shape:"pill",size:"md",variant:"secondary",className:"h-11",children:[(0,t.jsx)("span",{children:"createTime"===l?e("history.shared-with-me.order-by.create-time","Most recent"):e("history.shared-with-me.order-by.view-count","Most popular")}),(0,t.jsx)(eP.ChevronDownIcon,{className:(0,f.cn)("size-3 text-fg-tertiary transition-transform",{"rotate-180":u})})]})}),(0,t.jsxs)(eR.DropdownMenuContent,{children:[(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>c("createTime"),children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 w-full",children:[(0,t.jsx)("span",{children:e("history.shared-with-me.order-by.create-time","Most recent")}),"createTime"===l&&(0,t.jsx)(e_.CheckIcon,{className:"text-fg-primary size-4"})]})}),(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>c("viewCount"),children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 w-full",children:[(0,t.jsx)("span",{children:e("history.shared-with-me.order-by.view-count","Most popular")}),"viewCount"===l&&(0,t.jsx)(e_.CheckIcon,{className:"text-fg-primary size-4"})]})})]})]})})}),(0,t.jsx)(q.AnimatePresence,{mode:"wait",children:h.length>0?(0,t.jsxs)("div",{className:"flex-1 overflow-hidden relative",children:[(0,t.jsx)("div",{className:"absolute inset-x-0 bottom-0 h-6 bg-gradient-to-t from-surface-base to-transparent z-10"}),(0,t.jsx)("div",{className:"absolute inset-x-0 top-0 h-6 bg-gradient-to-b from-surface-base to-transparent z-10"}),(0,t.jsxs)("div",{ref:y,style:{scrollPaddingBlock:"1rem"},className:(0,f.cn)("flex flex-col gap-1 h-full overflow-y-auto py-4"),children:[null==h?void 0:h.map(e=>(0,t.jsx)("div",{"data-selected":a===e.shareLinkId,onMouseEnter:()=>M(e.shareLinkId),onMouseLeave:T,children:(0,t.jsx)(i2,{isSelected:a===e.shareLinkId,shareLink:e,orderBy:l,isLoading:r===e.shareLinkId,onOpenShareLink:N,onStartNewConversation:C,onOpenInNewTab:E})},e.shareLinkId)),(0,t.jsx)("div",{ref:b,className:"h-[1px] flex justify-center !m-0 !p-0"})]})]}):g&&(0,t.jsx)(H.motion.div,{variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.1},className:"flex flex-col gap-1 py-4",children:Array.from({length:3}).map((e,i)=>(0,t.jsx)(eC.Skeleton,{className:"h-[48px] w-full rounded-2xl"},i))},"skeletons")})]}):(0,t.jsx)(H.motion.div,{variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",transition:{duration:.1},children:(0,t.jsx)(iQ,{title:e("history.empty-share-list.title","No shared conversations yet"),description:e("history.empty-share-list.description","Shared conversations will appear here"),onClick:()=>i()})},"no-results")})})},i2=(0,w.memo)(e=>{var i,s,a,n,r;let{isSelected:o,shareLink:l,isLoading:d,orderBy:c,onOpenShareLink:u,onOpenInNewTab:m,onStartNewConversation:p}=e,h=(0,L.useMobileSize)(),{t:g}=(0,k.useTranslation)("base"),x=(0,w.useMemo)(()=>{var e,t;return!!((null==l||null==(e=l.user)?void 0:e.familyName)||(null==l||null==(t=l.user)?void 0:t.givenName))},[l]);return(0,t.jsx)("div",{className:(0,f.cn)("h-[48px] rounded-2xl grid grid-cols-1 grid-rows-1 flex-shrink-0",o&&"bg-button-ghost-hover"),onClick:()=>u(l.shareLinkId),children:(0,t.jsxs)("div",{className:(0,f.cn)("flex cursor-pointer items-center px-3 col-start-1 col-end-2 row-start-1 row-end-2"),children:[(0,t.jsx)("div",{className:"flex-grow min-w-0",children:(0,t.jsx)("div",{className:"flex items-center w-full",children:(0,t.jsx)("div",{className:"truncate text-primary",children:(null==(i=l.conversation)?void 0:i.title)||"Untitled Conversation"})})}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"w-32 flex justify-start items-center",children:!h&&(0,t.jsxs)(eK.Tooltip,{children:[(0,t.jsx)(eK.TooltipTrigger,{disabled:!x,asChild:!0,children:(0,t.jsx)("div",{className:"flex items-center gap-2 w-full",children:x?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i0.Avatar,{user:null==l?void 0:l.user,className:"size-6",textClassName:"text-[12px]"}),(0,t.jsx)("span",{className:"text-fg-secondary text-sm truncate",children:"".concat((null==l||null==(s=l.user)?void 0:s.givenName)||""," ").concat((null==l||null==(a=l.user)?void 0:a.familyName)||"")})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eC.Skeleton,{className:"size-6 rounded-full flex-shrink-0"}),(0,t.jsx)(eC.Skeleton,{className:"w-full h-[16px] flex-shrink-0 flex-grow"})]})})}),x&&(0,t.jsx)(eK.TooltipContent,{side:"top",align:"center",children:"".concat((null==l||null==(n=l.user)?void 0:n.givenName)||""," ").concat((null==l||null==(r=l.user)?void 0:r.familyName)||"")})]})}),(0,t.jsx)("div",{className:"z-20 w-".concat(28," text-right"),children:d?(0,t.jsx)("div",{className:"flex items-center w-full justify-end",children:(0,t.jsx)(O.Spinner,{size:"xs",className:"mx-2"})}):h||o?(0,t.jsxs)("div",{className:"flex items-center gap-2 justify-end w-full",children:[(0,t.jsx)(R.ButtonWithTooltip,{tabIndex:-1,variant:"tertiary",size:"sm",shape:"square",onClick:e=>{e.stopPropagation(),m(l.shareLinkId)},tooltipContent:g("New Tab","New Tab"),"aria-label":g("New Tab","New Tab"),children:(0,t.jsx)(i$.SquareArrowOutUpRightIcon,{size:16,className:"text-primary"})}),(0,t.jsx)(R.ButtonWithTooltip,{tabIndex:-1,variant:"tertiary",size:"sm",shape:"square",onClick:e=>{e.stopPropagation(),p(l.shareLinkId)},tooltipContent:g("history.start-conversation","Start new converation"),"aria-label":g("history.start-conversation","Start new converation"),children:(0,t.jsx)(iZ.ArrowRightIcon,{size:16,className:"text-primary"})})]}):"createTime"===c?l.createTime&&(0,t.jsx)(iH.Timestamp,{conversation:{createTime:l.createTime,modifyTime:l.createTime}}):"viewCount"===c&&(0,t.jsx)("span",{className:"text-fg-secondary text-sm",children:g("history.shared-with-me.views",{count:parseInt(l.viewCount||"0"),defaultValue_one:"{{count}} view",defaultValue_other:"{{count}} views"})})})]})]})})}),i5=()=>{let e=(0,A.useLogEvent)(),i=(0,b.usePathname)(),s=(0,b.useRouter)(),{t:a}=(0,k.useTranslation)("base"),n=(0,w.useCallback)(()=>{e("sign_in_redirect",void 0,{location:"history-anon-page"});let t=new URLSearchParams({return_to:i}).toString();s.push("/sign-in?".concat(t))},[e,s,i]),r=(0,w.useCallback)(()=>{e("sign_up_redirect",void 0,{location:"history-anon-page"});let t=new URLSearchParams({return_to:i}).toString();s.push("/sign-up?".concat(t))},[e,s,i]);return(0,t.jsx)("div",{className:"flex flex-col h-full p-4 justify-center items-center",children:(0,t.jsxs)("div",{className:"max-w-xl flex flex-col items-center justify-center",children:[(0,t.jsx)("h1",{className:"text-3xl font-medium text-center whitespace-pre",children:a("history.anon.title","Conversation History")}),(0,t.jsx)("p",{className:"mt-6 text-secondary text-center",children:a("history.anon.description","Sign in to view and manage your past conversations with Grok.")}),(0,t.jsxs)("div",{className:"flex justify-center gap-2 mt-8",children:[(0,t.jsxs)(R.Button,{size:"sm",variant:"primary",shape:"pill",onClick:r,children:[(0,t.jsx)(X.User,{size:16,strokeWidth:2}),(0,t.jsx)("div",{children:a("Sign up","Sign up")})]}),(0,t.jsx)(R.Button,{size:"sm",variant:"secondary",shape:"pill",onClick:n,children:(0,t.jsx)("div",{children:a("Sign in","Sign in")})})]})]})})};function i4(){let{t:e}=(0,k.useTranslation)("base"),{currentTeam:i}=(0,ed.useEnterprise)(),{route:s}=(0,x.useRouting)(),{user:a}=(0,r.useSession)(),n=(0,d.useGrokRouter)(),[o,l]=(0,w.useState)(!1),c=(0,p.useRequestErrorToastFn)(),u=(0,e6.useQueryClient)(),m="history"===s.page&&s.tab||"conversations";return i||"shared-with-me"!==m||(m="conversations"),(0,t.jsxs)("main",{className:(0,f.cn)("h-dvh w-full relative flex flex-col items-center"),children:[(0,t.jsx)(t0.ChatTopNav,{hideIncognito:!0}),a?(0,t.jsx)("div",{className:"max-w-[50rem] px-6 @lg:px-2 pt-16 @sm:pt-18 mx-auto w-full flex flex-col h-full items-center pb-4",children:(0,t.jsxs)("div",{className:"flex flex-col gap-4 w-full flex-1 min-h-0",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center justify-between px-2.5",children:[(0,t.jsx)("span",{className:"text-2xl font-semibold",children:e("history.title","History")}),(0,t.jsx)(R.Button,{variant:o?"danger":"secondary",size:"sm",shape:"rectangle",onBlur:()=>l(!1),onClick:()=>{o?(v.useConversationStore.getState().fetchSoftDeleteAllConversations().then(()=>{N.toast.success(e("history.delete-success","All conversations have been deleted successfully")),u.invalidateQueries({queryKey:["conversations"]}),n.routeToConversation(void 0)}).catch(t=>{c("history.delete-all",t,e("history.delete-failed","Failed to delete conversations"))}),l(!1)):l(!0)},children:o?e("history.delete-confirm","Are you sure?"):e("history.delete-all","Delete All")})]}),(0,t.jsxs)(iq.Tabs,{value:m,className:"flex flex-col flex-1 min-h-0",children:[(0,t.jsx)(er.EnterpriseWrapper,{requireSelectedTeam:!0,children:(0,t.jsxs)(iq.TabsList,{className:"bg-transparent border-none relative w-full justify-start p-0 px-1 mt-4",children:[(0,t.jsx)(iq.TabsTrigger,{value:"conversations",variant:"underline",className:"px-2",asChild:!0,children:(0,t.jsx)(x.Link,{route:{page:"history",tab:"conversations"},className:"font-semibold",children:e("history.my-conversations","My Conversations")})}),(0,t.jsx)(iq.TabsTrigger,{value:"shared-with-me",variant:"underline",className:"px-2",asChild:!0,children:(0,t.jsx)(x.Link,{route:{page:"history",tab:"shared-with-me"},className:"font-semibold",children:e("history.shared-with-me","Shared with me")})}),(0,t.jsx)("div",{className:"absolute inset-x-1 bottom-0 border-b border-border-l2"})]})}),(0,t.jsx)(iq.TabsContent,{value:"conversations",className:"mt-4 flex-1 min-h-0 focus-visible:ring-0",children:(0,t.jsx)(iX,{})}),(0,t.jsx)(er.EnterpriseWrapper,{requireSelectedTeam:!0,children:(0,t.jsx)(iq.TabsContent,{value:"shared-with-me",className:"mt-4 flex-1 min-h-0 focus-visible:ring-0",children:(0,t.jsx)(i1,{})})})]})]})}):(0,t.jsx)(i5,{})]})}var i3=e.i(10134),i6=e.i(432517);function i8(){let{t:e}=(0,k.useTranslation)("base");return(0,t.jsxs)("div",{className:"w-full min-h-dvh flex flex-col items-center justify-center pt-4",children:[(0,t.jsx)(x.Link,{route:{page:"main"},className:"block focus:outline-none focus-visible:ring-1 focus-visible:ring-ring rounded-lg",children:(0,t.jsx)(a.GrokWordLogo,{height:20,width:60,className:"opacity-80 hover:opacity-100 fill-black dark:fill-white"})}),(0,t.jsx)(i6.ErrorCard,{title:e("pages.forbidden-business.title","Access Denied"),description:e("pages.forbidden-business.description","This feature was disabled by your organization. Please contact your administrator for more information."),cta:e("pages.forbidden-business.home","Return to home")})]})}var i9=e.i(829735);e.i(303583);var i7=e.i(868275),se=e.i(564448);e.i(602723);var st=e.i(562929),si=e.i(130317);function ss(){w.default.useEffect(()=>{sa.getState().setConfigs({tv_poll_rate:2e4,feed_polling_rate:1e4,feed_num_columns:2,photo_roll_id:"e97e0435-e8d0-4640-a31d-ec26bf6ab09e",tv_feed_id:"92004b18-f4f7-4f82-b453-fa06b8d1b1f2",total_tvs:2,theme_options:[],screen_idle_timeout:3e4})},[])}(0,se.createStore)(class{constructor(e,t){(0,i7._)(this,"set",void 0),(0,i7._)(this,"get",void 0),(0,i7._)(this,"scrollPositionByPageId",void 0),(0,i7._)(this,"positionerByKey",void 0),(0,i7._)(this,"positionerLastItemCount",void 0),(0,i7._)(this,"getScrollPosition",void 0),(0,i7._)(this,"getPositioner",void 0),(0,i7._)(this,"setPositioner",void 0),(0,i7._)(this,"reset",void 0),this.set=e,this.get=t,this.scrollPositionByPageId={},this.positionerByKey={},this.positionerLastItemCount={},this.getScrollPosition=e=>{var t;return null!=(t=this.get().scrollPositionByPageId[e])?t:0},this.getPositioner=(e,t)=>{var i;return t<(null!=(i=this.get().positionerLastItemCount[e])?i:0)?void this.set(()=>({positionerByKey:{...this.get().positionerByKey,[e]:void 0}})):(this.set(()=>({positionerLastItemCount:{...this.get().positionerLastItemCount,[e]:t}})),this.get().positionerByKey[e])},this.setPositioner=(e,t,i)=>{this.set(()=>({positionerByKey:{...this.get().positionerByKey,[e]:t}})),"number"==typeof i?this.set(()=>({positionerLastItemCount:{...this.get().positionerLastItemCount,[e]:i}})):this.set(()=>({positionerLastItemCount:{...this.get().positionerLastItemCount,[e]:0}}))},this.reset=()=>{this.set(()=>({scrollPositionByPageId:{},positionerByKey:{},positionerLastItemCount:{}}))}}},"useScrollStore");let sa=(0,se.createStore)(class{constructor(e,t){(0,i7._)(this,"set",void 0),(0,i7._)(this,"get",void 0),(0,i7._)(this,"photoRollPollingInterval",void 0),(0,i7._)(this,"byId",void 0),(0,i7._)(this,"tvItemsById",void 0),(0,i7._)(this,"selectedAsset",void 0),(0,i7._)(this,"list",void 0),(0,i7._)(this,"tv_poll_rate",void 0),(0,i7._)(this,"feed_polling_rate",void 0),(0,i7._)(this,"feed_num_columns",void 0),(0,i7._)(this,"photo_roll_id",void 0),(0,i7._)(this,"tv_feed_id",void 0),(0,i7._)(this,"total_tvs",void 0),(0,i7._)(this,"theme_options",void 0),(0,i7._)(this,"screen_idle_timeout",void 0),(0,i7._)(this,"enabled",void 0),(0,i7._)(this,"asset_path",void 0),(0,i7._)(this,"email_str",void 0),(0,i7._)(this,"thanks_str1",void 0),(0,i7._)(this,"thanks_str2",void 0),(0,i7._)(this,"thanks_str3",void 0),(0,i7._)(this,"image_model_name",void 0),(0,i7._)(this,"show_legal_terms",void 0),(0,i7._)(this,"prefix_url_to_prompt",void 0),(0,i7._)(this,"use_old_polling",void 0),(0,i7._)(this,"setConfigs",void 0),(0,i7._)(this,"setSelectedAsset",void 0),(0,i7._)(this,"fetchPhotoRoll",void 0),(0,i7._)(this,"fetchTvFeed",void 0),(0,i7._)(this,"getTvItem",void 0),(0,i7._)(this,"startPhotoRollPolling",void 0),(0,i7._)(this,"stopPhotoRollPolling",void 0),(0,i7._)(this,"submitImageForProcessing",void 0),(0,i7._)(this,"_submitImageForProcessing",void 0),(0,i7._)(this,"throwToTv",void 0),this.set=e,this.get=t,this.photoRollPollingInterval=null,this.byId={},this.tvItemsById={},this.selectedAsset=null,this.list=[],this.tv_poll_rate=5e3,this.feed_polling_rate=5e3,this.feed_num_columns=2,this.photo_roll_id="xxx-e97e0435-e8d0-4640-a31d-ec26bf6ab09e",this.tv_feed_id="xxx-92004b18-f4f7-4f82-b453-fa06b8d1b1f2",this.total_tvs=2,this.theme_options=[],this.screen_idle_timeout=3e4,this.enabled=!1,this.asset_path="",this.email_str="-",this.thanks_str1="-",this.thanks_str2="-",this.thanks_str3="-",this.image_model_name="imagine",this.show_legal_terms=!0,this.prefix_url_to_prompt=!0,this.use_old_polling=!1,this.setConfigs=e=>{var t,i,s,a,n,r,o,l,d,c,u,m,p,h,g,x,f,v;let y=this.get(),b=null!=(t=e.tv_poll_rate)?t:y.tv_poll_rate,j=null!=(i=e.feed_polling_rate)?i:y.feed_polling_rate,w=null!=(s=e.feed_num_columns)?s:y.feed_num_columns,k=null!=(a=e.photo_roll_id)?a:y.photo_roll_id,N=null!=(n=e.tv_feed_id)?n:y.tv_feed_id,S=null!=(r=e.total_tvs)?r:y.total_tvs,I=null!=(o=e.theme_options)?o:y.theme_options,C=null!=(l=e.screen_idle_timeout)?l:y.screen_idle_timeout,E=null!=(d=e.enabled)?d:y.enabled,M=null!=(c=e.asset_path)?c:y.asset_path,T=null!=(u=e.email_str)?u:y.email_str,_=null!=(m=e.thanks_str1)?m:y.thanks_str1,P=null!=(p=e.thanks_str2)?p:y.thanks_str2,R=null!=(h=e.thanks_str3)?h:y.thanks_str3,A=null!=(g=e.image_model_name)?g:y.image_model_name,L=null!=(x=e.show_legal_terms)?x:y.show_legal_terms,D=null!=(f=e.prefix_url_to_prompt)?f:y.prefix_url_to_prompt,z=null!=(v=e.use_old_polling)?v:y.use_old_polling;this.set(e=>({...e,tv_poll_rate:b,feed_polling_rate:j,feed_num_columns:w,photo_roll_id:k,tv_feed_id:N,total_tvs:S,theme_options:I,screen_idle_timeout:C,enabled:E,asset_path:M,email_str:T,thanks_str1:_,thanks_str2:P,thanks_str3:R,image_model_name:A,show_legal_terms:L,prefix_url_to_prompt:D,use_old_polling:z}))},this.setSelectedAsset=e=>{this.set(t=>({...t,selectedAsset:e}))},this.fetchPhotoRoll=async()=>{let e=await eg.assetRepositoryApi.assetRepositoryListAssetMetadata({workspaceId:this.get().photo_roll_id,pageSize:1e4,orderBy:st.AssetRepositoryListAssetMetadataOrderByEnum.OrderByCreateTime}),t={};return this.set(i=>{var s;return{...i,byId:(null==(s=e.assets)?void 0:s.filter(e=>!!e.assetId).reduce((e,t)=>({...e,[t.assetId]:t}),t))||{}}}),e},this.fetchTvFeed=async()=>{let e=await eg.assetRepositoryApi.assetRepositoryListAssetMetadata({workspaceId:this.get().tv_feed_id,pageSize:1e4,orderBy:st.AssetRepositoryListAssetMetadataOrderByEnum.OrderByLastUseTime}),t={};return this.set(i=>{var s;return{...i,tvItemsById:(null==(s=e.assets)?void 0:s.filter(e=>!!e.assetId).reduce((e,t)=>({...e,[t.assetId]:t}),t))||{}}}),e},this.getTvItem=e=>{let t=this.get().total_tvs,i=Object.values(this.get().tvItemsById).sort((e,t)=>(e.lastUseTime?new Date(e.lastUseTime).getTime():0)-(t.lastUseTime?new Date(t.lastUseTime).getTime():0)),s=i.length,a=[],n=Math.max(0,s-t);for(;n<s;n++)a[n%t]=i[n];return a[e]},this.startPhotoRollPolling=e=>{let t=this.get().feed_polling_rate;if(this.get().use_old_polling)this.stopPhotoRollPolling(),this.photoRollPollingInterval=setInterval(async()=>{await this.fetchPhotoRoll(),await this.fetchTvFeed()},t),setTimeout(async()=>{await this.fetchPhotoRoll(),await this.fetchTvFeed()},0);else{let i=async()=>{try{"photo_roll"===e?await this.fetchPhotoRoll():await this.fetchTvFeed()}catch(e){(0,h.logError)("ImagineCarpetStore:startPhotoRollPolling",e)}this.stopPhotoRollPolling(),this.photoRollPollingInterval=setTimeout(i,t)};i().catch(e=>{(0,h.logError)("ImagineCarpetStore:startPhotoRollPolling",e)})}},this.stopPhotoRollPolling=()=>{var e,t;this.get().use_old_polling?clearInterval(null!=(e=this.photoRollPollingInterval)?e:0):clearTimeout(null!=(t=this.photoRollPollingInterval)?t:0),this.photoRollPollingInterval=null},this.submitImageForProcessing=async(e,t,i)=>{for(let s=0;s<3;s++){try{let s=await this._submitImageForProcessing(e,t,i);if("error_try_again"===s)continue;return}catch(e){(0,h.logError)("generateVideoForImage",e)}await new Promise(e=>setTimeout(e,500))}},this._submitImageForProcessing=async(e,t,i)=>{let s,a=e.split("/").filter(e=>e.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/i)).map(e=>e.slice(0,36)).pop(),n=this.get().image_model_name,r=this.get().prefix_url_to_prompt?e+" "+t:t,{raw:o}=await eg.chatApi.chatCreateConversationAndRespondRaw({body:{fileAttachments:[a||e],modelName:"grok-3",message:r,responseMetadata:{modelConfigOverride:{modelMap:{imageEditModel:n}}},toolOverrides:{imageGen:!0},...sn}}),l=(0,si.processChunks)(o),d="",c="";try{for await(let e of l){var u,m,p;let t=null==(u=e.result)?void 0:u.response,i=null==(m=e.result)?void 0:m.conversation;i&&(d=null!=(p=i.conversationId)?p:""),(null==t?void 0:t.responseId)&&(c=t.responseId)}let e=new Date().toLocaleTimeString("en-US",{hour:"numeric",minute:"numeric",hour12:!0});await new Promise(e=>setTimeout(e,1e3));try{await eg.chatApi.chatAddResponse({conversationId:d,body:{modelName:"grok-3",message:"Repeat this exactly:\n "+e+"\n\n"+i,toolOverrides:{imageGen:!1},parentResponseId:c,...sn}})}catch(e){(0,h.logError)("ImagineCarpetStore:submitImageForProcessing",e)}await new Promise(e=>setTimeout(e,1e3));let t=i.split("@")[0];d&&await eg.chatApi.chatUpdateConversation({conversationId:d,body:{title:e+" - "+t}})}catch(e){(0,h.logError)("ImagineCarpetStore:submitImageForProcessing",e)}return s},this.throwToTv=async e=>{let t=e.split("/"),i=t[t.length-2];if(!i)return;let s=await eg.assetRepositoryApi.assetRepositoryShareAsset({assetId:i,shareWithTeamMembers:!1,teamMembersToShare:[]}),a=await eg.assetRepositoryApi.assetRepositoryCloneAsset({assetId:s.rootAssetId||""});await eg.workspaceRepositoryApi.workspaceRepositoryAddAsset({workspaceId:this.get().tv_feed_id,body:{assetId:a.assetId}})}}},"useImagineCarpetStore");(0,se.observe)(sa,"byId","list",e=>Object.values(e).sort((e,t)=>{let i=e.createTime?new Date(e.createTime).getTime():0;return(t.createTime?new Date(t.createTime).getTime():0)-i}));let sn={enableImageGeneration:!0,returnImageBytes:!1,returnRawGrokInXaiRequest:!1,enableImageStreaming:!0,imageGenerationCount:4,forceConcise:!1,enableSideBySide:!1,sendFinalMetadata:!0,isReasoning:!1,disableTextFollowUps:!0,disableMemory:!1,forceSideBySide:!1},sr=(e,t)=>{let i,s,a=t||so;return function(){return i&&a(arguments,i)?s:s=e.apply(null,i=arguments)}},so=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3],sl=class{constructor(){let e,t;this.set=void 0,this.get=void 0,this.get=i=>i===e?t:void 0,this.set=(i,s)=>{e=i,t=s}}},sd=e=>{let t=w.useRef(e);return w.useEffect(()=>{t.current=e}),t},sc=e=>{try{return new e}catch(t){let e={};return{set(t,i){e[t]=i},get:t=>e[t]}}},su=(e,t)=>{let i,{g:s,s:a}=(e=>{let t,i,s,a,n=e.length,r=sc(e[0]),o=1===n;return n<3?{g:e=>void 0===(t=r.get(e[0]))||o?t:t.get(e[1]),s:(s,a)=>(o?r.set(s[0],a):void 0===(t=r.get(s[0]))?((i=sc(e[1])).set(s[1],a),r.set(s[0],i)):t.set(s[1],a),a)}:{g:e=>{for(s=0,a=r;s<n;s++)if(void 0===(a=a.get(e[s])))return;return a},s:(t,o)=>{for(s=0,a=r;s<n-1;s++)void 0===(i=a.get(t[s]))&&(i=sc(e[s+1]),a.set(t[s],i)),a=i;return a.set(t[n-1],o),o}}})(e);return function(){return void 0===(i=s(arguments))?a(arguments,t.apply(null,arguments)):i}},sm=new WeakMap;function sp(){let e=w.useState(sh)[1];return w.useRef(()=>e({})).current}let sh={},sg=w.createElement;function sx(e){let t,{positioner:i,resizeObserver:s,items:a,as:n="div",id:r,className:o,style:l,role:d="grid",tabIndex:c=0,containerRef:u,itemAs:m="div",itemStyle:p,itemHeightEstimate:h=300,itemKey:g=sw,overscanBy:x=2,scrollTop:f,isScrolling:v,height:y,render:b,onRender:j}=e,k=0,N=sp(),S=sN(i,s),I=a.length,{columnWidth:C,columnCount:E,range:M,estimateHeight:T,size:_,shortestColumn:P}=i,R=_(),A=P(),L=[],D="list"===d?"listitem":"grid"===d?"gridcell":void 0,z=sd(j),B=f+(x*=y),G=A<B&&R<I;if(M(Math.max(0,f-x/2),B,(e,i,s)=>{let n=a[e],r=g(n,e),o={top:s,left:i,width:C,writingMode:"horizontal-tb",position:"absolute"};L.push(sg(m,{key:r,ref:S(e),role:D,style:"object"==typeof p&&null!==p?Object.assign({},o,p):o},sv(b,e,n,C))),void 0===t?(k=e,t=e):(k=Math.min(k,e),t=Math.max(t,e))}),G){let e=Math.min(I-R,Math.ceil((f+x-A)/h*E)),t=R,i=sk(C);for(;t<R+e;t++){let e=a[t],s=g(e,t);L.push(sg(m,{key:s,ref:S(t),role:D,style:"object"==typeof p?Object.assign({},i,p):i},sv(b,t,e,C)))}}w.useEffect(()=>{"function"==typeof z.current&&void 0!==t&&z.current(k,t,a),sf="1"},[k,t,a,z]),w.useEffect(()=>{G&&N()},[G,i]);let F=sy(v,T(I,h));return sg(n,{ref:u,key:sf,id:r,role:d,className:o,tabIndex:c,style:"object"==typeof l?sj(F,l):F,children:L})}let sf="0",sv=su([sl,{},WeakMap,sl],(e,t,i,s)=>sg(e,{index:t,data:i,width:s})),sy=sr((e,t)=>({position:"relative",width:"100%",maxWidth:"100%",height:Math.ceil(t),maxHeight:Math.ceil(t),willChange:e?"contents":void 0,pointerEvents:e?"none":void 0})),sb=(e,t)=>e[0]===t[0]&&e[1]===t[1],sj=sr((e,t)=>Object.assign({},e,t),sb);function sw(e,t){return t}let sk=sr(e=>({width:e,zIndex:-1e3,visibility:"hidden",position:"absolute",writingMode:"horizontal-tb"}),(e,t)=>e[0]===t[0]),sN=sr((e,t)=>i=>s=>{null!==s&&(t&&(t.observe(s),sm.set(s,i)),void 0===e.get(i)&&e.set(i,s.offsetHeight))},sb),sS={low:0,max:0,high:0,C:2,P:void 0,R:void 0,L:void 0,list:void 0};function sI(e){let t=e.high;e.L===sS&&e.R===sS?e.max=t:e.L===sS?e.max=Math.max(e.R.max,t):e.R===sS?e.max=Math.max(e.L.max,t):e.max=Math.max(Math.max(e.L.max,e.R.max),t)}function sC(e){let t=e;for(;t.P!==sS;)sI(t.P),t=t.P}function sE(e,t){if(t.R===sS)return;let i=t.R;t.R=i.L,i.L!==sS&&(i.L.P=t),i.P=t.P,t.P===sS?e.root=i:t===t.P.L?t.P.L=i:t.P.R=i,i.L=t,t.P=i,sI(t),sI(i)}function sM(e,t){if(t.L===sS)return;let i=t.L;t.L=i.R,i.R!==sS&&(i.R.P=t),i.P=t.P,t.P===sS?e.root=i:t===t.P.R?t.P.R=i:t.P.L=i,i.R=t,t.P=i,sI(t),sI(i)}function sT(e,t,i){t.P===sS?e.root=i:t===t.P.L?t.P.L=i:t.P.R=i,i.P=t.P}sS.P=sS,sS.L=sS,sS.R=sS;let s_=function(e,t,i,s){void 0===i&&(i=0),void 0===s&&(s=i);let a=function(){let e={root:sS,size:0},t={};return{insert(i,s,a){let n,r=e.root,o=sS;for(;r!==sS&&i!==(o=r).low;)r=i<r.low?r.L:r.R;if(i===o.low&&o!==sS){if(!function(e,t,i){let s,a=e.list;for(;a;){if(a.index===i)return!1;if(t>a.high)break;s=a,a=a.next}return s||(e.list={index:i,high:t,next:a}),s&&(s.next={index:i,high:t,next:s.next}),!0}(o,s,a))return;o.high=Math.max(o.high,s),sI(o),sC(o),t[a]=o,e.size++;return}let l={low:i,high:s,max:s,C:0,P:o,L:sS,R:sS,list:{index:a,high:s,next:null}};o===sS?e.root=l:(l.low<o.low?o.L=l:o.R=l,sC(l));for(var d=l;0===d.P.C;)d.P===d.P.P.L?0===(n=d.P.P.R).C?(d.P.C=1,n.C=1,d.P.P.C=0,d=d.P.P):(d===d.P.R&&sE(e,d=d.P),d.P.C=1,d.P.P.C=0,sM(e,d.P.P)):0===(n=d.P.P.L).C?(d.P.C=1,n.C=1,d.P.P.C=0,d=d.P.P):(d===d.P.L&&sM(e,d=d.P),d.P.C=1,d.P.P.C=0,sE(e,d.P.P));e.root.C=1,t[a]=l,e.size++},remove(i){let s,a=t[i];if(void 0===a)return;delete t[i];let n=function(e,t){let i=e.list;if(i.index===t)return null===i.next?0:(e.list=i.next,1);let s=i;for(i=i.next;null!==i;){if(i.index===t)return s.next=i.next,1;s=i,i=i.next}}(a,i);if(void 0===n)return;if(1===n){a.high=a.list.high,sI(a),sC(a),e.size--;return}let r=a,o=r.C;a.L===sS?(s=a.R,sT(e,a,a.R)):a.R===sS?(s=a.L,sT(e,a,a.L)):(o=(r=function(e){for(;e.L!==sS;)e=e.L;return e}(a.R)).C,s=r.R,r.P===a?s.P=r:(sT(e,r,r.R),r.R=a.R,r.R.P=r),sT(e,a,r),r.L=a.L,r.L.P=r,r.C=a.C),sI(s),sC(s),1===o&&function(e,t){let i;for(;t!==sS&&1===t.C;)t===t.P.L?(0===(i=t.P.R).C&&(i.C=1,t.P.C=0,sE(e,t.P),i=t.P.R),1===i.L.C&&1===i.R.C?(i.C=0,t=t.P):(1===i.R.C&&(i.L.C=1,i.C=0,sM(e,i),i=t.P.R),i.C=t.P.C,t.P.C=1,i.R.C=1,sE(e,t.P),t=e.root)):(0===(i=t.P.L).C&&(i.C=1,t.P.C=0,sM(e,t.P),i=t.P.L),1===i.R.C&&1===i.L.C?(i.C=0,t=t.P):(1===i.L.C&&(i.R.C=1,i.C=0,sE(e,i),i=t.P.L),i.C=t.P.C,t.P.C=1,i.L.C=1,sM(e,t.P),t=e.root));t.C=1}(e,s),e.size--},search(t,i,s){let a=[e.root];for(;0!==a.length;){let e=a.pop();if(e!==sS&&!(t>e.max)&&(e.L!==sS&&a.push(e.L),e.R!==sS&&a.push(e.R),e.low<=i&&e.high>=t)){let i=e.list;for(;null!==i;)i.high>=t&&s(i.index,e.low),i=i.next}}},get size(){return e.size}}}(),n=Array(e),r=[],o=Array(e);for(let t=0;t<e;t++)n[t]=0,o[t]=[];return{columnCount:e,columnWidth:t,set:function(e,l){void 0===l&&(l=0);let d=0;for(let e=1;e<n.length;e++)n[e]<n[d]&&(d=e);let c=n[d]||0;n[d]=c+l+s,o[d].push(e),r[e]={left:d*(t+i),top:c,height:l,column:d},a.insert(c,c+l,e)},get:e=>r[e],update:t=>{let i=Array(e),l=0,d=0;for(;l<t.length-1;l++){let e=t[l],s=r[e];s.height=t[++l],a.remove(e),a.insert(s.top,s.top+s.height,e),i[s.column]=void 0===i[s.column]?e:Math.min(e,i[s.column])}for(l=0;l<i.length;l++){if(void 0===i[l])continue;let e=o[l],t=sP(e,i[l]),c=r[o[l][t]];for(n[l]=c.top+c.height+s,d=t+1;d<e.length;d++){let t=e[d],i=r[t];i.top=n[l],n[l]=i.top+i.height+s,a.remove(t),a.insert(i.top,i.top+i.height,t)}}},range:(e,t,i)=>a.search(e,t,(e,t)=>i(e,r[e].left,t)),estimateHeight:(t,i)=>{let s=Math.max(0,Math.max.apply(null,n));return t===a.size?s:s+Math.ceil((t-a.size)/e)*i},shortestColumn:()=>n.length>1?Math.min.apply(null,n):n[0]||0,size:()=>a.size,all:()=>r}},sP=(e,t)=>{let i=0,s=e.length-1;for(;i<=s;){let a=i+s>>>1,n=e[a];if(n===t)return a;n<=t?i=a+1:s=a-1}return -1},sR=function(e,t,i,s,a,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=8),s=s||Math.min(Math.floor((e+i)/(t+i)),a||1/0)||1;let r=Math.floor((e-i*(s-1))/s);return void 0!==n&&r>n&&(r=n),[r,s]},sA=[],sL=function(e){var t=[],i=null,s=function(){for(var s=arguments.length,a=Array(s),n=0;n<s;n++)a[n]=arguments[n];t=a,i||(i=requestAnimationFrame(function(){i=null,e.apply(void 0,t)}))};return s.cancel=function(){i&&(cancelAnimationFrame(i),i=null)},s};function sD(e){let t=sB(e,sp());function i(){return t.disconnect()}return w.useEffect(()=>i,[t]),t}function sz(e){e.cancel()}let sB=su([WeakMap],(e,t)=>{let i=[],s=sL(()=>{i.length>0&&(e.update(i),t(i)),i.length=0}),a=t=>{let a=t.offsetHeight;if(a>0){let s=sm.get(t);if(void 0!==s){let t=e.get(s);void 0!==t&&a!==t.height&&i.push(s,a)}}s()},n=new Map,r=new ResizeObserver(e=>{let t=0;for(;t<e.length;t++){let i=e[t],s=sm.get(i.target);if(void 0===s)continue;let r=n.get(s);r||(r=sL(a),n.set(s,r)),r(i.target)}}),o=r.disconnect.bind(r);return r.disconnect=()=>{o(),n.forEach(sz)},r}),sG=w.default["undefined"!=typeof document&&void 0!==document.createElement?"useLayoutEffect":"useEffect"],sF=function(e,t,i,s){let a=w.useRef(i),n=w.useRef(s);w.useEffect(()=>{a.current=i,n.current=s}),w.useEffect(()=>{let i=e&&"current"in e?e.current:e;if(!i)return;let s=0;function r(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];s||a.current.apply(this,t)}i.addEventListener(t,r);let o=n.current;return()=>{s=1,i.removeEventListener(t,r),o&&o()}},[e,t])};function sO(e){let t=()=>{let{current:t}=e;if(t){let e=getComputedStyle(t),i=parseFloat;return{width:t.clientWidth-i(e.paddingTop)-i(e.paddingBottom),height:t.clientHeight-i(e.paddingLeft)-i(e.paddingRight)}}return{width:0,height:0}},[i,s]=w.useState(t),a=()=>s(t());return sF("undefined"!=typeof window?window:null,"resize",a),sF("undefined"!=typeof window?window:null,"orientationchange",a),sG(()=>{s(t())},[]),i}let sV="undefined",sU=typeof window!==sV?window:{},sq=typeof performance!==sV?performance:Date,sH=()=>sq.now(),sW="AnimationFrame",sK="cancel"+sW,sY="request"+sW,sQ=sU[sY]&&sU[sY].bind(sU),sX=sU[sK]&&sU[sK].bind(sU);if(!sQ||!sX){let e=0;sQ=t=>{let i=sH(),s=Math.max(e+1e3/60,i);return setTimeout(()=>{t(e=s)},s-i)},sX=function(e){return clearTimeout(e)}}let sJ="undefined"!=typeof performance?performance:Date;function sZ(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{offset:i=0,fps:s=12}=t,a=e&&"current"in e?e.current:e,n=()=>a?"scrollTop"in a?a.scrollTop:a.pageYOffset||a.scrollY:0,[r,o]=function(e,t,i){let s=w.useState(e);return[s[0],function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=sd(e),a=1e3/t,n=w.useRef(0),r=w.useRef(),o=()=>r.current&&clearTimeout(r.current),l=[t,i,s];function d(){n.current=0,o()}return w.useEffect(()=>d,l),w.useCallback(function(){let e=arguments,t=sJ.now(),l=()=>{n.current=t,o(),s.current.apply(null,e)},d=n.current;if(i&&0===d)return l();if(t-d>a){if(d>0)return l();n.current=t}o(),r.current=setTimeout(()=>{l(),n.current=0},a)},l)}(s[1],t,void 0)]}(n,s),[l,d]=w.useState(!1);function c(){d(!1)}return sG(()=>{if(a){let e,t=!1,i=()=>e&&void sX(e.v||-1),r=()=>{t||(o(n()),d(!0),i(),e=((e,t)=>{let i=sH(),s={},a=()=>{sH()-i>=t?e.call(null):s.v=sQ(a)};return s.v=sQ(a),s})(c,1e3/s))};return a.addEventListener("scroll",r),()=>{a.removeEventListener("scroll",r),i(),t=!0}}},[a,s]),{scrollTop:Math.max(0,r-i),isScrolling:l}}var s$=e.i(844858),s0=e.i(579899),s0=s0;function s1(){let{route:e}=(0,x.useRouting)(),i=sa(e=>e.enabled),s=sa(e=>e.selectedAsset),[a,n]=(0,w.useState)(null),{resolvedTheme:r,setTheme:o}=(0,ee.useTheme)();return((0,w.useEffect)(()=>{"dark"!==r&&o("dark")},[]),ss(),i)?a?(0,t.jsxs)("div",{className:"w-full h-dvh flex flex-col items-center justify-center gap-4 bg-black",children:[(0,t.jsx)("div",{className:"w-full h-[10%]",children:(0,t.jsx)(s9,{backAction:()=>{n(null)}})}),(0,t.jsx)("div",{className:"w-full h-[90%]",children:(0,t.jsx)("iframe",{allow:"fullscreen",src:a+"?"+new Date().getTime(),className:"w-full h-full"})})]}):"imagine-carpet"===e.page&&void 0!==e.display?(0,t.jsx)(s2,{idx:e.display}):s?(0,t.jsx)(s5,{onBack:()=>{sa.getState().setSelectedAsset(null)}}):(0,t.jsx)(s4,{setIframeSrc:n}):(0,t.jsx)(O.Spinner,{})}function s2(e){var i,s;let{idx:a}=e;ss();let n=(0,w.useRef)(null);(0,w.useEffect)(()=>(sa.getState().startPhotoRollPolling("tv_feed"),()=>{sa.getState().stopPhotoRollPolling()}),[]);let r=sa(e=>e.getTvItem(a-1)),o=(0,_.useEnvironment)().ASSET_SERVER_URL,l=null!=(i=(0,ej.getCachedAssetUrl)(o,null==r?void 0:r.key))?i:"";return(0,t.jsx)("img",{ref:n,src:l,alt:null!=(s=null==r?void 0:r.name)?s:"full screen image",className:"w-full h-dvh object-cover",onClick:function(){var e;null==(e=n.current)||e.requestFullscreen().catch(e=>{(0,h.logError)("TvDisplay:handleClick",e)})}})}function s5(e){var i,s,a;let{onBack:n}=e,r=sa(e=>e.submitImageForProcessing),o=sa(e=>e.setSelectedAsset),[l,d]=(0,w.useState)(!1),[c,u]=(0,w.useState)(!0),[m,p]=(0,w.useState)(0),[g,x]=(0,w.useState)(""),[f,v]=(0,w.useState)(!1),y=(0,w.useRef)(null),b=sa(e=>e.asset_path),j=sa(e=>e.email_str),k=sa(e=>e.thanks_str1),N=sa(e=>e.thanks_str2),S=sa(e=>e.thanks_str3);(0,w.useEffect)(()=>{l&&setTimeout(()=>{o(null),d(!1)},13e3)},[l,o,d]);let I=sa(e=>e.theme_options),C=sa(e=>e.selectedAsset),E=(0,_.useEnvironment)().ASSET_SERVER_URL,M=null!=(s=(0,ej.getCachedAssetUrl)(E,null==C?void 0:C.key))?s:"",T=null!=(a=null==I||null==(i=I[m])?void 0:i.prompt)?a:"",P=(0,w.useCallback)(()=>{d(!0),u(!0),setTimeout(()=>{(async function(){await r(M,null!=T?T:"",g)})().catch(e=>{(0,h.logError)("SelectedAsset:submit",e)})},1)},[r,d,g,u,M,T]),A=(0,w.useCallback)(e=>{p(e),v(!0),setTimeout(()=>{u(!1),v(!1)},250)},[u,v]);return l?(0,t.jsxs)("div",{className:"w-full h-dvh flex flex-col ",children:[(0,t.jsx)("img",{src:"https://data.x.ai/"+b+"/background.png",alt:"Background",className:"absolute top-0 left-0 w-full h-dvh object-cover -z-10"}),(0,t.jsx)(q.AnimatePresence,{mode:"popLayout",children:(0,t.jsxs)(H.motion.div,{className:"flex flex-col items-center justify-center gap-8 w-full h-full",initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},transition:{duration:.3,ease:"circIn"},children:[(0,t.jsx)("h1",{className:"text-5xl font-bold ",children:k}),(0,t.jsx)("p",{className:"text-3xl font-semibold w-full text-center leading-normal",children:N}),(0,t.jsx)("p",{className:"text-3xl font-semibold w-2/3 text-center leading-normal",children:S})]})}),(0,t.jsx)(s8,{})]}):c?(0,t.jsxs)("div",{className:"w-full h-dvh flex flex-col ",children:[(0,t.jsx)(s7,{backAction:n}),(0,t.jsx)("img",{src:"https://data.x.ai/"+b+"/background.png",alt:"Background",className:"absolute top-0 left-0 w-full h-dvh object-cover -z-10"}),(0,t.jsx)("div",{className:"absolute top-10 left-0 w-full flex items-center justify-center pointer-events-none",children:(0,t.jsx)("img",{src:"https://data.x.ai/"+b+"/choose_theme.png",alt:"Choose Photo",width:340.5,height:32.5})}),(0,t.jsx)("div",{className:"w-full h-full flex flex-col items-center justify-center ",children:(0,t.jsx)("div",{className:"flex flex-wrap gap-20 justify-center",children:(0,t.jsx)(q.AnimatePresence,{mode:"wait",children:I.map((e,i)=>{let s=!1;return f&&i===m&&(s=!0),(0,t.jsx)(H.motion.button,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},transition:{duration:.3,ease:"easeIn",delay:.1*i},onClick:e=>{e.stopPropagation(),e.preventDefault(),A(i)},children:(0,t.jsxs)("div",{className:"w-[280px] h-[380px] flex flex-col items-center justify-center gap-1 ",children:[(0,t.jsx)("img",{src:e.image,className:"w-full h-full object-cover"+(s?" ring-4 ring-white":""),alt:"<img>"}),(0,t.jsx)("label",{className:" text-center m-2 font-bold text-xl",children:e.label})]})},i)})})})}),(0,t.jsx)(s8,{bottom:20})]}):(0,t.jsxs)("div",{className:"w-full h-dvh flex flex-col gap-2",children:[(0,t.jsx)(s9,{backAction:()=>{u(!0)}}),(0,t.jsx)("img",{src:"https://data.x.ai/"+b+"/background.png",alt:"Background",className:"absolute top-0 left-0 w-full h-dvh object-cover -z-10"}),(0,t.jsx)("div",{className:"w-full h-2/5 flex items-center justify-center p-4 mt-8",children:(0,t.jsx)(q.AnimatePresence,{mode:"popLayout",children:(0,t.jsx)(H.motion.img,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.5,opacity:0},transition:{duration:.3,ease:"easeIn"},width:225,height:400,src:M,alt:null==C?void 0:C.name,className:"object-cover ",style:{rotate:"10deg"}})})}),(0,t.jsxs)("div",{className:"w-full h-1/2 flex flex-col items-center  gap-4",children:[(0,t.jsx)("h2",{className:"text-[42px] font-bold w-2/3 text-center leading-normal",children:j}),(0,t.jsx)("div",{className:"w-4/5",children:(0,t.jsxs)("form",{className:"w-full flex flex-row items-center justify-center",autoComplete:"off",onSubmit:e=>{var t;e.preventDefault(),(null==(t=y.current)?void 0:t.validity.valid)&&P()},children:[(0,t.jsx)(R.Button,{type:"submit",variant:"none",size:"md",shape:"circle",className:"invisible",children:(0,t.jsx)(s0.default,{className:"size-8"})}),(0,t.jsx)("input",{ref:y,autoComplete:"off",pattern:"[a-z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,}$",spellCheck:"false",autoCapitalize:"none",autoCorrect:"off",type:"email",id:"email",name:"email",required:!0,className:"outline-none w-full font-medium p-10 m-2 border-b-4 border-white bg-transparent text-3xl",placeholder:"ani@grok.com",value:g,onChange:e=>{x(e.target.value)}}),(0,t.jsx)(R.Button,{type:"submit",variant:"none",size:"md",shape:"circle","aria-label":"Submit",children:(0,t.jsx)(s0.default,{className:"size-10"})})]})})]}),(0,t.jsx)(s8,{})]})}function s4(e){let{setIframeSrc:i}=e,[s,a]=(0,w.useState)(!0);(0,w.useEffect)(()=>(sa.getState().startPhotoRollPolling("photo_roll"),()=>{sa.getState().stopPhotoRollPolling()}),[]);let n=sa(e=>e.asset_path),[r,o]=(0,w.useState)(!0),l=sa(e=>e.show_legal_terms),d=(0,w.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),o(!1),setTimeout(()=>{a(!1),o(!0)},250)},[a]),[c,u]=(0,w.useState)(null);return((0,w.useEffect)(()=>{let e="pulse-bright-inline";if(!document.getElementById(e)){let t=document.createElement("style");t.id=e,t.textContent="\n        @keyframes pulse-bright-inline {\n          0%, 100% { filter: brightness(0.8); opacity: 0.75; }\n          50% { filter: brightness(1.8); opacity: 1; }\n        }\n        .pulse-bright-inline {\n          animation: pulse-bright-inline 1s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n        }\n      ",document.head.appendChild(t),u(e)}return()=>{if(c){let e=document.getElementById(c);e&&document.head.removeChild(e)}}},[c]),s)?(0,t.jsxs)("div",{className:"w-full h-dvh flex flex-col bg-black items-center justify-center",onClick:d,children:[(0,t.jsx)("img",{src:"https://data.x.ai/"+n+"/logo2.png",alt:"Logo",width:467,height:140,className:"mix-blend-screen"}),(0,t.jsx)("div",{className:"h-[200px]"}),(0,t.jsx)("div",{className:"w-full flex items-center justify-center",style:{height:"".concat(131,"px")},children:(0,t.jsx)(q.AnimatePresence,{mode:"popLayout",children:r&&(0,t.jsx)(H.motion.img,{initial:{scale:.5,opacity:0},animate:{scale:1,opacity:1},exit:{scale:1.5,opacity:0},transition:{duration:.3,ease:"easeOut"},src:"https://data.x.ai/"+n+"/start_btn.png",alt:"Start",width:432,height:131,className:"mix-blend-screen pulse-bright-inline"})})}),(0,t.jsx)("div",{className:"h-[200px]"}),(0,t.jsx)("div",{className:"h-[140px]"}),(0,t.jsx)(s8,{scale:1.75,includeTerms:l,setIframeSrc:i})]}):(0,t.jsx)(s3,{setShowStartPage:a})}function s3(e){let{setShowStartPage:i}=e,s=sa(e=>e.list),a=(0,w.useRef)(null),n=sa(e=>e.asset_path),{width:r,height:o}=sO(a),l=function(e,t){let{width:i,columnWidth:s=200,columnGutter:a=0,rowGutter:n,columnCount:r,maxColumnCount:o,maxColumnWidth:l}=e;void 0===t&&(t=sA);let d=()=>{let[e,t]=sR(i,s,a,r,o,l);return s_(t,e,a,null!=n?n:a)},c=w.useRef();void 0===c.current&&(c.current=d());let u=w.useRef(t),m=[i,s,a,n,r,o,l],p=w.useRef(m),h=!m.every((e,t)=>p.current[t]===e);if(h||!t.every((e,t)=>u.current[t]===e)){let e=c.current,i=d();if(u.current=t,p.current=m,h){let t=e.size();for(let s=0;s<t;s++){let t=e.get(s);i.set(s,void 0!==t?t.height:0)}}c.current=i}return c.current}({width:r,columnWidth:512,columnGutter:10,columnCount:2,maxColumnCount:5},[r]),d=sD(l),{scrollTop:c,isScrolling:u}=sZ(a);(0,w.useEffect)(()=>{let e;function t(){clearTimeout(e),e=setTimeout(()=>{i(!0)},15e3)}return window.addEventListener("mousemove",t),window.addEventListener("touchstart",t),window.addEventListener("keydown",t),window.addEventListener("touchmove",t),t(),()=>{window.removeEventListener("mousemove",t),window.removeEventListener("touchstart",t),window.removeEventListener("keydown",t),window.removeEventListener("touchmove",t),clearTimeout(e)}},[i,c]);let m=sx({positioner:l,resizeObserver:d,scrollTop:c,isScrolling:u,height:o,itemHeightEstimate:500,items:s,render:s6,onRender:()=>{},overscanBy:5,itemKey:e=>{var t;return null!=(t=null==e?void 0:e.assetId)?t:""},role:"list"});return(0,t.jsxs)("div",{className:"w-full h-dvh flex flex-col bg-black fade-in",children:[(0,t.jsx)("div",{tabIndex:-1,className:"flex flex-col w-full h-dvh overflow-scroll items-center",ref:e=>{a.current=e},children:m}),(0,t.jsx)("div",{className:"w-full h-[364px] absolute top-0 left-0 pointer-events-none",children:(0,t.jsx)("img",{className:"animate-accordion-down",src:"https://data.x.ai/"+n+"/scrim.png",alt:"Choose Photo",width:"100%",height:"100%"})}),(0,t.jsx)("div",{className:"absolute top-10 left-0 w-full flex items-center justify-center pointer-events-none",children:(0,t.jsx)("img",{src:"https://data.x.ai/"+n+"/choose_photo.png",alt:"Choose Photo",width:340.5,height:32.5})})]})}function s6(e){var i;let{data:s,width:a,index:n}=e,{ASSET_SERVER_URL:r}=(0,_.useEnvironment)(),[o,l]=(0,w.useState)(!1),d=null!=(i=(0,ej.getCachedAssetUrl)(r,s.key))?i:"";return(0,t.jsx)("div",{style:{width:a,height:1.5*a},onClick:e=>{o&&sa.getState().setSelectedAsset(s),e.stopPropagation(),e.preventDefault()},children:(0,t.jsx)("img",{onLoad:()=>setTimeout(()=>l(!0),50*Math.min(10,n+1)),className:(0,f.cn)("w-full h-full object-cover opacity-0 transition-all duration-500 ease-in-expo scale-50  ",o&&"opacity-100 scale-100"),src:d,alt:s.name})})}function s8(e){let{bottom:i=100,scale:s=1,includeTerms:a=!1,setIframeSrc:n}=e,r=sa(e=>e.asset_path);return(0,t.jsxs)("div",{className:"absolute right-0 w-full flex flex-col items-center justify-center gap-6",style:{bottom:"".concat(i,"px")},children:[(0,t.jsx)("img",{src:"https://data.x.ai/"+r+"/powered_by.png",alt:"Powered by",width:154*Math.max(1,.75*s),height:20*Math.max(1,.75*s)}),(0,t.jsx)("img",{src:"https://data.x.ai/"+r+"/grok_imagine.png",alt:"Grok Imagine",width:205*s,height:50*s}),a&&(0,t.jsxs)("div",{className:" flex flex-row gap-4 mt-4",children:[(0,t.jsx)(R.Button,{variant:"none",size:"md",shape:"rectangle",className:"bg-transparent opacity-30 border-b-2 border-white rounded-none text-lg","aria-label":"Back",onClick:e=>{null==n||n("https://data.x.ai/"+r+"/xAI_TOS.htm"),e.stopPropagation(),e.preventDefault()},children:"xAI Terms of Service"}),(0,t.jsx)(R.Button,{variant:"none",size:"md",shape:"rectangle",className:"bg-transparent opacity-30 border-b-2 border-white rounded-none text-lg","aria-label":"Back",onClick:e=>{null==n||n("https://data.x.ai/"+r+"/xAI_PP.html"),e.stopPropagation(),e.preventDefault()},children:"xAI Privacy Policy"})]})]})}function s9(e){let{backAction:i}=e;return(0,t.jsx)(R.Button,{variant:"none",size:"md",shape:"circle",className:"absolute top-10 left-10 bg-transparent opacity-50","aria-label":"Back",onClick:i,children:(0,t.jsx)(s$.ArrowLeft,{className:"size-8"})})}function s7(e){let{backAction:i}=e;return(0,t.jsx)(R.Button,{variant:"none",size:"md",shape:"circle",className:"absolute top-10 left-10 bg-transparent opacity-50","aria-label":"Back",onClick:i,children:(0,t.jsx)(ic.X,{className:"size-8"})})}var ae=e.i(519837),at=e.i(74643),ai=e.i(516498),as=e.i(572498);e.i(883805);var aa=e.i(122710),an=e.i(541243),ar=e.i(874249);let ao=(e,t)=>void 0!==t[e],al={};var ad=e.i(90495),s0=s0,ac=e.i(296451),au=e.i(667965);let am=(0,B.default)("ShieldX",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]]);var ap=e.i(468755),ah=e.i(258591),ag=e.i(228337);function ax(e,t){(0,h.logEventGlobal)(e,void 0,{location:"imagine-grid-card",...t})}let af=350;function av(e){var i,s,a,n,r,o,l;let{data:d,width:c}=e,{t:m}=(0,k.useTranslation)("imagine"),{push:p,route:g}=(0,x.useRouting)(),{ASSET_SERVER_URL:v}=(0,_.useEnvironment)(),y=(0,w.useRef)(null),b=(0,tO.useMobileUa)(),j=(0,u.useFeatureFlags)(),S=j.IMAGINE_ENABLE_CHILD_POST_IDS,I=j.IMAGINE_CONFIGS.get("enable_moderation_reporting",!1),C=(0,ar.useMediaStore)(e=>e.createMediaPostFromUrl),E=(0,ar.useMediaStore)(e=>e.favoritesById[d.id||""]||e.byId[d.id||""])||d,M=(0,ar.useMediaStore)(e=>e.setImageDimensions),T=(0,ar.useMediaStore)(e=>ag.default.findLast(e.videoByMediaId[E.id],e=>(null==e?void 0:e.progress)===100)),P=null==(i=d.mimeType)?void 0:i.startsWith("video"),R=(null!=(r=null!=(n=null==T?void 0:T.thumbnailImageUrl)?n:null==d?void 0:d.thumbnailImageUrl)?r:"")||P&&(null==(s=d.originalPost)?void 0:s.mediaUrl)||d.blobSrc||!P&&d.mediaUrl;R="string"==typeof R&&R.startsWith("data:")?R:null!=(o=(0,ej.getCachedAssetUrl)(v,R))?o:R;let[A,L]=(0,w.useState)(R?[R]:[]),[D,z]=(0,w.useState)(null),[B,G]=(0,w.useState)({}),[F,O]=(0,w.useState)(!1),V=(null==T?void 0:T.videoUrl)||(null==T?void 0:T.mediaUrl),[U,q]=(0,w.useState)(!1),H=(0,w.useMemo)(()=>ag.default.debounce(q,200),[]),W=(0,w.useMemo)(()=>V&&U?(0,ej.getCachedAssetUrl)(v,V):null,[V,U,v]),K=E.moderated,Y=I&&(null==T?void 0:T.moderated)&&(T.mediaUrl||(null==T?void 0:T.videoUrl)),Q=!!(E.blobSrc&&E.complete),X=I&&E.moderated&&(E.mediaUrl&&!E.blobSrc||Q),J=Y?null==T?void 0:T.id:null!=(l=E.itemId)?l:E.id,Z=X||Y,$=(0,w.useCallback)(()=>{N.toast.success("Thank you for reporting."),ax("imagine_incorrect_moderation",{type:Y?"video":"image",id:J,moderated:Y?Y.toString():X.toString()})},[Y,X,J]),ee=(0,w.useMemo)(()=>{var e;return F&&(!K||Z)&&(!!W||!d.isGenerated||d.isGenerated&&(null!=(e=d.progress)?e:0)>=100)},[d.isGenerated,d.progress,W,F,K,Z]);(0,w.useEffect)(()=>{let e=y.current;if(!e||!V)return;let t=new IntersectionObserver(e=>H(e.some(e=>e.isIntersecting)),{root:null,rootMargin:"0px",threshold:.1});return t.observe(e),()=>{e&&t.unobserve(e),t.disconnect(),H.cancel()}},[y,V]),(0,w.useEffect)(()=>{R&&L(e=>e.includes(R)?e:[...e,R])},[R]),(0,w.useEffect)(()=>{D&&L(e=>{let t=e.indexOf(D);return e.length>1&&-1!==t?e.slice(t):e})},[D,L]);let et=(0,ar.useMediaStore)(e=>e.smoothedVideoProgress[E.id]),ei=E.height||af||832;E.width&&E.height&&(af=ei=c/(E.width/E.height));let es=(null==(a=E.userInteractionStatus)?void 0:a.likeStatus)===!0,ea="number"==typeof et,en=ea&&et<100,er=!!V||!!en,eo=!!(ea&&(en||!W));return(0,t.jsxs)("div",{ref:y,className:(0,f.cn)("relative group/media-post-masonry-card",F&&"hover:scale-[1.02] transition-transform duration-300",!b&&"pointer-events-auto"),onClick:()=>{var e,t;if(d.isGenerated&&(null!=(e=d.progress)?e:0)<100&&!er)return;ax("image_feed_image_selected",{source:{"imagine-feed":"feed","imagine-post":"rabbithole","imagine-favorites":"favorites","imagine-more":"more"}[g.page]||"unknown",model_name:null!=(t=d.modelName)?t:""});let i="parentXPostId"in g?g.parentXPostId:void 0,s="imagine-more"===g.page?g.action:void 0;p({page:"imagine-post",postId:E.id,parentXPostId:i,action:s}),E.isGenerated&&S&&C(E.mediaUrl,E.mimeType).catch(e=>{(0,h.logError)("imagine-grid-card:createMediaPostFromUrl",e)})},children:[(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:(0,f.cn)(!F&&"hidden"),children:[A.map((e,i)=>(0,t.jsx)("img",{className:(0,f.cn)("opacity-".concat(B[e]||0," transition-opacity duration-500 ease-out rounded-2xl"),i>0&&"absolute top-0 left-0",X&&"border-[6px] border-red-500"),style:{width:c,height:ei},onLoad:t=>{let i=t.target;M(d.id,i.naturalWidth,i.naturalHeight),O(!0),G(t=>({...t,[e]:1})),setTimeout(()=>{z(e)},500)},src:e,alt:"Generated image"},e)),F&&W&&(0,t.jsx)("video",{onLoadedData:e=>{if(0===A.length){let t=e.target;M(d.id,t.videoWidth,t.videoHeight)}},src:W,muted:!0,autoPlay:!0,controls:!1,loop:!0,playsInline:!0,poster:A[A.length-1]||void 0,style:{width:c,height:ei},className:(0,f.cn)("top-0 left-0 col-start-1 row-start-1  object-cover rounded-2xl","pointer-events-none",A.length>0&&"absolute",Y&&"border-[6px] border-red-500"),children:m("video-unsupported.label","Your browser does not support the video tag.")}),eo&&(0,t.jsxs)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-100 h-100",children:[(0,t.jsx)("svg",{className:"size-12 text-black/35 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2",children:(0,t.jsx)("circle",{cx:"50%",cy:"50%",r:"50%",fill:"#5D7BE2",strokeWidth:"0"})}),(0,t.jsx)(ap.RadialProgress,{progressPercentage:null!=et?et:0,size:60,thickness:7,trackClassName:"stroke-black/15",progressClassName:"stroke-white/90"}),(0,t.jsx)(au.Play,{fill:"currentColor",strokeWidth:0,className:"animate-pulse size-6 text-white absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"})]},"progress")]}),(0,t.jsx)(eC.Skeleton,{pulse:!!en,className:(0,f.cn)("rounded-2xl",F&&"hidden"),style:{width:c,height:ei}})]}),(0,t.jsxs)("div",{className:ee?"":"invisible",children:[(0,t.jsx)(ay,{hasVideo:er,isLiked:es,postId:d.id,reportOverModeration:X||Y?$:void 0}),null]})]})}let ay=(0,w.memo)(e=>{let{hasVideo:i,isLiked:s,postId:a,reportOverModeration:n}=e,r=(0,ar.useMediaStore)(e=>e.like),o=(0,ar.useMediaStore)(e=>e.unlike),l=(0,ar.useMediaStore)(e=>e.generateVideoForImage),{t:d}=(0,k.useTranslation)("imagine");return(0,t.jsxs)("div",{className:(0,f.cn)("absolute bottom-2 right-2","flex flex-row gap-2"),onClick:ah.handleIsolateClick,children:[n?(0,t.jsx)(R.ButtonWithTooltipOptimized,{tooltipContent:(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-semibold",children:"Report Over Moderation"}),(0,t.jsx)("p",{children:"This content was moderated by our system. Report if false positive (ie. it should have not been moderated)."})]}),tooltipProps:{delayDuration:300},tooltipContentProps:{side:"bottom"},"aria-label":"Report Over Moderation",className:(0,f.cn)("bg-black/25 hover:bg-white/10 border border-white/15 border-opacity-10","group-hover/media-post-masonry-card:opacity-100","opacity-0"),shape:"circle",size:"md",variant:"none",onClick:n,children:(0,t.jsx)(am,{className:(0,f.cn)("size-4","text-white")})}):null,i?(0,t.jsx)(R.ButtonWithTooltipOptimized,{tooltipContent:s?d("image-unlike-button.label","Unsave"):d("image-like-button2.label","Save"),className:(0,f.cn)("bg-black/25 hover:bg-white/10 border border-white/15 border-opacity-10","group-hover/media-post-masonry-card:opacity-100","opacity-0"),shape:"circle",size:"md",variant:"none",onClick:()=>(s?ax("image_feed_image_unliked",{type:"video"}):ax("image_feed_image_liked",{type:"video"}),s?o(a):r(a)),children:(0,t.jsx)(ac.HeartIcon,{className:(0,f.cn)("size-4","text-white"),fill:s?"currentColor":"none",stroke:s?"none":"currentColor"})}):(0,t.jsx)(R.ButtonWithTooltipOptimized,{tooltipContent:d("image-make-video-button.label","Make video"),className:"bg-black/25 hover:bg-white/10 border border-white/15 border-opacity-10",shape:"circle",size:"md",variant:"none",onClick:()=>{ax("image_feed_video_generation_started",{location:"imagine-grid-card",mode:"normal",source:"feed_video_button"}),l(a,void 0,"normal","imagine-grid-card").catch(e=>{let t,i="Unknown",s="Unknown",a="Unknown";e instanceof Error?(t=e.message,i=e.name,s=e.cause?String(e.cause):"",a=e.stack?e.stack:""):t="string"==typeof e?e:String(e),ax("image_feed_video_generation_error",{location:"imagine-grid-card",mode:"normal",message:t,error:i,cause:s,stack:a}),(0,h.logError)("imagine-grid-card",e)})},children:(0,t.jsx)(au.Play,{fill:"currentColor",strokeWidth:0,className:"size-4 text-white"})})]})});var ab=e.i(913106),aj=e.i(55316);let aw=function(e){(0,w.useEffect)(e,[])};var ak=e.i(694193);function aN(){let e=(0,ar.useImagineModelOverrideStore)(e=>e.showOverridesDialog),i=(0,ar.useImagineModelOverrideStore)(e=>e.setShowOverridesDialog),s=(0,ar.useImagineModelOverrideStore)(e=>e.imagineModelOverrides),a=(0,ar.useImagineModelOverrideStore)(e=>e.resetOverridesSelections),n=(0,ar.useImagineModelOverrideStore)(e=>e.fetchImagineModelOverrides),r=(0,ar.useImagineModelOverrideStore)(e=>e.enable),o=(0,ar.useImagineModelOverrideStore)(e=>e.setEnable),{t:l}=(0,k.useTranslation)("imagine");return aw(()=>{n().catch(e=>{(0,h.logError)("imagine-model-override-dialog:fetchImagineModelOverrides",e)})}),(0,t.jsx)(ab.Dialog,{open:e,onOpenChange:e=>{i(e)},children:(0,t.jsxs)(iv.DialogContent,{className:"min-w-[500px] max-w-full p-4 rounded-2xl border border-border-l1 flex flex-col gap-6",children:[(0,t.jsxs)(iv.DialogHeader,{className:"flex flex-row items-center justify-between",children:[(0,t.jsxs)(ab.DialogTitle,{className:" font-bold flex flex-row items-center justify-center gap-2",children:[(0,t.jsx)(aj.Triangle,{size:18}),l("imagine-model-override-dialog.title","Imagine model overrides")]}),(0,t.jsxs)("div",{className:"flex flex-row items-center justify-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-fg-secondary font-semibold",children:l("imagine-model-override-dialog.enable","Enable")}),(0,t.jsx)(ak.Switch,{checked:r,onCheckedChange:e=>o(e),"aria-label":l("imagine-model-override-dialog.enable","Enable")})]})]}),(0,t.jsx)("div",{className:"flex flex-col w-full item-start justify-start gap-2",children:s.map(e=>{var i,s;return(0,t.jsx)(aS,{name:null!=(i=e.name)?i:"",overrideKey:null!=(s=e.key)?s:"",enabled:r},e.key)})}),(0,t.jsx)(R.Button,{shape:"pill",size:"sm",variant:"tertiary",onClick:()=>a(),children:"Reset all"})]})})}function aS(e){let{name:i,overrideKey:s,enabled:a}=e,n=(0,ar.useImagineModelOverrideStore)(e=>e.overridesSelections[s]),r=(0,ar.useImagineModelOverrideStore)(e=>e.setOverrideSelection),o=(0,ar.useImagineModelOverrideStore)(e=>{var t;return null==(t=e.imagineModelOverrides.find(e=>e.key===s))?void 0:t.options}),[l,d]=(0,w.useState)(!1);return(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:(0,f.cn)("font-semibold text-sm line-clamp-1",{"opacity-30":!a}),children:i}),(0,t.jsxs)(eR.DropdownMenu,{open:l,onOpenChange:d,children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,disabled:!a,children:(0,t.jsxs)(R.Button,{shape:"pill",size:"sm",variant:"tertiary",disabled:!a,children:[n||"(Default)",(0,t.jsx)(il.ChevronDown,{className:"size-4 group-data-[state=open]:rotate-180 transition-rotate duration-200"}),(0,t.jsx)("div",{className:"w-4"})]})}),(0,t.jsxs)(eR.DropdownMenuContent,{align:"start",side:"top",children:[(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>r(s,void 0),children:"(Default)"},"default"),null==o?void 0:o.map(e=>(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>r(s,e),className:(0,f.cn)("line-clamp-1",{"font-semibold":n===e}),children:e},e))]})]})]})}function aI(e){let{post:i,index:s,numImages:a,sizePx:n,isHovered:r}=e,[o]=(0,w.useState)(!0),l=i.thumbnailImageUrl||i.blobSrc||i.mediaUrl;(null==l?void 0:l.endsWith(".mp4"))&&(l=void 0);let{ASSET_SERVER_URL:d}=(0,_.useEnvironment)();return(null==l?void 0:l.startsWith("data:"))||(l=(0,ej.getCachedAssetUrl)(d,l)),(0,t.jsx)("div",{className:(0,f.cn)("absolute top-0 left-0 ","transition-transform duration-[".concat(r?200:300,"ms] ease-out")),style:{width:"".concat(n,"px"),height:"".concat(n,"px"),transform:"rotate(".concat(o?(-(3*a)+12*s)*(r?1.5:1):0,"deg) translateX(").concat(r?7*(s-1):3*(s-1),"px) scale(").concat(r?1.1:1,")")},children:l?(0,t.jsx)("img",{src:l,alt:i.id,className:(0,f.cn)("w-full h-full object-cover rounded-xl",s===a-1&&"border-2  border-inner border-white")}):(0,t.jsx)("div",{className:"w-full h-full bg-gray-200/50 rounded-xl"})})}function aC(e){let{sizePx:i=100}=e,s=(0,ar.useMediaStore)(e=>e.fetchListMediaPosts),a=(0,ar.useMediaStore)(e=>e.globalVideoProgress),n=(0,ar.useMediaStore)(e=>e.favoritesList).slice(0,3).reverse(),r=n.length,[o,l]=(0,w.useState)(!1);return(0,w.useEffect)(()=>{s({source:"MEDIA_POST_SOURCE_LIKED"}).catch((0,h.createLogError)("imagine-fav-pile"))},[s]),(0,t.jsxs)("div",{className:"relative",onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),style:{width:"".concat(i,"px"),height:"".concat(i,"px")},children:[n.map((e,s)=>(0,t.jsx)(aI,{post:e,index:s,numImages:r,sizePx:i,isHovered:o},e.id)),a.numberOfVideosInProgress>0&&a.progress<100&&(0,t.jsx)(aE,{sizePx:i,progress:a.progress,numInProgress:a.numberOfVideosInProgress})]})}function aE(e){let{sizePx:i=100,progress:s=0,numInProgress:a=0}=e,{resolvedTheme:n}=(0,ee.useTheme)(),r="dark"===n;return(0,t.jsxs)("div",{className:"absolute top-2 right-0",children:[(0,t.jsx)("div",{className:"absolute -translate-x-1/2 -translate-y-1/2",children:(0,t.jsx)(ap.RadialProgress,{progressPercentage:s,size:.55*i,trackClassName:(0,f.cn)(r?"stroke-white/20":"stroke-black/10"),progressClassName:(0,f.cn)(r?"stroke-white":"stroke-black/70"),thickness:3,offsetDegrees:0})}),(0,t.jsx)("div",{className:"absolute -translate-x-1/2 -translate-y-1/2",children:(0,t.jsx)(aM,{sizePx:i,count:a})})]})}function aM(e){let{sizePx:i=100,count:s=0}=e;return(0,t.jsxs)("div",{style:{width:"".concat(.4*i,"px"),height:"".concat(.4*i,"px")},children:[(0,t.jsx)("svg",{width:.4*i,height:.4*i,children:(0,t.jsx)("circle",{cx:.2*i,cy:.2*i,r:.2*i,fill:"#5D7BE2"})}),(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center absolute top-0 left-0 ",children:(0,t.jsx)("span",{className:"text-white text-sm font-semibold",children:s})})]})}var aT=e.i(543526),a_=e.i(420986);e.i(164201);let aP=(0,w.memo)(function(e){let{showFavorites:i=!0}=e,{t:s}=(0,k.useTranslation)("imagine"),a=(0,L.useMobileSize)(640),{push:n}=(0,x.useRouting)();return i?(0,t.jsx)("div",{className:(0,f.cn)("flex flex-row items-center gap-2 justify-center",a&&"mb-5 gap-0"),children:(0,t.jsx)(R.ButtonWithTooltip,{className:(0,f.cn)("h-full  flex items-start",a&&"justify-start p-2 w-[70px]"),tooltipContent:s("imagine-favorites-button-label","Favorites"),variant:"none",size:"md",shape:"rectangle",onClick:()=>n({page:"imagine-favorites"}),children:(0,t.jsx)(aC,{sizePx:a?42:50})})}):null}),aR=(0,w.memo)(function(e){let{setQuery:i,showFavorites:s,paddingForFavorites:a=!1,navigateOnQuery:n=!0,disableInput:r=!1,placeholderText:o}=e,{t:l}=(0,k.useTranslation)("imagine"),{push:d}=(0,x.useRouting)(),c=(0,aT.useAssetStore)(e=>e.fetchGetAsset),m=(0,ar.useMediaStore)(e=>e.createMediaPostFromPrompt),p=(0,ar.useMediaStore)(e=>e.like),g=(0,ar.useMediaStore)(e=>e.generateVideoForImage),v=(0,_.useEnvironment)(),y=(0,eo.useSettingsStore)(e=>e.userSettings.preferences.disableVideoGenerationOnUpload),b=(0,a_.useGenImagineVideoFromMediaUrl)({disableVideoGeneration:y}),[j,N]=(0,w.useState)(!1),S=(0,u.useFeatureFlags)().ENABLE_IMAGINE_TEXT_TO_VIDEO,{route:C}=(0,x.useRouting)(),E=C.page.startsWith("imagine-more"),M=(0,ar.useImagineModeStore)(e=>E?e.imagineModePostPage:e.imagineMode),T=S?M:"image",P=(0,w.useCallback)(async e=>{var t,s;if("video"!==T||!e.query||(null==(t=e.fileAttachmentIds)?void 0:t.length))if((null==(s=e.fileAttachmentIds)?void 0:s.length)&&"string"==typeof e.fileAttachmentIds[0]){let t=await c({assetId:e.fileAttachmentIds[0]}),i="".concat(v.ASSET_SERVER_URL,"/").concat(t.key);await b(i,t.mimeType)}else n&&d({page:"imagine"}),i(e.query||"");else{let t=await m(an.GrokApiMediaPostType.MediaPostTypeVideo,e.query);p(t.id).catch(e=>{(0,h.logError)("imagine-query-bar:like",e)}),d({page:"imagine-post",postId:t.id}),g(t.id,void 0,"custom","imagine-query-bar",void 0,e.query).catch(e=>{(0,h.logError)("imagine-query-bar:generateVideoForImage",e)})}return!0},[n,i,c,b,d,v,T,m,p,g]),A=(0,w.useCallback)(()=>{N(!0)},[]);(0,w.useEffect)(()=>{j&&ar.useMediaStore.getState().connectWebSocket()},[j]);let D=(0,L.useMobileSize)(),z=(0,L.useMobileSize)(640),B=D?"w-0":"w-gutter";return a&&(B=z?"w-[75px]":"w-[100px]"),(0,t.jsxs)("div",{className:(0,f.cn)("flex flex-row items-center gap-2 justify-center",z&&"mb-5 gap-0"),children:[!z||a?(0,t.jsx)("div",{className:B}):null,s&&(0,t.jsx)(R.ButtonWithTooltip,{className:(0,f.cn)("h-full  flex items-start",z&&"justify-start p-2 w-[70px]"),tooltipContent:l("imagine-favorites-button-label","Favorites"),variant:"none",size:"md",shape:"rectangle",onClick:()=>d({page:"imagine-favorites"}),children:(0,t.jsx)(aC,{sizePx:z?42:50})}),(0,t.jsx)(I.QueryBar,{disabled:r,onChange:A,textAreaClassName:"min-h-14 py-4 my-0 mb-0",className:(0,f.cn)(tL.QUERY_BAR_MAX_WIDTH_CLASS,r&&"opacity-0 pointer-events-none"),expandable:!1,onFrontPage:!1,restrictedModel:!0,placeholder:r?"":null!=o?o:l("imagine-query-bar-placeholder","Type to imagine"),onQuery:P}),D?null:(0,t.jsx)("div",{className:B})]})});var aA=e.i(735806),aL=e.i(424475),aD=e.i(66662);let az=[],aB=new class{get(e){return this.purgeOld(),this.blobs[e]||(this.blobs[e]={timestamp:new Date,blobSrc:ar.noiseMaker.getNoiseImageBlob()}),this.blobs[e].blobSrc}purgeOld(){Object.keys(this.blobs).forEach(e=>{this.blobs[e]&&this.blobs[e].timestamp.getTime()<Date.now()-5e3&&delete this.blobs[e]})}constructor(){(0,i7._)(this,"blobs",{})}};function aG(){let e=(0,ar.useMediaStore)(e=>e.videoGenModerated),i=(0,ar.useMediaStore)(e=>e.requestRateLimited),s=(0,ar.useMediaStore)(e=>e.requestRejected),a=(0,ar.useMediaStore)(e=>e.rateLimitedPeakHours),{t:n}=(0,k.useTranslation)("imagine");(0,w.useEffect)(()=>{if(e){let e=n("Content Moderated","Content Moderated. Try a different idea.");N.toast.error((0,t.jsx)(aF,{text:e,upsell:!1}))}if(i){let e=n("Request Rate Limited","Rate limit reached"),i=n("Imagine Request Rate Limited CTA","Upgrade to unlock more"),s=n("Imagine Request Rate Peak Hours","Peak hours");N.toast.error((0,t.jsx)(aF,{text:e,peakHours:null!=a?a:void 0,peakHoursText:s,secondaryText:i,upsell:!0}),{duration:2e4})}if(s){let e=n("Imagine Request Rejected","Request Rejected.");N.toast.error((0,t.jsx)(aF,{text:e,upsell:!1}))}},[e,n,i,s,a])}function aF(e){let{text:i,peakHours:s,peakHoursText:a,secondaryText:n,upsell:r}=e,l=(0,A.useLogEvent)(),d=(0,aA.useUpsellStore)(j.prop("setIsUpselling")),{t:c}=(0,k.useTranslation)("base");return(0,t.jsxs)("div",{className:"flex items-center font-semibold",children:[(0,t.jsx)(aL.AlertTriangle,{className:"h-5 w-5 flex-shrink-0 me-3"}),(0,t.jsxs)("span",{children:[i,s&&(0,t.jsxs)("div",{className:"bg-button-ghost-hover rounded-lg p-2 my-1",children:[(0,t.jsx)(aD.Clock,{className:"inline-block text-fg-danger mt-[-2px]",size:12})," ",a,(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"font-medium",children:s})]}),n&&(0,t.jsx)("div",{children:(0,t.jsx)("span",{className:"text-secondary font-medium",children:n})})]}),r&&(0,t.jsx)(o.Button,{variant:"primary",className:"font-medium ms-4",onClick:()=>{l("upsell_clicked","",{location:"imagine-toast"}),d(!0)},children:c("Upgrade","Upgrade")})]})}let aO=[];var aV=e.i(654917),aU=e.i(560831),aq=e.i(123018);function aH(e){let{prompt:t,scrollContainerRef:i,postId:s,freezeLoading:a,width:n,height:r,padding:o=0,isInitial:l,positionerConfig:d,imageModelName:c,fetchMoreUsingOriginalPrompt:u=!1,filterUnloadedOnFreeze:m=!0}=e,{masonryRender:p}=function(e){var t,i;let{prompt:s,scrollContainerRef:a,postId:n,freezeLoading:r,width:o,height:l,isInitial:d,positionerConfig:c,imageModelName:u,fetchMoreUsingOriginalPrompt:m=!1,filterUnloadedOnFreeze:p=!0,padding:g=0}=e,x=(0,w.useRef)(0),v=(0,w.useRef)(null),{items:y,maybeLoadMore:b}=function(e){var t,i;let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1],a=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,l=arguments.length>6?arguments[6]:void 0,d=arguments.length>7?arguments[7]:void 0,c=(0,ar.useMediaStore)(e=>e.switchContext),u=(0,ar.useMediaStore)(e=>e.fetchImageGen),m=(0,ar.useMediaStore)(e=>e.fetchImageGenMore),p=e+(a?"-".concat(a):""),g=(0,ar.useMediaStore)(e=>e.firstFetchStatus[p]),x=null!=(i=(0,ar.useMediaStore)(e=>e.byPrompt[p]))?i:az,f=(0,w.useRef)(!1),v=(0,w.useRef)(s||!d);v.current=s||!d;let y=x&&(null==(t=x[0])?void 0:t.blobSrc)?x[0]:null,b=(0,w.useMemo)(()=>{var t,i,s,a,n;return l?null!=(s=null!=(i=null!=(t=null==y?void 0:y.originalPrompt)?t:null==y?void 0:y.prompt)?i:e)?s:"":null!=(n=null!=(a=null==y?void 0:y.prompt)?a:e)?n:""},[y,e,l]),j=(0,w.useCallback)((e,t)=>v.current||!t,[v]),k=(0,w.useCallback)(async()=>{b&&s&&await m(b,p,j,o)},[m,b,s,p,j,o]),N=function(e,t){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],s=(0,w.useRef)(!1),a=(0,w.useRef)(!1),n=(0,w.useRef)(0),r=(0,w.useRef)(2),o=(0,w.useRef)(0),l=(0,w.useRef)(0);(0,w.useEffect)(()=>(a.current=!0,()=>{a.current=!1}),[]),o.current=Math.max(t,o.current);let d=(0,w.useCallback)(async(t,d)=>{if(d>-1&&(l.current=d),!s.current&&i){for(s.current=!0;a.current&&l.current+2>=o.current;){if(n.current>=r.current){await new Promise(e=>setTimeout(e,100));continue}o.current+=4,e().then(()=>{n.current--}).catch(e=>{n.current--,(0,h.logError)("useInfiniteImagineLoader:fetchMoreFn",e)}),n.current++}s.current=!1}},[e,i]);return(0,w.useEffect)(()=>{i&&a.current&&l.current+2>=o.current&&d(-1,-1).catch(e=>{(0,h.logError)("useInfiniteImagineLoader:fetcher",e)})},[i,d,a,l,o]),d}(k,x.length,"complete"===g);return(0,w.useEffect)(()=>{!f.current&&(f.current=!0,s&&("complete"===g?b&&c(b):e&&!g&&u(e,!!n,p,j,o).then(()=>{}).catch(e=>{(0,h.logError)("useImageGenQuery:fetchImageGen",e)})))},[e,s,a,p,n,j,g,b,o]),{items:(0,w.useMemo)(()=>{let e=x;if(s||!d){e=x;let t=r?x.length%r:0,i=s?r:0;t&&r&&(i=r-t),e=[...x,...Array(i).fill(null).map((e,t)=>({id:"placeholder-".concat(t),progress:0,mediaUrl:"",blobSrc:aB.get(t.toString())}))]}else if(e=x.filter(e=>100===e.progress),r){let t=e.length%r;e.length=e.length-t}return e},[x,s,r,d]),fetchMore:k,maybeLoadMore:N,fullPrompt:b}}(s,!r,n,d,x.current,u,m,p),j=(0,w.useRef)(1),{offset:k}=function(e,t){void 0===t&&(t=aO);let[i,s]=w.useState({offset:0,width:0});return sG(()=>{let{current:t}=e;if(null!==t){let e=0,a=t;do e+=a.offsetTop||0,a=a.offsetParent;while(a)(e!==i.offset||t.offsetWidth!==i.width)&&s({offset:e,width:t.offsetWidth})}},t),i}(v,[Math.random()]),{scrollTop:N,isScrolling:S}=sZ(a,{offset:k-100});S&&(j.current=2);let I=aQ("imagine-masonry-section-".concat(n),y.length,{width:o-2*g,...aW,...c},[]);x.current=I.columnCount;let C=(l||832)-Math.max(0,null!=(i=null==(t=v.current)?void 0:t.getBoundingClientRect().top)?i:0),E=sD(I);return{masonryRender:sx({className:(0,f.cn)("max-w-[646px] mx-auto min-h-[90vh]",r?"min-h-10":"min-h-[100vh]"),positioner:I,resizeObserver:E,scrollTop:N,isScrolling:S,height:C,overscanBy:j.current,itemHeightEstimate:400,containerRef:v,items:y,render:av,onRender:r?void 0:b,role:"list"})}}({prompt:t,scrollContainerRef:i,postId:s,freezeLoading:a,width:n,height:r,isInitial:l,positionerConfig:d,imageModelName:c,fetchMoreUsingOriginalPrompt:u,filterUnloadedOnFreeze:m,padding:o});return p}let aW={columnGutter:8,maxColumnCount:2};function aK(e){let{promptKey:i,prompt:s,widthStyle:a="full",initExpanded:n=!1,isEditable:r=!0,onEdit:o=()=>{},maxWidth:l,withBrustIcon:d=!1,withStickyHeader:c=!0,stickyHeaderTop:u=65}=e,m=(0,ar.useMediaStore)(e=>e.getSelectionPromptByPromptKey(null!=i?i:"")),{t:p}=(0,k.useTranslation)("imagine"),[h,g]=(0,w.useState)(n),[x,v]=(0,w.useState)(s),y=(0,w.useRef)(null),[b,j]=(0,w.useState)(!1);(0,w.useEffect)(()=>{v(m||s)},[m,s]);let N=(0,w.useCallback)(()=>{if(x&&o){let e=o(x);e&&v(e)}g(!1)},[o,x]),S=y.current;return((0,w.useEffect)(()=>{if(!b)return;let e=e=>{if("Escape"===e.key){e.stopPropagation(),e.preventDefault();return}"Enter"!==e.key||e.shiftKey||(e.preventDefault(),e.stopPropagation(),N())};return S&&S.addEventListener("keydown",e),()=>{S&&S.removeEventListener("keydown",e)}},[b,S,N]),s)?(0,t.jsx)("div",{onClick:()=>{h||(g(!0),setTimeout(()=>{var e,t,i;null==(e=y.current)||e.focus();let s=null!=(i=null==x?void 0:x.length)?i:0;null==(t=y.current)||t.setSelectionRange(s,s)},200))},className:(0,f.cn)("bg-surface-l1 rounded-full px-4 py-2 z-10",!h&&"fit"===a&&"w-fit",!h&&"truncate rounded-full ",h&&"rounded-3xl",h&&r&&"pe-2 border-border-l2 border",c&&"sticky"),style:{maxWidth:null!=l?l:"100%",top:c?u+"px":"auto"},children:h&&r?(0,t.jsxs)("div",{className:"relative w-full flex items-center justify-center",children:[d?(0,t.jsx)(aq.Brush,{className:"inline-block size-4 me-2 mb-1"}):null,(0,t.jsx)(aV.default,{ref:y,onFocus:()=>j(!0),onBlur:()=>j(!1),style:{resize:"none"},value:x,onChange:e=>v(e.target.value),rows:1,maxRows:4,"aria-required":"true","aria-label":p("image-prompt-textarea.placeholder","Image prompt"),className:(0,f.cn)("w-full pe-8 bg-transparent  text-md font-medium placeholder:text-muted-foreground focus-visible:outline-none")}),(0,t.jsx)(R.Button,{variant:"primary",size:"xs",shape:"circle",onClick:N,className:"absolute right-0 bottom-0","aria-label":p("image-prompt-textarea.submit","Submit"),children:(0,t.jsx)(aU.ArrowUpIcon,{className:"w-4 h-4"})})]}):(0,t.jsxs)(t.Fragment,{children:[d?(0,t.jsx)(aq.Brush,{className:"inline-block size-4 me-2 mb-1"}):null,(0,t.jsx)("span",{children:null!=x?x:"Nothing"})]})}):null}let aY=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!e||!t)return;let s=t.scrollTop,a=performance.now(),n=1/60,r=o=>{let l=(o-a)/1e3;a=o;let d=(e=>{let t=0;do t+=e.offsetTop||0,e=e.offsetParent;while(e)return t})(e)-i,c=1-Math.pow(.9,l/n);t.scrollTop=s+=(d-s)*c,Math.abs(s-d)>2&&requestAnimationFrame(r)};requestAnimationFrame(r)},aQ=(e,t,i,s)=>{let{width:a,columnWidth:n=200,columnGutter:r=0,rowGutter:o,columnCount:l,maxColumnCount:d,maxColumnWidth:c}=i,[u,m]=aX(a,n,r,l,d,c),p=[e,a,u,m,r,o,...s].join("-"),h=(0,w.useRef)(p),g=ar.useScrollStore.getState().getPositioner(p,t);return g||(g=function(){let e=s_(m,u,r,o);return ar.useScrollStore.getState().setPositioner(p,e,t),h.current&&h.current!==p&&ar.useScrollStore.getState().setPositioner(h.current,void 0,t),h.current=p,e}()),g},aX=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,s=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,n=arguments.length>5?arguments[5]:void 0;s=s||Math.min(Math.floor((e+i)/(t+i)),a||1/0)||1;let r=Math.floor((e-i*(s-1))/s);return void 0!==n&&r>n&&(r=n),1===s&&(r=e),[r,s]};function aJ(e,t){(0,h.logEventGlobal)(e,void 0,{location:"imagine-feed",...t})}let aZ=[""];function a$(e){var i,s,a;let{variant:n="default"}=e,o=(0,ar.useMediaStore)(e=>e.homeGenPrompts),l=(0,ar.useMediaStore)(e=>e.pushHomeGenPrompt),d=(0,ar.useMediaStore)(e=>e.pushPostPageSection),c=(0,ar.useMediaStore)(e=>e.resetImageGen),u=(0,ar.useMediaStore)(e=>e.clearHomeGenPrompts),m=(0,ar.useMediaStore)(e=>e.upsertMediaPost),{t:p}=(0,k.useTranslation)("base"),{user:g}=(0,r.useSession)(),f=!g,{route:v,replace:y}=(0,x.useRouting)(),b="imagine"===v.page&&!!v.parentXPostId&&!!v.mediaUrl,N="imagine"===v.page&&!!v.mediaUrl,S="imagine-more"===v.page?v.postId:"",I=(0,ar.useMediaStore)(e=>e.postPageSections[S])||aZ,C=(0,ae.useSettingsDialogStore)(j.prop("open"));(0,w.useEffect)(()=>{if(!g||!N)return;let e="imagine"===v.page?v.mediaUrl:null,t="imagine"===v.page?v.parentXPostId:null,i="imagine"===v.page?v.action:null;if(!e)return;let s=crypto.randomUUID();m({id:s,mediaUrl:e,mediaType:an.GrokApiMediaPostType.MediaPostTypeImage}),y({page:"imagine-post",postId:s,parentXPostId:t,action:i,mediaUrl:e})},[g,N,v,y,m]);let E="default"===n&&o.length>0,M="more"===n,T=(0,ar.useMediaStore)(e=>e.byId[S]||e.favoritesById[S]),_=(0,ar.useMediaStore)(e=>e.fetchMediaPost),P=(null==T||null==(i=T.mimeType)?void 0:i.includes("video"))&&(null==T||null==(s=T.originalPost)?void 0:s.mediaUrl)?(null==T||null==(a=T.originalPost)?void 0:a.prompt)||(null==T?void 0:T.prompt)||T.originalPrompt:(null==T?void 0:T.prompt)||(null==T?void 0:T.originalPrompt);(0,w.useEffect)(()=>{S&&_(S).catch((0,h.createLogError)("imagine-page"))},[S,_]);let R=(0,w.useCallback)(e=>{E||M||c(),M?d(S,e):l(e)},[E,l,c,M,S,d]),A=o.length>0&&"default"===n?"query":n;if((0,w.useEffect)(()=>{if(C)return;let e=e=>{"Escape"===e.key&&(("favorites"===A||"more"===A)&&window.history.back(),"query"===A&&(c(),u()))},t=setTimeout(()=>{window.addEventListener("keydown",e)},50);return()=>{clearTimeout(t),window.removeEventListener("keydown",e)}},[u,c,A,C]),(0,w.useEffect)(()=>{"favorites"===A?aJ("image_feed_gallery_opened"):"default"===A&&aJ("image_feed_opened")},[A]),aG(),f){let e="imagine"===v.page&&"img_edit"===v.action,i=b||e?p("imagine.x-edit-subtitle","Sign up or log in to continue editing image."):void 0;return(0,t.jsx)(ad.default,{subtitle:i})}return N?null:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(aN,{}),(0,t.jsx)(a0,{postId:S,variant:A,querys:"more"===n?I:o,setQuery:R,postPrompt:P},A+S)]})}function a0(e){var i;let{variant:s,postId:a,querys:n,setQuery:r,postPrompt:o}=e,{t:l}=(0,k.useTranslation)("base"),d=(0,u.useFeatureFlags)(),{data:{enableFileUploads:m,enableImageUploads:p}={}}=(0,tB.useFeatureControls)(),{resolvedTheme:h}=(0,ee.useTheme)(),g=(0,w.useRef)(null),[x,v]=(0,w.useState)({width:0,height:0}),{width:y,height:b}=x,j=(0,w.useCallback)(e=>{v(e)},[]),N=(0,ai.useResizeObserver)(j),S=(0,as.useScrollGradient)({ref:N,size:"dark"===h?[.1,.18]:[.09,.16],midpoint:[.66,.6]}),I=(0,ar.useMediaStore)(e=>e.clearHomeGenPrompts),C=Math.min(y,"query"===s||"more"===s?1630:2290),E=n[n.length-1],M=(0,w.useMemo)(()=>"query"===s&&E?E:"favorites"===s?l("imagine-favorites-html-document-title","Imagine Favorites"):l("imagine-html-document-title","Imagine"),[s,l,E]);(0,c.useDocumentTitle)(M),i=y>0?"imagine-page"+s+a:"",(0,w.useEffect)(()=>{let e=N.current,t=()=>{var t;let s=null!=(t=null==e?void 0:e.scrollTop)?t:0;ar.useScrollStore.setState(e=>({...e,scrollPositionByPageId:{...e.scrollPositionByPageId,[i]:s}}))};if(e){let s=ar.useScrollStore.getState().getScrollPosition(i);s&&(e.scrollTop=s),e.addEventListener("scroll",t)}return()=>{e&&e.removeEventListener("scroll",t)}},[N,i]);let T=(0,w.useMemo)(()=>{let e="";return"favorites"===s&&(e=l("imagine-favorites-title","Favorites")),"more"===s&&(e=l("imagine-more-title","More")),e&&(e=" / "+e),e},[s,l]),_=(0,L.useMobileSize)();return(0,t.jsxs)("div",{className:"w-full relative",ref:g,children:[m&&p&&(0,t.jsx)(iT,{conversationId:void 0,containerRef:g,imageAttachmentsOnly:!0}),_&&(0,t.jsx)("div",{className:"-mx-3",children:(0,t.jsx)(t0.ChatTopNav,{hideIncognito:!0,disableBackgroundGradient:!0})}),(0,t.jsxs)("div",{tabIndex:-1,className:"flex flex-col w-full h-dvh overflow-scroll items-center px-3",ref:N,style:{outline:"none",scrollbarWidth:"none",...S},children:[(0,t.jsxs)("div",{className:(0,f.cn)("py-3 flex items-center gap-3 h-[4rem] w-full top-0",_&&"mt-14 px-2"),children:["favorites"===s||"query"===s||"more"===s?(0,t.jsx)(R.Button,{variant:"secondary",shape:"circle",size:"md","aria-label":l("imagine-back-button.label","Back"),onClick:"query"===s?I:()=>{window.history.back()},children:(0,t.jsx)(s$.ArrowLeft,{className:"size-4"})}):null,(0,t.jsxs)("h1",{className:"text-lg font-semibold",children:[(0,t.jsx)("span",{className:"text-primary",children:l("imagine-title","Imagine")}),T&&(0,t.jsx)("span",{className:"text-secondary",children:T})]}),(0,t.jsx)("div",{className:"flex-1"}),d.ENABLE_UPGRADE_BUTTON_IN_IMAGINE_PAGE&&(0,t.jsx)(at.UpsellButton,{variant:"vibrant",entrypointKey:"imagine-page"})]}),y>0&&("more"===s&&o||"more"!==s)&&(0,t.jsx)("div",{style:{maxWidth:"".concat(C,"px")},className:"w-full",children:"query"===s||"more"===s?(0,t.jsx)(a5,{queries:n,scrollContainerRef:N,postId:"more"===s?a:"home-grid",width:C,height:b,postPrompt:o}):(0,t.jsx)(a2,{containerRef:N,variant:s,width:C,height:b})})]}),!d.ENABLE_IMAGINE_QUERY_BAR_V2&&(0,t.jsx)("div",{className:"absolute left-0 bottom-0 w-full p-3",children:(0,t.jsx)(aR,{setQuery:r,showFavorites:"favorites"!==s,navigateOnQuery:"more"!==s})})]})}function a1(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{width:e,columnWidth:250,maxColumnWidth:t?400:450,columnGutter:10,maxColumnCount:t?4:5}}function a2(e){let{containerRef:t,variant:i,width:s,height:a}=e,{ENABLE_IMAGINE_VIDEO_FEED:n}=(0,u.useFeatureFlags)(),[r,o]=(0,Z.useLocalStorage)("visited-imagine2",!1),l="favorites"===i?aa.GrokApiMediaPostSource.MediaPostSourceLiked:aa.GrokApiMediaPostSource.MediaPostSourcePublic,d=n&&"favorites"!==i?{mediaType:an.GrokApiMediaPostType.MediaPostTypeVideo}:{},c=(0,ar.useMediaStore)(e=>e.fetchListMediaPosts),m=function(e,t){void 0===t&&(t=al);let{isItemLoaded:i,minimumBatchSize:s=16,threshold:a=16,totalItems:n=9e9}=t,r=sd(e),o=sd(i);return w.useCallback((e,t,i)=>{let l=function(e,t,i,s,a,n){void 0===e&&(e=ao),void 0===t&&(t=16),void 0===s&&(s=9e9);let r=[],o,l,d=a;for(;d<=n;d++)e(d,i)?void 0!==o&&void 0!==l&&(r.push(o,l),o=l=void 0):(l=d,void 0===o&&(o=d));if(void 0!==o&&void 0!==l){let a=Math.min(Math.max(l,o+t-1),s-1);for(d=l+1;d<=a;d++)if(e(d,i))break;else l=d;r.push(o,l)}if(r.length){let s=r[0],a=r[1];for(;a-s+1<t&&s>0;){let t=s-1;if(e(t,i))break;r[0]=s=t}}return r}(o.current,s,i,n,Math.max(0,e-a),Math.min(n-1,(t||0)+a));for(let e=0;e<l.length-1;++e)r.current(l[e],l[++e],i)},[n,s,a,r,o])}(()=>c({...d,source:l}),{});(0,w.useEffect)(()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize")),o(!0)},100),p.length||c({...d,source:l}).catch((0,h.createLogError)("imagine-page"))},[]);let p=(0,ar.useMediaStore)(e=>"favorites"===i?e.favoritesList:e.list),g=aQ("imagine-page-".concat(i),p.length,a1(s),[s]),x=sD(g),{scrollTop:f,isScrolling:v}=sZ(t);return sx({positioner:g,resizeObserver:x,scrollTop:f,isScrolling:v,height:a||832,itemHeightEstimate:300,items:p,render:av,onRender:m,overscanBy:"query"===i?1:2,itemKey:e=>e.id,role:"list"})}function a5(e){let{queries:i,scrollContainerRef:s,postId:a,width:n,height:r,postPrompt:o}=e,l=(0,w.useRef)(i.length),d=(0,ar.useMediaStore)(e=>e.pushHomeGenPrompt),c=(0,ar.useMediaStore)(e=>e.pushPostPageSection),u=(0,ar.useMediaStore)(e=>e.switchContext),m=!!o,p=(0,w.useCallback)(e=>{u(e),m?c(a,e):d(e)},[m,c,d,a,u]);return(0,w.useEffect)(()=>{i.length<=1||l.current===i.length||setTimeout(()=>{let e="imagine-masonry-section-".concat(i.length-1),t=document.getElementById(e);t&&aY(t,s.current,80)},350)},[i.length,s,l]),(0,t.jsx)("div",{children:i.map((e,l)=>{let d=a+"-"+l,c=e+"-".concat(d);return(0,t.jsxs)("div",{id:"imagine-masonry-section-".concat(l),className:"flex flex-col gap-3 mb-1 relative",children:[(0,t.jsx)(aK,{promptKey:c,prompt:0===l&&m?o:e,widthStyle:"fit",onEdit:p}),(0,t.jsx)(aH,{isInitial:0===l&&!!m||void 0,prompt:0===l&&m?o:e,scrollContainerRef:s,postId:d,width:n,height:r,positionerConfig:a1(n,!0),freezeLoading:l<i.length-1,fetchMoreUsingOriginalPrompt:!0})]},"imagine-masonry-section-".concat(l))})})}var a4=e.i(973332),a3=e.i(867846),a6=e.i(873251),a8=e.i(930991);let a9=(0,B.default)("Expand",[["path",{d:"m21 21-6-6m6 6v-4.8m0 4.8h-4.8",key:"1c15vz"}],["path",{d:"M3 16.2V21m0 0h4.8M3 21l6-6",key:"1fsnz2"}],["path",{d:"M21 7.8V3m0 0h-4.8M21 3l-6 6",key:"hawz9i"}],["path",{d:"M3 7.8V3m0 0h4.8M3 3l6 6",key:"u9ee12"}]]);var a7=e.i(796782),ne=e.i(847675);let nt=(0,B.default)("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);var ni=e.i(992069),ns=e.i(497218),na=e.i(875969),nn=e.i(946032),nr=e.i(290583);let no=nr.z.object({display_name:nr.z.string(),mode_name:nr.z.string(),is_mature:nr.z.boolean().optional(),custom_mode:nr.z.boolean().optional(),speech_mode:nr.z.boolean().optional(),model_generated_only:nr.z.boolean().optional()});function nl(e){let{isModelGenerated:t}=e,i=(0,u.useFeatureFlags)(),{stage:s}=(0,a3.useAgeVerificationStage)();return(0,w.useMemo)(()=>{let e=[];for(let a of i.MEDIA_GEN_VIDEO_CONFIG.get("media_gen_video_prompt_available_modes",[])){if(a.model_generated_only&&!t)continue;let i=no.safeParse(a);i.success&&("nopass"!==s||!i.data.is_mature)&&e.push(i.data)}return e},[i.MEDIA_GEN_VIDEO_CONFIG,s,t])}var nd=e.i(969736),nc=e.i(592884),nu=e.i(398304),nm=e.i(178759),np=e.i(394786),nh=e.i(813940),ng=e.i(390418);class nx{constructor(e,t){(0,i7._)(this,"set",void 0),(0,i7._)(this,"get",void 0),(0,i7._)(this,"post",void 0),(0,i7._)(this,"videoExtendMode",void 0),(0,i7._)(this,"setVideoExtendMode",void 0),(0,i7._)(this,"videoEditMode",void 0),(0,i7._)(this,"setVideoEditMode",void 0),(0,i7._)(this,"videoCurrentTimeRef",void 0),(0,i7._)(this,"lastGeneratedVideo",void 0),(0,i7._)(this,"lastGeneratedVideoWasExtendedFrom",void 0),(0,i7._)(this,"lastGeneratedVideoWasExtendedFromTime",void 0),(0,i7._)(this,"lastGeneratedVideoWasEditedFrom",void 0),(0,i7._)(this,"originalPrompt",void 0),(0,i7._)(this,"isModelGenerated",void 0),(0,i7._)(this,"onVideoGenerationStart",void 0),(0,i7._)(this,"isVideoOnlyPost",void 0),(0,i7._)(this,"imageEditPromptMode",void 0),(0,i7._)(this,"setImageEditPromptMode",void 0),(0,i7._)(this,"runImageEditPrompt",void 0),(0,i7._)(this,"isImportingMedia",void 0),(0,i7._)(this,"updateContext",void 0),(0,i7._)(this,"clearContext",void 0),this.set=e,this.get=t,this.post=null,this.videoExtendMode=!1,this.setVideoExtendMode=null,this.videoEditMode=!1,this.setVideoEditMode=null,this.videoCurrentTimeRef=(0,w.createRef)(),this.lastGeneratedVideo=void 0,this.lastGeneratedVideoWasExtendedFrom=void 0,this.lastGeneratedVideoWasExtendedFromTime=void 0,this.lastGeneratedVideoWasEditedFrom=void 0,this.originalPrompt=void 0,this.isModelGenerated=!1,this.onVideoGenerationStart=void 0,this.isVideoOnlyPost=!1,this.imageEditPromptMode=!1,this.setImageEditPromptMode=null,this.runImageEditPrompt=null,this.isImportingMedia=!1,this.updateContext=e=>{this.set(t=>({...t,...e}))},this.clearContext=()=>{this.set({post:null,videoExtendMode:!1,setVideoExtendMode:null,videoEditMode:!1,setVideoEditMode:null,lastGeneratedVideo:void 0,lastGeneratedVideoWasExtendedFrom:void 0,lastGeneratedVideoWasExtendedFromTime:void 0,lastGeneratedVideoWasEditedFrom:void 0,originalPrompt:void 0,isModelGenerated:!1,onVideoGenerationStart:void 0,isVideoOnlyPost:!1,imageEditPromptMode:!1,setImageEditPromptMode:null,runImageEditPrompt:null,isImportingMedia:!1})}}}let nf=(0,ng.create)()((e,t)=>new nx(e,t));var s0=s0;let nv=(0,B.default)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var ny=e.i(722423),nb=e.i(249914),nb=nb;let nj=(0,B.default)("VolumeOff",[["path",{d:"M16 9a5 5 0 0 1 .95 2.293",key:"1fgyg8"}],["path",{d:"M19.364 5.636a9 9 0 0 1 1.889 9.96",key:"l3zxae"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"m7 7-.587.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298V11",key:"1gbwow"}],["path",{d:"M9.828 4.172A.686.686 0 0 1 11 4.657v.686",key:"s2je0y"}]]);var nw=e.i(929394);let nk=e=>{let{spacing:i=36,bandWidth:s=200,dotDiameter:a=6,duration:n=3,minOpacity:r=.09,maxOpacity:o=.5,minScale:l=1,maxScale:d=1.5,color:c="white",direction:u="diagonalTLtoBR",isShown:m=!0,width:p=300,height:h=300}=e,g=(0,w.useRef)(null),[x,f]=(0,w.useState)(+!!m),v=(0,w.useRef)(null);return(0,w.useEffect)(()=>{let e=+!!m,t=Date.now(),i=()=>{let s=Math.min((Date.now()-t)/250,1);f(x+(e-x)*(1-Math.pow(1-s,3))),s<1&&(v.current=requestAnimationFrame(i))};Math.abs(x-e)>.001&&(v.current&&cancelAnimationFrame(v.current),v.current=requestAnimationFrame(i))},[m,x]),(0,w.useEffect)(()=>{let e=g.current;if(!e)return;let t=e.getContext("2d");if(!t)return;let m=window.devicePixelRatio||1;e.width=p*m,e.height=h*m,e.style.width="".concat(p,"px"),e.style.height="".concat(h,"px"),t.scale(m,m);let f=Date.now(),y=()=>{if(t.clearRect(0,0,p,h),x<.001){v.current=requestAnimationFrame(y);return}let e=(Date.now()-f)/1e3%n/n*(p+h),m=[];for(let e=i/2;e<=p;e+=i)m.push(e);let g=[];for(let e=i/2;e<=h;e+=i)g.push(e);for(let i of(t.fillStyle=c,g))for(let n of m){let c;switch(u){case"diagonalTLtoBR":default:c=n+i;break;case"diagonalTRtoBL":c=p-n+i}let m=.5-.5*Math.cos(Math.max(0,1-Math.abs(c-e)/s)*Math.PI),h=r+(o-r)*m,g=(l+(d-l)*m)*x*a/2;t.globalAlpha=h*x,t.beginPath(),t.arc(n,i,g,0,2*Math.PI),t.fill()}t.globalAlpha=1,v.current=requestAnimationFrame(y)};return v.current=requestAnimationFrame(y),()=>{v.current&&cancelAnimationFrame(v.current)}},[p,h,i,s,a,n,r,o,l,d,c,u,x]),(0,t.jsx)("canvas",{ref:g,style:{background:"transparent",display:"block"}})},nN="text-white bg-[#555]/75  hover:bg-[#555]/100 border-0";function nS(e){let{videoRef:i,setInhibitFullPanelMute:s,show:a=!0,setExtendMode:n,videoExtendMode:r=!1,extendInProgress:o=!1}=e,{t:l}=(0,k.useTranslation)("imagine"),{ENABLE_IMAGINE_EXTEND_VIDEO_MODE:d}=(0,u.useFeatureFlags)(),c=(0,w.useRef)(0),[m,p]=(0,w.useState)(0),g=(0,w.useRef)("scrubber"),[x,v]=(0,w.useState)(!1),[y,b]=(0,w.useState)(!1),j=(0,w.useRef)(null),N=(0,w.useRef)(null),S=(0,w.useRef)(0),[I,C]=(0,w.useState)(!1),E=(0,eq.useDebouncedValue)(a,300),M=(0,w.useRef)(null),{width:T}=sO(M),_=i.current;(0,w.useEffect)(()=>{if(!_||!E&&!a)return;let e=!0,t=()=>{if(e){let e=_.currentTime/_.duration;e!==c.current&&(c.current=e,p(e)),requestAnimationFrame(t)}};return t(),()=>{e=!1}},[_,i,a,E]);let P=(0,w.useCallback)(e=>{var t,i,s,a;if("extend-button"==g.current){let s=null!=(i=null==(t=N.current)?void 0:t.getBoundingClientRect())?i:{left:0,width:0};return Math.max(0,Math.min(1,(e.clientX-s.left+S.current)/(s.width-T)))}{let t=null!=(a=null==(s=j.current)?void 0:s.getBoundingClientRect())?a:{left:0,width:0};return Math.max(0,Math.min(1,(e.clientX-t.left)/t.width))}},[j,N,T]),A=(0,w.useMemo)(()=>(0,ag.throttle)(e=>{_&&_.duration&&(r?_.currentTime=Math.max(1,e*(_.duration-.05)):_.currentTime=e*(_.duration-.05))},48),[_,r]),L=(0,w.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),g.current="scrubber",v(!0),s(!0),A(P(e.nativeEvent));let t=!(null==_?void 0:_.paused);b(t),t&&(null==_||_.pause())},[A,P,_,s,v,b]),D=(0,w.useRef)(!1),z=(0,w.useRef)(!1),B=(0,w.useCallback)(e=>{var t,i;e.stopPropagation(),e.preventDefault(),g.current="extend-button",v(!0),s(!0),b(!1),null==_||_.pause(),null==n||n(!0),S.current=(null!=(i=null==(t=M.current)?void 0:t.getBoundingClientRect().left)?i:0)-e.clientX},[n,_,s,v,b]);return(0,w.useEffect)(()=>{if(!x)return;let e=e=>{e.stopPropagation(),e.preventDefault(),e.stopPropagation(),e.preventDefault(),v(!1),D.current=!1,z.current=!1,setTimeout(()=>{s(!1)},10),y&&(null==_||_.play().catch(e=>{(0,h.logError)("imagine-post-page:handleMouseUp",e)}))},t=e=>{e.stopPropagation(),e.preventDefault(),e.stopPropagation(),e.preventDefault(),x&&A(P(e))};return document.addEventListener("mouseup",e),document.addEventListener("mousemove",t),()=>{document.removeEventListener("mouseup",e),document.removeEventListener("mousemove",t)}},[x,L,P,A,_,s,y]),(0,t.jsxs)("div",{className:"flex flex-col justify-center items-center w-full h-8 px-2 relative",onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),children:[(0,t.jsx)("div",{ref:j,onMouseDown:L,onClick:e=>{e.stopPropagation(),e.preventDefault()},className:(0,f.cn)("w-full bg-[#555]/50 z-10  rounded-full overflow-hidden transition-all duration-300 cursor-pointer",a||x?"opacity-100":"opacity-0",I||x?"h-3":"h-1"),children:(0,t.jsx)("div",{className:"w-full h-full bg-[#fff]/90",style:{width:"".concat(100*m,"%")}})}),d&&!o&&a?(0,t.jsx)("div",{className:"w-full h-full  absolute px-[65px]",children:(0,t.jsx)("div",{className:"w-full h-full  relative ",ref:N,children:(0,t.jsx)(R.Button,{ref:M,shape:"pill",size:"md",variant:"secondary",className:(0,f.cn)(" text-black absolute font-semibold text-xs hover:bg-white/80 transition-opacity duration-300 border-0",r?"bg-white":"bg-[#555]/75  hover:bg-[#555]/100 text-white",I||x||r?"opacity-100":"opacity-0"),style:{left:r?"calc(".concat(100*m,"% - ").concat(T*m,"px)"):"calc(50% - ".concat(T/2,"px)"),top:"-39px"},onMouseDown:B,children:l("imagine-post-extend-from-frame-button.label","Extend from Frame")})})}):null]})}function nI(e){let{value:i,onValueChange:s,className:a,activeQuality:n,videoOnly:r}=e,{t:o}=(0,k.useTranslation)("imagine"),l=(0,L.useMobileSize)(),d=(0,eq.useDebouncedValue)(n,500);return r&&"hd"!==n?null:(0,t.jsxs)("div",{className:(0,f.cn)("flex p-0  rounded-full  bg-[#555]/75",{"gap-0":l},a),"aria-label":"Text alignment",onClick:e=>{e.stopPropagation(),s("video"===i?"image":"video")},children:[(0,t.jsxs)(R.Button,{shape:"circle",size:"md",variant:"video"===i?"secondary":"tertiary",className:(0,f.cn)("text-white border-0 relative","video"===i?"bg-white/15  hover:bg-white/15":"bg-transparent hover:bg-white/10 text-white/50 hover:text-white"),onClick:e=>{e.stopPropagation(),s("video")},children:["hd"===d?(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full pt-0.5",children:[(0,t.jsx)(a7.Film,{className:"size-[15px]"}),(0,t.jsx)("div",{className:" text-[10px] font-bold text-white",children:"HD"})]}):(0,t.jsx)(a7.Film,{className:"size-[20px]"}),(0,t.jsx)("span",{className:(0,f.cn)("font-semibold sr-only","video"===i?"text-primary":"text-secondary"),children:o("imagine-post-tab.video","Video")})]}),!r&&(0,t.jsxs)(R.Button,{shape:"circle",size:"md",variant:"image"===i?"secondary":"tertiary",className:(0,f.cn)(" text-white border-0","image"===i?"bg-white/15  hover:bg-white/15":"bg-transparent hover:bg-white/10 text-white/50 hover:text-white"),onClick:()=>s("image"),children:[(0,t.jsx)(nv,{className:"size-[20px]"}),(0,t.jsx)("span",{className:(0,f.cn)("font-semibold sr-only","image"===i?"text-primary":"text-secondary"),children:o("imagine-post-tab.image","Image")})]})]})}let nC=w.default.memo(function(e){let i,s,{mediaId:a,imageWidth:n,imageHeight:o,imageSrc:l,videoPlaceholderImageSrc:d,videoSrc:c,hdVideoSrc:m,audioSrc:p,className:g,videoCurrentTimeRef:x,videoPlayingRef:v,videoPlayingCb:y,firstTimeInteracted:b=!1,upscalingInProgress:j=!1,extendInProgress:S=!1,altText:I,setExtendMode:C,videoExtendMode:E=!1,displayImageOnly:M=!1,setImageEditPromptMode:T,imageEditPromptMode:_=!1,videoModerated:P=!1,imageModerated:A=!1,videoItemId:L="",imageItemId:D="",onMoreClick:z,sideBySideMode:B=!1,onSideBySidePreferClick:G,onSideBySideHoverCoverage:F,nextItemInProgress:O=!1,children:V,filmstrip:U,makeVideoClick:q}=e,{t:H}=(0,k.useTranslation)("imagine"),{user:W}=(0,r.useSession)(),[K,Y]=(0,w.useState)(!1),[Q,X]=(0,w.useState)(!1),[J,$]=(0,w.useState)(!1),ee=(0,ar.useImagineModeStore)(e=>e.mediaPlayerTab),et=(0,ar.useImagineModeStore)(e=>e.setMediaPlayerTab),ei=(0,w.useRef)(null),[es,ea]=(0,w.useState)(!1),[en,er]=(0,Z.useLocalStorage)("imagine-mute-preference",!1,!1),[eo,el]=(0,w.useState)(!1),ed=(0,w.useMemo)(()=>ag.default.debounce(el,500),[]),[ec,eu]=(0,w.useState)(!b),em=(0,w.useRef)(null),ep=(0,tO.useMobileUa)(),eh=c||m,eg=(0,ar.useImagineModeStore)(e=>e.aspectRatio),ex=(0,u.useFeatureFlags)(),ef=ex.ENABLE_IMAGINE_IMAGE_EDIT,ev=ex.ENABLE_IMAGINE_QUERY_BAR_V2,ey=ex.IMAGINE_CONFIGS.get("enable_moderation_reporting",!1),{sdRef:eb,hdRef:ej,start:ew,activeQuality:ek}=function(e,t){let i=(0,w.useRef)(null),s=(0,w.useRef)(null),[a,n]=(0,w.useState)(null),r=(0,w.useRef)(!1),o=(0,w.useRef)(!1),l=(0,w.useRef)([]),[d,c]=(0,w.useState)(void 0),[u,m]=(0,w.useState)(void 0),p=(0,w.useRef)(null),h=(0,w.useRef)(null),g=(0,w.useRef)(null),x=!!(e||t),f=(0,w.useCallback)(()=>{l.current.forEach(e=>e()),l.current=[]},[]),v=(0,w.useCallback)(()=>{let e=s.current;if(r.current||!i.current||!e)return;r.current=!0;let t=setTimeout(()=>{var t,s,a,r;if(!i.current)return;let o=null!=(t=i.current.currentTime)?t:0,d=null!=(s=i.current.muted)&&s;if(e.currentTime=o+.1,e.currentTime,e.muted=d,!d){let t;e.volume=0;let s=(a=i.current,r=()=>{let e=setTimeout(()=>{i.current&&(i.current.pause(),i.current.volume=1)},10);l.current.push(()=>clearTimeout(e))},t=setInterval(()=>{a.volume=Math.max(0,a.volume-.033),e.volume=Math.min(1,e.volume+.033),(0===a.volume||1===e.volume)&&(clearInterval(t),r())},10),()=>{clearInterval(t)});l.current.push(()=>{i.current&&(i.current.volume=1),s()})}n("hd")},100);l.current.push(()=>clearTimeout(t))},[]),y=(0,w.useCallback)(()=>{let a=s.current;if(!a||!e||!t)return;h.current&&clearInterval(h.current);let n=setInterval(()=>{(()=>{if(r.current||!a.buffered.length||!i.current)return;let e=a.buffered.end(0),t=a.duration,s=1==a.networkState,o=i.current.currentTime>.25;if((e>=t||s&&e+.2>=t)&&o){let e=setTimeout(()=>{v()},250);l.current.push(()=>clearTimeout(e)),clearInterval(n)}})()},100);h.current=n,l.current.push(()=>{h.current&&clearInterval(h.current),h.current=null})},[e,t,v]),b=(0,w.useCallback)(()=>{let a=i.current;if(!a||!e)return;let r=()=>{a.duration};if(g.current=r,a.src!==e&&(g.current&&a.removeEventListener("loadedmetadata",g.current),a.addEventListener("loadedmetadata",r,{once:!0}),a.src=e,a.play().catch(e=>console.error("Play failed:",e))),a.preload="auto",t&&s.current&&!o.current){p.current&&a.removeEventListener("playing",p.current);let e=()=>{if(o.current||!s.current)return;let e=s.current;o.current=!0,y(),e.muted=!0,e.preload="auto",e.src=t,e.play().catch(e=>console.error("HD play failed:",e))};a.addEventListener("playing",e,{once:!0}),p.current=e}n("sd")},[e,t,y]),j=(0,w.useCallback)(()=>{let i=s.current;i&&t&&e&&"sd"===a&&!o.current&&requestAnimationFrame(()=>{if(o.current)return;o.current=!0,y(),i.muted=!0,i.src=t,i.load(),i.preload="auto";let e=e=>console.error("HD video error:",e);i.addEventListener("error",e),l.current.push(()=>i.removeEventListener("error",e))})},[t,e,a,y]),k=(0,w.useCallback)(()=>{let e=s.current;e&&t&&(e.src!==t&&(e.muted=!0,e.src=t,e.load()),e.preload="auto",e.paused&&e.readyState<1&&e.addEventListener("loadedmetadata",()=>{e.play().catch(e=>console.error("Play failed:",e))},{once:!0}),n("hd"))},[t]),N=(0,w.useCallback)(()=>{x&&(e?b():k())},[x,e,b,k]),S=(0,w.useCallback)(()=>{f(),i.current&&(p.current&&(i.current.removeEventListener("playing",p.current),p.current=null),i.current.pause()),s.current&&(s.current.pause(),s.current.muted=!1),n(null),r.current=!1,o.current=!1},[f,n]);return(0,w.useEffect)(()=>{let i=t!==u;e!==d?(S(),c(e),m(t),requestAnimationFrame(()=>{x&&N()})):i&&e&&(m(t),j())},[e,t]),(0,w.useEffect)(()=>()=>S(),[S]),{sdRef:i,hdRef:s,activeQuality:a,start:N,destroy:S,isReady:x}}(null!=c?c:void 0,null!=m?m:void 0),eN=(0,eq.useDebouncedValue)(ek,100);(0,w.useEffect)(()=>{if(E){eu(!0);let t="sd"===ek?eb.current:ej.current;if(t&&!t.paused){var e;t.pause(),t.currentTime=null!=(e=t.duration)?e:0}}},[E,ek,eb,ej]),(0,w.useEffect)(()=>{let e=em.current;if(!e)return;let t=new IntersectionObserver(e=>ed(e.some(e=>e.isIntersecting)),{root:null,rootMargin:"0px",threshold:.1});return t.observe(e),()=>{e&&t.unobserve(e),t.disconnect(),ed.cancel()}},[em]);let eS=en||!eo||!ec||"image"===ee;B&&(eS=!Q),(0,w.useEffect)(()=>{let e="sd"===ek?eb.current:ej.current,t=(c||m)&&e,i=p&&ei.current;t&&(t.muted=eS),i&&(i.muted=eS),!eS&&i&&t&&(i.play(),i.currentTime=t.currentTime)},[eS,ec,c,m,p,ek,eb,ej]),(0,w.useEffect)(()=>{v&&(v.current="video"===ee),y&&y("video"===ee)},[y,v,ee]),(0,w.useEffect)(()=>{eh?(et("video"),ew()):l&&et("image")},[eh]),(0,w.useEffect)(()=>{M&&et("image")},[M,et]),(0,w.useEffect)(()=>{let e="sd"===ek?eb.current:ej.current;e&&("image"===ee?e.pause():"video"===ee&&e.src&&e.play().catch(e=>{(0,h.logError)("imagine-post-page:handlePlay",e)}))},[ee,ek,eb,ej]),(0,w.useEffect)(()=>{let e="sd"===ek?eb.current:ej.current,t=ei.current;if(!e)return;let i=()=>{ea(!1),t&&(null==t||t.play(),t.currentTime=e.currentTime)},s=()=>{null==t||t.pause(),ea(!0)},a=()=>{t&&(t.currentTime=e.currentTime)},n=()=>{t&&(t.pause(),t.currentTime=0)},r=()=>{t&&(t.currentTime=e.currentTime)},o=()=>{x&&(x.current=e.currentTime)};return e.addEventListener("play",i),e.addEventListener("pause",s),e.addEventListener("seeking",a),e.addEventListener("ended",n),null==t||t.addEventListener("play",r),e.addEventListener("timeupdate",o),()=>{e.removeEventListener("play",i),e.removeEventListener("pause",s),e.removeEventListener("seeking",a),e.removeEventListener("ended",n),null==t||t.removeEventListener("play",r),e.removeEventListener("timeupdate",o)}},[c,p,ea,ek,eb,ej,ei,x]);let eI=(0,w.useCallback)(e=>{e.stopPropagation(),ec?er(!en):(eu(!0),er(!1))},[en,er,eu,ec]),eC=en||!ec,eE=(0,ar.useMediaStore)(e=>e.setImageDimensions),eM=(0,w.useCallback)(e=>{let t=e.target;eE(a,t.naturalWidth,t.naturalHeight)},[eE,a]),eT=(0,w.useCallback)(e=>{let t=e.target;eE(a,t.videoWidth,t.videoHeight)},[eE,a]),e_=(0,w.useMemo)(()=>{let[e,t]=eg;return Math.max(1,null!=n?n:e)/Math.max(1,null!=o?o:t)},[n,o,eg]),eP=window.innerHeight-(B?250:160),{width:eR}=sO(em);e_>eR/eP?(i=eR,s=Math.round(eR/e_)):(s=eP,i=Math.round(eP*e_));let[eA,eL]=(0,w.useState)(0);(0,w.useEffect)(()=>{var e,t;let i=em.current,s=null==i||null==(t=i.parentElement)||null==(e=t.parentElement)?void 0:e.parentElement;if(!i||!s)return;let a=()=>{let e=i.getBoundingClientRect(),t=s.getBoundingClientRect();eL(e.left-t.left)};a();let n=new ResizeObserver(a);return n.observe(i),s&&n.observe(s),()=>n.disconnect()},[]);let eD=Math.round((eR-i)/2),ez=Math.round(eR/2-i/2-75),eB=!1;eA+eD<80&&(ez=eD+5,eB=!0);let eG="image"===ee?!l:!c&&!m,eF=ey&&(c&&P&&"video"===ee||l&&A&&"image"===ee),eO=(0,w.useCallback)(e=>{e.stopPropagation(),e.preventDefault(),(0,h.logEventGlobal)("imagine_incorrect_moderation",void 0,{location:"imagine-media-player",type:ee,id:"video"===ee?L:D,moderated:eF?"true":"false"}),N.toast.success("Thank you for reporting.")},[ee,eF,L,D]),eV=(0,w.useRef)(new nw.Coverage(250));(0,w.useEffect)(()=>{if(!Q)return;let e=eb.current,t=eV.current,i=setInterval(()=>{if(!e)return;let i=e.currentTime;t.setLength(1e3*e.duration),t.sample(1e3*i),null==F||F(t.getCoverage())},200);return()=>{clearInterval(i),null==F||F(t.getCoverage())}},[Q,F,eb]);let eU=(0,w.useCallback)(()=>{let e="sd"===ek?eb.current:ej.current;e&&(eV.current.sample(1e3*e.currentTime),eV.current.setLength(1e3*e.duration),null==F||F(eV.current.getCoverage()),null==G||G())},[ek,eb,ej,F,G,eV]);return(0,t.jsxs)("div",{className:"w-full",ref:em,children:[(0,t.jsxs)("div",{onMouseEnter:()=>$(!0),onMouseLeave:()=>$(!1),onClick:Q?eU:K?void 0:eI,className:(0,f.cn)("group relative mx-auto rounded-2xl overflow-hidden ",g,eF&&"border-[6px] border-red-500",Q&&"ring-[5px] ring-surface-invert cursor-pointer"),style:{width:i,height:s},children:[(0,t.jsxs)("div",{className:"grid",children:[l?(0,t.jsx)("img",{onLoad:eM,src:l,className:(0,f.cn)("col-start-1 row-start-1 w-full h-full object-cover","image"!==ee&&"invisible pointer-events-none"),alt:null!=I?I:H("generic-image-alt","Generated image")}):(0,t.jsx)(nE,{className:"col-start-1 row-start-1",width:i,height:s}),eh&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("video",{id:"sd-video",onLoadedData:eT,ref:eb,playsInline:!0,autoPlay:!0,controls:!1,loop:!0,poster:null!=d?d:l,style:{visibility:("sd"===ek||"sd"===eN)&&"video"===ee?"visible":"hidden"},className:(0,f.cn)("col-start-1 row-start-1 w-full h-full object-cover","video"!==ee&&"invisible pointer-events-none"),children:H("video-unsupported.label","Your browser does not support the video tag.")}),(0,t.jsx)("video",{id:"hd-video",ref:ej,playsInline:!0,autoPlay:!0,controls:!1,loop:!0,poster:null!=d?d:l,style:{visibility:"hd"===ek&&"video"===ee?"visible":"hidden"},className:(0,f.cn)("col-start-1 row-start-1  w-full h-full object-cover","video"!==ee&&"invisible pointer-events-none"),children:H("video-unsupported.label","Your browser does not support the video tag.")})]})]}),eh&&p&&(0,t.jsx)("audio",{ref:ei,src:p,muted:!0,loop:!0,className:"hidden",children:H("audio-unsupported.label","Your browser does not support the audio tag.")}),B?(0,t.jsx)("div",{className:"absolute top-0 left-0 w-full h-full flex flex-col justify-end items-center gap-2 p-4 ",onMouseEnter:()=>X(!0),onMouseLeave:()=>X(!1),children:(0,t.jsxs)(R.Button,{shape:"pill",size:"md",variant:"primary",className:"ring-1 ring-white/10 bg-black/60 text-white/85 hover:text-white hover:bg-black/90 font-semibold",onClick:eU,children:[(0,t.jsx)(ns.ThumbsUp,{className:"size-4"}),H("side-by-side-button.label","I prefer this")]})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"absolute bottom-12 left-0 flex flex-col items-center w-full p-3 gap-3",children:[j&&(0,t.jsxs)("div",{className:"flex flex-row justify-center items-center gap-2 bg-[#555]/75 rounded-full p-2 px-2.5 animate-pulse-lg",children:[(0,t.jsx)(a9,{size:18,className:"text-white"}),(0,t.jsx)("span",{className:"text-white text-sm font-semibold",children:H("upscaling.label","Upscaling")})]}),S&&(0,t.jsxs)("div",{className:"flex flex-row justify-center items-center gap-2 bg-[#555]/75 rounded-full p-2 px-2.5 animate-pulse-lg",children:[(0,t.jsx)(e5.Plus,{size:18,className:"text-white"}),(0,t.jsx)("span",{className:"text-white text-sm font-semibold",children:H("extending.label","Extending")})]}),eG&&(0,t.jsx)("div",{className:"flex flex-row justify-center items-center gap-2 bg-[#555]/75 rounded-full p-2 px-4 animate-pulse-lg",children:(0,t.jsx)("span",{className:"text-white text-sm font-semibold",children:H("generating.label","Generating")})})]}),(0,t.jsxs)("div",{className:"absolute top-0 left-0 flex flex-row justify-end items-center w-full py-3 p-4 gap-2",children:[eF&&(0,t.jsxs)(R.ButtonWithTooltip,{tooltipContent:"This content was moderated by our system. Report if false positive (ie. it should have not been moderated). ",shape:"pill",size:"md",variant:"secondary",className:"text-white bg-[#555]/75   hover:bg-[#555]/100 border-0 font-semibold","aria-label":H("video-play-button.label","Play"),onClick:eO,children:[(0,t.jsx)(am,{className:"size-[20px]"}),"Report Over Moderation"]}),!M||ev?(0,t.jsx)(nI,{value:ee,onValueChange:et,className:(0,f.cn)({hidden:!eh}),activeQuality:ek,videoOnly:!l}):null,V]}),_&&!ev&&(0,t.jsx)("div",{className:"absolute bottom-0 right-0 flex flex-row items-center justify-end w-full p-4 gap-3",children:(0,t.jsx)(R.ButtonWithTooltip,{tooltipContent:H("image-edit-button.make-video","Make video"),shape:"circle",size:"md",variant:"secondary",className:"text-white bg-[#555]/75   hover:bg-[#555]/100 border-0",onClick:q,children:(0,t.jsx)(au.Play,{className:"size-4",strokeWidth:0,fill:"currentColor"})})}),(0,t.jsxs)("div",{className:(0,f.cn)("absolute bottom-0 left-0 flex flex-row items-center w-full p-4 gap-3",ev?"justify-end":"justify-between",{hidden:"video"===ee||_&&!ev||!W||!ef&&!ev||!l}),children:[z||ev?null:(0,t.jsx)("div",{className:"w-10 h-10"}),!ev&&(0,t.jsxs)(R.Button,{shape:"pill",size:"md",variant:"secondary",className:"text-white bg-[#555]/75   hover:bg-[#555]/100 border-0 font-semibold","aria-label":H("video-play-button.label","Play"),onClick:()=>{null==T||T(!0)},children:[(0,t.jsx)(aq.Brush,{className:"size-4"}),H("image-edit-button.label","Edit image")]}),z?(0,t.jsxs)(R.ButtonWithTooltip,{tooltipContent:H("imagine-more-button.tooltip","Generate more images like this"),shape:"pill",size:"md",variant:"secondary",className:"text-white bg-[#555]/75   hover:bg-[#555]/100 border-0 font-semibold pe-3 gap-1","aria-label":H("video-play-button.label","Play"),onClick:e=>{e.stopPropagation(),e.preventDefault(),null==z||z()},children:[H("imagine-more-button.label","More"),(0,t.jsx)(s0.default,{className:"size-5 opacity-90"})]}):null]}),(0,t.jsxs)("div",{className:(0,f.cn)("absolute bottom-[15px] left-0 flex flex-row justify-between items-center w-full p-4 gap-3",{hidden:"image"===ee}),children:[(0,t.jsx)("div",{className:(0,f.cn)(" transition-opacity duration-300",(J||ep)&&"video"===ee?"opacity-100":"opacity-0"),children:es?(0,t.jsx)(R.Button,{shape:"circle",size:"md",variant:"secondary",className:"text-white bg-[#555]/75   hover:bg-[#555]/100 border-0","aria-label":H("video-play-button.label","Play"),onClick:e=>{e.stopPropagation(),e.preventDefault();let t="sd"===ek?eb.current:ej.current;null==t||t.play().catch(e=>{(0,h.logError)("imagine-post-page:handlePlay",e)})},children:(0,t.jsx)(au.Play,{className:"size-[20px]",fill:"currentColor",strokeWidth:0})}):(0,t.jsx)(R.Button,{shape:"circle",size:"md",variant:"secondary",className:"text-white bg-[#555]/75   hover:bg-[#555]/100 border-0","aria-label":H("video-pause-button.label","Pause"),onClick:e=>{e.stopPropagation(),e.preventDefault();let t="sd"===ek?eb.current:ej.current;null==t||t.pause()},children:(0,t.jsx)(ny.Pause,{className:"size-[20px]",fill:"currentColor",strokeWidth:0})})}),(0,t.jsx)("div",{children:(0,t.jsxs)(R.Button,{shape:ec?"circle":"pill",size:"md",variant:"secondary",className:(0,f.cn)("text-white bg-[#555]/75   hover:bg-[#555]/100 border-0 transition-opacity duration-300","video"!==ee&&"hidden",!ec&&" gap-4",J||ep||eC?"opacity-100":"opacity-0"),onClick:eI,children:[eC?(0,t.jsx)(nj,{className:"size-[20px]"}):(0,t.jsx)(nb.default,{className:"size-[20px]"}),(0,t.jsx)("span",{className:(0,f.cn)("font-semibold text-md",ec&&"sr-only"),children:eC?H("video-unmute-button.label","Unmute"):H("video-mute-button.label","Mute")})]})})]}),(0,t.jsx)("div",{className:(0,f.cn)("absolute bottom-0 left-0 flex flex-row justify-between items-center w-full p-2 py-0 gap-3",{hidden:"image"===ee}),children:(0,t.jsx)(nS,{videoRef:"sd"===ek?eb:ej,setInhibitFullPanelMute:Y,show:(J||E)&&"video"===ee&&!ep,setExtendMode:C,videoExtendMode:E,extendInProgress:S})})]})]}),(0,t.jsx)("div",{className:(0,f.cn)("absolute top-0 w-fit py-[100px] opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center pointer-events-auto",O||J?"opacity-100":"opacity-0",!eB&&"opacity-100"),style:{left:"".concat(ez,"px"),height:s},children:(0,t.jsx)("div",{className:"max-h-[420px] h-full w-full",children:U})})]})});function nE(e){let{className:i,width:s,height:a}=e,{resolvedTheme:n}=(0,ee.useTheme)(),r=Math.floor(s/36);return(0,t.jsx)("div",{className:(0,f.cn)("bg-accent rounded-md w-full h-full",i),children:(0,t.jsx)(nk,{width:s,height:a,spacing:s/r,color:"dark"===n?"white":"black"})})}function nM(e,t){(0,h.logEventGlobal)(e,void 0,{location:"imagine-rabbithole",...t})}let nT=!1,n_=!1;function nP(){let e=function(){let{IMAGINE_ENABLE_CHILD_POST_IDS:e}=(0,u.useFeatureFlags)(),{route:t}=(0,x.useRouting)(),i="imagine-post"===t.page?t.postId:(0,nu.never)("only for imagine post page");if(!e)return i;let s=ar.useMediaStore.getState().getContainerRoot(i);return ar.useMediaStore.getState().setCurrentRootContainer(s),s}(),i=(0,tO.useMobileUa)(),s=(0,ar.useMediaStore)(t=>!!(t.byId[e]||t.favoritesById[e])),a=(0,u.useFeatureFlags)(),n=(0,ar.useMediaStore)(e=>e.rehydrated);return((!s||n)&&(ar.useMediaStore.getState().resetRehydrated(),!function(e){let{rehydrated:t}=e;function i(e){("Space"===e.key||"Enter"===e.key)&&s()}function s(){setTimeout(()=>{nT=!1},500),document.removeEventListener("click",s,!0),document.removeEventListener("touchstart",s,!0),document.removeEventListener("touchend",s,!0),document.removeEventListener("mousedown",s,!0),document.removeEventListener("mouseup",s,!0),document.removeEventListener("dblclick",s,!0),document.removeEventListener("keydown",i,!0),document.removeEventListener("keyup",i,!0)}n_||(nM("imagine-post-page-first-time-interacted",{url:window.location.href,rehydrated:t?"true":"false"}),n_=!0,document.addEventListener("click",s,!0),document.addEventListener("touchstart",s,!0),document.addEventListener("touchend",s,!0),document.addEventListener("mousedown",s,!0),document.addEventListener("mouseup",s,!0),document.addEventListener("dblclick",s,!0),document.addEventListener("keydown",i,!0),document.addEventListener("keyup",i,!0),nT=!0)}({rehydrated:n})),i&&!s)?(0,t.jsx)(ad.default,{}):(0,t.jsxs)("div",{className:"w-full relative",children:[(0,t.jsx)(nL,{id:e}),!a.ENABLE_IMAGINE_QUERY_BAR_V2&&(0,t.jsx)("div",{className:"absolute left-0 bottom-0 p-3 pointer-events-auto z-20",children:(0,t.jsx)(aP,{showFavorites:!0})})]},e)}function nR(e){return function(t){var i;return!!t&&(!t.videoId||!e[null!=(i=t.videoId)?i:""])&&(void 0==t.progress||100===t.progress)&&(t.videoUrl||t.mediaUrl||t.hdMediaUrl)}}function nA(e){return"number"!=typeof e.progress||!(e.progress<100)}function nL(e){var i,s,a,n,o,l,d,p,g,v,y,b,S,I,C,E,M,T,P,A,D;let{id:z}=e,{user:B}=(0,r.useSession)(),{ASSET_SERVER_URL:G}=(0,_.useEnvironment)(),{t:F}=(0,k.useTranslation)("imagine"),O=(0,ae.useSettingsDialogStore)(j.prop("open")),{route:V,push:U,replace:q}=(0,x.useRouting)(),H="imagine-post"===V.page?V.postId:"",W="parentXPostId"in V?V.parentXPostId:void 0,K=(0,w.useRef)("imagine-post"===V.page?V.mediaUrl:null).current,Y=(0,ar.useMediaStore)(e=>e.fetchGenerateImageEdits),Q=(0,ar.useMediaStore)(e=>e.createMediaPostFromUrl),X=(0,ar.useImagineModeStore)(e=>e.setMediaPlayerTab),J=(0,ar.useMediaStore)(e=>{var t;if(!H||H===z)return 0;let i=(null!=(t=e.videoByMediaId[z])?t:[]).filter(nR(e.inhibitedVideoIds)),s=i.findIndex(e=>e.videoId===H||e.id===H);return s>=0?i.length-s-1:0}),Z=(0,ar.useMediaStore)(e=>{var t;if(!H||H===z)return 0;let i=(null!=(t=e.imageByMediaId[z])?t:[]).filter(nA),s=i.findIndex(e=>e.id===H);return s>=0?i.length-s-1:0}),[$,et]=(0,w.useState)(J),[ei,es]=(0,w.useState)(Z),[en,er]=(0,w.useState)(!1),eo=(0,w.useRef)(nT),el=(0,u.useFeatureFlags)(),ed=el.IMAGINE_ENABLE_CHILD_POST_IDS,ec=el.IMAGINE_CONFIGS,eu=ec.get("enable_like_on_image"),em=ec.get("enable_moderation_reporting",!1);aG();let[ep,eh]=(0,w.useState)(()=>!!K),[ex,ef]=(0,w.useState)(null),ev=(0,w.useRef)(!1);(0,w.useEffect)(()=>{K&&q({page:"imagine-post",postId:H,parentXPostId:W,mediaUrl:null})},[K,q,H,W]),(0,w.useEffect)(()=>{K&&!ev.current&&(ev.current=!0,eh(!0),(0,nc.fetch)(K,{referrerPolicy:"no-referrer"}).then(e=>{if(!e.ok)throw Error("Failed to fetch media: ".concat(e.status));let t=e.headers.get("content-type")||"image/jpeg";return e.arrayBuffer().then(e=>({buffer:e,contentType:t}))}).then(e=>{let{buffer:t,contentType:i}=e,s=new URL(K).pathname.split("/").pop()||"imported-media";return eg.chatApi.chatUploadFile({body:{fileName:s,fileMimeType:i,content:a4.Buffer.from(t).toString("base64")}})}).then(e=>{var t;if(!e.fileUri)throw Error("Upload succeeded but no fileUri returned");return Q("".concat(G,"/").concat(e.fileUri),(null==(t=e.fileMimeType)?void 0:t.startsWith("video/"))?"video/mp4":void 0)}).then(e=>{ef(e.id),eh(!1),q({page:"imagine-post",postId:e.id,parentXPostId:W})}).catch(e=>{(0,h.logError)("imagine-post-page:importMediaFromUrl",e),eh(!1),U({page:"imagine"})}))},[K,G,Q,q,U,W]);let ey=(0,ar.useMediaStore)(e=>e.fetchMediaPost),eb=!K,{isErrored:ew,isLoading:ek}=(0,m.usePromise)(eb?ey(z):Promise.resolve(void 0)),eN=(0,ar.useMediaStore)(e=>e.byId[z]||e.favoritesById[z]);(0,ar.useMediaStore)(e=>ex?e.byId[ex]||e.favoritesById[ex]:null);let eS=(0,ar.useMediaStore)(e=>{var t;return(null!=(t=e.videoByMediaId[z])?t:[]).filter(nR(e.inhibitedVideoIds)).length}),eI=(0,ar.useMediaStore)(e=>{var t;return(null!=(t=e.videoByMediaId[z])?t:[]).filter(nR(e.inhibitedVideoIds))[Math.max(0,Math.min(eS-$-1,eS-1))]}),eC=(0,ar.useMediaStore)(e=>{var t;return(null!=(t=e.imageByMediaId[z])?t:[]).filter(nA).length}),eE=(0,ar.useMediaStore)(e=>{var t;return(null!=(t=e.imageByMediaId[z])?t:[]).filter(nA)[Math.max(0,Math.min(eC-ei-1,eC-1))]});(null==eN||null==(i=eN.mimeType)?void 0:i.includes("video"))&&!eS&&(eI=eN);let eM=en?eI:eE,eT=(0,ar.useMediaStore)(e=>{var t,i;let s=null!=(t=e.videoByMediaId[z])?t:[],a=null!=(i=e.imageByMediaId[z])?i:[],n=s[s.length-1],r=a[a.length-1];return en?n&&"number"==typeof n.progress&&n.progress<100:r&&"number"==typeof r.progress&&r.progress<100}),e_=(0,ar.useMediaStore)(e=>{var t;let i=null!=(t=e.imageByMediaId[z])?t:[];return i[i.length-1]}),eP=(0,eq.useDebouncedValue)(eT,500)||eT,eR=eI&&eI.originalRefType===nm.GrokApiOriginalRefType.OriginalRefTypeVideoExtension?eI.originalPostId:void 0,eA=eR?eI.videoExtensionStartTime:void 0,eL=eI&&eI.originalRefType===nm.GrokApiOriginalRefType.OriginalRefTypeVideoEdit?eI.originalPostId:void 0,eD=(0,ar.useMediaStore)(e=>{var t,i;let s=e.sideBySideVideoComparisonByVideoId[null!=(t=null==eI?void 0:eI.id)?t:""];if(!s)return;let a=(null!=(i=e.videoByMediaId[z])?i:[]).find(e=>e.videoId===s);if(a&&100===a.progress&&a.videoUrl&&(null==eI?void 0:eI.videoUrl))return a}),ez=(0,w.useRef)(0);(0,w.useEffect)(()=>{eD?ez.current=Date.now():ez.current=0},[eD]),(0,w.useEffect)(()=>{ed&&(en&&!eD&&(null==eI?void 0:eI.id)?H!==(null==eI?void 0:eI.id)&&q({page:"imagine-post",postId:null==eI?void 0:eI.id}):!en&&((null==eE?void 0:eE.id)?H!==(null==eE?void 0:eE.id)&&q({page:"imagine-post",postId:null==eE?void 0:eE.id}):H!==z&&z&&q({page:"imagine-post",postId:z})))},[eN,q,en,eI,eE,H,ed,z,eD]);let eB=(0,w.useCallback)(e=>{var t,i,s;Y({imageUrl:null!=(i=null!=(t=null==eE?void 0:eE.mediaUrl)?t:null==eN?void 0:eN.mediaUrl)?i:"",prompt:e,postId:z,imagePostId:null!=(s=null==eE?void 0:eE.id)?s:z}).catch(e=>{(0,h.logError)("error fetching image edit",e)}),es(0)},[z,Y,null==eN?void 0:eN.mediaUrl,null==eE?void 0:eE.mediaUrl,null==eE?void 0:eE.id]),eG=(e,t)=>{var i,s,a,n,r;let o=ar.useMediaStore.getState(),l=null!=(a=e.videoId)?a:"",d=null!=(n=null==(i=o.videoByMediaId[z])?void 0:i.findIndex(e=>e.videoId===(null==eI?void 0:eI.id)))?n:0;et(-((null!=(r=null==(s=o.videoByMediaId[z])?void 0:s.findIndex(t=>t.videoId===(null==e?void 0:e.videoId)))?r:0)-d));let c=Date.now()-ez.current;o.recordPreferredSideBySideVideoIds(l,c,t)},eF=(e,t)=>{var i;ar.useMediaStore.getState().recordSideBySideVideoCoverage(null!=(i=e.videoId)?i:"",t)},eO=(0,w.useCallback)(()=>{eo.current?U({page:"imagine"}):window.history.back()},[U,eo]);(0,w.useEffect)(()=>{if(O)return;let e=e=>{"Escape"===e.key&&eO()},t=setTimeout(()=>{window.addEventListener("keydown",e)},50);return()=>{clearTimeout(t),window.removeEventListener("keydown",e)}},[eO,O]);let eV=(null==eI?void 0:eI.videoUrl)||(null==(s=eI)?void 0:s.mediaUrl),eU=(null==eI?void 0:eI.hdMediaUrl)||(null==(a=eI)?void 0:a.hdMediaUrl),eH=null==eI?void 0:eI.upscalingInProgress,eW=(0,ar.useMediaStore)(e=>{var t;return e.extendProcessingById[null!=(t=null==eI?void 0:eI.id)?t:""]}),eK=null==eI||null==(n=eI.audioUrls)?void 0:n[0];(eK===eV||eK===eU)&&(eK=void 0);let eY=null!=(d=null==eI?void 0:eI.id)?d:null==eI?void 0:eI.videoId,eQ=null!=(p=null==eE?void 0:eE.id)?p:null==eN?void 0:eN.id,eX=(0,w.useRef)(!1),eJ=(0,w.useRef)(0),eZ=(0,w.useRef)(null),e$=(0,w.useRef)(null),e0=(0,L.useMobileSize)(),e1=(0,L.useMobileSize)(640),[e2,e5]=(0,w.useState)(!1),[e4,e3]=(0,w.useState)(!1),e6=eZ.current,e8=el.ENABLE_IMAGINE_MORE_BUTTON;(0,w.useEffect)(()=>{let e;if(e8)return;let t=()=>{var e,t;let i=document.getElementById("imagine-post-page-content"),s=null==i?void 0:i.getBoundingClientRect(),a=(null!=(e=null==s?void 0:s.top)?e:0)<.6*window.innerHeight,n=(null!=(t=null==e6?void 0:e6.getBoundingClientRect().width)?t:0)>770;n!==e2&&e5(n),a!==e4&&e3(!!a)};return e6&&(e6.addEventListener("scroll",t),e=setInterval(t,333)),()=>{e6&&e6.removeEventListener("scroll",t),e&&clearInterval(e)}},[e4,e3,e6,e2,e5,e8]),(0,w.useEffect)(()=>{setTimeout(()=>{window.dispatchEvent(new Event("resize"))},100)},[U,eN]);let e9=K||(null!=(b=null!=(y=null!=(v=null!=(g=null==eE?void 0:eE.blobSrc)?g:null==eE?void 0:eE.mediaUrl)?v:null==eE?void 0:eE.thumbnailImageUrl)?y:null==eN?void 0:eN.mediaUrl)?b:null==eN?void 0:eN.thumbnailImageUrl),e7=!!((null==eN?void 0:eN.prompt)||(null==eN?void 0:eN.originalPrompt)),te=(null==eE?void 0:eE.moderated)&&eE.mediaType===an.GrokApiMediaPostType.MediaPostTypeImage,tt=B&&(!te||em)&&!eD&&!el.ENABLE_IMAGINE_QUERY_BAR_V2,ti=null!=(S=null==eI?void 0:eI.modelName)?S:"",ts=null!=(I=null==eI?void 0:eI.mode)?I:"",ta=null==eI?void 0:eI.originalPrompt,[tn,tr]=(0,w.useState)(!1),to="imagine-post"===V.page&&"img_edit"===V.action,[tl,td]=(0,w.useState)(()=>to),[tc,tu]=(0,w.useState)(!1),tm=!!(null==eI?void 0:eI.moderated),tp=!!(null==eN?void 0:eN.moderated)&&eN.mediaType===an.GrokApiMediaPostType.MediaPostTypeImage;((null==e9?void 0:e9.endsWith(".mp4"))||e9==eV)&&(e9=void 0),(null==eN?void 0:eN.blobSrc)&&!eN.complete&&(tp=!1);let th=!e9,tg=!eV&&!!e9,tx=(null==eN||null==(o=eN.userInteractionStatus)?void 0:o.likeStatus)===!0,tf=B&&tg&&eu,tv=(0,ar.useMediaStore)(e=>e.like),ty=(0,ar.useMediaStore)(e=>e.unlike),tb=th&&!e7&&!ta,tj=eN&&tb&&ec.get("enable_edits");(0,w.useEffect)(()=>{tj&&tu(!0)},[tj]);let tw=null!=(C=null==eN||null==(l=eN.originalPost)?void 0:l.id)?C:"",tk=null!=z?z:"";(0,w.useEffect)(()=>{new URL(window.location.href).searchParams.get("source")&&nT&&nM("image_feed_shared_media_opened",{originalPostId:tw,postID:tk})},[tw,tk]),(0,c.useDocumentTitle)(F("imagine-post-html-document-title","Imagine"),null!=(E=null==eM?void 0:eM.prompt)?E:"");let tN=nf(e=>e.updateContext),tS=nf(e=>e.clearContext);(0,w.useEffect)(()=>{if(el.ENABLE_IMAGINE_QUERY_BAR_V2&&eN&&B)return(!te||em)&&tN({post:eN,videoExtendMode:tn,setVideoExtendMode:tr,videoEditMode:tc,setVideoEditMode:tj?void 0:tu,videoCurrentTimeRef:eJ,lastGeneratedVideo:eI,lastGeneratedVideoWasExtendedFrom:eR,lastGeneratedVideoWasExtendedFromTime:eA,lastGeneratedVideoWasEditedFrom:eL,originalPrompt:ta,isModelGenerated:e7,onVideoGenerationStart:()=>{et(0),tr(!1),tu(!1)},isVideoOnlyPost:th,imageEditPromptMode:tl,setImageEditPromptMode:td,runImageEditPrompt:eB}),()=>{tS()}},[el.ENABLE_IMAGINE_QUERY_BAR_V2,eN,B,tn,tr,tc,tu,eJ,eI,eR,eA,eL,ta,e7,th,te,em,tj,tN,tS,tl,td,eB]),(0,w.useEffect)(()=>{el.ENABLE_IMAGINE_QUERY_BAR_V2&&tN({isImportingMedia:ep})},[el.ENABLE_IMAGINE_QUERY_BAR_V2,ep,tN]),(0,w.useEffect)(()=>{let e;return eN||ek||ep||(e=setTimeout(()=>{N.toast.error(F("imagine-post-not-found","Post not found. Redirecting to imagine home...")),e=setTimeout(()=>{U({page:"imagine"})},500)},500)),()=>{e&&clearTimeout(e)}},[ek,ep,eN,U,F]);let tI="imagine-post"===V.page?V.action:null,tC=(0,w.useMemo)(()=>{if(el.ENABLE_IMAGINE_MORE_BUTTON){var e,t,i;if((null==eN||null==(e=eN.mimeType)?void 0:e.includes("video"))&&(null==eN||null==(t=eN.originalPost)?void 0:t.mediaUrl)?(null==eN||null==(i=eN.originalPost)?void 0:i.prompt)||(null==eN?void 0:eN.prompt)||eN.originalPrompt:(null==eN?void 0:eN.prompt)||(null==eN?void 0:eN.originalPrompt))return()=>{var e;nM("imagine_more_button_clicked",{}),U({page:"imagine-more",postId:en?eI.id:null!=(e=null==eN?void 0:eN.id)?e:z,parentXPostId:W,action:tI})}}},[el.ENABLE_IMAGINE_MORE_BUTTON,U,en,eI,eN,z,W,tI]),{resolvedTheme:tE}=(0,ee.useTheme)(),tM="dark"===tE,tT=(0,as.useScrollGradient)({ref:eZ,size:tM?[.04,.15]:[.05,.16],midpoint:tM?[.7,.66]:[.7,.6]}),t_=eD&&"videoId"in eD?null==eD?void 0:eD.videoId:"",tP=(0,w.useMemo)(()=>t_?.5>Math.random()?"left":"right":"",[t_]),tR=(0,w.useCallback)(e=>{e.preventDefault(),e.stopPropagation();let t=null==eE?void 0:eE.id;nM("image_feed_video_generation_started",{location:"imagine-post-page",mode:"normal",source:"media-player"}),et(0),tr(!1),tu(!1),td(!1),eI&&X("video"),ar.useMediaStore.getState().generateVideoForImage(null!=z?z:"",t,"normal","imagine-post-page",void 0,void 0,void 0,0,void 0,void 0).catch(e=>{(0,h.logError)("imagine-post-page:handleMediaPlayerMakeVideoClick",e)})},[z,eE,eI,et,tr,tu,td,X]);if(ek&&!eN||!eN)return"";let tA=eD&&"videoUrl"in eD&&eD.videoUrl?(0,t.jsx)(nC,{setImageEditPromptMode:null!=td?td:void 0,imageEditPromptMode:tl,videoExtendMode:tn,setExtendMode:tr,firstTimeInteracted:nT,mediaId:eN.id,imageWidth:eN.width,imageHeight:eN.height,imageSrc:e9||"",videoSrc:(0,ej.getCachedAssetUrl)(G,eD.videoUrl),sideBySideMode:!!eD,onSideBySidePreferClick:()=>eG(eD,tP),onSideBySideHoverCoverage:e=>eF(eD,e)},"side-by-side-video-2"):null,tL=eD?null:(0,t.jsx)(nW,{postId:eN.id,videoTab:en,pastVideoOffset:$,setPastVideoOffset:et,pastImageOffset:ei,setPastImageOffset:es,height:50,vertical:!e1});return(0,t.jsxs)("main",{tabIndex:-1,className:"w-full h-dvh relative",style:{outline:"none",scrollbarWidth:"none",...th?{}:tT},ref:eZ,children:[B&&(0,t.jsx)("div",{className:"h-0 sticky top-0 z-10 flex flex-row",children:(0,t.jsx)(R.Button,{variant:"secondary",shape:"circle",size:"md","aria-label":F("imagine-back-button.label","Back"),onClick:eO,className:"sticky top-0 !bg-surface-l1 z-10 mt-3 mx-3",children:(0,t.jsx)(s$.ArrowLeft,{className:"size-4"})})}),(0,t.jsxs)("article",{className:(0,f.cn)("max-w-[750px] my-4  mx-auto flex flex-col gap-4",e0&&"my-0",eD&&"max-w-[1200px]"),ref:e$,children:[eD&&(0,t.jsxs)("div",{className:"flex flex-col gap-2 justify-center items-center",children:[(0,t.jsx)("h3",{className:"text-xl font-bold",children:F("side-by-side-video.title","Which video do you prefer?")}),(0,t.jsx)("p",{className:"text-sm",children:F("side-by-side-video.description","You will keep both videos. Your feedback will help us improve the quality of our videos. ")}),(0,t.jsx)(R.Button,{variant:"secondary",size:"md",shape:"pill",className:"font-semibold",onClick:()=>{let e=ar.useMediaStore.getState(),t=Date.now()-ez.current;e.skipSideBySideVideo(t)},children:F("side-by-side-video.skip","Skip")})]}),(0,t.jsxs)("div",{className:"relative flex flex-row gap-2 justify-center items-center",children:[(0,t.jsx)("div",{className:"flex items-center absolute top-0 -left-16 py-[100px] h-full",children:(0,t.jsx)("div",{className:"max-h-[400px] h-full w-full",children:tL&&null})}),"left"===tP?tA:null,(0,t.jsx)(nC,{onMoreClick:tC,setImageEditPromptMode:null!=td?td:void 0,imageEditPromptMode:tl,videoExtendMode:tn,setExtendMode:tr,firstTimeInteracted:nT,mediaId:eN.id,imageWidth:eN.width,imageHeight:eN.height,imageSrc:e9,videoPlaceholderImageSrc:null!=(T=null!=(M=null==eI?void 0:eI.thumbnailImageUrl)?M:e9)?T:"",videoSrc:(0,ej.getCachedAssetUrl)(G,eV),audioSrc:(0,ej.getCachedAssetUrl)(G,eK),hdVideoSrc:(0,ej.getCachedAssetUrl)(G,eU),videoPlayingRef:eX,videoCurrentTimeRef:eJ,videoPlayingCb:er,upscalingInProgress:null!=eH&&eH,extendInProgress:null!=eW&&eW,altText:null!=(P=null==eM?void 0:eM.prompt)?P:"",displayImageOnly:tl,videoModerated:tm,imageModerated:tp,videoItemId:null!=(A=null==eI?void 0:eI.id)?A:"",imageItemId:null!=(D=null==eE?void 0:eE.id)?D:"",sideBySideMode:!!eD,onSideBySidePreferClick:()=>eG(eI,"left"===tP?"right":"left"),onSideBySideHoverCoverage:e=>eF(eI,e),filmstrip:e1?null:tL,nextItemInProgress:eP,makeVideoClick:tR,children:B?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("div",{onClick:e=>{e.preventDefault(),e.stopPropagation()},className:"flex flex-row gap-2",children:[tf?(0,t.jsx)(R.ButtonWithTooltip,{shape:"circle",size:"md",variant:"tertiary",tooltipContent:F("image-save-button.tooltip","Save"),className:nN,onClick:()=>(tx?nM("image_feed_image_unliked",{type:"image"}):nM("image_feed_image_liked",{type:"image"}),tx?ty(eN.id):tv(eN.id)),children:(0,t.jsx)(ac.HeartIcon,{className:(0,f.cn)("size-4"),fill:"none",stroke:"currentColor"})}):null,(0,t.jsx)(nq,{lastGeneratedImage:eE,videoModerated:tm,imageModerated:tp,setImageEditPromptMode:td,setPastVideoOffset:et,onExtendVideo:e=>{if(void 0!==e)return void tr(e);tr(e=>!e)},hdVideoUrl:eU,post:eN,imageUrl:e9||"",videoUrl:eV,videoPlayingRef:eX,lastGeneratedVideo:eI,videoTab:en,handleHistoryBack:eO,setVideoEditMode:tj?void 0:tu})]})}):null},eD?"side-by-side-video-1":"main-video"),B&&!eD&&el.ENABLE_IMAGINE_QUERY_BAR_V2&&(0,t.jsxs)("div",{className:(0,f.cn)("flex flex-col gap-2 absolute bottom-20",e0?"right-1":"-right-14"),children:[(0,t.jsx)(R.ButtonWithTooltip,{shape:"circle",size:"md",variant:"secondary",tooltipContent:tx?F("image-unsave-button.tooltip","Unsave"):F("image-save-button.tooltip","Save"),onClick:()=>(tx?nM("image_feed_image_unliked",{type:"image"}):nM("image_feed_image_liked",{type:"image"}),tx?ty(eN.id):tv(eN.id)),children:(0,t.jsx)(ac.HeartIcon,{className:(0,f.cn)("size-4",tx&&"text-red-400 dark:text-red-500"),fill:tx?"currentColor":"none",stroke:tx?"none":"currentColor"})}),(0,t.jsx)(R.ButtonWithTooltip,{shape:"circle",size:"md",variant:"secondary",tooltipContent:F("download-button.tooltip","Download"),onClick:()=>{nM("image_feed_image_saved",{post_id:eN.id,video_id:null==eI?void 0:eI.id,model_name:null==eI?void 0:eI.modelName,mode:null==eI?void 0:eI.mode});let e=eX.current?eU||eV:e9||"",t=(0,ej.getCachedAssetUrl)(G,e),i=eX.current?"grok-video-".concat(eN.id,".mp4"):"grok-image-".concat(eN.id,".png"),s=new URL(null!=t?t:"https://grok.com");s.searchParams.set("dl","1");let a=s.toString();(0,nd.downloadImage)(a,i,!1).catch(e=>{(0,h.logError)("imagine-post-page:downloadImage",e)})},children:(0,t.jsx)(a6.Download,{className:"size-4"})}),(0,t.jsx)(nF,{post:eN,videoPlayingRef:eX,videoId:eY,mode:ts})]}),"right"===tP?tA:null]}),e1?(0,t.jsx)("div",{className:"w-full h-fit",children:tL}):null,B&&!tl&&!eD&&tt&&!el.ENABLE_IMAGINE_QUERY_BAR_V2&&(0,t.jsxs)("div",{className:(0,f.cn)("flex justify-between gap-5",e1&&"gap-2"),children:[(0,t.jsx)("div",{className:"flex justify-end relative w-full",children:tt&&(0,t.jsx)(nD,{videoTab:en,videoCurrentTimeRef:eJ,videoExtendMode:tn,setVideoExtendMode:tr,post:eN,isModelGenerated:e7,originalPrompt:ta,onVideoGenerationStart:()=>{et(0),tr(!1),tu(!1)},lastGeneratedVideo:eI,lastGeneratedVideoWasExtendedFrom:eR,lastGeneratedVideoWasExtendedFromTime:eA,lastGeneratedVideoWasEditedFrom:eL,isVideoOnlyPost:th,videoEditMode:tc,setVideoEditMode:tj?void 0:tu,lastGeneratedImage:eE})}),(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:"flex flex-row border border-border-l2 rounded-full p-1 h-13 bg-surface-l1 ",children:[(0,t.jsx)(nz,{post:eN,videoPlayingRef:eX,imageSrc:e9||"",videoUrl:eV,hdVideoUrl:eU,modelName:ti,mode:ts,videoId:eY}),(0,t.jsx)(nB,{post:eN,videoPlayingRef:eX,videoId:eY,imageId:eQ,mode:ts}),el.ENABLE_SHARE_TO_X_BUTTON&&(0,t.jsx)(nG,{post:eN,videoPlayingRef:eX,videoId:eY,mode:ts})]})})]}),B&&tl&&!eD&&!el.ENABLE_IMAGINE_QUERY_BAR_V2&&(0,t.jsxs)("div",{className:(0,f.cn)("flex justify-between gap-5",e1&&"gap-2"),children:[(0,t.jsx)("div",{className:"flex justify-end relative w-full",children:(0,t.jsx)(nU,{runImageEditPrompt:eB,setImageEditPromptMode:td,lastGeneratedImageWithOriginalPost:e_&&nA(e_)&&(null==eE?void 0:eE.originalPostId)?eE:void 0})}),(0,t.jsx)("div",{children:(0,t.jsxs)("div",{className:"flex flex-row border border-border-l2 rounded-full p-1 h-13 bg-surface-l1 ",children:[(0,t.jsx)(nz,{post:eN,videoPlayingRef:eX,imageSrc:e9||"",videoUrl:eV,hdVideoUrl:eU,modelName:ti,mode:ts,videoId:eY}),(0,t.jsx)(nB,{post:eN,videoPlayingRef:eX,videoId:eY,imageId:eQ,mode:ts}),el.ENABLE_SHARE_TO_X_BUTTON&&(0,t.jsx)(nG,{post:eN,videoPlayingRef:eX,videoId:eY,mode:ts})]})})]}),(0,t.jsx)("hr",{id:"imagine-post-page-content",className:"h-0 p-0 -my-2 invisible"}),!B&&(0,t.jsxs)("div",{className:"flex flex-col  mb-10  pb-10",children:[(null==eM?void 0:eM.prompt)&&(0,t.jsx)(aK,{prompt:null==eM?void 0:eM.prompt,widthStyle:"full",isEditable:!1}),(0,t.jsx)("div",{className:"w-full flex flex-col items-center justify-center  -mt-4",children:(0,t.jsx)(ea,{persistentBanner:!0})})]})]})]})}function nD(e){var i,s,a,n,o;let{post:l,videoExtendMode:d,setVideoExtendMode:c,isModelGenerated:u,originalPrompt:m,onVideoGenerationStart:p,lastGeneratedVideo:g,lastGeneratedImage:x,lastGeneratedVideoWasExtendedFrom:f,lastGeneratedVideoWasExtendedFromTime:v,lastGeneratedVideoWasEditedFrom:y,videoCurrentTimeRef:b,isVideoOnlyPost:j,videoEditMode:k,setVideoEditMode:N,videoTab:S}=e,{user:I}=(0,r.useSession)(),{stage:C,dateOfBirthSeconds:E}=(0,a3.useAgeVerificationStage)(),M=null!=(a=null!=E?E:null==I||null==(i=I.birthDate)?void 0:i.seconds)?a:void 0,T=!!M,_=M&&function(e){let t=new Date().getTime()/1e3-567648e3;return"string"==typeof e?(e=parseInt(e))<t:"number"==typeof e&&e<t}(M),P=null==g?void 0:g.videoDuration,R=(0,w.useRef)(""),A=null!=(n=null==(s=l.originalPost)?void 0:s.id)?n:l.id,L=(0,ar.useMediaStore)(e=>e.lastUsedPromptById[A]),[D,z]=(0,w.useState)(null!=m?m:""),B=null!=(o=(0,ar.useMediaStore)(e=>(0,np.default)(e.videoByMediaId[l.id])))?o:l,G="number"==typeof(null==B?void 0:B.progress)&&B.progress<100,F=(0,ar.useMediaStore)(e=>e.generateVideoForImage),O=(0,eo.useSettingsStore)(e=>e.setShowAgeVerification),V=(0,eo.useSettingsStore)(e=>e.setAgeVerificationCallback),U=(0,eo.useSettingsStore)(e=>e.setAgeVerificationBehavior),q=(0,eo.useSettingsStore)(e=>e.ageVerificationCallback),H=(0,ar.useMediaStore)(e=>e.smoothedVideoProgress[l.id]),W=G?Math.round(null!=H?H:0):100;(0,w.useEffect)(()=>{if(d)return void z("");z(G?null!=L?L:"":null!=m?m:"")},[m,G,L,d]);let K=(0,w.useCallback)(function(e){var t;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2?arguments[2]:void 0,a=null!=(t=R.current)?t:"",n=()=>{var t,n,r,o,d,c,u;let m=null!=(o=null!=(r=S?null==g?void 0:g.originalPostId:null==x?void 0:x.id)?r:null==(t=l.originalPost)?void 0:t.id)?o:l.id,j=e.speech_mode?"speech":e.custom_mode?"custom":"",w="speech"===j?a:void 0,N="custom"===j?a:void 0;nM("image_feed_video_generation_started",{location:"imagine-post-page",mode:e.mode_name,source:"lightbox"}),null==p||p(),F(null!=(d=l.id)?d:"",m,e.mode_name,"imagine-post-page",w,N,i?null==g?void 0:g.id:f,i?b.current:v,s,k||!!y,k?null!=(u=null!=(c=null==g?void 0:g.id)?c:null==(n=l.originalPost)?void 0:n.id)?u:l.id:y).catch(t=>{let i,s,a,n;s="Unknown",a="Unknown",n="Unknown",t instanceof Error?(i=t.message,s=t.name,a=t.cause?String(t.cause):"",n=t.stack?t.stack:""):i="string"==typeof t?t:String(t),nM("image_feed_video_generation_error",{location:"imagine-post-page",message:i,mode:e.mode_name,error:s,cause:a,stack:n}),(0,h.logError)("imagine-post-page",t)})};if(!(e.is_mature&&(T&&!_||"pass"!==C)))return void n();let r=(t,i)=>{e.is_mature&&"nopass"===t||(n(),q===r&&V(void 0))};V(r),U("redirect"),O(!0)},[l,F,O,V,q,R,C,p,g,f,v,b,y,k,U,T,_,x,S]);return(0,t.jsx)(nO,{isVideoOnlyPost:j,videoProgress:W,lastPrompt:D,runVideoGeneration:function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3?arguments[3]:void 0;e.custom_mode&&(R.current=t,z(t)),K(e,i,s)},isModelGenerated:u,videoExtendMode:d,setVideoExtendMode:c,lastGeneratedVideoDuration:P,videoEditMode:k,setVideoEditMode:N})}function nz(e){let{post:i,videoPlayingRef:s,videoUrl:a,hdVideoUrl:n,modelName:r,mode:o,videoId:l,imageSrc:d}=e,{t:c}=(0,k.useTranslation)("imagine"),{ASSET_SERVER_URL:u}=(0,_.useEnvironment)();return(0,t.jsxs)(R.ButtonWithTooltip,{shape:"circle",size:"sm",variant:"tertiary",tooltipContent:c("download-button.tooltip","Download"),className:"text-primary",onClick:()=>{nM("image_feed_image_saved",{post_id:i.id,video_id:l,model_name:r,mode:o});let e=s.current?n||a:d,t=(0,ej.getCachedAssetUrl)(u,e),c=s.current?"grok-video-".concat(i.id,".mp4"):"grok-image-".concat(i.id,".png"),m=new URL(null!=t?t:"https://grok.com");m.searchParams.set("dl","1");let p=m.toString();(0,nd.downloadImage)(p,c,!1).catch(e=>{(0,h.logError)("imagine-post-page:downloadImage",e)})},children:[(0,t.jsx)(a6.Download,{className:"size-4"}),(0,t.jsx)("span",{className:"sr-only",children:c("image-download-button.label","Download image")})]})}function nB(e){let i,s,{post:a,videoPlayingRef:n,videoId:r,imageId:o,mode:l}=e,{t:d}=(0,k.useTranslation)("imagine"),{route:c}=(0,x.useRouting)(),[u,m]=(0,w.useState)(!1),p=(0,ar.useMediaStore)(e=>e.createShareLink);return(0,t.jsx)(R.ButtonWithTooltip,{shape:"circle",size:"sm",variant:"tertiary",onClick:()=>{m(!0);let e=(async()=>{var e,t;let i=(0,x.getCanonicalUrl)(c,window.location.origin);if(s=n.current&&r?null!=(e=await p(r,"post-page"))?e:"":o?null!=(t=await p(o,"post-page"))?t:"":i,window.location.hostname.includes("localhost")){let e=new URL(s);s="http://localhost:26000"+e.pathname+e.search}return new Blob([s],{type:"text/plain"})})();navigator.clipboard.write([new ClipboardItem({"text/plain":e})]).then(()=>{var e,t;N.toast.success(d("image-share-copy-link-success","Public link copied")),nM("image_feed_media_shared",{type:"copy_link",media:n.current?"video":"image",post_id:null!=(e=null==i?void 0:i.id)?e:a.id,post_link:null!=s?s:"",model_name:null!=(t=a.modelName)?t:"",mode:l})}).catch(e=>{console.error("Failed to copy: ",e)}).finally(()=>{m(!1)})},tooltipContent:d("imagine-share-button.label","Create share link"),className:"px-1.5 text-primary",children:u?(0,t.jsx)(O.Spinner,{size:"xs"}):(0,t.jsx)(nt,{className:"size-4"})})}function nG(e){let{post:i,videoPlayingRef:s,videoId:a,mode:n}=e,{t:r}=(0,k.useTranslation)("imagine"),{route:o}=(0,x.useRouting)(),l=(0,ar.useMediaStore)(e=>e.resolveMediaPostForMaybeGenerated),d=(0,ar.useMediaStore)(e=>e.createShareLink),c="parentXPostId"in o?o.parentXPostId:void 0,u=(0,w.useCallback)(async e=>{try{var t,r;let o=await l(i),c=s.current&&a?a:null!=(t=null==o?void 0:o.id)?t:i.id,u=await d(c,"post-page");if(!u)return void(0,h.logError)("imagine-post-page:handleShareToX","No share link returned");nM("image_feed_media_shared",{type:e?"share_to_x_reply":"share_to_x_compose",media:s.current?"video":"image",post_id:c,video_id:null!=a?a:"",model_name:null!=(r=i.modelName)?r:"",mode:n,...e?{parent_x_post_id:e}:{}});let m=window.location.hostname.includes("localhost"),p="".concat(m?"https://localhost.x.com:3443":"https://x.com","/compose/post?").concat(e?"in_reply_to=".concat(e,"&"):"","externalMedia=").concat(encodeURIComponent(u));window.open(p,"_blank")}catch(e){(0,h.logError)("imagine-post-page:handleShareToX",e)}},[l,i,s,a,d,n]);return c?(0,t.jsxs)(eR.DropdownMenu,{children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(R.Button,{shape:"circle",size:"sm",variant:"tertiary",className:"px-1.5 text-primary focus-visible:ring-0","aria-label":r("imagine-share-to-x-button.label","Share to X"),children:(0,t.jsx)(nn.XLogoIcon,{className:"size-4"})})}),(0,t.jsxs)(eR.DropdownMenuContent,{align:"end",side:"right",children:[(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>{u(c).catch(e=>{(0,h.logError)("imagine-post-page:handleShareToX",e)})},children:r("imagine-share-to-x.reply-to-post","Reply to Post")}),(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>{u().catch(e=>{(0,h.logError)("imagine-post-page:handleShareToX",e)})},children:r("imagine-share-to-x.compose-post","Compose Post")})]})]}):(0,t.jsx)(R.ButtonWithTooltip,{shape:"circle",size:"sm",variant:"tertiary",className:"px-1.5 text-primary",tooltipContent:r("imagine-share-to-x.compose-post","Compose Post"),onClick:()=>{u().catch(e=>{(0,h.logError)("imagine-post-page:handleShareToX",e)})},children:(0,t.jsx)(nn.XLogoIcon,{className:"size-4"})})}function nF(e){let i,{post:s,videoPlayingRef:a,videoId:n,imageId:r,mode:o}=e,{t:l}=(0,k.useTranslation)("imagine"),{route:d}=(0,x.useRouting)(),[c,u]=(0,w.useState)(!1),m=(0,ar.useMediaStore)(e=>e.createShareLink);return(0,t.jsx)(R.ButtonWithTooltip,{shape:"circle",size:"md",variant:"secondary",onClick:()=>{u(!0);let e=(async()=>{var e,t;let s=(0,x.getCanonicalUrl)(d,window.location.origin);if(i=a.current&&n?null!=(e=await m(n,"post-page"))?e:"":r?null!=(t=await m(r,"post-page"))?t:"":s,window.location.hostname.includes("localhost")){let e=new URL(i);i="http://localhost:26000"+e.pathname+e.search}return new Blob([i],{type:"text/plain"})})();navigator.clipboard.write([new ClipboardItem({"text/plain":e})]).then(()=>{var e;N.toast.success(l("image-share-copy-link-success","Public link copied")),nM("image_feed_media_shared",{type:"copy_link",media:a.current?"video":"image",post_id:s.id,post_link:null!=i?i:"",model_name:null!=(e=s.modelName)?e:"",mode:o})}).catch(e=>{console.error("Failed to copy: ",e)}).finally(()=>{u(!1)})},tooltipContent:l("imagine-share-button.label","Create share link"),children:c?(0,t.jsx)(O.Spinner,{size:"xs"}):(0,t.jsx)(nt,{className:"size-4"})})}function nO(e){let{videoProgress:i,lastPrompt:s,runVideoGeneration:a,isModelGenerated:n,videoExtendMode:r,setVideoExtendMode:o,isVideoOnlyPost:l,lastGeneratedVideoDuration:d,videoEditMode:c,setVideoEditMode:u}=e,[m,p]=(0,w.useState)(!1),h=(0,w.useRef)(null),g=h.current,x=(0,w.useCallback)(()=>{if(g){let e=g.getBoundingClientRect();e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)||setTimeout(()=>{g.scrollIntoView({behavior:"instant",block:"end"})},50)}},[g]);return(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsx)("div",{className:(0,f.cn)("flex w-full h-full border border-border-l2 rounded-full overflow-hidden items-center bg-surface-l1",m&&"rounded-3xl"),children:(0,t.jsx)(nV,{scrollTextareaIntoView:x,lastPrompt:s,videoProgress:i,isMultiline:m,setIsMultiline:p,runVideoGeneration:a,isModelGenerated:n,videoExtendMode:r,setVideoExtendMode:o,isVideoOnlyPost:l,lastGeneratedVideoDuration:d,videoEditMode:c,setVideoEditMode:u})}),(0,t.jsx)("div",{ref:h,className:"absolute left-0 -bottom-24 bg-red-500 w-10 h-10 z-10 invisible"})]})}function nV(e){let{lastPrompt:i,videoProgress:s,isMultiline:a,setIsMultiline:n,runVideoGeneration:r,scrollTextareaIntoView:o,isModelGenerated:l,videoExtendMode:d,setVideoExtendMode:c,isVideoOnlyPost:m,lastGeneratedVideoDuration:p,videoEditMode:h,setVideoEditMode:g}=e,{t:x}=(0,k.useTranslation)("imagine"),v=(0,u.useFeatureFlags)(),y=v.ENABLE_IMAGINE_VIDEO_LENGTH,b=v.ENABLE_IMAGINE_ASPECT_RATIO&&m,N=(0,ar.useImagineModeStore)(e=>e.videoDurationOptions),S=(0,ar.useImagineModeStore)(e=>e.setVideoLength),I=(0,ar.useImagineModeStore)(e=>e.videoLength),C=(0,ar.useImagineModeStore)(e=>e.aspectRatio),E=(0,ar.useImagineModeStore)(e=>e.setAspectRatio),[M,T]=(0,w.useState)(!1),_=(0,ae.useSettingsDialogStore)(j.prop("open")),[P,A]=(0,w.useState)(I);(0,w.useEffect)(()=>{p&&A(p)},[p,A]);let D=nl({isModelGenerated:l}).filter(e=>"custom"!==e.mode_name),z=(0,w.useCallback)(e=>{r(e,""),G(null),Q("")},[r]),[B,G]=(0,w.useState)(i),F=(0,w.useRef)(null),O=F.current,V=x("video-prompt.placeholder-extend","Type to extend video..."),U=x("video-prompt.placeholder-extend-small-mobile","Extend video..."),q=d?V:x("imagine-video-prompt.placeholder","Type to customize video..."),H=d?U:x("video-prompt.placeholder-small-mobile","Customize video..."),[W,K]=(0,w.useState)(0),[Y,Q]=(0,w.useState)(i);(0,w.useEffect)(()=>{Q(i),G(i)},[i]),(0,w.useEffect)(()=>{h?Q(""):Q(i)},[h]);let[X,J]=(0,w.useState)(!1),[Z,$]=(0,w.useState)(!1),ee=!!Y,et=B&&B.trim()==Y.trim(),ei=s<100,es=et&&ei,ea=(es||!Y.trim())&&ei;(0,w.useEffect)(()=>{ee||K(e=>e+1)},[ee,K]);let en=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Y.trim();t?(r({mode_name:"custom",display_name:"Custom",custom_mode:!0},t,e,P),G(t)):(r({mode_name:"normal",display_name:"Normal"},"",e,P),G(null))},[er,eo]=(0,w.useState)(!1),el=(0,w.useCallback)((e,t)=>{let i=Math.floor((e-15)/t.rowHeight),s=i>=4;s!==er&&eo(s),n(i>1),i>1&&X&&o()},[er,eo,4,n,o,X]);(0,w.useEffect)(()=>{Z&&($(!1),en(d))},[Z,d]),(0,w.useEffect)(()=>{F.current&&(F.current.style.setProperty("border-bottom",er?"5px solid transparent":"0px solid transparent"),F.current.style.setProperty("border-top",er?"1px solid transparent":"0px solid transparent"))},[er,F]),(0,w.useEffect)(()=>{X&&setTimeout(()=>{var e;null==(e=F.current)||e.focus()},10)},[X,F,W]),(0,w.useEffect)(()=>{if(d){var e;null==(e=F.current)||e.focus()}},[d]),(0,w.useEffect)(()=>{if(!X||_)return;let e=e=>{if("Escape"===e.key){e.stopPropagation(),e.preventDefault();return}"Enter"!==e.key||e.shiftKey||(e.preventDefault(),e.stopPropagation(),$(!0))};return O&&O.addEventListener("keydown",e),()=>{O&&O.removeEventListener("keydown",e)}},[X,O,$,_]);let ed=(0,L.useMobileSize)(640),ec=et&&!es&&!X,eu=ec||Y.trim().length<17&&!ed;return(0,t.jsxs)("div",{className:(0,f.cn)("relative flex flex-row px-1 w-full items-center bg-surface-l1",a&&"items-end"),children:[d?(0,t.jsxs)(R.Button,{"aria-label":x("image-exit-extend-mode-button.label","Exit extend mode"),variant:"secondary",shape:"pill",size:"sm",className:(0,f.cn)("h-[34px] ps-2 pe-3 bg-surface-l2  border-surface-l3 text-secondary",a&&"mb-1 mt-1 ms-0.5"),onClick:()=>c(!1),children:[(0,t.jsx)(ic.X,{size:16}),(0,t.jsx)("span",{className:"font-semibold text-nowrap",children:x("image-extend-button.label","Extend")})]}):null,h?(0,t.jsxs)(R.Button,{"aria-label":x("edit-button.label","Edit"),variant:"secondary",shape:"pill",size:"sm",disabled:void 0===g,onClick:()=>null==g?void 0:g(!1),children:[void 0!==g?(0,t.jsx)(ic.X,{size:16}):null,(0,t.jsx)(ne.Paintbrush,{size:16}),(0,t.jsx)("span",{className:"font-semibold text-nowrap",children:x("edit-button.label","Video")})]}):null,(0,t.jsx)(aV.default,{style:{resize:"none"},onFocus:()=>J(!0),onBlur:()=>J(!1),value:Y,onChange:e=>Q(e.target.value),ref:F,rows:1,maxRows:4,"aria-required":"true","aria-label":x("video-prompt.placeholder","Make a video"),placeholder:ed?H:q,onHeightChange:el,className:(0,f.cn)("w-full px-3 pe-16 bg-transparent py-2 text-md font-medium placeholder:text-muted-foreground focus-visible:outline-none",es&&"animate-pulse-lg")},"textarea-editor-".concat(W)),(0,t.jsxs)("div",{className:(0,f.cn)("flex flex-row  items-center absolute right-0 px-1  justify-end h-7",a&&"mb-2"),children:[(0,t.jsxs)(eR.DropdownMenu,{open:M,onOpenChange:T,children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(R.ButtonWithTooltip,{shape:"pill",size:"sm",variant:s<100?"primary":"tertiary",className:(0,f.cn)("transition-all duration-400 h-8 group ps-1.5 pe-1 gap-0 text-secondary ms-1 rounded-e-none -me-4",a&&"rounded-l-3xl",s<100&&"text-fg-invert",s>=100&&"bg-surface-l2/95 hover:bg-surface-l2",!1),tooltipContent:x("make-video-options.label","Video Options"),children:[s<100?(0,t.jsxs)("div",{className:"text-xs font-semibold w-[4ch] mb-[1px] tabular-nums",children:[s,"%"]}):(0,t.jsx)(a7.Film,{className:"size-4"}),(0,t.jsx)(il.ChevronDown,{className:"size-4 group-data-[state=open]:rotate-180 transition-rotate duration-200"}),(0,t.jsx)("div",{className:"w-4"})]})}),(0,t.jsxs)(eR.DropdownMenuContent,{align:"start",side:"top",children:[y&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-2 ",role:"menuitem",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-primary",children:x("mode-select.video-duration.heading","Video Duration")}),(0,t.jsx)("div",{className:"flex flex-row gap-0",children:N.map(e=>(0,t.jsx)(nh.VideoLengthIcon,{videoLength:e,selected:P.toString()===e.toString(),onSelect:()=>{S(e),A(e),setTimeout(()=>{ea&&en(d),T(!1)},100)}},e.toString()))})]}),(0,t.jsx)(eR.DropdownMenuSeparator,{})]}),b&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-2 ",role:"menuitem",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-primary",children:x("mode-select.aspect-ratio.heading","Aspect Ratio")}),(0,t.jsx)("div",{className:"flex flex-row gap-0",children:ar.ASPECT_RATIOS.map(e=>(0,t.jsx)(nh.AspectRatioIcon,{aspectRatio:e,selected:C.toString()===e.toString(),onSelect:()=>{E(e),setTimeout(()=>{T(!1)},100)}},e.toString()))})]}),(0,t.jsx)(eR.DropdownMenuSeparator,{})]}),(0,t.jsx)("div",{className:"flex flex-col gap-1 p-2 ",role:"menuitem",children:(0,t.jsx)("p",{className:"text-sm font-semibold text-primary",children:x("make-video-presets.label","Video Presets")})}),D.map(e=>(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>z(e),children:e.display_name},e.mode_name))]})]}),(0,t.jsxs)(R.Button,{"aria-label":x("image-make-video-button.label","Make video"),shape:eu?"pill":"circle",size:"sm",variant:"primary",onClick:()=>en(d),className:(0,f.cn)("h-8  z-20 items-center",a&&" me-0.5",eu&&"pe-2 ps-3",!eu&&"w-8"),children:[eu&&(0,t.jsx)("span",{className:"font-semibold text-xs",children:ec?x("video-redo-button.label","Redo"):h?x("edit-button.label","Edit"):x("image-make-video-button.label","Make video")}),(0,t.jsx)("span",{children:(0,t.jsx)(aU.ArrowUpIcon,{size:18,fill:"currentColor",strokeWidth:0})})]})]})]})}function nU(e){let{runImageEditPrompt:i,setImageEditPromptMode:s,lastGeneratedImageWithOriginalPost:a}=e,n=(0,L.useMobileSize)(640),r=(0,w.useRef)(null),o=r.current,l=(0,ae.useSettingsDialogStore)(j.prop("open")),d=(0,w.useRef)(""),c=(0,w.useCallback)(()=>{if(o){let e=o.getBoundingClientRect();e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)||setTimeout(()=>{o.scrollIntoView({behavior:"instant",block:"end"})},50)}},[o]),{t:u}=(0,k.useTranslation)("imagine"),[m,p]=(0,w.useState)(!1),[h,g]=(0,w.useState)(!1),[x,v]=(0,w.useState)(""),y=(0,w.useRef)(null),[b,N]=(0,w.useState)(!1),S=x.trim().length<17&&!n,[I,C]=(0,w.useState)(!1),E=(0,w.useCallback)(()=>{i(x.trim()),v("")},[i,x]);(0,w.useEffect)(()=>{I&&(E(),C(!1))},[I]),(0,w.useEffect)(()=>{if(a){var e;let t=(null!=(e=a.originalPrompt)?e:"").replace(/^\[Image ID:\s*\d+\]\s*/i,"");v(e=>e&&e!==d.current?e:t),t&&(d.current=t)}},[a,v]);let M=(0,w.useCallback)((e,t)=>{let i=Math.floor((e-15)/t.rowHeight),s=i>=4;s!==b&&N(s),p(i>1),i>1&&c()},[b,N,4,p,c]);return(0,w.useEffect)(()=>{if(!h||l)return;let e=y.current,t=e=>{if("Escape"===e.key){e.stopPropagation(),e.preventDefault();return}"Enter"!==e.key||e.shiftKey||(e.preventDefault(),e.stopPropagation(),C(!0))};return e&&e.addEventListener("keydown",t),()=>{e&&e.removeEventListener("keydown",t)}},[h,y,C,l]),(0,w.useEffect)(()=>{setTimeout(()=>{y.current&&(y.current.focus(),y.current.select())},300)},[y]),(0,t.jsxs)("div",{className:"relative w-full",children:[(0,t.jsx)("div",{className:(0,f.cn)("flex w-full h-full border border-border-l2 rounded-full overflow-hidden items-center bg-surface-l1",m&&"rounded-3xl"),children:(0,t.jsxs)("div",{className:(0,f.cn)("relative flex flex-row px-1 w-full items-center bg-surface-l1",m&&"items-end"),children:[(0,t.jsxs)(R.Button,{"aria-label":u("image-exit-extend-mode-button.label","Exit extend mode"),variant:"secondary",shape:"pill",size:"sm",className:(0,f.cn)("h-[34px] ps-2 pe-3 bg-surface-l2  border-surface-l3 text-secondary",m&&"mb-1 mt-1 ms-0.5"),onClick:()=>s(!1),children:[(0,t.jsx)(ic.X,{size:16}),(0,t.jsx)(aq.Brush,{className:"inline-block size-4 ms-2"}),(0,t.jsx)("span",{className:"font-semibold text-nowrap",children:u("image-edit-prompt-button.label","Image")})]}),(0,t.jsx)(aV.default,{style:{resize:"none"},onFocus:()=>g(!0),onBlur:()=>g(!1),value:x,onChange:e=>v(e.target.value),ref:y,rows:1,maxRows:4,"aria-required":"true","aria-label":u("image-edit-prompt.placeholder","Type to edit image..."),placeholder:u("image-edit-prompt.placeholder","Type to edit image..."),onHeightChange:M,className:(0,f.cn)("w-full px-3 pe-16 bg-transparent py-2 text-md font-medium placeholder:text-muted-foreground focus-visible:outline-none")},"textarea-editor"),(0,t.jsx)("div",{className:(0,f.cn)("flex flex-row  items-center absolute right-0 px-1  justify-end h-7",m&&"mb-2"),children:(0,t.jsxs)(R.Button,{"aria-label":u("image-make-video-button.label","Make video"),shape:S?"pill":"circle",size:"sm",variant:"primary",onClick:E,className:(0,f.cn)("h-8  z-20 items-center",m&&" me-0.5",S&&"pe-2 ps-3",!S&&"w-8"),children:[S&&(0,t.jsx)("span",{className:"font-semibold text-xs",children:u("image-edit-submit-button.label","Edit")}),(0,t.jsx)("span",{children:(0,t.jsx)(aU.ArrowUpIcon,{size:18,fill:"currentColor",strokeWidth:0})})]})})]})}),(0,t.jsx)("div",{ref:r,className:"absolute left-0 -bottom-24 bg-red-500 w-10 h-10 z-10 invisible"})]})}function nq(e){var i,s;let{post:a,imageUrl:n,videoUrl:r,hdVideoUrl:o,videoPlayingRef:l,lastGeneratedVideo:d,lastGeneratedImage:c,onExtendVideo:m,videoTab:p,handleHistoryBack:g,setPastVideoOffset:x,setImageEditPromptMode:v,setVideoEditMode:y,videoModerated:b,imageModerated:S}=e,I=(0,u.useFeatureFlags)(),[C,E]=(0,w.useState)(!1),M=(0,ae.useSettingsDialogStore)(j.prop("open")),T=I.ENABLE_IMAGINE_DELETE_BUTTON,_=I.ENABLE_IMAGINE_EXTEND_VIDEO_MODE,P=I.IMAGINE_CONFIGS,A=P.get("post_dashboard_url"),L=P.get("video_dashboard_url"),D=P.get("enable_moderation_reporting",!1),z=l.current?r:n,B=(0,ar.useMediaStore)(e=>e.dislikedIds[z]),G=(0,ar.useMediaStore)(e=>e.likedIds[z]),F=(0,ar.useMediaStore)(e=>e.upscaleVideo),O=(0,ar.useMediaStore)(e=>e.setDisliked),V=(0,ar.useMediaStore)(e=>e.setLiked),U=(0,ar.useMediaStore)(e=>e.createShareLink),q=(null!=(s=null==d?void 0:d.videoDuration)?s:6)<=ar.VIDEO_EDIT_MAX_DURATION,H=(0,ar.useMediaStore)(e=>{var t,i;return e.preferredSideBySideVideoIds[null!=(i=null!=(t=null==d?void 0:d.videoId)?t:null==d?void 0:d.id)?i:""]}),W=(0,ar.useMediaStore)(e=>e.like),K=(0,ar.useMediaStore)(e=>e.unlike),Y=(null==(i=a.userInteractionStatus)?void 0:i.likeStatus)===!0,Q=(0,ar.useMediaStore)(e=>e.deletePost),X=async()=>{Y?nM("image_feed_image_unliked",{type:l.current?"video":"image"}):nM("image_feed_image_liked",{type:l.current?"video":"image"}),Y?await K(a.id):await W(a.id)},J=p?!!(null==d?void 0:d.itemId)||!!(null==d?void 0:d.id):!!(null==c?void 0:c.id),Z=I.IMAGINE_CONFIGS.get("enable_edits")&&y&&q,$=I.ENABLE_IMAGINE_IMAGE_EDIT;(0,w.useEffect)(()=>{if(!C||M)return;let e=e=>{e.preventDefault(),e.stopPropagation(),"Escape"===e.key&&E(!1)};return window.addEventListener("keydown",e,{capture:!0}),()=>{window.removeEventListener("keydown",e,{capture:!0})}},[C,E,M]);let ee=(null==d?void 0:d.id)===a.id,{t:et}=(0,k.useTranslation)("imagine"),ei=et("image-make-video-three-dot-button.label","More options");return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ab.Dialog,{open:C,onOpenChange:()=>{},children:(0,t.jsxs)(iv.DialogContent,{className:"w-full max-w-[350px] p-4 rounded-2xl border border-border-l1 flex flex-col gap-6",children:[(0,t.jsx)(iv.DialogHeader,{children:(0,t.jsx)(ab.DialogTitle,{children:(0,t.jsx)("h3",{className:"font-semibold text-sm",children:et("are you sure","Are you sure you want to delete?")})})}),(0,t.jsx)("p",{className:"text-sm text-fg-secondary",children:et("archive-description-no-access","This cannot be undone.")}),(0,t.jsxs)("div",{className:"flex flex-row w-full items-end justify-end gap-2",children:[(0,t.jsx)(R.Button,{variant:"danger",size:"md",shape:"pill",onClick:()=>{E(!1),Q(null==d?void 0:d.id,a.id),setTimeout(()=>{x(0),ee&&g()},1)},children:ee?et("imagine-delete-post-confirm.label","Delete post"):et("imagine-delete-video-confirm.label","Delete video")}),(0,t.jsx)(R.Button,{variant:"secondary",size:"md",shape:"pill",onClick:()=>{E(!1)},children:et("archive-cancel","Cancel")})]})]})}),(0,t.jsxs)(eR.DropdownMenu,{children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(R.Button,{shape:"circle",size:"md",variant:"tertiary","aria-label":ei,className:nN,children:(0,t.jsx)(a8.Ellipsis,{className:"size-4"})})}),(0,t.jsxs)(eR.DropdownMenuContent,{align:"end",side:"bottom",children:[A&&J&&(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>{let e=p?d:c,t=(null==e?void 0:e.itemId)||(null==e?void 0:e.id),i=p?L:A;if(!t)return void(0,h.logError)("imagine-post-page-handleDashboard",Error("No item ID found"));let s="".concat(i).concat(t);U(t,"dashboard").then(e=>{window.open(s,"_blank")}).catch(e=>{window.open(s,"_blank"),(0,h.logError)("imagine-post-page-handleDashboard",e)})},children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(aj.Triangle,{className:"size-4"}),et("image-dashboard-button.label","Dashboard")]})}),(0,t.jsx)(eR.DropdownMenuItem,{onSelect:X,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ac.HeartIcon,{className:(0,f.cn)("size-4",Y&&"text-red-400 dark:text-red-500"),fill:Y?"currentColor":"none",stroke:Y?"none":"currentColor"}),(0,t.jsx)("span",{children:Y?et("image-unlike-button.label","Unsave"):et("image-like-button2.label","Save")})]})}),T&&d&&p?(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>{E(!0)},children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(na.Trash,{className:"size-4"}),(0,t.jsx)("span",{children:ee?et("imagine-delete-post-confirm.label","Delete post"):et("imagine-delete-video-confirm.label","Delete video")})]})}):null,(0,t.jsx)(eR.DropdownMenuItem,{disabled:G,onSelect:()=>{var e;V(z),O(z,!1),nM("image_feed_like",{type:l.current?"video":"image",url:z,post_id:null!=(e=a.itemId)?e:a.id,model_name:l.current?null==d?void 0:d.modelName:null==c?void 0:c.modelName})},children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ns.ThumbsUp,{className:"size-4",fill:G?"currentColor":"none"}),et("image-thumbs-up-button.label","Thumbs up")]})}),(0,t.jsx)(eR.DropdownMenuItem,{disabled:B,onSelect:()=>{var e;O(z),V(z,!1),nM("image_feed_dislike",{type:l.current?"video":"image",url:z,post_id:null!=(e=a.itemId)?e:a.id,model_name:l.current?null==d?void 0:d.modelName:null==c?void 0:c.modelName})},children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ni.ThumbsDown,{className:"size-4",fill:B?"currentColor":"none"}),et("image-thumbs-down-button.label","Thumbs down")]})}),I.ENABLE_UPSCALE_VIDEO&&(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>{if(!(null==d?void 0:d.id))return void(0,h.logError)("imagine-post-page",Error("No video ID found"));F(a.id,null==d?void 0:d.id).catch(e=>{(0,h.logError)("imagine-post-page",e)})},disabled:!!o||!r,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(a9,{className:"size-4"}),et("image-upscale-video-button.label","Upscale video")]})}),_&&(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>{m(),v(!1)},children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(e5.Plus,{className:"size-4"}),et("image-extend-video-button.label","Extend video")]})}),$&&n&&!I.ENABLE_IMAGINE_QUERY_BAR_V2&&(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>{v(!0),m(!1)},children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(aq.Brush,{className:"size-4"}),et("image-edit-button.label","Edit image")]})}),Z&&r&&!I.ENABLE_IMAGINE_QUERY_BAR_V2&&(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>{v(!1),null==y||y(!0),m(!1)},children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ne.Paintbrush,{className:"size-4"}),et("edit-button.label","Edit")]})}),D&&(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>{let e=l.current;nM("imagine_incorrect_moderation",{type:e?"video":"image",id:e?null==d?void 0:d.id:null==c?void 0:c.id,moderated:e?b.toString():S.toString()}),N.toast.success("Thank you for reporting.")},children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(am,{className:"size-4"}),"Report Incorrect Moderation"]})}),H&&(0,t.jsx)(eR.DropdownMenuItem,{disabled:!0,children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(ns.ThumbsUp,{className:"size-4"}),et("side-by-side-video-was-preferred.label","Preferred")]})})]})]})]})}let nH=(0,w.memo)(function(e){let{item:i,index:s,isSelected:a,height:n,videoTab:r,onItemClick:o,assetServerUrl:l,postId:d}=e,c="number"==typeof i.progress&&i.progress<100&&!i.moderated,u=Math.round((0,ar.useMediaStore)(e=>{var t,s,a;return null!=(a=null!=(s=e.smoothedVideoProgress[null!=(t=i.id)?t:""])?s:e.smoothedVideoProgress[d])?a:0})),m=i.thumbnailImageUrl||("blobSrc"in i?i.blobSrc:void 0)||("mediaUrl"in i?i.mediaUrl:void 0)||("videoUrl"in i?i.videoUrl:void 0);return(null==m?void 0:m.endsWith(".mp4"))&&(m=i.thumbnailImageUrl||void 0),m&&!m.startsWith("data:")&&(m=(0,ej.getCachedAssetUrl)(l,m)),(0,t.jsxs)("button",{onClick:e=>{e.stopPropagation(),o(s)},className:(0,f.cn)("relative flex-shrink-0 rounded-lg overflow-hidden drop-shadow-md","hover:ring-2 hover:ring-fg-primary/60",a&&"ring-2 ring-fg-primary",!a&&"opacity-75 hover:opacity-100",i.moderated&&"ring-red-500 hover:ring-red-500 ring-2"),style:{width:n,height:n},children:[m?(0,t.jsx)("img",{src:m,alt:"Thumbnail ".concat(s+1),className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:"w-full h-full bg-gray-700 flex items-center justify-center",children:r?(0,t.jsx)(a7.Film,{className:"size-4 text-gray-400"}):(0,t.jsx)("div",{className:"size-4 bg-gray-500 rounded"})}),c&&u&&(0,t.jsx)("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-white text-xs tabular-nums font-semibold",children:[u,"%"]})}),c&&!u&&(0,t.jsx)("div",{className:"absolute inset-0 bg-black/60 flex items-center justify-center",children:(0,t.jsx)(O.Spinner,{size:"sm",className:"text-white"})}),r&&!c&&(0,t.jsx)("div",{className:"absolute bottom-1 right-1",children:(0,t.jsx)(a7.Film,{className:"size-3 text-white drop-shadow-md"})})]},i.id)});function nW(e){let{postId:i,videoTab:s,pastVideoOffset:a,setPastVideoOffset:n,pastImageOffset:r,setPastImageOffset:o,height:l=64,vertical:d=!1}=e,{ASSET_SERVER_URL:c}=(0,_.useEnvironment)(),u=(0,w.useRef)(null),m=(0,ar.useMediaStore)(e=>{var t;return null!=(t=e.videoByMediaId[i])?t:[]}),p=(0,ar.useMediaStore)(e=>{var t;return null!=(t=e.imageByMediaId[i])?t:[]}),h=s?m.slice():p.slice(),g=s?a:r,x=h.length-1-g,v=s?n:o,y=(0,w.useCallback)(e=>{v(h.length-1-e)},[h.length,v]);(0,w.useEffect)(()=>{let e=u.current;e&&setTimeout(()=>{d?e.scrollTop=e.scrollHeight:e.scrollLeft=e.scrollWidth},1)},[h.length,d,s]);let b=(0,as.useScrollGradient)({ref:u,size:.15,midpoint:.7,direction:d?"vertical":"horizontal"}),[j,k]=(0,w.useState)(!1);(0,w.useEffect)(()=>{let e=u.current;if(!e)return;let t=()=>{d?k(e.scrollHeight>e.clientHeight):k(e.scrollWidth>e.clientWidth)};t();let i=new ResizeObserver(t);return i.observe(e),()=>i.disconnect()},[d,h.length]);let N=h.length>1,S=N?l+5:0;return(0,t.jsx)("div",{ref:u,className:(0,f.cn)("relative flex gap-2 scrollbar-hide items-center",d?"h-full flex-col overflow-y-auto":"w-full overflow-x-auto",!j&&"justify-center"),style:d?{width:S,...b}:{height:S,...b},children:N&&h.map((e,a)=>(0,t.jsx)(nH,{item:e,index:a,isSelected:a===x,height:l,videoTab:s,onItemClick:y,assetServerUrl:c,postId:i},e.id))})}var nK=e.i(990629);e.i(254854);var nY=e.i(310366),nQ=e.i(114007),nX=e.i(185879);let nJ=()=>{let{t:e}=(0,k.useTranslation)("base"),i=(0,nY.useTransport)(),{data:s=[]}=(0,ev.useQuery)({...(0,nK.listUserInvitationsOptions)({transport:i}),select:e=>e.invitations}),{assignLicenseAndAccept:a,declineInvitation:n,isPending:r}=(0,nX.useTeamInvitations)();return 0===s.length?null:(0,t.jsx)(nQ.Card,{className:"max-w-md w-full divide-y",children:s.map(i=>{let{teamId:s,teamName:o,productIdToActivate:l}=i;return l?(0,t.jsxs)("div",{className:"flex gap-4 items-center p-4 text-start",onClick:e=>e.preventDefault(),children:[(0,t.jsxs)("div",{className:"flex-1 w-64",children:[(0,t.jsx)("p",{className:"font-semibold",children:(0,t.jsx)(tZ.Trans,{ns:"base",i18nKey:"invites.item.title",defaults:"Join {{teamName}}",values:{teamName:o}})}),(0,t.jsx)("p",{className:"text-xs text-secondary",children:(0,t.jsx)(tZ.Trans,{ns:"base",i18nKey:"invites.item.description",defaults:"You were invited to collaborate with the  <strong>{{teamName}}</strong> team.",values:{teamName:o}})})]}),(0,t.jsxs)("div",{className:"space-x-2",children:[(0,t.jsx)(R.Button,{variant:"secondary",size:"xs",shape:"pill",disabled:r,onClick:()=>n({teamId:s}),children:e("invites.decline","Decline")}),(0,t.jsx)(R.Button,{variant:"primary",size:"xs",shape:"pill",disabled:r,onClick:()=>a(s,l),children:e("invites.accept","Accept")})]})]},s):null})})};function nZ(){let{t:e}=(0,k.useTranslation)("base");return(0,t.jsx)("div",{className:"w-full min-h-dvh flex flex-col items-center justify-center pt-4 [&>div]:first:h-fit",children:(0,t.jsx)(i6.ErrorCard,{title:e("pages.no-license.title","Missing License"),description:e("pages.no-license.description","You are a member of an organization that does not allow personal workspaces, but you have not been assigned a Grok Business license. Please reach out to your administrator to be assigned a license."),cta:(0,t.jsx)(nJ,{})})})}var n$=e.i(19862),n0=e.i(799477),n1=e.i(486647),n2=e.i(548535);let n5=e=>{let{isCreatingTemplate:i,onUsePreset:s}=e,{t:a}=(0,k.useTranslation)("base"),{library:n}=tj(),r=(0,w.useCallback)(e=>{i||s(e)},[i,s]);return(0,t.jsx)("div",{className:"w-full h-full flex justify-center items-center @container/templates-empty-state",children:(0,t.jsxs)("div",{className:"w-full max-w-3xl h-full mt-16 space-y-6",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold px-4",children:a("templates.try-preset-templates","Try these templates")}),(0,t.jsxs)(iq.Tabs,{defaultValue:"all",className:"space-y-6",children:[(0,t.jsxs)(iq.TabsList,{className:"flex items-center justify-start gap-2 flex-wrap border-0 py-0 px-2",children:[(0,t.jsx)(iq.TabsTrigger,{"aria-controls":void 0,value:"all",variant:"default",asChild:!0,children:(0,t.jsx)(R.Button,{variant:"secondary",shape:"pill",size:"sm",className:"rounded-full",children:a("templates.library.all","All")})}),Object.entries(n).map(e=>{let[i,s]=e;return(0,t.jsx)(iq.TabsTrigger,{"aria-controls":void 0,value:i,variant:"default",asChild:!0,children:(0,t.jsx)(R.Button,{variant:"secondary",shape:"pill",size:"sm",className:"rounded-full",children:s.label})},i)})]}),(0,t.jsx)(iq.TabsContent,{value:"all",children:(0,t.jsx)(n4,{category:"all",onUsePreset:r})}),Object.entries(n).map(e=>{let[i]=e;return(0,t.jsx)(iq.TabsContent,{value:i,children:(0,t.jsx)(n4,{category:i,onUsePreset:r})},i)})]})]})})},n4=e=>{let{category:i,onUsePreset:s}=e,{library:a}=tj(),n=(0,w.useMemo)(()=>"all"===i?Object.values(a).flatMap(e=>e.templates.map(t=>({name:t.name,categoryLabel:e.label,icon:t.icon}))):a[i].templates.map(e=>({name:e.name,categoryLabel:a[i].label,icon:e.icon})),[i,a]),r=(0,w.useCallback)(e=>{let t=Object.values(a).flatMap(e=>e.templates).find(t=>t.name===e);t&&s({templateName:t.name,templateDescription:t.description,systemPrompt:t.systemPrompt,inputGuidance:t.inputGuidance})},[a,s]);return(0,t.jsx)("div",{className:"grid grid-cols-1 gap-x-8 gap-y-2 @md/templates-empty-state:grid-cols-2",children:n.map(e=>(0,t.jsx)("div",{onClick:()=>r(e.name),className:"flex items-center gap-4 p-3 rounded-2xl hover:bg-card-hover cursor-pointer",children:(0,t.jsxs)("div",{className:"flex flex-grow items-center gap-3",children:[(0,t.jsx)("div",{className:"size-10 flex items-center justify-center rounded-xl bg-surface-l1 border border-border-l1 flex-shrink-0",children:(0,t.jsx)(e.icon,{className:"w-4 h-4 text-fg-secondary"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-sm",children:e.name}),(0,t.jsx)("div",{className:"text-sm text-fg-tertiary",children:e.categoryLabel})]})]})},e.name))})};var n3=e.i(572806),n6=e.i(680491),n8=e.i(597733),n9=e.i(246639),n7=e.i(949033);let re=e=>{let{template:i,isSelected:s,onClick:a,onDuplicate:n,onDelete:o}=e,{t:l}=(0,k.useTranslation)("base"),{user:d}=(0,r.useSession)(),[c,u]=(0,w.useState)(!1),m=(0,w.useMemo)(()=>i.userId===(null==d?void 0:d.userId),[i.userId,null==d?void 0:d.userId]);return(0,t.jsxs)("div",{onClick:()=>{c||null==a||a()},className:(0,f.cn)("p-3 flex items-center justify-between gap-1 cursor-pointer hover:bg-card-hover rounded-xl duration-100 group/template-card",{"bg-card-focus hover:bg-card-focus":s,"bg-card-hover":c}),children:[(0,t.jsxs)("div",{className:"flex flex-col flex-grow min-w-0 gap-1",children:[(0,t.jsx)("span",{className:"truncate font-semibold h-6",children:i.templateName||l("templates.values.name.placeholder","New Template")}),(0,t.jsx)("span",{className:"truncate font-medium text-sm text-fg-secondary h-[21px]",children:i.templateDescription||l("templates.values.description.placeholder","Description")})]}),(0,t.jsxs)(eR.DropdownMenu,{open:c,onOpenChange:u,children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(R.Button,{variant:"tertiary",size:"sm",shape:"square",className:(0,f.cn)("hidden group-hover/template-card:flex aria-expanded:bg-button-ghost-hover rounded-lg flex-shrink-0",c&&"flex"),children:(0,t.jsx)(n9.EllipsisVertical,{size:14})})}),(0,t.jsxs)(eR.DropdownMenuContent,{hideWhenDetached:!0,side:"right",align:"start",sideOffset:6,alignOffset:-8,className:"min-w-36 space-y-0.5",children:[n&&(0,t.jsxs)(eR.DropdownMenuItem,{onSelect:n,className:"flex items-center gap-2",children:[(0,t.jsx)(n7.Files,{size:18,className:"-ml-1"}),(0,t.jsx)("span",{children:l("templates.duplicate","Duplicate")})]}),o&&m&&(0,t.jsxs)(eR.DropdownMenuItem,{onSelect:o,className:"flex items-center gap-2",children:[(0,t.jsx)(na.Trash,{size:18,className:"text-fg-danger -ml-1"}),(0,t.jsx)("span",{children:l("templates.delete","Remove")})]})]})]})]})};var rt=e.i(500751),ri=e.i(233833);let rs=e=>{let{tab:i,selectedTemplateId:s,isCreatingTemplate:a,onTabChange:n,onTemplateSelect:r,onTemplateDuplicate:o,onTemplateDelete:l,onAddNew:d,className:c}=e,{t:u}=(0,k.useTranslation)("base"),{push:m}=(0,x.useRouting)(),p=(0,L.useMobileSize)(),{toggleSidebar:h}=(0,ri.useSidebar)(),[g,v]=(0,w.useState)(e2.GrokForTeamsTemplatesListTemplatesOrderByEnum.ListTemplatesOrderByCreateTime),[y,b]=(0,w.useState)(!1),[j,N]=(0,w.useState)(""),S=(0,w.useMemo)(()=>{var e;return null!=(e=null==j?void 0:j.trim())?e:""},[j]),{results:I,containerRef:C,loadMoreRef:E,isFetchingNextPage:M,isLoading:T,isDebouncing:_,isFetching:P,isError:A,refetch:D}=(0,e0.useListConversationTemplates)({orderBy:g,filter:"shared-with-me"===i?e2.GrokForTeamsTemplatesListTemplatesFilterEnum.ListTemplatesFilterShared:e2.GrokForTeamsTemplatesListTemplatesFilterEnum.ListTemplatesFilterPersonal,query:S}),z=(0,w.useCallback)(()=>{m({page:"main"})},[m]);return(0,t.jsxs)("div",{className:(0,f.cn)("flex flex-col h-full @container/template-list",c),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[p?(0,t.jsx)(R.Button,{"aria-label":u("side-nav-toggle-button","Toggle sidebar"),variant:"text",size:"sm",shape:"circle",onClick:h,children:(0,t.jsx)(n3.AlignJustify,{})}):(0,t.jsxs)(R.Button,{size:"sm",variant:"secondary",shape:"circle",className:"hidden @[280px]/template-list:block",onClick:z,children:[(0,t.jsx)(n6.ChevronLeft,{size:18}),(0,t.jsx)("span",{className:"sr-only",children:u("templates.back","Back")})]}),(0,t.jsx)("h1",{className:"text-xl font-semibold",children:u("templates.title","Templates")})]}),(0,t.jsxs)(R.Button,{size:"sm",variant:"secondary",shape:"rectangle",disabled:a,onClick:d,children:[(0,t.jsx)(rt.PopInOut,{children:a?(0,t.jsx)(O.Spinner,{size:"xs",className:"-ml-0.5"}):(0,t.jsx)(e5.Plus,{size:18,className:"-ml-0.5"})},a?"spinner":"plus"),(0,t.jsx)("span",{className:"hidden @[200px]/template-list:block",children:u("templates.add-new","Add")})]})]}),(0,t.jsxs)(iq.Tabs,{value:i,onValueChange:e=>n(e),className:"flex flex-col flex-1 min-h-0",children:[(0,t.jsxs)(iq.TabsList,{className:"bg-transparent border-none relative w-full justify-start p-0 px-4 pt-4 flex-shrink-0",children:[(0,t.jsx)(iq.TabsTrigger,{"aria-controls":void 0,value:"personal",variant:"underline",className:"px-2",children:u("templates.tabs.personal","Personal")}),(0,t.jsx)(iq.TabsTrigger,{value:"shared-with-me",variant:"underline",className:"px-2","aria-controls":void 0,children:u("templates.tabs.shared-with-me","Shared with me")}),(0,t.jsx)("div",{className:"absolute inset-x-4 bottom-0 border-b border-border-l2"})]}),(0,t.jsxs)("div",{className:"flex-shrink-0 flex flex-col @[340px]/template-list:flex-row items-center gap-4  @[360px]/template-list:gap-2 mx-4 mt-4 mb-0.5",children:[(0,t.jsx)("div",{className:"flex-grow relative z-20 w-full",children:(0,t.jsx)(ts,{value:j,onChange:N,isLoading:!!((T||P||_)&&S),className:"h-10 text-sm"})}),(0,t.jsx)("div",{className:"relative flex-shrink-0 self-start",children:(0,t.jsxs)(eR.DropdownMenu,{open:y,onOpenChange:b,children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(R.Button,{shape:"pill",size:"md",variant:"secondary",children:[(0,t.jsx)("span",{children:g===e2.GrokForTeamsTemplatesListTemplatesOrderByEnum.ListTemplatesOrderByCreateTime?u("templates.order-by.create-time","Most recent"):u("templates.order-by.usage-count","Most used")}),(0,t.jsx)(eP.ChevronDownIcon,{className:(0,f.cn)("size-3 text-fg-tertiary transition-transform",{"rotate-180":y})})]})}),(0,t.jsxs)(eR.DropdownMenuContent,{children:[(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>v(e2.GrokForTeamsTemplatesListTemplatesOrderByEnum.ListTemplatesOrderByCreateTime),children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 w-full",children:[(0,t.jsx)("span",{children:u("templates.order-by.create-time","Most recent")}),g===e2.GrokForTeamsTemplatesListTemplatesOrderByEnum.ListTemplatesOrderByCreateTime&&(0,t.jsx)(e_.CheckIcon,{className:"text-fg-primary size-4"})]})}),(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>v(e2.GrokForTeamsTemplatesListTemplatesOrderByEnum.ListTemplatesOrderByUsageCount),children:(0,t.jsxs)("div",{className:"flex items-center justify-between gap-3 w-full",children:[(0,t.jsx)("span",{children:u("templates.order-by.usage-count","Most used")}),g===e2.GrokForTeamsTemplatesListTemplatesOrderByEnum.ListTemplatesOrderByUsageCount&&(0,t.jsx)(e_.CheckIcon,{className:"text-fg-primary size-4"})]})})]})]})})]}),(0,t.jsxs)("div",{className:"flex-1 min-h-0 relative",children:[(0,t.jsx)("div",{className:"absolute inset-x-4 bottom-0 h-4 bg-gradient-to-t from-surface-base to-transparent z-10"}),(0,t.jsx)("div",{className:"absolute inset-x-4 top-0 h-4 bg-gradient-to-b from-surface-base to-transparent z-10"}),(0,t.jsxs)("div",{ref:C,className:"py-4 h-full overflow-auto flex flex-col gap-1 px-4",children:[A?(0,t.jsx)("div",{className:"w-full border border-border-l1 rounded-2xl flex flex-col gap-2 justify-center items-center",children:(0,t.jsx)(tt,{title:u("templates.failed-to-load","Failed to load templates"),onClick:()=>D()})}):I.length>0?I.map(e=>(0,t.jsx)(re,{template:e,isSelected:e.templateId===s,onClick:()=>null==r?void 0:r(e),onDelete:()=>e.templateId&&(null==l?void 0:l(e.templateId)),onDuplicate:()=>e.templateId&&(null==o?void 0:o(e))},e.templateId)):T&&!S?(0,t.jsx)("div",{className:"flex flex-col gap-1",children:Array.from({length:2}).map((e,i)=>(0,t.jsx)(eC.Skeleton,{className:"h-[73px] w-full rounded-2xl opacity-20"},i))}):!T&&!_&&(S?(0,t.jsx)("div",{className:"flex flex-col gap-1 pt-8",children:(0,t.jsx)("div",{className:"text-center text-sm text-fg-secondary px-4",children:u("templates.no-results","No templates found")})}):(0,t.jsxs)("div",{className:"h-[90px] w-full border border-border-l1 rounded-2xl flex flex-col gap-2 justify-center items-center",children:[(0,t.jsx)(n8.LayoutIcon,{size:18,className:"text-fg-secondary"}),(0,t.jsx)("span",{className:"text-fg-secondary text-xs",children:u("templates.no-templates-yet","No templates yet")})]})),M&&(0,t.jsxs)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},className:"flex w-full justify-center items-center gap-3 py-2",children:[(0,t.jsx)("p",{className:"text-fg-tertiary text-sm",children:u("templates.loading-more","Loading more")}),(0,t.jsx)(O.Spinner,{size:"xs"})]},"loading-more"),(0,t.jsx)("div",{ref:E,className:"h-[1px] flex justify-center !m-0 !p-0"})]})]})]})]})};var ra=e.i(792869);e.i(881081);var rn=e.i(727151),rr=e.i(227881);let ro=(0,B.default)("FileWarning",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),rl=e=>{let{name:i,label:s,placeholder:a,maxRows:n,isFocused:r,readonly:o,value:l,onChange:d,onFocus:c,onBlur:u,inputClassName:m,textClassName:p,isLoading:h}=e,g=(0,w.useCallback)(e=>{d(e.target.value)},[d]);return h?(0,t.jsx)(eC.Skeleton,{className:"w-full",children:(0,t.jsx)("span",{className:(0,f.cn)(p,"text-transparent"),children:"''"})}):r?(0,t.jsx)(aV.default,{id:i,autoFocus:!0,"aria-label":s,value:l,placeholder:a,onChange:g,minRows:1,maxRows:n,onBlur:u,className:(0,f.cn)("bg-transparent resize-none focus-within:outline-none placeholder:text-fg-tertiary",m,{"cursor-default":o})}):(0,t.jsx)("div",{tabIndex:o?-1:0,onClick:c,onFocus:c,className:(0,f.cn)("cursor-default focus-within:outline-none",p,{"text-fg-tertiary":!l}),children:l||a})};var rd=e.i(659097),rc=e.i(23854);let ru=e=>{let{onFileUpload:i,className:s}=e,{t:a}=(0,k.useTranslation)("files"),n=(0,w.useRef)(null),{data:{enableImageUploads:r}={}}=(0,tB.useFeatureControls)(),o=(0,w.useCallback)((e,t)=>{let s=t.items;if(!s||0===s.length||!s[0]||!("webkitGetAsEntry"in s[0]))return void e.forEach(e=>i(e));let n=e=>{".DS_Store"!==e.name&&i(e)},r=e=>{(0,h.logError)("template-file-drop-zone:file-upload",e),N.toast.error(a("templates.file-processing-error","Error while processing file"))};for(let e=0;e<s.length;e++){let t=s[e];if(!t)continue;let i=t.webkitGetAsEntry();i&&(0,rc.extractFiles)(i,n,r)}},[a,i]),l=(0,iM.useDropZone)({ref:n,onDrop:o,canDrop:e=>!(!r&&e.files.some(e=>null==e?void 0:e.type.startsWith("image/")))||(N.toast.error(a("feature-controls.enable-image-uploads.forbidden","Image uploads are disabled for your team.")),!1)});return(0,t.jsx)(rd.DropCard,{ref:n,dragState:l,title:a("templates.file-drop-zone-title","Drop files to upload"),className:s})};var rm=e.i(319073),rp=e.i(488675),rh=e.i(284210);let rg=e=>{let{templateAssets:i,uploadingFiles:s,isReadonly:a,onFileUpload:n,onRemoveAsset:r}=e,{t:o}=(0,k.useTranslation)("base"),l=(0,aT.useAssetStore)(e=>e.fetchListAssets),{data:{enableFileUploads:d,enableImageUploads:c}={}}=(0,tB.useFeatureControls)(),{data:u}=(0,ev.useQuery)({queryKey:["listAssets",null==i?void 0:i.flatMap(e=>e.assetId)],queryFn:()=>l({assetIds:i.filter(e=>!!e.assetId).map(e=>e.assetId),isLatest:!0}),enabled:i.length>0,select:e=>e.assets||[]}),m=e=>{r(e.assetId)},p=(0,w.useCallback)(()=>{let e=document.createElement("input");e.type="file",e.multiple=!0,e.onchange=e=>{let t=e.target;if(!t.files)return;let i=Array.from(t.files),s=c?i:i.filter(e=>!e.type.startsWith("image/"));i.length!==s.length&&N.toast.error(o("feature-controls.enable-image-uploads.forbidden","Image uploads are disabled for your team.")),s.forEach(e=>n(e))},e.click()},[c,n,o]),h=(0,w.useMemo)(()=>s.length+((null==u?void 0:u.length)||0),[s,u]);return(0,t.jsxs)("div",{className:"flex flex-shrink-0 items-center gap-2 flex-1 overflow-x-auto",children:[d&&(0,t.jsxs)(R.ButtonWithTooltip,{tooltipContent:o("templates.attach-files-tooltip","Attach reference files (docs, transcripts, logs, etc.) that Grok can use alongside your instructions to generate better outputs"),tooltipContentProps:{align:"start",sideOffset:8},variant:"secondary",shape:"rectangle",size:"sm",className:"flex-shrink-0",disabled:a,tabIndex:-1,onClick:p,children:[(0,t.jsx)(rt.PopInOut,{initial:!1,children:(null==s?void 0:s.length)>0?(0,t.jsx)(O.Spinner,{size:"xs"}):(0,t.jsx)(rm.AttachmentIcon,{size:16})},(null==s?void 0:s.length)>0?"uploading":"idle"),o("templates.attach","Attach Files")]}),h>0&&(0,t.jsxs)(eR.DropdownMenu,{children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)("div",{className:"max-w-full",children:(0,t.jsx)(R.Button,{variant:"secondary",shape:"rectangle",size:"sm",className:"flex-shrink-0",tabIndex:-1,children:o("templates.attached-files",{count:h,defaultValue_one:"Attached ({{count}})",defaultValue_other:"Attached ({{count}})"})})},"more-button")}),(0,t.jsxs)(eR.DropdownMenuContent,{side:"top",alignOffset:12,className:"space-y-1",children:[s.map((e,i)=>(0,t.jsx)(eR.DropdownMenuItem,{className:"cursor-default p-0",children:(0,t.jsx)(rp.FileChip,{file:e,metadata:void 0,variant:"list-item",labelClassName:"w-32"})},e.name+i)),null==u?void 0:u.map(e=>(0,t.jsx)(eR.DropdownMenuItem,{className:"cursor-default p-0 overflow-hidden",children:(0,t.jsx)(rh.AssetMetadataChip,{asset:e,hideEdit:!0,variant:"list-item",labelClassName:"w-32",onRemoveAsset:m})},e.assetId))]})]})]})};var rx=e.i(997549);let rf=e=>{let{values:i,isReadonly:s,isLoading:a,onChange:n}=e,{t:r}=(0,k.useTranslation)("base"),[o,l]=(0,w.useState)(s?null:"templateName"),[d,c]=(0,w.useState)([]),u=(0,w.useRef)(null),m=(0,w.useRef)(null),{data:{enableFileUploads:p}={}}=(0,tB.useFeatureControls)(),h=(0,w.useCallback)((e,t)=>{a||s||n({...i,[e]:t})},[n,i,s,a]),g=(0,w.useCallback)(e=>{var t,i;s||a||o===e||(l(e),"systemPrompt"===e?null==(t=u.current)||t.focus():"inputGuidance"===e&&(null==(i=m.current)||i.focus()))},[s,a,o]),x=(0,w.useCallback)(()=>{l(null)},[]),v=(0,w.useCallback)(async e=>{let i=await e.arrayBuffer(),s={name:e.name,mimeType:e.type,content:a4.Buffer.from(i).toString("base64")};c(t=>[...t,e]);try{var a;let e=aT.useAssetStore.getState(),t=await e.fetchCreateAsset(s),i=null!=(a=t.rootAssetId)?a:t.assetId;if(i)n(e=>({...e,assets:[...e.assets,{assetId:i}]}));else throw Error("Invalid asset")}catch(e){N.toast.error((0,t.jsx)(tZ.Trans,{ns:"files",i18nKey:"templates.file-upload-error",defaults:"Error while uploading file"}))}finally{c(t=>t.filter(t=>t!==e))}},[n]),y=(0,w.useCallback)(e=>{a||s||n(t=>({...t,assets:t.assets.filter(t=>t.assetId!==e)}))},[n,s,a]);return(0,t.jsxs)("form",{className:"flex flex-col gap-6 mx-auto h-full min-h-0 max-w-3xl w-full",children:[p&&!s&&!a&&(0,t.jsx)(ru,{className:"-m-1",onFileUpload:v}),(0,t.jsxs)("div",{className:"flex flex-col gap-2 flex-shrink-0 w-full",children:[(0,t.jsx)(rl,{name:"templateName",label:r("templates.values.name.label","Name"),placeholder:r("templates.values.name.placeholder","New Template"),maxRows:2,isFocused:!s&&"templateName"===o,readonly:s||a,value:i.templateName,onChange:e=>h("templateName",e),onFocus:()=>g("templateName"),onBlur:x,inputClassName:"text-xl font-semibold",textClassName:"text-xl font-semibold line-clamp-2",isLoading:a}),(0,t.jsx)(rl,{name:"templateDescription",label:r("templates.values.description.label","Description"),placeholder:r("templates.values.description.placeholder","Description"),maxRows:2,isFocused:"templateDescription"===o,readonly:s||a,value:i.templateDescription,onChange:e=>h("templateDescription",e),onFocus:()=>g("templateDescription"),onBlur:x,inputClassName:"text-fg-secondary text-base",textClassName:"text-fg-secondary line-clamp-2 text-base",isLoading:a})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-6 flex-1 min-h-0 overflow-y-auto",children:[(0,t.jsxs)("div",{className:(0,f.cn)("border border-border-l2 rounded-2xl flex flex-col overflow-hidden",{"animate-pulse":a}),onClick:()=>g("systemPrompt"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5 flex-shrink-0 w-fit pt-4 px-4",children:[(0,t.jsx)("label",{htmlFor:"systemPrompt",className:"text-sm text-fg-secondary font-semibold",children:r("templates.values.system-prompt.label","Instructions for Grok")}),(0,t.jsxs)(eK.Tooltip,{disableHoverableContent:!1,children:[(0,t.jsx)(eK.TooltipTrigger,{tabIndex:-1,type:"button",className:"cursor-help",children:(0,t.jsx)(iA.Info,{className:"text-fg-secondary",size:16})}),(0,t.jsx)(eK.TooltipContent,{align:"start",side:"bottom",sideOffset:8,className:"text-fg-primary text-sm !p-4",children:(0,t.jsx)(rv,{})})]})]}),(0,t.jsxs)("div",{className:"flex-1 min-h-0 relative px-4",children:[(0,t.jsx)("div",{className:"absolute inset-x-0 bottom-0 h-2.5 bg-gradient-to-t from-surface-base to-transparent z-10"}),(0,t.jsx)("div",{className:"absolute inset-x-0 top-0 h-2.5 bg-gradient-to-b from-surface-base to-transparent z-10"}),(0,t.jsx)("div",{className:"min-h-[160px] h-full",children:a?(0,t.jsx)("div",{className:"flex flex-col gap-1.5 py-2.5",children:Array.from({length:4}).map((e,i)=>(0,t.jsx)(eC.Skeleton,{className:"h-6 w-full",style:{width:"".concat(100-10*i,"%")}},i))}):(0,t.jsx)(rx.TemplateMarkdownEditor,{ref:u,name:"systemPrompt",initialValue:i.systemPrompt,placeholder:r("templates.values.system-prompt.placeholder","Describe how Grok should respond"),isReadonly:s,className:"h-full overflow-y-auto py-2.5",onChange:e=>h("systemPrompt",e),onFocus:()=>g("systemPrompt"),onBlur:x})})]}),(0,t.jsx)("div",{className:"w-full flex-shrink-0 flex justify-between items-center pt-2 pb-4 px-4",children:(0,t.jsx)(rg,{templateAssets:i.assets,uploadingFiles:d,onFileUpload:v,onRemoveAsset:y,isReadonly:s||a})})]}),(0,t.jsxs)("div",{className:(0,f.cn)("bg-surface-l1 border border-border-l2 rounded-2xl flex flex-col flex-shrink-0 overflow-hidden",{"animate-pulse":a}),onClick:()=>g("inputGuidance"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-1.5 flex-shrink-0 w-fit px-4 pt-4",children:[(0,t.jsx)("label",{htmlFor:"inputGuidance",className:"text-sm text-fg-secondary font-semibold",children:r("templates.values.input-guidance.label","Display message")}),(0,t.jsxs)(eK.Tooltip,{disableHoverableContent:!1,children:[(0,t.jsx)(eK.TooltipTrigger,{tabIndex:-1,type:"button",className:"cursor-help",children:(0,t.jsx)(iA.Info,{className:"text-fg-secondary",size:16})}),(0,t.jsx)(eK.TooltipContent,{align:"start",side:"bottom",sideOffset:8,className:"text-fg-primary text-sm !p-4",children:(0,t.jsx)(ry,{})})]})]}),(0,t.jsxs)("div",{className:"flex-1 min-h-0 relative px-4",children:[(0,t.jsx)("div",{className:"absolute inset-x-0 bottom-0 h-2.5 bg-gradient-to-t from-surface-l1 to-transparent z-10"}),(0,t.jsx)("div",{className:"absolute inset-x-0 top-0 h-2.5 bg-gradient-to-b from-surface-l1 to-transparent z-10"}),(0,t.jsx)("div",{className:"min-h-[48px] max-h-[240px] h-full",children:a?(0,t.jsx)("div",{className:"py-2.5",children:(0,t.jsx)(eC.Skeleton,{className:"h-6 w-full"})}):(0,t.jsx)(rx.TemplateMarkdownEditor,{ref:m,name:"inputGuidance",initialValue:i.inputGuidance,placeholder:r("templates.values.input-guidance.placeholder","Provide a guideline on what should be sent to Grok"),isReadonly:s,className:"h-full overflow-y-auto py-2.5",onChange:e=>h("inputGuidance",e),onFocus:()=>g("inputGuidance"),onBlur:x})})]})]})]})]})},rv=()=>{let{t:e}=(0,k.useTranslation)("base");return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold block",children:e("templates.values.system-prompt.tooltip.title","Instructions for Grok")}),(0,t.jsx)("p",{className:"block mt-2",children:e("templates.values.system-prompt.tooltip.description","Hidden instructions given to Grok before any user message. They define what Grok should output, including its personality, response style, and safety boundaries, for the entire conversation.")})]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("p",{className:"font-semibold block",children:e("templates.values.system-prompt.tooltip.tips.title","Tips: ")}),(0,t.jsxs)("ul",{className:"block list-disc list-inside space-y-1 mt-2",children:[(0,t.jsx)("li",{children:e("templates.values.system-prompt.tooltip.tips.be-clear-and-specific","Be clear and specific")}),(0,t.jsx)("li",{children:e("templates.values.system-prompt.tooltip.tips.provide-just-enough-context","Provide just enough context")}),(0,t.jsx)("li",{children:e("templates.values.system-prompt.tooltip.tips.define-groks-role-or-persona","Define Grokâ€™s role or persona")}),(0,t.jsx)("li",{children:e("templates.values.system-prompt.tooltip.tips.specify-desired-output-structure","Specify desired output structure")}),(0,t.jsx)("li",{children:e("templates.values.system-prompt.tooltip.tips.include-examples-when-useful","Include examples when useful")}),(0,t.jsx)("li",{children:e("templates.values.system-prompt.tooltip.tips.break-complex-tasks-into-steps","Break complex tasks into steps")})]})]})]})},ry=()=>{let{t:e}=(0,k.useTranslation)("base");return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold block",children:e("templates.values.input-guidance.tooltip.title","Display message for template user")}),(0,t.jsx)("p",{className:"block mt-2",children:e("templates.values.input-guidance.tooltip.description","A short message shown to anyone who starts a chat with this template. It guides users on what to say next and how to get the best results.")})]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("p",{className:"font-semibold block",children:e("templates.values.input-guidance.tooltip.tips.title","Tips: ")}),(0,t.jsxs)("ul",{className:"block list-disc list-inside space-y-1 mt-2",children:[(0,t.jsx)("li",{children:e("templates.values.input-guidance.tooltip.tips.tell-what-to-send","Tell users exactly what to send to Grok")}),(0,t.jsx)("li",{children:e("templates.values.input-guidance.tooltip.tips.keep-it-concise","Keep it short, clear, and precise")}),(0,t.jsx)("li",{children:e("templates.values.input-guidance.set-expectations-for-best-results","Set expectations for best results")})]})]})]})};var rb=e.i(832753),rb=rb,rj=e.i(534661),rw=e.i(427935);let rk=e=>{let{isReadonly:i,isLoading:s,isError:a,onShare:n,onDuplicate:r,onDelete:o,onClose:l,onStartConversation:d}=e,{t:c}=(0,k.useTranslation)("base"),{commandPrefix:u}=(0,et.useOs)();return(0,t.jsxs)("div",{className:"flex items-center justify-between h-8",children:[(0,t.jsx)("div",{className:"flex h-full items-center",children:l&&(0,t.jsxs)(R.Button,{variant:"textsecondary",shape:"pill",size:"sm",onClick:l,className:"-ms-3",children:[(0,t.jsx)(n6.ChevronLeft,{size:16}),(0,t.jsx)("span",{className:"hidden @[360px]/template-editor:block",children:c("templates.back","Back")})]})}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(eR.DropdownMenu,{children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(R.Button,{variant:"textsecondary",shape:"circle",size:"sm",disabled:s||a,children:[(0,t.jsx)(rb.default,{size:18}),(0,t.jsx)("span",{className:"sr-only",children:c("templates.more","More Options")})]})}),!s&&(0,t.jsxs)(eR.DropdownMenuContent,{children:[(0,t.jsxs)(eR.DropdownMenuItem,{onSelect:r,className:"flex items-center gap-2",children:[(0,t.jsx)(n7.Files,{size:18,className:"-ml-1"}),(0,t.jsx)("span",{children:c("templates.duplicate","Duplicate")})]}),!i&&(0,t.jsxs)(eR.DropdownMenuItem,{onSelect:o,className:"flex items-center gap-2",children:[(0,t.jsx)(na.Trash,{size:18,className:"text-fg-danger -ml-1"}),(0,t.jsx)("span",{children:c("templates.delete","Remove")})]})]})]}),!i&&(0,t.jsxs)(R.ButtonWithTooltip,{size:"sm",variant:"secondary",shape:"pill",disabled:s||a,onClick:n,tooltipContentProps:{align:"start",sideOffset:8},tooltipContent:(0,t.jsx)("div",{className:"flex items-center gap-1",children:c("templates.share-tooltip","Update sharing options for this template")}),children:[(0,t.jsx)(rj.ShareIcon,{size:18,className:"-ml-0.5"}),(0,t.jsx)("span",{className:"hidden @[300px]/template-editor:block",children:c("templates.share","Share")})]}),(0,t.jsxs)(R.ButtonWithTooltip,{variant:"primary",shape:"pill",size:"sm",tooltipContentProps:{align:"start",sideOffset:8},tooltipContent:(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{children:c("templates.use-template-tooltip","Start conversation with template")}),u&&(0,t.jsx)("span",{className:"text-secondary",children:"".concat(u,"âŽ")})]}),onClick:d,disabled:s||a,children:[(0,t.jsx)(rw.SquarePenIcon,{size:18,className:"-ml-0.5"}),(0,t.jsx)("span",{className:"hidden @[300px]/template-editor:block",children:c("templates.use-template","Use")})]})]})]})};var rN=e.i(304543);let rS=e=>{let{isReadonly:i,isSaving:s,lastEditTime:a,owner:n}=e,{t:r}=(0,k.useTranslation)("base"),o=(0,w.useMemo)(()=>a?tI(a):null,[a]);return(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{children:!!n&&i&&(0,t.jsx)("div",{className:"justify-self-start",children:(0,t.jsx)("span",{className:"text-sm text-fg-tertiary",children:r("templates.shared-by","Shared by {{owner}}",{owner:"".concat(n.givenName," ").concat(n.familyName)})})})}),(0,t.jsx)("div",{children:i?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-fg-tertiary",children:[(0,t.jsx)(rN.Lock,{size:14}),r("templates.readonly","Read only")]}):(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:o&&(0,t.jsxs)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"text-sm text-fg-tertiary flex items-center gap-2",children:[(0,t.jsx)("span",{children:r("templates.saved","Saved {{time}}",{time:o})}),(0,t.jsx)("div",{className:"size-4",children:(0,t.jsx)(q.AnimatePresence,{mode:"wait",initial:!1,children:s&&(0,t.jsx)(H.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,transition:{delay:.2}},transition:{duration:.2},children:(0,t.jsx)(O.Spinner,{size:"xs"})},s?"spinner":"")})})]},o)})})]})},rI=e=>{let{templateId:i,onClose:s,onDelete:a,onDuplicate:n}=e,{user:o}=(0,r.useSession)(),{t:l}=(0,k.useTranslation)("base"),{startConversationWithTemplate:d}=(0,e1.useConversationTemplate)({templateId:i}),[c,u]=(0,w.useState)(null),[m,p]=(0,w.useState)({templateName:"",templateDescription:"",inputGuidance:"",systemPrompt:"",sharedWithTeam:!1,assets:[]}),{data:h,isLoading:g,isError:x,refetch:f}=(0,ra.useGetConversationTemplate)({templateId:i}),v=(0,w.useMemo)(()=>c===i,[c,i]),y=(0,w.useMemo)(()=>!!(h&&(null==h?void 0:h.userId)!==(null==o?void 0:o.userId)),[h,o]),{isSaving:b}=function(e){let{templateId:t,formValues:i,delay:s=200,enabled:a}=e,n=(0,e6.useQueryClient)(),{t:r}=(0,k.useTranslation)("base"),o=(0,w.useRef)(new Map),{mutate:l}=(0,e3.useMutation)({mutationFn:e=>eg.grokForTeamsApi.grokForTeamsTemplatesUpdateTemplate({templateId:e.templateId,body:{template:{templateName:e.templateName,templateDescription:e.templateDescription,inputGuidance:e.inputGuidance,systemPrompt:e.systemPrompt,sharedWithTeam:e.sharedWithTeam,assets:e.assets}}})}),d=(0,w.useCallback)(e=>o.current.get(e),[]),c=(0,w.useCallback)((e,t)=>{o.current.has(e)||o.current.set(e,{currentValues:{...t},lastSavedValues:{...t},timeoutRef:null,isSaving:!1,isInitialized:!1})},[]),u=(0,w.useCallback)(e=>{let t=d(e);return!!t&&Object.keys(t.currentValues).some(e=>t.currentValues[e]!==t.lastSavedValues[e])},[d]),m=(0,w.useCallback)(async e=>{let t=d(e);if(t&&!t.isSaving&&u(e)){t.isSaving=!0;try{await new Promise((i,s)=>{l({templateId:e,...t.currentValues},{onSuccess:()=>{n.invalidateQueries({queryKey:(0,e0.getConversationTemplatesQueryKey)({})}),n.invalidateQueries({queryKey:(0,ra.getConversationTemplateQueryKey)(e)}),i()},onError:e=>{s(e)}})}),t.lastSavedValues={...t.currentValues},t.isSaving=!1}catch(e){throw t.isSaving=!1,N.toast.error(r("templates.failed-to-update-template","Failed to update template")),t.currentValues={...t.lastSavedValues},e}}},[d,u,l,n,r]),p=(0,w.useCallback)(e=>{if(!a)return;let t=d(e);t&&(t.timeoutRef&&(clearTimeout(t.timeoutRef),t.timeoutRef=null),u(e)&&(t.timeoutRef=setTimeout(()=>{m(e),t.timeoutRef=null},s)))},[a,d,u,m,s]);(0,w.useEffect)(()=>{if(!t||!a)return;c(t,i);let e=d(t);e&&(e.isInitialized?(e.currentValues={...i},p(t)):(e.currentValues={...i},e.lastSavedValues={...i},e.isInitialized=!0))},[i,t,a,c,d,p]),(0,w.useEffect)(()=>{if(t)return c(t,i),()=>{let e=d(t);e&&(e.timeoutRef&&(clearTimeout(e.timeoutRef),e.timeoutRef=null),u(t)&&!e.isSaving&&a&&m(t).catch(e=>{console.error("Failed to save template ".concat(t," on switch:"),e)}))}},[t]),(0,w.useEffect)(()=>()=>{o.current.forEach((e,t)=>{e.timeoutRef&&(clearTimeout(e.timeoutRef),e.timeoutRef=null),u(t)&&!e.isSaving&&a&&m(t).catch(e=>{console.error("Failed to save template ".concat(t," on unmount:"),e)})}),o.current.clear()},[]);let h=t?d(t):void 0;return{hasUnsavedChanges:!!t&&u(t),isSaving:(null==h?void 0:h.isSaving)||!1}}({templateId:i,formValues:m,enabled:v&&!y}),j=(0,w.useCallback)(()=>{i&&function(e){let{templateId:t,title:i,disclaimer:s}=e,a=["share-template",t];rr.useShareStore.getState().openShareDialog({title:i,disclaimer:s,allowUserSpecificSharing:!1,onSave:async e=>eg.grokForTeamsApi.grokForTeamsTemplatesUpdateTemplate({templateId:t,body:{template:{...e.template,sharedWithTeam:e.sharedWithTeam}}}).then(()=>{let e=(0,rn.getQueryClient)();e.invalidateQueries({queryKey:a}),e.invalidateQueries({queryKey:(0,ra.getConversationTemplateQueryKey)(t)})}).catch(e=>{throw e}),useFetchData:()=>(0,ev.useQuery)({queryKey:a,queryFn:async()=>{let e=(await eg.grokForTeamsApi.grokForTeamsTemplatesGetTemplate({templateId:t})).template||null;return e?{shareUrl:"".concat(window.location.origin,"/?templateId=").concat(e.templateId),sharedWithTeam:!!e.sharedWithTeam,template:e}:{shareUrl:"",sharedWithTeam:!1,template:{}}}})})}({templateId:i,title:l("templates.share-template","Share Template"),disclaimer:{icon:(0,t.jsx)(ro,{size:16,className:"text-fg-secondary flex-shrink-0 mt-[1px]"}),description:l("templates.share-template-disclaimer","When sharing a template, any attached files will also be shared and can't be deleted unless you unlink or delete the template")}})},[i,l]);return(0,w.useEffect)(()=>{!h||g||x||v||(u(i),p({templateName:h.templateName||"",templateDescription:h.templateDescription||"",inputGuidance:h.inputGuidance||"",systemPrompt:h.systemPrompt||"",sharedWithTeam:!!h.sharedWithTeam,assets:h.assets||[]}))},[h,g,c,x,i,v]),(0,T.useHotkeys)(M.KBD_SUBMIT,d,[d]),(0,t.jsxs)("div",{className:"@container/template-editor flex flex-col gap-6 h-full w-full relative",children:[(0,t.jsx)("div",{className:"w-full shrink-0",children:(0,t.jsx)(rk,{isReadonly:y,isLoading:!v,isError:x,onClose:s,onShare:j,onStartConversation:d,onDelete:()=>a(i),onDuplicate:()=>n(m)})}),(0,t.jsx)("div",{className:"flex-grow w-full min-h-0",children:x?(0,t.jsx)("div",{className:"flex items-center justify-center w-full h-full",children:(0,t.jsx)(tt,{onClick:f,title:l("templates.load-error.title","Failed to load template"),description:l("templates.load-error.description","This template doesnâ€™t exist or you donâ€™t have access to it.")})}):(0,t.jsx)(rf,{values:m,isReadonly:y,isLoading:!v,onChange:p})}),(0,t.jsx)("div",{className:"w-full shrink-0",children:(0,t.jsx)(rS,{isSaving:b,isReadonly:y,owner:null==h?void 0:h.owner,lastEditTime:(null==h?void 0:h.modifyTime)||null})})]})};function rC(){let{teams:e}=(0,ed.useEnterprise)(),i=(0,er.useIsActiveGrokBusinessSession)(),{route:s,replace:a}=(0,x.useRouting)(),n=(0,L.useMobileSize)(),r=(0,e6.useQueryClient)(),{t:o}=(0,k.useTranslation)("base"),{push:l}=(0,x.useRouting)(),d=(0,A.useLogEvent)(),c=(0,w.useMemo)(()=>"templates"===s.page&&s.templateId||null,[s]),u=(0,w.useMemo)(()=>"templates"===s.page&&s.tab?s.tab:"personal",[s]),m=(0,w.useCallback)(e=>{a({page:"templates",tab:e,templateId:c})},[a,c]),{mutate:p,isPending:h}=(0,e3.useMutation)({mutationFn:e=>eg.grokForTeamsApi.grokForTeamsTemplatesCreateTemplate({body:e})}),g=(0,w.useCallback)(e=>{let{templateName:t,templateDescription:i,inputGuidance:s,systemPrompt:n,assets:l}=e;return p({templateName:t||"",templateDescription:i||"",inputGuidance:s||"",systemPrompt:n||"",assets:l||[],sharedWithTeam:!1},{onSuccess:e=>{let{template:t}=e;if(t&&t.templateId)return r.setQueryData((0,ra.getConversationTemplateQueryKey)(t.templateId),{template:t}),a({page:"templates",tab:"personal",templateId:t.templateId}),r.invalidateQueries({queryKey:(0,e0.getConversationTemplatesQueryKey)({})})},onError:()=>{N.toast.error(o("templates.failed-to-create-template","Failed to create template"))}})},[a,p,r,o]),v=(0,w.useCallback)(e=>g({templateName:e.templateName?o("template.copy-name","{{name}} (Copy)",{name:e.templateName}):"",templateDescription:e.templateDescription||"",inputGuidance:e.inputGuidance||"",systemPrompt:e.systemPrompt||"",assets:e.assets||[],sharedWithTeam:!1}),[g,o]),y=(0,w.useCallback)(async e=>eg.grokForTeamsApi.grokForTeamsTemplatesDeleteTemplate({templateId:e}).then(()=>(e===c&&a({page:"templates",tab:u,templateId:null}),r.invalidateQueries({queryKey:(0,e0.getConversationTemplatesQueryKey)({})}))).catch(()=>{N.toast.error(o("templates.failed-to-delete-template","Failed to delete template"))}),[a,u,r,o,c]),b=(0,w.useCallback)(e=>{e.templateId&&e.templateId!==c&&(r.setQueryData((0,ra.getConversationTemplateQueryKey)(e.templateId),{template:e}),a({page:"templates",tab:u,templateId:e.templateId}))},[a,u,r,c]),j=(0,w.useCallback)(()=>{a({page:"templates",tab:u,templateId:null})},[a,u]),{startConversationWithTemplate:S}=(0,e1.useConversationTemplate)({templateId:c});return(0,T.useHotkeys)(M.KBD_NEW_CHAT,e=>{e.preventDefault(),e.stopPropagation(),d("pressed_cmd_j",void 0,{location:"templates-page:useHotkeys"}),c?S():l({page:"main",templateId:null})},[d,c,l]),(0,t.jsx)("main",{className:(0,f.cn)("h-dvh w-full relative flex flex-col items-center @container"),children:i?(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(n2.PanelGroup,{direction:"horizontal",autoSaveId:"files-page-layout",style:{height:"100vh"},className:"w-full h-[100vh] overflow-hidden",tagName:"main",children:[(0,t.jsx)(n2.Panel,{minSize:25,defaultSize:30,order:0,children:(0,t.jsx)(rs,{tab:u,isCreatingTemplate:h,selectedTemplateId:c||void 0,onTabChange:m,onAddNew:()=>g({}),onTemplateSelect:b,onTemplateDelete:y,onTemplateDuplicate:e=>v({templateName:e.templateName,templateDescription:e.templateDescription,systemPrompt:e.systemPrompt,inputGuidance:e.inputGuidance,assets:e.assets})})}),n?(0,t.jsx)(n1.ResponsiveDialog,{open:!!c,setOpen:e=>{e||j()},children:(0,t.jsx)("div",{className:"h-[90dvh] w-dvw p-4",children:c&&(0,t.jsx)(rI,{templateId:c,onDuplicate:v,onDelete:y},c)})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n0.ResizeHandle,{className:"focus:outline-ring"}),(0,t.jsx)(n2.Panel,{order:1,minSize:50,defaultSize:75,className:"p-4",children:c?(0,t.jsx)(rI,{templateId:c,onDuplicate:v,onDelete:y,onClose:j},c):(0,t.jsx)(n5,{isCreatingTemplate:h,onUsePreset:g})})]})]})}):e[0]?(0,t.jsx)(iG.TeamSwitchPrompt,{teamId:e[0].teamId,attemptAutoSwitch:!1,description:o("templates.switch-to-team-to-access","Templates are only available in team workspaces. Switch to a team to access templates.")}):(0,t.jsx)(n$.default,{})})}var rE=e.i(524556),rM=e.i(779886);let rT=e=>e.toLocaleDateString("en-US",{day:"2-digit",month:"short",year:"numeric",timeZone:"UTC"});function r_(e){let{changeLogEntries:i}=e;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("header",{children:[(0,t.jsx)(x.Link,{route:{page:"changelog",anchor:null},children:(0,t.jsx)("h1",{children:"Grok Changelog"})}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground mb-8",children:"Latest updates for Grok Web"})]}),(0,t.jsxs)("main",{children:[(0,t.jsx)("p",{children:"See what's new in Grok. Here you'll find information about all the latest updates, new features, improvements, and bug fixes."}),(0,t.jsx)(rM.Separator,{className:"my-8"}),i.map((e,s)=>(0,t.jsxs)("div",{children:[(0,t.jsx)(rR,{entry:e}),s!==i.length-1&&(0,t.jsx)(rM.Separator,{className:"my-8"})]},e.anchor)),(0,t.jsx)(rM.Separator,{className:"my-8"}),(0,t.jsxs)("p",{children:["Want to see what Grok can do with the latest features?"," ",(0,t.jsx)(x.Link,{route:{page:"main"},children:"Start a conversation now!"})]})]})]})}function rP(e){let{entry:i}=e;return(0,t.jsxs)("section",{children:[(0,t.jsx)(x.Link,{route:{page:"changelog",anchor:null},children:(0,t.jsxs)(o.Button,{variant:"link","aria-label":"Changelog",className:"flex items-center gap-1 p-0",children:[(0,t.jsx)(rE.ChevronLeftIcon,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:"Changelog"})]})}),(0,t.jsx)("header",{className:"flex flex-col my-4",children:(0,t.jsx)("h1",{className:"text-2xl font-bold",children:rT(i.date)})}),(0,t.jsx)(rM.Separator,{className:"my-8"}),(0,t.jsx)("div",{children:i.content})]})}function rR(e){let{entry:i}=e;return(0,t.jsx)("div",{className:"flex justify-between w-full items-center",id:i.anchor,children:(0,t.jsxs)("div",{className:"flex flex-col md:flex-row items-start gap-4",children:[(0,t.jsx)(x.Link,{route:{page:"changelog",anchor:i.anchor},className:"text-primary hover:text-primary",children:(0,t.jsx)("div",{className:"text-sm text-muted-foreground w-32",children:rT(i.date)})}),(0,t.jsx)("div",{className:"flex flex-col items-start gap-4",children:(0,t.jsx)("div",{className:"flex flex-col prose",children:i.content})})]})})}function rA(){let e=(0,U.useRoutingStore)(e=>e.route),i="changelog"===e.page?e:(0,nu.never)("only for /changelog"),s=(0,w.useMemo)(()=>[{anchor:"nov-18-2025",date:new Date("2025-11-18"),content:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h4",{children:"New Features"}),(0,t.jsxs)("ul",{children:[(0,t.jsxs)("li",{children:[(0,t.jsx)(x.Link,{route:{page:"main",modelCode:8},children:"Grok 4.1"})," released â€“ #1 on LMSYS Arena, vastly improved reasoning, emotional intelligence, and creative writing, 3Ã— fewer hallucinations"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)(x.Link,{route:{page:"main",modelCode:7},children:"Grok 4 Fast"})," â€“ state-of-the-art search and multimodal reasoning"]}),(0,t.jsx)("li",{children:"Added cards in chat for stocks, sports, maps, and weather"}),(0,t.jsx)("li",{children:"Show searched images in chat"}),(0,t.jsx)("li",{children:"Improved typeahead latency and added personalization"}),(0,t.jsx)("li",{children:"Added instant Grok answers that appear directly in typeaheads"}),(0,t.jsxs)("li",{children:[(0,t.jsx)(x.Link,{route:{page:"imagine"},children:"Imagine"})," video generation with customizable prompts"]}),(0,t.jsx)("li",{children:"Shared chats & projects now show view counts"}),(0,t.jsx)("li",{children:"Integrated Thoughts component"}),(0,t.jsx)("li",{children:"Improved query bar styling"}),(0,t.jsx)("li",{children:"File upload limit raised to 100 files"}),(0,t.jsx)("li",{children:"Faster initial page load"}),(0,t.jsx)("li",{children:"Reduce unnecessary calculations to reduce CPU usage"}),(0,t.jsx)("li",{children:"Improved code block styling"}),(0,t.jsx)("li",{children:"Better OpenGraph previews rendering Markdown"})]}),(0,t.jsx)("h4",{children:"Bug Fixes & Improvements"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Higher success rate under heavy load"}),(0,t.jsx)("li",{children:"Faster search latency"}),(0,t.jsx)("li",{children:"Fixed conversations list in projects"})]})]})},{anchor:"sep-05-2025",date:new Date("2025-09-05"),content:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h4",{children:"New Features"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Calculator, unit conversion tools"}),(0,t.jsx)("li",{children:"Improved typeaheads"}),(0,t.jsx)("li",{children:"Improved code highlighting, performance, and styles"}),(0,t.jsx)("li",{children:"Tool calling for fast mode"}),(0,t.jsx)("li",{children:"Generate Imagine videos from chat generated images"}),(0,t.jsx)("li",{children:"Imagine audio mute preference persistence"}),(0,t.jsx)("li",{children:"Faster video loading for generated videos"}),(0,t.jsx)("li",{children:"Textbox option for chat surveys"}),(0,t.jsx)("li",{children:"Ctrl + Shift + M to switch model mode"})]}),(0,t.jsx)("h4",{children:"Bug Fixes"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:'Fix "Export to PDF" black background'}),(0,t.jsx)("li",{children:"Fix web results not showing in voice mode"}),(0,t.jsx)("li",{children:"Fix double Finished Thinking notification"}),(0,t.jsx)("li",{children:"Fix text direction in side panel and typeaheads for RTL languages"})]})]})},{anchor:"aug-29-2025",date:new Date("2025-08-29"),content:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("h4",{children:"New Features"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Imagine"}),(0,t.jsx)("li",{children:"Grok 4 for anonymous users"}),(0,t.jsx)("li",{children:"Improved typeaheads"}),(0,t.jsx)("li",{children:"Cleaned up citation rendering"}),(0,t.jsx)("li",{children:"Better search results"})]}),(0,t.jsx)("h4",{children:"Bug Fixes"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"General chat stability under bad network conditions"}),(0,t.jsx)("li",{children:"Fixed bugs with creating new chats from shared links"})]})]})}],[]),a=(0,w.useMemo)(()=>s.find(e=>e.anchor===i.anchor),[s,i.anchor]);return(0,t.jsxs)("div",{className:"h-dvh flex-1 overflow-auto relative",children:[(0,t.jsx)("div",{className:"sm:hidden mt-2",children:(0,t.jsx)(t0.TopLeftButton,{shared:!1})}),(0,t.jsx)("div",{className:"prose pb-8 px-4 mt-8 mx-auto pt-2 sm:pt-8",children:i.anchor&&a?(0,t.jsx)(rP,{entry:a}):(0,t.jsx)(r_,{changeLogEntries:s})})]})}var rL=e.i(76756),rD=e.i(412920),rz=e.i(452208),rB=e.i(647582);let rG=e=>{var i;let{conversation:s,restore:a,forceDelete:n}=e,{t:r}=(0,k.useTranslation)("base"),l=(0,er.useIsActiveGrokBusinessSession)();return(0,t.jsxs)(H.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"flex justify-between items-center p-2 border rounded-xl bg-card",children:[(0,t.jsx)("span",{className:"truncate",children:null!=(i=s.title)?i:s.conversationId}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(o.Button,{onClick:()=>s.conversationId&&a(s.conversationId),variant:l?"primary":"outline",children:r("deleted-conversations.restore","Restore")}),!l&&(0,t.jsx)(o.Button,{onClick:()=>s.conversationId&&n(s.conversationId),variant:"destructive",children:r("deleted-conversations.force-delete","Force Delete")})]})]})};function rF(){let{t:e}=(0,k.useTranslation)("base"),{user:i}=(0,r.useSession)(),{conversations:s,isLoading:a,error:n,refetch:l,loadMoreRef:d,historyContainerRef:c}=(0,rB.useListSoftDeletedConversations)(),{restoreConversation:u}=(0,rB.useRestoreConversation)(),{forceDeleteConversation:m}=(0,rB.useForceDeleteConversation)();return i?(0,t.jsxs)("main",{className:(0,f.cn)("h-dvh w-full relative flex flex-col items-center"),children:[(0,t.jsx)(t0.ChatTopNav,{hideIncognito:!0}),(0,t.jsx)(rL.CommandMenu,{}),(0,t.jsxs)("div",{className:"max-w-[50rem] px-5 pt-16 pb-8 @sm:pt-18 mx-auto w-full flex flex-col h-full",ref:c,children:[(0,t.jsx)("h1",{className:"text-2xl flex gap-2 items-center",children:e("deleted-conversations.title","Deleted Conversations")}),(0,t.jsx)("div",{className:"flex flex-col w-full items-start text-xs text-muted-foreground pb-4",children:e("deleted-conversations.description","Conversations marked for deletion will be permanently deleted after 30 days.")}),(0,t.jsx)(rD.FadeScrollContainer,{children:(0,t.jsxs)(q.AnimatePresence,{children:[null==s?void 0:s.map(e=>(0,t.jsx)(rG,{conversation:e,restore:u,forceDelete:m},e.conversationId)),(null==s?void 0:s.length)===0&&!a&&(0,t.jsx)(H.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,t.jsx)("div",{className:"text-center",children:e("deleted-conversations.no-conversations-found","No deleted conversations found")})},"no-conversations-found"),a&&(0,t.jsx)("div",{className:"flex justify-center items-center w-full h-full max-h-[150px]",children:(0,t.jsx)(H.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)(rz.Loader2,{className:"animate-spin"})})})},"deleted-conversations-loading"),n&&(0,t.jsxs)("div",{className:"flex justify-center items-center w-full h-full max-h-[150px] flex-col gap-4",children:[(0,t.jsx)("div",{className:"text-center",children:e("deleted-conversations.error.description","There was an issue loading your deleted conversations")}),(0,t.jsx)(o.Button,{variant:"filledSecondary",onClick:()=>l(),children:e("Retry","Retry")})]},"deleted-conversations-error"),(0,t.jsx)("div",{ref:d})]})})]})]}):(0,t.jsx)("main",{className:(0,f.cn)("w-screen h-dvh relative"),children:(0,t.jsx)(i6.ErrorCard,{title:e("deleted-conversations.error.title","Error"),description:e("deleted-conversations.error.anonymous-user","You must be logged in to access this page"),cta:e("deleted-conversation-page.cta","Return home")})})}var rO=e.i(878191);let rV=e=>{let{anchor:i,children:s}=e;return(0,t.jsx)(x.Link,{route:{page:"faq",anchor:i},onClick:()=>{(0,h.logEventGlobal)("faq_item_click",i,{location:"faq_page"})},children:(0,t.jsx)(o.Button,{variant:"ghost",size:"lg","aria-label":"View answer",className:"my-1",asChild:!0,children:(0,t.jsxs)("div",{className:"flex justify-between w-full items-center",id:i,children:[(0,t.jsx)("span",{className:"text-lg overflow-hidden text-ellipsis",children:s}),(0,t.jsx)(rO.ChevronRightIcon,{className:"w-4 h-4"})]})})})},rU=(0,w.memo)(function(){var e,i,s;let a=(0,U.useRoutingStore)(e=>e.route),n="faq"===a.page?a:(0,nu.never)("only for /faq"),r=(0,ae.useSettingsDialogStore)(e=>e.setTab),l=(0,ae.useSettingsDialogStore)(e=>e.toggleOpen),{SUPPORT_URL:d}=(0,_.useEnvironment)(),c=(0,w.useCallback)(e=>{e.preventDefault(),l(),r("personality")},[l,r]),u=(0,w.useMemo)(()=>(e=>{let{handlePersonalityClick:i}=e;return{"what-is-grok":{anchor:"what-is-grok",question:"What is Grok?",answer:(0,t.jsx)("p",{children:"Grok is a conversational generative AI powered by xAI's state-of-the-art Large Language Models. It's built to assist with a wide range of tasks while being helpful, entertaining, and truthful. Grok aims to answer questions about the universe, help with deep work, and provide real-time insights, all with a touch of humor and personality."})},"key-features":{anchor:"key-features",question:"What are Grok's key features?",answer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"Grok offers a variety of powerful features, including:"}),(0,t.jsxs)("ul",{children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Natural Language Processing and Question Answering"}),": Handles text and voice queries for accurate, context-aware responses."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Real-Time Search and Information Retrieval"}),": Searches public X posts (formerly Twitter) and the web in real-time for up-to-date information."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Creative Writing and Content Generation"}),": Assists with writing stories, articles, or other creative content."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Image Generation and Editing"}),": Creates and edits images based on your descriptions."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Image and Video Understanding"}),": Analyzes uploaded images or videos to provide insights or descriptions."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Coding Assistance"}),": Helps write, debug, and explain code."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Document Analysis"}),": Upload documents for summarization, analysis, or extraction of key information."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Personas and Customization"}),": Choose fun personas (e.g., witty, unhinged, or role-playing like a wizard) to customize Grok's tone and style."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Native Tool Use"}),": Integrates tools like code interpreters and internet access to query missing context and adjust responses dynamically."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Multilingual Capabilities"}),": Supports multiple languages with high precision."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Private Chat Mode"}),": Activate for conversations that aren't saved long-term, ensuring privacy for sensitive discussions."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Conversation History"}),": View and manage past chats for continuity."]})]}),(0,t.jsx)("p",{children:'Grok stands out for its real-time capabilities, reasoning agents, and focus on being a "trusted assistant for deep work."'})]})},models:{anchor:"models",question:"What models power Grok, and what are their features?",answer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"Grok is powered by advanced models from xAI, each with unique strengths:"}),(0,t.jsxs)("ul",{children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Grok 4"}),": The most intelligent model in the world, featuring native tool use, real-time search integration, and superior reasoning."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Grok 4 Heavy"}),": The most powerful version of Grok 4, offering enhanced performance and higher rate limits. Accessible through the SuperGrok Heavy subscription tier."]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("strong",{children:"Grok 3"}),": Fast model that combines reasoning with extensive pretraining knowledge. It includes code interpreters, internet access, and the ability to dynamically adjust approaches for complex tasks."]})]})]})},"creative-tasks":{anchor:"creative-tasks",question:"Can Grok handle creative or specialized tasks?",answer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"Yes! Grok excels at:"}),(0,t.jsxs)("ul",{children:[(0,t.jsxs)("li",{children:[(0,t.jsx)(x.Link,{route:{page:"files"},children:"Generating rich documents, stories, or reports"}),"."]}),(0,t.jsx)("li",{children:"Writing and debugging code in various languages."}),(0,t.jsxs)("li",{children:[(0,t.jsx)(x.Link,{route:{page:"files",emptyView:"image"},children:'Creating/editing images (e.g., via prompts like "generate a cosmic landscape")'}),"."]}),(0,t.jsx)("li",{children:"Analyzing images for descriptions, insights, or edits."}),(0,t.jsx)("li",{children:'Role-playing or adopting personas for fun interactions (e.g., "Respond as a pirate captain").'})]})]})},"real-time-search":{anchor:"real-time-search",question:"Does Grok have real-time search and how does it work?",answer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"Yes, Grok has the most advanced real-time search capabilities. It can:"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Search public X posts for the latest discussions."}),(0,t.jsx)("li",{children:"Perform web searches for current information."}),(0,t.jsx)("li",{children:"Integrate results into responses for up-to-date, accurate answers."})]}),(0,t.jsx)("p",{children:"This is powered by models like Grok 4, ensuring responses are timely and relevant."})]})},"customize-responses":{anchor:"customize-responses",question:"Can I customize Grok's responses?",answer:(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("p",{children:["Absolutely. You can choose one of predefined styles or write your own instructions in"," ",(0,t.jsx)("a",{onClick:i,className:"cursor-pointer",children:"settings"}),"."]})})},"mistakes-inaccuracies":{anchor:"mistakes-inaccuracies",question:"How does Grok handle mistakes or inaccuracies?",answer:(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("p",{children:'Like all AIs, Grok may occasionally "hallucinate" or provide incorrect info based on its training data. It encourages users to verify facts, and you can provide feedback to help improve it. Grok\'s design prioritizes truthfulness to minimize this.'})})},"share-links":{anchor:"share-links",question:"How do shared links work?",answer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"bg-yellow-100/10 dark:bg-yellow-900/10 border border-yellow-200/50 dark:border-yellow-800/50 rounded-lg px-4 py-2 mb-4 flex flex-row items-center gap-3",children:[(0,t.jsx)(aL.AlertTriangle,{className:"text-yellow-200 dark:text-yellow-100 size-5"}),(0,t.jsx)("p",{className:"font-semibold",children:"Shared links can be viewed by anyone with the link."})]}),(0,t.jsx)("h4",{children:"Can I share my Grok conversations?"}),(0,t.jsx)("p",{children:"Yes, you control what you choose to share. You can share your Grok conversations with others:"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:'On grok.com by clicking "Share" in the top right corner of your browser or the share icon below your conversation to create and copy a share link'}),(0,t.jsx)("li",{children:"On the Grok Apps by tapping the share icon under your conversation to create a share link"})]}),(0,t.jsx)("p",{children:"From there, you also control where you share your Grok conversation."}),(0,t.jsx)("h4",{children:"What happens when you share"}),(0,t.jsx)("p",{children:"When you create a share link, anyone with the link can view your entire conversationâ€”including messages, uploads, and generated content. No Grok account required."}),(0,t.jsx)("p",{children:"Note: Any share link you generate will be accessible to anyone you choose to share the link with. For example, if you share the link publicly on a social media platform, it may be subject to indexing by a search engine (e.g., Google) just like any other publicly shared content."}),(0,t.jsx)("h4",{children:"Can I revoke access to my shared Grok conversations?"}),(0,t.jsx)("p",{children:"Yes, you control what you share and how long it is shared. You can revoke access to any or all of your Grok conversation shared links by:"}),(0,t.jsxs)("ul",{children:[(0,t.jsxs)("li",{children:["Logging into grok.com, navigating to"," ",(0,t.jsx)(x.Link,{route:{page:"share-links"},children:"grok.com/share-links"}),', and clicking "Remove" next to the share link you no longer wish to share']}),(0,t.jsx)("li",{children:"Using the menu in your chat"}),(0,t.jsx)("li",{children:"Clicking Unshare on the shared conversation page"})]}),(0,t.jsx)("h4",{children:"Before you share"}),(0,t.jsxs)("ul",{children:[(0,t.jsx)("li",{children:"Review your entire conversation"}),(0,t.jsx)("li",{children:"Remove any personal or sensitive information"}),(0,t.jsx)("li",{children:"Remember that recipients can save or download content"})]}),(0,t.jsx)("p",{className:"mt-4",children:"Tip: Use Private Chat Mode for sensitive conversations that shouldn't be shared."})]})},"linking-accounts":{anchor:"linking-accounts",question:"Why can't I access my subscription on all my devices?",answer:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:"If you're unable to access your subscription on certain devices, this usually happens when you log in using different authentication methods across devices."}),(0,t.jsx)("p",{children:"Even if you use the same email address, different authentication methods (like Google, Apple, or email/password) create separate accounts that aren't automatically connected."}),(0,t.jsxs)("p",{children:["To resolve this, you'll need to manage your accounts at"," ",(0,t.jsx)("a",{href:"https://accounts.x.ai",target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:text-blue-600 underline",children:"accounts.x.ai"}),". Since different authentication methods create separate accounts, you'll need to delete the duplicate accounts and keep only your primary one with your subscription."]}),(0,t.jsxs)("div",{className:"bg-blue-100/10 dark:bg-blue-900/10 border border-blue-200/50 dark:border-blue-800/50 rounded-lg px-4 py-3 mt-4",children:[(0,t.jsx)("p",{className:"font-semibold text-blue-200 dark:text-blue-100 mb-2",children:"ðŸ”— Account Management Steps:"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-1",children:[(0,t.jsxs)("li",{children:["Visit ",(0,t.jsx)("strong",{children:"accounts.x.ai"})," with any duplicate accounts created by different authentication methods."]}),(0,t.jsx)("li",{children:"Delete the duplicate accounts."}),(0,t.jsx)("li",{children:"Log in with your primary account (the one with your subscription)."}),(0,t.jsx)("li",{children:"Navigate to account settings."}),(0,t.jsx)("li",{children:"Connect additional authentication methods to your primary account."}),(0,t.jsx)("li",{children:"Verify that you can access your subscription on all your devices."})]})]}),(0,t.jsxs)("div",{className:"bg-yellow-100/10 dark:bg-yellow-900/10 border border-yellow-200/50 dark:border-yellow-800/50 rounded-lg px-4 py-3 mt-4",children:[(0,t.jsx)("p",{className:"font-semibold text-yellow-200 dark:text-yellow-100 mb-2",children:"âš ï¸ Important Note:"}),(0,t.jsxs)("p",{className:"text-sm",children:[(0,t.jsx)("strong",{children:"Do not delete your primary account with the subscription."})," Only delete the duplicate accounts created when logging in with different authentication methods (Google, Apple, email/password, etc.) using the same email address."]})]}),(0,t.jsxs)("div",{className:"bg-blue-100/10 dark:bg-blue-900/10 border border-blue-200/50 dark:border-blue-800/50 rounded-lg px-4 py-3 mt-4",children:[(0,t.jsx)("p",{className:"font-semibold text-blue-200 dark:text-blue-100 mb-2",children:"â„¹ï¸ Note:"}),(0,t.jsx)("p",{className:"text-sm",children:"SuperGrok subscriptions do not apply to Grok in X. If you have a SuperGrok subscription, it will only work on grok.com and the Grok mobile apps, not within the X platform."})]})]})}}})({handlePersonalityClick:c}),[c]);return(0,t.jsxs)("div",{className:"h-dvh flex-1 overflow-auto relative",children:[(0,t.jsx)("div",{className:"sm:hidden mt-2",children:(0,t.jsx)(t0.TopLeftButton,{shared:!1})}),(0,t.jsx)("div",{className:"prose pb-8 px-4 mt-8 mx-auto pt-2 sm:pt-8",children:n.anchor&&u[n.anchor]?(0,t.jsxs)("section",{children:[(0,t.jsx)("nav",{"aria-label":"Breadcrumb",children:(0,t.jsxs)("ol",{className:"flex items-center m-0 p-0 gap-4",children:[(0,t.jsx)("li",{className:"flex items-center list-none",children:(0,t.jsx)(x.Link,{route:{page:"faq",anchor:null},children:(0,t.jsx)(o.Button,{variant:"link","aria-label":"FAQ",className:"text-muted-foreground p-0",asChild:!0,children:(0,t.jsx)("span",{children:"FAQ"})})})}),(0,t.jsx)("span",{className:"text-muted-foreground",children:(0,t.jsx)(rO.ChevronRightIcon,{className:"w-4 h-4"})}),(0,t.jsx)("li",{className:"list-none m-0 p-0",children:(0,t.jsx)("span",{className:"text-muted-foreground",id:n.anchor,children:null==(e=u[n.anchor])?void 0:e.question})})]})}),(0,t.jsxs)("header",{className:"flex flex-col my-4",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:null==(i=u[n.anchor])?void 0:i.question}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Updated on Sept 15, 2025"})]}),(0,t.jsx)(rM.Separator,{className:"my-8"}),(0,t.jsx)("div",{children:null==(s=u[n.anchor])?void 0:s.answer})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("header",{children:[(0,t.jsx)(x.Link,{route:{page:"faq",anchor:null},children:(0,t.jsx)("h1",{children:"Grok Web FAQ"})}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground mb-8",children:"Updated on Sept 15, 2025"})]}),(0,t.jsxs)("main",{children:[(0,t.jsxs)("p",{children:["Welcome to the Grok Web FAQ page! Grok is designed to be a helpful, witty, and maximally truthful assistant, inspired by the Hitchhiker's Guide to the Galaxy and JARVIS from Iron Man. This FAQ focuses on Grok's Web features, capabilities, and how to make the most of them. For legal terms, privacy, or account issues, visit"," ",(0,t.jsx)("a",{href:"https://x.ai/legal",target:"_blank",rel:"noreferrer noopener",children:"x.ai/legal"}),"."]}),(0,t.jsxs)("p",{children:["If your question isn't covered here, feel free to"," ",(0,t.jsx)(x.Link,{route:{page:"main"},children:"ask Grok directly"})," or visit our"," ",(0,t.jsx)("a",{href:d,target:"_blank",rel:"noreferrer noopener",children:"community forum"}),"."]}),(0,t.jsx)(rM.Separator,{className:"my-8"}),Object.values(u).map((e,i)=>{let{anchor:s,question:a}=e;return(0,t.jsx)(rV,{anchor:s,children:a},i)}),(0,t.jsx)(rM.Separator,{className:"my-8"}),(0,t.jsxs)("p",{children:["If you have more questions,"," ",(0,t.jsx)(x.Link,{route:{page:"main"},children:"chat with Grok now! ðŸš€"})]})]})]})})]})});var rq=e.i(749659);let rH=()=>{let{t:e}=(0,k.useTranslation)(),{isSuperGrokUser:i,isSuperGrokProUser:s,isEnterpriseUser:n}=(0,en.useSubscriptions)(),r=(0,en.useCheckoutSuccess)(),{push:l}=(0,x.useRouting)();return(0,t.jsxs)("div",{className:(0,f.cn)("fixed z-50 bg-background grid inset-0 place-items-center gap-4 duration-200 w-[100vw] min-h-[100vh] overflow-x-hidden","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 p-6"),children:[(0,t.jsx)("meta",{name:"description",content:"Unlock advanced AI capabilities with SuperGrok. With SuperGrok you get signifcantly more access to our premium models and early access to new features."})," ",(0,t.jsx)("meta",{name:"keywords",content:"Grok, Supergrok, Subscription, xAI, AI, Models, Context, Images, Generation, Tools, Features"}),(0,t.jsx)(o.Button,{asChild:!0,variant:"secondary",size:"pill",className:"absolute top-8 z-10 h-10 pr-5",children:(0,t.jsxs)(x.Link,{route:{page:"main"},children:[(0,t.jsx)(n6.ChevronLeft,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"-mt-px",children:e("Go to","Go to")}),(0,t.jsx)("div",{className:"-mx-0.5 -mt-px",children:(0,t.jsx)(a.GrokWordLogo,{className:"h-3"})})]})}),(0,t.jsx)(rq.UpsellPlansV2,{isSubscribed:i||s||n||!1,isSuccessful:r,onSuccess:()=>l({page:"main"})})]})};var rW=e.i(199231);let rK=e=>{var i;let{shareLink:s,conversation:a}=e,{t:n}=(0,k.useTranslation)("base"),{deleteShareLink:r,isPending:l}=(0,rW.useDeleteShareLink)(),d=(0,eb.useShareRoute)();return(0,t.jsxs)(H.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"flex justify-between items-center py-2 px-4 border rounded-xl bg-card gap-2",children:[(0,t.jsx)($.default,{href:d(null!=(i=s.publicId)?i:""),className:"group cursor-pointer text-sm flex-1 min-w-0 grow",children:(0,t.jsx)("span",{className:"line-clamp-1 font-semibold",children:a?a.title:n("share-links.unknown-conversation","Untitled")})}),(0,t.jsxs)("div",{className:"flex flex-row items-center gap-4 shrink-0 select-none",children:[s.viewCount&&(0,t.jsx)("span",{className:"flex items-center text-xs text-muted-foreground",children:n("share-links.views",{count:parseInt(s.viewCount),defaultValue_zero:"No views",defaultValue_one:"{{count}} view",defaultValue_other:"{{count}} views"})}),(0,t.jsx)(o.Button,{onClick:e=>{e.stopPropagation(),s.shareLinkId&&r(s.shareLinkId)},variant:"outline",rounded:!0,disabled:l,children:n("share-links.remove","Unshare")})]})]})};function rY(){let{t:e}=(0,k.useTranslation)("base"),{user:i}=(0,r.useSession)(),{currentTeam:s}=(0,ed.useEnterprise)(),{shareLinks:a,isLoading:n,error:l,refetch:d,loadMoreRef:c,historyContainerRef:u}=(0,rW.useListShareLinks)();return i?(0,t.jsxs)("main",{className:(0,f.cn)("h-dvh w-full relative flex flex-col items-center"),children:[(0,t.jsx)(t0.ChatTopNav,{hideIncognito:!0}),(0,t.jsx)(rL.CommandMenu,{}),(0,t.jsxs)("div",{className:"max-w-[50rem] px-5 pt-16 pb-8 @sm:pt-18 mx-auto w-full flex flex-col h-full",ref:u,children:[(0,t.jsx)("div",{className:"flex justify-between align-center min-h-[42px] w-full",children:(0,t.jsx)("h1",{className:"text-2xl flex gap-2 items-center font-semibold",children:e("share-links.title","Shared Conversations")})}),(0,t.jsx)("div",{className:"flex flex-col w-full items-start text-muted-foreground",children:(null==s?void 0:s.teamId)?e("share-links.description.team","Shared links can be viewed by team members with access."):e("share-links.description.personal","Shared links can be viewed by anyone with the link.")}),(0,t.jsxs)(rD.FadeScrollContainer,{className:"gap-2 pt-6",children:[(0,t.jsxs)(q.AnimatePresence,{children:[null==a?void 0:a.map(e=>{var i;return(0,t.jsx)(rK,{shareLink:e,conversation:null==e||null==(i=e.sharedLink)?void 0:i.conversation},e.shareLinkId)}),(null==a?void 0:a.length)===0&&!n&&(0,t.jsx)(H.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,t.jsx)("div",{className:"text-center h-40 flex items-center justify-center w-full py-8 border rounded-3xl flex-col gap-4 p-4 sm:p-6 select-none",children:(0,t.jsx)("div",{className:"font-semibold",children:e("share-links.no-share-links-found","Nothing shared yet")})})},"no-share-links-found"),n&&(0,t.jsx)("div",{className:"flex justify-center items-center w-full h-full max-h-[150px]",children:(0,t.jsx)(H.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)(rz.Loader2,{className:"animate-spin"})})})},"share-links-loading"),l&&(0,t.jsxs)("div",{className:"flex justify-center items-center w-full h-full max-h-[150px] flex-col gap-4",children:[(0,t.jsx)("div",{className:"text-center",children:e("share-links.error.description","Can't load shared conversations")}),(0,t.jsx)(o.Button,{variant:"filledSecondary",onClick:()=>d(),children:e("Retry","Try Again")})]},"share-links-error")]}),(0,t.jsx)("div",{ref:c})]})]})]}):(0,t.jsx)("main",{className:(0,f.cn)("w-screen h-dvh relative"),children:(0,t.jsx)(i6.ErrorCard,{title:e("deleted-conversations.error.title","Sign In Required"),description:e("deleted-conversations.error.anonymous-user","Sign in to view your shared conversations"),cta:e("share-links-page-error.cta","Return home")})})}e.i(70015);var rQ=e.i(252221),rX=e.i(143883),rJ=e.i(832959),rZ=e.i(890395),r$=e.i(633378),r0=e.i(744106),r1=e.i(604703),r2=e.i(252499),r5=e.i(175505);function r4(e){let{editorRef:i,value:s,placeholder:a,textAreaClassName:n,disabled:r,isPostPage:o,isImageEditMode:l,imagineQueryBarDisableTextEditing:d,server:c,pulseText:u,maxLines:m,handleKeyDown:p,handleChange:h,handlePaste:g,handleFocus:x,handleBlur:v}=e,{t:y}=(0,k.useTranslation)("imagine"),b=(0,tO.useMobileUa)()?r2.TextareaEditor:r5.TiptapEditorWithFallback,j=m?{maxHeight:"calc(".concat(m," * 1.75rem + 2.5rem)")}:void 0;return(0,t.jsx)("div",{className:(0,f.cn)("px-4",u&&"animate-pulse-lg",m&&"overflow-y-auto"),style:j,children:(0,t.jsx)(b,{ref:i,value:s,placeholder:c?"":l?y("image-edit-prompt.placeholder","Type to edit image..."):null!=a?a:y("imagine-query-bar-placeholder","Type to imagine"),isLoading:!1,textAreaClassName:n,handleKeyDown:p,handleChange:h,handlePaste:g,handleFocus:x,handleBlur:v,isExpanded:!0,disabled:d||c||r,disableAutoFocus:o&&!l})})}var r3=e.i(445872);function r6(e){let{flatFiles:i,existingAssets:s,totalFileCount:a,onRemoveFile:n,onRemoveExistingAsset:r}=e,{scrollRef:o,className:l}=(0,r3.useHorizontalScroll)(),d=(0,L.useMobileSize)();return(0,t.jsx)("div",{className:"w-full ps-4 pe-2",children:(0,t.jsx)(H.motion.div,{ref:o,initial:{translateY:-10,opacity:0},animate:{translateY:0,opacity:1},exit:{translateY:-10,opacity:0},className:(0,f.cn)("w-full flex flex-row gap-2 mt-3 px-1 whitespace-nowrap",{hidden:!(a>0),"flex-wrap":!d,"overflow-x-auto":d},l),children:(0,t.jsxs)(q.AnimatePresence,{initial:!1,mode:"popLayout",children:[i.map((e,i)=>(0,t.jsx)(H.motion.div,{className:"max-w-full",initial:{opacity:0,translateY:-10},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:-10},transition:{duration:.2},children:(0,t.jsx)(rp.FileChip,{file:e.file,metadata:e.metadata,onRemoveFile:n,allowCompact:!0})},e.file.name+i)),s.map((e,i)=>(0,t.jsx)(H.motion.div,{className:"max-w-full",initial:{opacity:0,translateY:-10},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:-10},children:(0,t.jsx)(rh.AssetMetadataChip,{asset:e,onRemoveAsset:r,allowCompact:!0})},e.assetId+i))]})})})}var r8=e.i(556934),r9=e.i(219823),r7=e.i(225355),oe=e.i(111171),ot=e.i(740690);let oi=[];function os(e,t){(0,h.logEventGlobal)(e,void 0,{location:"imagine-query-bar-v2",...t})}function oa(e,t){os("image_feed_video_generation_error",{location:"imagine-query-bar-v2",message:e instanceof Error?e.message:"unknown error",mode:t.mode_name})}var on=e.i(715127),or=e.i(184031),oo=e.i(363921),ol=e.i(954125);function od(e){let{imagineMode:i,setImagineMode:s}=e,{t:a}=(0,k.useTranslation)("imagine");return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(R.Button,{"aria-label":a("mode-select.image.label","Image"),variant:"image"===i?"primary":"tertiary",shape:"pill",size:"sm",className:(0,f.cn)("h-10 px-3 gap-1.5","image"!==i&&"text-secondary hover:text-primary"),onClick:()=>s("image"),children:[(0,t.jsx)(on.ImageIcon,{size:18}),(0,t.jsx)("span",{className:"font-semibold text-sm",children:a("mode-select.image.label","Image")})]}),(0,t.jsxs)(R.Button,{"aria-label":a("mode-select.video.label","Video"),variant:"video"===i?"primary":"tertiary",shape:"pill",size:"sm",className:(0,f.cn)("h-10 px-3 gap-1.5","video"!==i&&"text-secondary hover:text-primary"),onClick:()=>s("video"),children:[(0,t.jsx)(or.Video1Icon,{width:18,height:18}),(0,t.jsx)("span",{className:"font-semibold text-sm",children:a("mode-select.video.label","Video")})]})]})}function oc(e){let{mediaPlayerTab:i,isImageEditMode:s,videoControlProps:a}=e,{t:n}=(0,k.useTranslation)("imagine");return"image"===i?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(R.Button,{"aria-label":n("make-video-button.label","Make Video"),variant:s?"tertiary":"primary",shape:"pill",size:"sm",className:(0,f.cn)("h-10 px-3 gap-1.5",s&&"text-secondary hover:text-primary"),onClick:()=>{var e;return null==a||null==(e=a.setImageEditPromptMode)?void 0:e.call(a,!1)},children:[(0,t.jsx)(ol.VideoPlus,{className:"size-[18px]"}),(0,t.jsx)("span",{className:"font-semibold text-sm",children:n("make-video-button.label","Make Video")})]}),(0,t.jsxs)(R.Button,{"aria-label":n("edit-image-button.label","Edit Image"),variant:s?"primary":"tertiary",shape:"pill",size:"sm",className:(0,f.cn)("h-10 px-3 gap-1.5",!s&&"text-secondary hover:text-primary"),onClick:()=>{var e;return null==a||null==(e=a.setImageEditPromptMode)?void 0:e.call(a,!0)},children:[(0,t.jsx)(tT.ScanImageIcon,{className:"size-[18px]"}),(0,t.jsx)("span",{className:"font-semibold text-sm",children:n("edit-image-button.label","Edit Image")})]})]}):"video"===i?(0,t.jsxs)(R.Button,{"aria-label":n("edit-video-button.label","Edit Video"),variant:"textsecondary",shape:"pill",size:"sm",className:"h-10 px-3 gap-1.5 pointer-events-none",children:[(0,t.jsx)(oo.VideoIcon,{width:18,height:18}),(0,t.jsx)("span",{className:"font-semibold text-sm",children:n("edit-video-button.label","Edit Video")})]}):null}var ou=e.i(578077);function om(e){let{imagineMode:i,isOpen:s,setIsOpen:a}=e,{t:n}=(0,k.useTranslation)("imagine"),r=(0,u.useFeatureFlags)(),o=r.ENABLE_IMAGINE_ASPECT_RATIO,l=r.ENABLE_IMAGINE_VIDEO_LENGTH,d=(0,ar.useImagineModeStore)(e=>e.videoDurationOptions),c=(0,ar.useImagineModeStore)(e=>e.videoLength),m=(0,ar.useImagineModeStore)(e=>e.setVideoLength),p=(0,ar.useImagineModeStore)(e=>e.aspectRatio),h=(0,ar.useImagineModeStore)(e=>e.setAspectRatio);return o||l?(0,t.jsxs)(eR.DropdownMenu,{open:s,onOpenChange:a,children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(R.Button,{"aria-label":n("imagine-settings.label","Settings"),variant:"tertiary",shape:"circle",size:"sm",className:"h-10 w-10 text-secondary hover:text-primary",children:(0,t.jsx)(ou.Settings2,{size:20})})}),(0,t.jsxs)(eR.DropdownMenuContent,{align:"end",side:"top",sideOffset:8,children:[l&&"video"===i&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-2",role:"menuitem",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-primary",children:n("mode-select.video-duration.heading","Video Duration")}),(0,t.jsx)("div",{className:"flex flex-row gap-0",children:d.map(e=>(0,t.jsx)(nh.VideoLengthIcon,{videoLength:e,selected:c.toString()===e.toString(),onSelect:()=>{m(e),setTimeout(()=>{a(!1)},100)}},e.toString()))})]}),o&&(0,t.jsx)(eR.DropdownMenuSeparator,{})]}),o&&(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-2",role:"menuitem",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-primary",children:n("mode-select.aspect-ratio.heading","Aspect Ratio")}),(0,t.jsx)("div",{className:"flex flex-row gap-0",children:ar.ASPECT_RATIOS.map(e=>(0,t.jsx)(nh.AspectRatioIcon,{aspectRatio:e,selected:p.toString()===e.toString(),onSelect:()=>{h(e),setTimeout(()=>{a(!1)},100)}},e.toString()))})]})]})]}):null}function op(e){let{videoProgress:i,videoControlProps:s,modes:a,handleVideoGeneration:n}=e,{t:r}=(0,k.useTranslation)("imagine"),o=(0,u.useFeatureFlags)(),l=o.ENABLE_IMAGINE_VIDEO_LENGTH,d=o.ENABLE_IMAGINE_ASPECT_RATIO&&s.isVideoOnlyPost,c=(0,ar.useImagineModeStore)(e=>e.videoDurationOptions),m=(0,ar.useImagineModeStore)(e=>e.setVideoLength),p=(0,ar.useImagineModeStore)(e=>e.videoLength),h=(0,ar.useImagineModeStore)(e=>e.aspectRatio),g=(0,ar.useImagineModeStore)(e=>e.setAspectRatio),[x,v]=(0,w.useState)(!1),[y,b]=(0,w.useState)(p),{videoExtendMode:j,setVideoExtendMode:N}=s,S=(0,w.useCallback)(e=>{n(e,"")},[n]),I=i<100;return(0,t.jsxs)(t.Fragment,{children:[j&&(0,t.jsxs)(R.Button,{"aria-label":r("image-exit-extend-mode-button.label","Exit extend mode"),variant:"secondary",shape:"pill",size:"sm",className:"h-10 ps-2 pe-3 bg-surface-l2 border-surface-l3 text-secondary",onClick:()=>N(!1),children:[(0,t.jsx)(ic.X,{size:16}),(0,t.jsx)("span",{className:"font-semibold text-nowrap",children:r("image-extend-button.label","Extend")})]}),I&&(0,t.jsx)("div",{className:(0,f.cn)("h-10 min-w-12 flex items-center justify-center","rounded-l-full rounded-r-none","bg-button-filled text-fg-invert","ps-3 pe-6 -mr-5","z-0"),children:(0,t.jsxs)("span",{className:"text-xs font-semibold tabular-nums",children:[i,"%"]})}),!I&&(0,t.jsxs)(eR.DropdownMenu,{open:x,onOpenChange:v,children:[(0,t.jsx)(eR.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(R.ButtonWithTooltip,{"aria-label":r("make-video-options.label","Video Options"),variant:"tertiary",shape:"circle",size:"sm",className:"h-10 w-10 text-secondary hover:text-primary",tooltipContent:r("make-video-options.label","Video Options"),children:(0,t.jsx)(ou.Settings2,{size:20})})}),(0,t.jsxs)(eR.DropdownMenuContent,{align:"start",side:"top",children:[l&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-2",role:"menuitem",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-primary",children:r("mode-select.video-duration.heading","Video Duration")}),(0,t.jsx)("div",{className:"flex flex-row gap-0",children:c.map(e=>(0,t.jsx)(nh.VideoLengthIcon,{videoLength:e,selected:y.toString()===e.toString(),onSelect:()=>{m(e),b(e),setTimeout(()=>{v(!1)},100)}},e.toString()))})]}),(0,t.jsx)(eR.DropdownMenuSeparator,{})]}),d&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 p-2",role:"menuitem",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-primary",children:r("mode-select.aspect-ratio.heading","Aspect Ratio")}),(0,t.jsx)("div",{className:"flex flex-row gap-0",children:ar.ASPECT_RATIOS.map(e=>(0,t.jsx)(nh.AspectRatioIcon,{aspectRatio:e,selected:h.toString()===e.toString(),onSelect:()=>{g(e),setTimeout(()=>{v(!1)},100)}},e.toString()))})]}),(0,t.jsx)(eR.DropdownMenuSeparator,{})]}),(0,t.jsx)("div",{className:"flex flex-col gap-1 p-2",role:"menuitem",children:(0,t.jsx)("p",{className:"text-sm font-semibold text-primary",children:r("make-video-presets.label","Video Presets")})}),a.map(e=>(0,t.jsx)(eR.DropdownMenuItem,{onSelect:()=>S(e),children:e.display_name},e.mode_name))]})]})]})}function oh(e){let{onClick:i,ariaLabel:s,type:a="button",disabled:n=!1,isEnabled:r=!0,icon:o}=e;return(0,t.jsx)(H.motion.button,{initial:{opacity:.5},animate:{opacity:1,transition:{duration:.1}},whileHover:r?{scale:1.1}:void 0,whileTap:r?{scale:.95}:void 0,className:(0,f.cn)("group flex flex-col justify-center rounded-full","focus:outline-none focus-visible:outline-none","focus-visible:ring-1 focus-visible:ring-ring"),type:a,"aria-label":s,disabled:n,onClick:i,children:(0,t.jsx)("div",{className:(0,f.cn)("h-10 relative","aspect-square flex flex-col items-center justify-center","rounded-full ring-1 ring-inset","before:absolute before:inset-0 before:rounded-full","before:bg-button-filled before:ring-0","before:transition-[clip-path,background-color] duration-100",r?"bg-button-filled text-fg-invert ring-transparent before:[clip-path:circle(50%_at_50%_50%)]":"bg-warm-gray-100 dark:bg-gray-600 text-fg-secondary before:[clip-path:circle(0%_at_50%_50%)] ring-0"),children:null!=o?o:(0,t.jsx)(aU.ArrowUpIcon,{size:20,className:"relative"})})})}let og=async()=>!1,ox=(0,w.memo)((0,w.forwardRef)((e,i)=>{let{className:s,textAreaClassName:a,onQuery:n=og,disabled:o,onChange:l,onBlur:d,placeholder:c,showFavorites:m=!1,navigateOnQuery:g=!0,videoControlProps:v}=e,{t:y}=(0,k.useTranslation)("imagine"),{route:b}=(0,x.useRouting)();(0,r.useSession)();let j=(0,u.useFeatureFlags)(),S=(0,u.useMaxFiles)(),I=b.page.startsWith("imagine-post"),C="imagine-more"===b.page,E=!!v,M=!!(null==v?void 0:v.videoEditMode),T=(0,ar.useImagineModeStore)(e=>I?e.imagineModePostPage:e.imagineMode),_=(0,ar.useImagineModeStore)(e=>I?e.setImagineModePostPage:e.setImagineMode),P=(0,ar.useImagineModeStore)(e=>e.mediaPlayerTab),R=j.ENABLE_IMAGINE_TEXT_TO_VIDEO,D=j.ENABLE_IMAGINE_ASPECT_RATIO,z=j.ENABLE_IMAGINE_VIDEO_LENGTH,[B,G]=(0,w.useState)(!1),F=(0,L.useMobileSize)(640),[O]=(0,r0.useMeasure)(),V="imagine-"+("imagine-post"===b.page?"postId"in b?b.postId:"":"main"),{value:U,setValue:q,isLoading:H,isSubmitting:W,isQueryable:K,imagineQueryBarDisableTextEditing:Y,editorRef:Q,isComposingRef:X,register:J,errors:Z,flatFiles:$,existingAssets:ee,handleSubmit:et,handleKeyDown:ei,handleChange:es,onSubmit:ea}=function(e){let{conversationIdOrDefault:t,onQuery:i,disabled:s}=e,{t:a}=(0,k.useTranslation)("imagine"),n=(0,w.useRef)(null),{register:r,handleSubmit:o,formState:{errors:l}}=(0,ot.useForm)(),d=(0,tY.useFileStore)(e=>e.listByConversationId),c=(0,tY.useFileStore)(e=>e.attachListByConversationId),u=d[t]||oi,m=c[t]||oi,[p,g]=(0,w.useState)(""),[x,f]=(0,w.useState)(!1),[v,y]=(0,w.useState)(!1),b=(0,w.useMemo)(()=>{var e,i;let a=u.some(e=>void 0===e.metadata),n=u.some(e=>e.metadata instanceof Error),r=!!p||u.length>0||(null!=(i=null==(e=c[t])?void 0:e.length)?i:0)>0;return!a&&!n&&!x&&r&&!s},[u,s,x,p,c,t]),j=(0,w.useMemo)(()=>{let e=u.some(e=>void 0===e.metadata),t=u.some(e=>e.metadata instanceof Error);return e&&!t},[u]),S=(0,w.useCallback)(async()=>{var e,s;if(!b||!n.current)return;let r=n.current.value(),o=r.length;if(o>oe.MAX_QUERY_LENGTH){let e=a("query-bar.too-long","Character Limit Exceeded: {{currentLength}}/{{maxLength}}",{maxLength:oe.MAX_QUERY_LENGTH.toFixed(0),currentLength:o.toFixed(0)});return N.toast.error(e),!1}let l=tY.useFileStore.getState(),d=u.map(e=>e.metadata).filter(e=>void 0!==e&&!(e instanceof Error)),m=[...null!=(e=c[t])?e:[]],p=[...d.map(e=>e.fileMetadataId),...m.map(e=>e.assetId)];g(""),n.current.setValue(""),l.removeByConversationId(t),l.removeAttachByConversationId(t),f(!0),await i({query:r,fileAttachmentIds:p}).finally(()=>{f(!1)})||(g(r),null==(s=n.current)||s.setValue(r),u.map(e=>l.lisertByConversationId(e,t)),m.map(e=>l.lisertAttachByConversationId(e,t)))},[b,u,c,t,i,a]),I=(0,w.useCallback)(async()=>{if(!v){y(!0);try{await S()}catch(e){(0,h.logError)("imagine-query-bar-v2:submit",e)}y(!1)}},[v,S]),C=(0,w.useMemo)(()=>o(I),[o,I]),E=(0,w.useCallback)(e=>{e.preventDefault(),C().catch(e=>{(0,h.logError)("imagine-query-bar-v2:handleSubmit",e)})},[C]),M=(0,r9.useIsComposing)(n),T=(0,r7.useUniversalSubmit)(void 0,M,e=>{e.stopPropagation(),e.preventDefault(),b&&C().catch(e=>{(0,h.logError)("imagine-query-bar-v2:handleKeyDown",e)})},[C]),_=(0,w.useCallback)(e=>{g(null!=e?e:"")},[]);return{value:p,setValue:g,isLoading:x,isSubmitting:v,isQueryable:b,imagineQueryBarDisableTextEditing:j,editorRef:n,isComposingRef:M,register:r,errors:l,flatFiles:u,existingAssets:m,handleSubmit:E,handleKeyDown:T,handleChange:_,onSubmit:C}}({conversationIdOrDefault:V,onQuery:n,disabled:o}),en=(0,w.useCallback)(e=>{es(e),null==l||l(e)},[es,l]),{totalFileCount:er,attachLabel:el,handleClickUpload:ed,handleRemoveFile:ec,handleRemoveExistingAsset:eu,handlePaste:em,fileInputRef:ep,allowedImageUploadTypes:eh,handleInputFilesChange:eg}=function(e){let{conversationIdOrDefault:t,flatFiles:i,existingAssets:s}=e,{t:a}=(0,k.useTranslation)("imagine"),n=(0,u.useFeatureFlags)().IMAGINE_CONFIGS,r=(0,A.useLogEvent)(),o=(0,p.useRequestErrorToastFn)(),l=(0,tY.useFileStore)(e=>e.fetchUploadFile),d=(0,tY.useFileStore)(e=>e.delistByConversationId),c=(0,tY.useFileStore)(e=>e.delistAttachByConversationId),m=(0,w.useRef)(null),h=(0,u.useMaxFiles)(),g="image/*";n.get("enable_edits")&&(g="image/*, video/*");let x=i.length+s.length,f=a("Attach","Attach"),v=(0,w.useCallback)(()=>{var e;null==(e=m.current)||e.click()},[]),y=(0,w.useCallback)(e=>{var i;if(!e.target.files)return;let s=r8.GrokApiV2UploadedFileSourceType.ImagineSelfUploadFileSource,n=Array.from(e.target.files),d=tY.useFileStore.getState(),c=d.listByConversationId[t]||[],u=null!=(i=d.attachListByConversationId[t])?i:[];if(c.length+u.length+n.length>h)return void N.toast.error(a("Can only submit a maximum of max files per message.","Can only submit a maximum of {{max}} files per message. Please remove some files before uploading more.",{max:h}));n.forEach(e=>{l(e,t,s).metadataPromise.catch(e=>{o("imagine-query-bar-v2:handleInputFilesChange",e)}),r("upload_file",e.name,{location:"imagine-query-bar-v2",mimeType:e.type})})},[t,l,o,r,h,a]),b=(0,w.useCallback)(e=>{if(m.current){let t=m.current.files;if(t){let i=new DataTransfer;Array.from(t).forEach(t=>{t!==e&&i.items.add(t)}),m.current.files=i.files}}d(t,e)},[t,d]),j=(0,w.useCallback)(e=>{c(t,e.assetId)},[t,c]),S=(0,w.useCallback)(e=>{var i,s;let n=[];if(!e.clipboardData.getData("text")){let t=e.clipboardData.items;if(t)for(let e=0;e<t.length;e++){let s=null==(i=t[e])?void 0:i.getAsFile();s&&n.push(s)}}if(n.length>0){e.preventDefault();let i=tY.useFileStore.getState(),d=i.listByConversationId[t]||[],c=null!=(s=i.attachListByConversationId[t])?s:[];if(d.length+c.length+n.length>h)return void N.toast.error(a("Can only submit a maximum of max files per message.","Can only submit a maximum of {{max}} files per message. Please remove some files before uploading more.",{max:h}));let u=r8.GrokApiV2UploadedFileSourceType.ImagineSelfUploadFileSource;n.forEach(e=>{l(e,t,u).metadataPromise.catch(e=>{o("imagine-query-bar-v2:handlePaste",e)}),r("upload_file",e.name,{location:"imagine-query-bar-v2-paste",mimeType:e.type})})}},[t,l,o,r,h,a]);return{fileInputRef:m,allowedImageUploadTypes:g,maxFiles:h,totalFileCount:x,attachLabel:f,handleClickUpload:v,handleInputFilesChange:y,handleRemoveFile:b,handleRemoveExistingAsset:j,handlePaste:S}}({conversationIdOrDefault:V,flatFiles:$,existingAssets:ee}),{videoProgress:ex,modesWithCustomFilteredOut:ef,handleVideoGeneration:ev}=function(e){var t,i;let{videoControlProps:s}=e,a=null!=(t=null==s?void 0:s.post.id)?t:"",n=(0,ar.useMediaStore)(e=>e.smoothedVideoProgress[a]),r=(0,ar.useMediaStore)(e=>e.videoByMediaId[a]),o=(0,w.useMemo)(()=>{var e;if(!s)return 100;let{post:t}=s,i=null!=(e=(0,np.default)(r))?e:t;return"number"==typeof(null==i?void 0:i.progress)&&i.progress<100?Math.round(null!=n?n:0):100},[s,r,n]),l=nl({isModelGenerated:null!=(i=null==s?void 0:s.isModelGenerated)&&i}),d=l.filter(e=>"custom"!==e.mode_name);return{videoProgress:o,modes:l,modesWithCustomFilteredOut:d,handleVideoGeneration:(0,w.useCallback)(function(e,t){var i,a;let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;if(!s)return;let{post:o,lastGeneratedVideo:l,lastGeneratedVideoWasExtendedFrom:d,lastGeneratedVideoWasExtendedFromTime:c,lastGeneratedVideoWasEditedFrom:u,videoCurrentTimeRef:m,videoEditMode:p,onVideoGenerationStart:g}=s,x=ar.useMediaStore.getState().generateVideoForImage,f=ar.useMediaStore.getState().fetchMediaPost,v=eo.useSettingsStore.getState().setShowAgeVerification,y=eo.useSettingsStore.getState().setAgeVerificationCallback,b=eo.useSettingsStore.getState().ageVerificationCallback,j=e.speech_mode?"speech":e.custom_mode?"custom":"",w="speech"===j?t:void 0,k="custom"===j?t:void 0,N=()=>{var t,i,s,a,v,y,b;os("image_feed_video_generation_started",{mode:e.mode_name,source:"imagine-query-bar-v2"});let j=null==(t=o.originalPost)?void 0:t.id;if(j)return void f(j).then(t=>{var i,s,a,o,f,v;null==g||g(),x(null!=(a=null==(i=t.originalPost)?void 0:i.id)?a:t.id,void 0,e.mode_name,"imagine-query-bar-v2",w,k,n?null==l?void 0:l.id:d,n?null!=(o=m.current)?o:void 0:c,r,p||!!u,p?null!=(v=null!=(f=null==l?void 0:l.id)?f:null==(s=t.originalPost)?void 0:s.id)?v:t.id:u).catch(t=>{oa(t,e),(0,h.logError)("imagine-query-bar-v2",t)})}).catch(e=>{os("image_feed_video_generation_error",{message:"failed to fetch original post"}),(0,h.logError)("imagine-query-bar-v2",e)});null==g||g(),x(null!=(a=null==(i=o.originalPost)?void 0:i.id)?a:o.id,void 0,e.mode_name,"imagine-query-bar-v2",w,k,n?null==l?void 0:l.id:d,n?null!=(v=m.current)?v:void 0:c,r,p||!!u,p?null!=(b=null!=(y=null==l?void 0:l.id)?y:null==(s=o.originalPost)?void 0:s.id)?b:o.id:u).catch(t=>{oa(t,e),(0,h.logError)("imagine-query-bar-v2",t)})},{stage:S}=null!=(a=null==(i=a3.useAgeVerificationStage.getState)?void 0:i.call(a3.useAgeVerificationStage))?a:{stage:"pass"};if(!e.is_mature||"pass"===S)return void N();let I=()=>{N(),b===I&&y(void 0)};y(I),v(!0)},[s])}}({videoControlProps:v}),[ey,eb]=(0,w.useState)(null),ej=(0,w.useCallback)((e,t,i,s)=>{eb(t||null),ev(e,t,i,s)},[ev]),{isImageEditMode:ew,handleImageEditSubmit:ek,handleKeyDownWithImageEdit:eN}=function(e){let{videoControlProps:t,editorRef:i,setValue:s,isComposingRef:a,handleKeyDown:n,handleVideoGeneration:r}=e,{route:o}=(0,x.useRouting)(),l=!!(null==t?void 0:t.imageEditPromptMode),d=!!t,c=("imagine-post"===o.page||"imagine-more"===o.page)&&"img_edit"===o.action,u=(0,w.useCallback)(()=>{var e,a,n,r;if(!(null==t?void 0:t.runImageEditPrompt)||!(null==t?void 0:t.setImageEditPromptMode))return;let o=null!=(r=null==(a=i.current)||null==(e=a.value())?void 0:e.trim())?r:"";t.runImageEditPrompt(o),c||t.setImageEditPromptMode(!1),s(""),null==(n=i.current)||n.setValue("")},[t,i,s,c]),m=(0,w.useCallback)(()=>{var e;null==t||null==(e=t.setImageEditPromptMode)||e.call(t,!1)},[t]),p=(0,w.useCallback)(()=>{var e,s,a,n;let o=null!=(a=null==(s=i.current)||null==(e=s.value())?void 0:e.trim())?a:"",l=ar.useImagineModeStore.getState().videoLength,d=null!=(n=null==t?void 0:t.videoExtendMode)&&n;o?r({mode_name:"custom",display_name:"Custom",custom_mode:!0},o,d,l):r({mode_name:"normal",display_name:"Normal"},"",d,l)},[t,i,r]),h=(0,w.useCallback)(e=>{if(l){if("Escape"===e.key){e.stopPropagation(),e.preventDefault(),m();return}if("Enter"===e.key&&!e.shiftKey&&!a.current){e.preventDefault(),e.stopPropagation(),u();return}}else if(d){if("Enter"===e.key&&!e.shiftKey&&!a.current){e.preventDefault(),e.stopPropagation(),p();return}}else n(e)},[l,d,n,u,p,m,a]);return{isImageEditMode:l,handleImageEditSubmit:u,handleExitImageEditMode:m,handleKeyDownWithImageEdit:h}}({videoControlProps:v,editorRef:Q,setValue:q,isComposingRef:X,handleKeyDown:ei,handleVideoGeneration:ej}),eS=I||C||ew||M,eI=E&&ex<100,eC=!!ey&&U.trim()===ey.trim(),eE=null==v?void 0:v.originalPrompt,eM=!!eE,eT=E&&eM&&U.trim()===eE.trim(),e_="postId"in b?b.postId:void 0,eP="".concat(b.page,"-").concat(null!=e_?e_:""),eR=w.default.useRef(void 0),eA=w.default.useRef(void 0),eL=w.default.useRef(!1);(0,w.useEffect)(()=>{let e=eR.current!==eP,t=eA.current!==eE;eM&&(e||t)?(q(eE),eL.current=!0):e&&eL.current&&!eM&&(q(""),eL.current=!1),eR.current=eP,eA.current=eE},[eM,eE,eP,q]),(0,w.useImperativeHandle)(i,()=>({focus:e=>{var t;null==(t=Q.current)||t.focus(e)}}));let{ref:eD,...ez}=J("files",{validate:e=>!($.length+((null==e?void 0:e.length)||0)>S)||y("validation.max-files","Max number of files allowed is {{maxFiles}}",{maxFiles:S})});(0,w.useEffect)(()=>{let e=$.some(e=>void 0===e.metadata),t=$.some(e=>e.metadata instanceof Error);e||t||!$.length&&!ee.length||W||ea().catch(e=>{(0,h.logError)("imagine-query-bar-v2:auto-submit",e)})},[$,ee,ea,W]);let[eB,eG]=(0,w.useState)(!0);(0,w.useLayoutEffect)(()=>{eG(!1)},[]);let eF=(0,w.useCallback)(()=>{},[]),eO=(0,w.useCallback)(()=>{null==d||d()},[d]);return(0,t.jsx)("form",{className:(0,f.cn)("w-full text-base flex flex-col gap-2 items-center justify-center relative z-10",s),onSubmit:ea,children:(0,t.jsx)("div",{className:(0,f.cn)("flex flex-row items-end justify-center w-full max-w-4xl mx-auto px-4",F&&"gap-0"),children:(0,t.jsxs)("div",{className:"flex-1 min-w-0 max-w-3xl",ref:O,children:[(0,t.jsx)("input",{ref:e=>{eD(e),ep.current=e},...ez,className:"hidden",type:"file",onChange:eg,multiple:!1,accept:eh}),Z.files&&(0,t.jsx)("div",{className:"text-red-500 absolute top-[-20px]",children:Z.files.message}),(0,t.jsxs)("div",{className:(0,f.cn)("query-bar group z-10","bg-surface-l1","ring-border-l1 hover:ring-border-l1 focus-within:ring-border-l1","relative w-full overflow-hidden @container/input","shadow-sm shadow-black/5",tL.QUERY_BAR_MAX_WIDTH_CLASS,"ring-1 ring-inset focus-within:ring-1","rounded-3xl"),style:{transitionProperty:"background-color, box-shadow, border-color",transitionDuration:"100ms",transitionTimingFunction:"ease-in-out"},children:[(0,t.jsx)(r6,{flatFiles:$,existingAssets:ee,totalFileCount:er,onRemoveFile:ec,onRemoveExistingAsset:eu}),(0,t.jsx)(r4,{editorRef:Q,value:U,placeholder:c,textAreaClassName:a,disabled:o,isPostPage:I,isImageEditMode:ew,imagineQueryBarDisableTextEditing:Y,server:eB,pulseText:eC&&eI,maxLines:2,handleKeyDown:eN,handleChange:en,handlePaste:em,handleFocus:eF,handleBlur:eO}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2 px-2 pb-2",children:[(0,t.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[!eS&&(0,t.jsxs)(e7.Popover,{children:[(0,t.jsx)(e7.PopoverTrigger,{asChild:!0,children:(0,t.jsx)(r$.AttachDropdown,{label:el,disabled:!1,queryBarExpanded:!0,totalFileCount:er,handleClickUpload:ed,onWorkspaceAttached:()=>{},imageAttachmentsOnly:!0,buttonVariant:"ghost",hideTooltip:!1})}),(0,t.jsx)(e7.PopoverContent,{side:"top",sideOffset:4,align:"start",className:"border-none relative group"})]}),!(I||C)&&R&&(0,t.jsx)(od,{imagineMode:T,setImagineMode:_}),(I||C)&&(0,t.jsx)(oc,{mediaPlayerTab:P,isImageEditMode:ew,videoControlProps:v})]}),(0,t.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[!(I||C)&&(D||z)&&(0,t.jsx)(om,{imagineMode:T,isOpen:B,setIsOpen:G}),E&&!ew&&v&&(0,t.jsx)(op,{videoProgress:ex,videoControlProps:v,modes:ef,handleVideoGeneration:ej}),(0,t.jsx)("div",{className:E&&ex<100?"relative z-10":"",children:(0,t.jsx)(oh,{onClick:E&&!ew?()=>{var e;let t=U.trim(),i=ar.useImagineModeStore.getState().videoLength,s=null!=(e=null==v?void 0:v.videoExtendMode)&&e;t?ej({mode_name:"custom",display_name:"Custom",custom_mode:!0},t,s,i):ej({mode_name:"normal",display_name:"Normal"},"",s,i)}:ew?ek:e=>{e&&e.preventDefault(),et({preventDefault:()=>{}})},ariaLabel:E&&!ew?eT?y("image-redo-video-button.label","Redo video"):y("image-make-video-button.label","Make video"):ew?y("image-edit-submit-button.label","Edit"):y("Submit","Submit"),type:E||ew?"button":"submit",disabled:ew?!U.trim():!E&&!K,isEnabled:ew?!!U.trim():E||K,icon:E&&!ew&&eT?(0,t.jsx)(r1.VideoRedoIcon,{width:20,height:20,className:"relative"}):void 0})})]})]})]})]})})})}));function of(e){let i,s,a,{children:n}=e,{t:r}=(0,k.useTranslation)("imagine"),o=(0,u.useFeatureFlags)(),{route:l,push:d}=(0,x.useRouting)(),c=(0,_.useEnvironment)(),m=(0,L.useMobileSize)(),p=(0,ar.useMediaStore)(e=>e.pushHomeGenPrompt),g=(0,ar.useMediaStore)(e=>e.resetImageGen),v=(0,ar.useMediaStore)(e=>e.pushPostPageSection),y=(0,ar.useMediaStore)(e=>e.homeGenPrompts),b=(0,ar.useMediaStore)(e=>e.createMediaPostFromPrompt),j=(0,ar.useMediaStore)(e=>e.like),N=(0,ar.useMediaStore)(e=>e.generateVideoForImage),S=(0,aT.useAssetStore)(e=>e.fetchGetAsset),I=(0,eo.useSettingsStore)(e=>e.userSettings.preferences.disableVideoGenerationOnUpload),C=(0,a_.useGenImagineVideoFromMediaUrl)({disableVideoGeneration:I}),[E,M]=(0,w.useState)(!1),T=o.ENABLE_IMAGINE_TEXT_TO_VIDEO,P=l.page.startsWith("imagine-post"),A=(0,ar.useImagineModeStore)(e=>P?e.imagineModePostPage:e.imagineMode),D=T?A:"image",z=(0,w.useCallback)(e=>{"imagine"===l.page&&y.length>0||g(),p(e)},[p,g,l,y.length]),B="imagine-post"===l.page||"imagine-more"===l.page?l.postId:null,G=(0,w.useCallback)(e=>{B&&v(B,e)},[v,B]);"imagine-more"===l.page||"imagine-post"===l.page?(i=G,s=!0,a=!1):("imagine-favorites"===l.page?(i=z,s=!1):(i=z,s=!0),a=!0);let F=nf((0,rZ.useShallow)(e=>({post:e.post,videoExtendMode:e.videoExtendMode,setVideoExtendMode:e.setVideoExtendMode,videoEditMode:e.videoEditMode,setVideoEditMode:e.setVideoEditMode,videoCurrentTimeRef:e.videoCurrentTimeRef,lastGeneratedVideo:e.lastGeneratedVideo,lastGeneratedVideoWasExtendedFrom:e.lastGeneratedVideoWasExtendedFrom,lastGeneratedVideoWasExtendedFromTime:e.lastGeneratedVideoWasExtendedFromTime,lastGeneratedVideoWasEditedFrom:e.lastGeneratedVideoWasEditedFrom,originalPrompt:e.originalPrompt,isModelGenerated:e.isModelGenerated,onVideoGenerationStart:e.onVideoGenerationStart,isVideoOnlyPost:e.isVideoOnlyPost,imageEditPromptMode:e.imageEditPromptMode,setImageEditPromptMode:e.setImageEditPromptMode,runImageEditPrompt:e.runImageEditPrompt,isImportingMedia:e.isImportingMedia}))),O=(0,w.useMemo)(()=>{var e,t,i;if("imagine-post"===l.page&&F.post&&F.setVideoExtendMode)return{post:F.post,videoExtendMode:F.videoExtendMode,setVideoExtendMode:F.setVideoExtendMode,videoEditMode:F.videoEditMode,setVideoEditMode:null!=(e=F.setVideoEditMode)?e:void 0,videoCurrentTimeRef:F.videoCurrentTimeRef,lastGeneratedVideo:F.lastGeneratedVideo,lastGeneratedVideoWasExtendedFrom:F.lastGeneratedVideoWasExtendedFrom,lastGeneratedVideoWasExtendedFromTime:F.lastGeneratedVideoWasExtendedFromTime,lastGeneratedVideoWasEditedFrom:F.lastGeneratedVideoWasEditedFrom,originalPrompt:F.originalPrompt,isModelGenerated:F.isModelGenerated,onVideoGenerationStart:F.onVideoGenerationStart,isVideoOnlyPost:F.isVideoOnlyPost,imageEditPromptMode:F.imageEditPromptMode,setImageEditPromptMode:null!=(t=F.setImageEditPromptMode)?t:void 0,runImageEditPrompt:null!=(i=F.runImageEditPrompt)?i:void 0}},[l.page,F]),V=(0,w.useCallback)(async e=>{var t,s;if("video"!==D||!e.query||(null==(t=e.fileAttachmentIds)?void 0:t.length))if((null==(s=e.fileAttachmentIds)?void 0:s.length)&&"string"==typeof e.fileAttachmentIds[0]){let t=await S({assetId:e.fileAttachmentIds[0]}),i="".concat(c.ASSET_SERVER_URL,"/").concat(t.key);await C(i,t.mimeType)}else a&&d({page:"imagine"}),i(e.query||"");else{let t=await b(an.GrokApiMediaPostType.MediaPostTypeVideo,e.query);j(t.id).catch(e=>{(0,h.logError)("imagine-query-bar:like",e)}),d({page:"imagine-post",postId:t.id}),N(t.id,void 0,"custom","imagine-query-bar",void 0,e.query).catch(e=>{(0,h.logError)("imagine-query-bar:generateVideoForImage",e)})}return!0},[a,i,S,C,d,c,D,b,j,N]),U=(0,w.useCallback)(()=>{M(!0)},[]);return(0,w.useEffect)(()=>{E&&ar.useMediaStore.getState().connectWebSocket()},[E]),(0,t.jsxs)("div",{className:"relative w-full",children:[n,o.ENABLE_IMAGINE_QUERY_BAR_V2&&(0,t.jsx)("div",{className:"absolute left-0 bottom-0 w-full p-3 pointer-events-none z-10",children:(0,t.jsxs)("div",{className:"pointer-events-auto flex flex-row items-end",children:[(0,t.jsx)("div",{className:(0,f.cn)("shrink-0",m?"w-12":"w-16"),children:s&&(0,t.jsx)(R.ButtonWithTooltip,{className:"h-full flex items-start",tooltipContent:r("imagine-favorites-button-label","Favorites"),variant:"none",size:"md",shape:"rectangle",onClick:()=>d({page:"imagine-favorites"}),children:(0,t.jsx)(aC,{sizePx:m?42:50})})}),(0,t.jsx)("div",{className:"flex-1 min-w-0",children:(0,t.jsx)(ox,{showFavorites:s,navigateOnQuery:a,videoControlProps:O,onQuery:V,onChange:U,disabled:F.isImportingMedia})}),(0,t.jsx)("div",{className:(0,f.cn)("shrink-0",m?"w-12":"w-16")})]})})]})}ox.displayName="ImagineQueryBarV2";let ov=(0,rJ.default)(()=>e.A(891650).then(e=>e.FilesPageContent),{loadableGenerated:{modules:[314298]}}),oy=(0,rJ.default)(()=>e.A(82203),{loadableGenerated:{modules:[787599]}});function ob(){(function(){let{route:e,push:t}=(0,x.useRouting)(),{user:i}=(0,r.useSession)();(0,w.useEffect)(()=>t$.useChatPageStore.subscribe((i,s)=>{if(!i.conversationId||i.conversationId===s.conversationId||"chat"===e.page&&e.conversationId!==i.conversationId||"main"!==e.page)return;let a=eo.useSettingsStore.getState().isIncognito;t({page:"chat",conversationId:a?null:i.conversationId,temporary:a})}),[t,e,i])})(),function(){let{route:e}=(0,x.useRouting)();(0,w.useEffect)(()=>{let{conversationMode:t,voiceConnectionStatus:i,exitVoiceMode:s}=t$.useChatPageStore.getState();"voice"!==t||"disconnecting"===i||["main","chat"].includes(e.page)||s("navigation").catch(e=>(0,h.logError)("page:handleVoiceModeExit",e))},[e.page])}(),(0,U.useRoutingSlugComponent)();let{ENABLE_TEMPLATES:e}=(0,u.useFeatureFlags)(),{data:{enableImagine:i}={}}=(0,tB.useFeatureControls)(),{data:{disablePersonalWorkspaces:s=!1}={}}=(0,tB.useOrganizationControls)(),a=(0,x.useRouting)(),n=a.route,{teams:o,currentTeam:l,switchTeam:d}=(0,ed.useEnterprise)(),c=(0,er.useIsActiveGrokBusinessSession)();if((0,w.useEffect)(()=>{let e=(0,x.getCanonicalUrl)(n,window.location.origin),t=document.querySelector("head link[rel='canonical']");return t||((t=document.createElement("link")).rel="canonical",document.head.appendChild(t)),t.href=e,()=>{let e=document.querySelector("head link[rel='canonical']");e&&document.head.removeChild(e)}},[n]),s&&!(null==l?void 0:l.teamId)){var m;let e=null==o||null==(m=o[0])?void 0:m.teamId;if(!e)return(0,t.jsx)(nZ,{});d({teamId:e,router:a})}switch(n.page){case"main":return(0,t.jsx)(iV,{},"main");case"chat":return(0,t.jsx)(iV,{},"chat");case"history":return(0,t.jsx)(i4,{},"history");case"highlights":return(0,t.jsx)(i9.default,{},"highlights");case"trends":return(0,t.jsx)(i9.default,{},"trends");case"workspace":return(0,t.jsx)(rQ.WorkspacePageContent,{workspaceId:n.workspaceId});case"workspaces":return(0,t.jsx)(rX.WorkspacesPageContent,{});case"files":return(0,t.jsx)(ov,{});case"tasks":return(0,t.jsx)(oy,{});case"images":case"finance":case"unknown":default:return(0,t.jsx)(n$.default,{});case"plans":return(0,t.jsx)(rH,{});case"faq":return(0,t.jsx)(rU,{});case"changelog":return(0,t.jsx)(rA,{});case"share-links":return(0,t.jsx)(rY,{});case"deleted-conversations":return(0,t.jsx)(rF,{});case"imagine":case"imagine-favorites":case"imagine-more":case"imagine-post":if("imagine"===n.page&&!i)return(0,t.jsx)(i8,{});return(0,t.jsx)(of,{children:"imagine-post"===n.page?(0,t.jsx)(nP,{}):(0,t.jsx)(a$,{variant:"imagine-more"===n.page?"more":"imagine-favorites"===n.page?"favorites":"default"})});case"imagine-carpet":return(0,t.jsx)(s1,{});case"clear-cache":return(0,t.jsx)(i3.ClearCachePage,{});case"templates":if((c||o.length)&&e)return(0,t.jsx)(rC,{});return(0,t.jsx)(n$.default,{});case"code":return null}}}]);

//# sourceMappingURL=dc8f0714990c4e7a.js.map
//# debugId=8a936c94-3ad1-54c3-b83a-3dd975932e5d
