
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="4e1b6f3d-352a-5ae5-ba8d-4f3546e08a52")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,398459,112089,e=>{"use strict";e.s(["HighlightsSection",()=>F,"HighlightsSectionSimple",()=>G,"HighlightsStoryRow",()=>O],398459);var t=e.i(247276),s=e.i(824027),i=e.i(981176),l=e.i(186679);e.i(685846);var a=e.i(415860),r=e.i(559326),o=e.i(417950),n=e.i(296451),c=e.i(679322),d=e.i(19945),h=e.i(883440),u=e.i(946032),g=e.i(235289);e.i(916390);var m=e.i(572848),x=e.i(9885),p=e.i(763578),f=e.i(443696),y=e.i(410289),v=e.i(723008),j=e.i(50636),S=e.i(920958),b=e.i(486492),I=e.i(165275),k=e.i(724499),N=e.i(211959),w=e.i(133735),C=e.i(555309),_=e.i(421593);e.i(18545);var H=e.i(116212),A=e.i(713216),L=e.i(676452);e.s(["useEngagingPosts",()=>M,"useLoadDiscussionPosts",()=>D,"useSourcePosts",()=>R],112089);var T=e.i(364778);e.i(298616);var E=e.i(111669),P=e.i(910503);function R(e,t){let s=(0,L.useHighlightsStore)(),i=(0,L.useHighlightsStore)(e=>e.accessDenied);return(0,P.useQuery)({queryKey:["highlights","source-posts",e,t],queryFn:async()=>{var i,l;if(!e)return[];let a=(null==(l=(await T.highlightsApi.highlightsGetSourcePosts({body:{storyIds:[e],source:t}})).storyPosts)||null==(i=l[0])?void 0:i.posts)||[];return s.setSourcePostsByStoryId(e,a),a},enabled:!!e&&!i,staleTime:3e5,gcTime:6e5,retry:!1,initialData:()=>e?s.getSourcePostsByStoryId(e):[]})}function M(e,t){let s=(0,L.useHighlightsStore)(e=>e.accessDenied);return(0,P.useQuery)({queryKey:["highlights","engaging-posts",e,t],queryFn:async()=>e&&(await T.highlightsApi.highlightsGetEngagingPosts({storyId:e,source:t})).engagingPosts||[],enabled:!!e&&!s,staleTime:3e5,gcTime:6e5,retry:!1})}function D(e,t){var s;let i=(0,L.useHighlightsStore)(e=>e.accessDenied),l=(0,E.useInfiniteQuery)({queryKey:["highlights","discussion-posts",e,t],queryFn:async s=>{let{pageParam:i}=s;if(!e)throw Error("Story ID is required");let l=await T.highlightsApi.highlightsGetDiscussionPosts({storyId:e,limit:20,cursor:i,source:t});return{discussionPosts:l.discussionPosts||[],nextCursor:l.nextCursor||void 0}},initialPageParam:void 0,getNextPageParam:e=>e.nextCursor,enabled:!!e&&!i,staleTime:3e5,gcTime:6e5,retry:!1});return{discussionPosts:(null==(s=l.data)?void 0:s.pages.flatMap(e=>e.discussionPosts))||[],isLoading:l.isLoading,error:l.error,hasMore:l.hasNextPage,loadMore:l.fetchNextPage,isFetchingNextPage:l.isFetchingNextPage}}let B={scale:[1,1.2,.9,1.1,1],rotate:[0,-10,10,-5,0]};function U(e){let{type:s,isActive:i,onClick:l,tooltipLabel:a}=e,[r,o]=(0,_.useState)(!1),n=(0,_.useCallback)(e=>{i||o(!0),l(e)},[l,i]),c=(0,_.useCallback)(()=>{o(!1)},[]),u="like"===s?h.ThumbsUpIcon:d.ThumbsDownIcon;return(0,t.jsx)(f.ButtonWithTooltip,{variant:"tertiary",size:"sm",shape:"circle",onClick:n,className:(0,N.cn)("transition-colors",i&&"text-primary"),tooltipContent:a,tooltipContentProps:{side:"top",sideOffset:4},children:(0,t.jsx)(C.motion.div,{animate:r?B:{},transition:{duration:.4,ease:"easeInOut"},onAnimationComplete:c,children:(0,t.jsx)(u,{className:"size-4",filled:i})})})}function z(){let{t:e}=(0,H.useTranslation)("chat"),s=(0,S.useLogEvent)(),[i,l]=(0,_.useState)(!1),a=(0,_.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),i)return;let t=window.location.href;navigator.clipboard.writeText(t).then(()=>{l(!0),s("highlights_share_link_copied",t,{location:"highlights-story-card:ShareLinkButton:handleCopy"})}).catch(e=>{(0,b.logError)("highlights-story-card:ShareLinkButton:handleCopy",e)})},[s,i]);return(0,_.useEffect)(()=>{if(i){let e=setTimeout(()=>{l(!1)},2e3);return()=>clearTimeout(e)}},[i]),(0,t.jsx)(f.ButtonWithTooltip,{variant:"tertiary",size:"sm",shape:"circle",onClick:a,disabled:i,className:(0,N.cn)(i&&"text-primary"),tooltipContent:i?e("highlights.link-copied","Link copied!"):e("highlights.share-this-story","Share this story"),tooltipContentProps:{side:"top",sideOffset:4},tooltipProps:{open:!!i||void 0},children:(0,t.jsx)(w.AnimatePresence,{mode:"wait",initial:!1,children:(0,t.jsx)(C.motion.div,{initial:i?{opacity:1,scale:1}:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.15*!i},children:i?(0,t.jsx)(r.Check,{className:"size-4"}):(0,t.jsx)(c.LinkIcon,{className:"size-4"})},i?"check":"link")})})}function O(e){var s,i,l;let{story:r,onClick:o,borderless:c,mode:d="embedded",onImageError:h}=e,[g,p]=(0,_.useState)(!1),f=(0,S.useLogEvent)(),{t:y}=(0,H.useTranslation)("chat"),{user:v}=(0,m.useSession)(),w=(0,L.useHighlightsStore)(e=>e.storyReactions),A=(0,j.useFeatureFlags)(),{data:T=[]}=R("minimal"!==d?r.storyId:void 0,r.source),E=w[r.storyId||""],P=r.updateTime?(0,x.formatCompactTime)(r.updateTime):void 0,M=(0,_.useMemo)(()=>T.reduce((e,t)=>{var s;return e+((null==(s=t.publicMetrics)?void 0:s.viewCount)||t.viewCount||0)},0),[T]),D=(0,_.useMemo)(()=>T.reduce((e,t)=>{var s;return e+((null==(s=t.publicMetrics)?void 0:s.likeCount)||0)},0),[T]),B=(0,_.useMemo)(()=>{let e=new Map;return T.forEach(t=>{if(t.username){var s;let i=(null==(s=t.publicMetrics)?void 0:s.likeCount)||0,l=e.get(t.username);l?i>l.maxLikeCount&&(l.maxLikeCount=i,l.postId=t.postId,!l.verifiedType&&t.verifiedType&&(l.verifiedType=t.verifiedType)):e.set(t.username,{name:t.name||"",username:t.username||"",profileImageUrl:t.profileImageUrl,verifiedType:t.verifiedType,maxLikeCount:i,postId:t.postId})}}),Array.from(e.values()).sort((e,t)=>t.maxLikeCount-e.maxLikeCount)},[T]),z=(0,_.useCallback)(e=>{if(!r.storyId)return void(0,b.logError)("highlights-story-card:HighlightsStoryRow:handleClick","storyId is undefined",{story:JSON.stringify(r)});f("highlights_story_tapped",r.storyId,{location:"highlights-story-card:HighlightsStoryRow:click",storyId:r.storyId,title:r.title||""}),e.metaKey||e.ctrlKey||(e.preventDefault(),o(r.storyId))},[r,f,o]),O=(0,_.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!r.storyId)return;let t=L.useHighlightsStore.getState();f("highlight_story_liked",r.storyId,{location:"highlights-story-card:HighlightsStoryRow:handleLike",storyId:r.storyId,title:r.title||"",wasAlreadyLiked:String("liked"===E)}),t.likeStory(r.storyId)},[r.storyId,r.title,E,f]),F=(0,_.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!r.storyId)return;let t=L.useHighlightsStore.getState();f("highlight_story_disliked",r.storyId,{location:"highlights-story-card:HighlightsStoryRow:handleDislike",storyId:r.storyId,title:r.title||"",wasAlreadyDisliked:String("disliked"===E)}),t.dislikeStory(r.storyId)},[r.storyId,r.title,E,f]),G=(0,_.useMemo)(()=>B.slice(0,3),[B]),X="minimal"===d,V="HIGHLIGHTS_SOURCE_PHOENIX"===r.source,W=A.HIGHLIGHTS_ONLY_TEXT,q=(null==v||null==(s=v.email)?void 0:s.endsWith("@x.ai"))||(null==v||null==(i=v.email)?void 0:i.endsWith("@teachx.ai")),Q=V&&q;return(0,t.jsx)(k.Link,{route:V?{page:"trends",storyId:r.storyId}:{page:"highlights",storyId:r.storyId},className:(0,N.cn)("w-full",X?["block rounded-xl transition-colors","group cursor-pointer"]:["grid gap-y-2 gap-x-4",W?"grid-cols-[1fr] grid-rows-[auto]":"grid-cols-[1fr_fit-content(200px)] grid-rows-[auto_24px]","overflow-hidden",c?"bg-transparent rounded-2xl":"border rounded-3xl bg-surface-l1","hover:bg-surface-l4-hover dark:hover:bg-surface-l2","ps-4 pe-3 py-3",!W&&"min-h-[90px]","text-start"]),onClick:z,children:X?(0,t.jsxs)(C.motion.div,{className:(0,N.cn)("flex gap-4 items-center px-3 py-4","rounded-xl","hover:bg-surface-l1-hover/80 hover:backdrop-blur-sm hover:shadow-lg"),variants:{rest:{scale:1,zIndex:1},hover:{scale:1.08,zIndex:10}},initial:"rest",whileHover:"hover",transition:{duration:.1,ease:"easeOut"},children:[!W&&(0,t.jsx)("div",{className:"shrink-0 w-[96px] h-[64px] rounded-xl overflow-hidden",children:r.thumbnailImageUrl&&!g?(0,t.jsx)("img",{src:r.thumbnailImageUrl,alt:r.title||y("highlights-story-media","Story media"),className:"w-full h-full object-cover",onError:()=>{p(!0),h&&r.storyId&&h(r.storyId)}}):(0,t.jsx)("div",{className:(0,N.cn)("w-full h-full bg-surface-l2 flex items-start p-2 overflow-hidden"),children:(0,t.jsx)("span",{className:"uppercase font-mono text-[10px] text-secondary leading-tight",children:r.summary})})}),(0,t.jsxs)("div",{className:"flex flex-col flex-1 min-w-0",children:[(0,t.jsx)("div",{className:"space-y-1",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,t.jsx)("h3",{className:"text-primary font-normal line-clamp-2 leading-tight m-0",children:r.title}),W&&Q&&(0,t.jsx)(u.XLogoIcon,{className:"size-3.5 text-secondary shrink-0 mt-0.5"})]})}),!W&&P&&(0,t.jsx)("div",{className:"flex flex-row gap-2 items-center mt-2",children:(0,t.jsx)("div",{className:"text-secondary text-sm",children:y("highlights.timestamp-ago","{{timestamp}} ago",{timestamp:P})})})]})]}):(0,t.jsx)("div",{className:"flex gap-4 flex-1",children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1.5 overflow-hidden col-span-1 row-span-1",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,t.jsx)("h3",{className:"text-primary font-semibold text-lg line-clamp-2 leading-tight m-0",children:r.title}),W&&Q&&(0,t.jsx)(u.XLogoIcon,{className:"size-3.5 text-secondary shrink-0 mt-1"})]}),!W&&("authors"===d?(0,t.jsxs)(t.Fragment,{children:[r.summary&&(0,t.jsx)("p",{className:"text-secondary text-sm line-clamp-2 leading-snug m-0 mt-1",children:r.summary}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-auto overflow-hidden",children:[(0,t.jsx)("div",{className:"flex gap-1.5 flex-nowrap overflow-hidden flex-shrink min-w-0",children:G.map((e,s)=>(e.name,e.username,e.profileImageUrl,e.verifiedType,e.verifiedType,(0,t.jsxs)("div",{className:(0,N.cn)("flex items-center gap-1.5","ps-1 pe-2 py-1 rounded-full","bg-surface-l2 hover:bg-surface-l3","border border-border-l1","cursor-pointer transition-all","flex-shrink-0"),onClick:t=>{t.stopPropagation(),t.preventDefault(),e.postId&&(f("highlight_author_pill_clicked",e.postId,{location:"highlights-story-card:HighlightsStoryRow:authorPill",storyId:r.storyId||"",username:e.username,postId:e.postId}),window.open("https://x.com/".concat(e.username,"/status/").concat(e.postId),"_blank"))},children:[(0,t.jsx)("div",{className:"relative size-5 rounded-full bg-surface-l3 overflow-hidden flex-shrink-0",children:e.profileImageUrl?(0,t.jsx)("img",{src:e.profileImageUrl,alt:e.name,className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:(0,N.cn)("w-full h-full flex items-center justify-center","bg-gradient-to-br from-purple-500/30 via-blue-500/30 to-pink-500/30","text-primary text-[10px] font-medium"),children:e.name.charAt(0).toUpperCase()})}),(0,t.jsxs)("span",{className:"text-xs text-primary font-medium",children:["@",e.username]})]},e.username)))}),B.length>G.length&&(0,t.jsx)("div",{className:(0,N.cn)("flex items-center gap-1.5 flex-shrink-0"),children:(0,t.jsxs)("span",{className:"text-xs text-secondary font-medium whitespace-nowrap",children:["+",y("highlights-more-authors",{defaultValue_one:"{{count}} more",defaultValue_other:"{{count}} more",count:B.length-G.length})]})})]})]}):(0,t.jsxs)(t.Fragment,{children:[B.length>0&&(0,t.jsxs)("div",{className:"flex items-center gap-1 text-secondary text-sm mt-1",children:[(0,t.jsxs)("span",{children:["@",null==(l=B[0])?void 0:l.username]}),B.length>1&&(0,t.jsxs)("span",{className:"text-xs",children:["+",y("highlights-more-authors",{defaultValue_one:"{{count}} more",defaultValue_other:"{{count}} more",count:B.length-1})]})]}),r.summary&&(0,t.jsx)("p",{className:"text-secondary text-sm line-clamp-2 leading-snug m-0",children:r.summary})]}))]}),!W&&(0,t.jsxs)("div",{className:"flex items-center h-min gap-1 text-secondary self-end text-xs col-span-1 row-span-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(U,{type:"like",isActive:"liked"===E,onClick:O,tooltipLabel:y("highlights-like-tooltip","Like")}),(0,t.jsx)(U,{type:"dislike",isActive:"disliked"===E,onClick:F,tooltipLabel:y("highlights-dislike-tooltip","Dislike")}),Q&&(0,t.jsx)(u.XLogoIcon,{className:"size-3.5 text-secondary"})]}),M>0&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(a.ChartBar,{className:"size-4 scale-x-[-1] rotate-90"}),(0,t.jsx)("span",{children:(0,I.formatNumber)(M)})]}),D>0&&(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(n.HeartIcon,{className:"size-4"}),(0,t.jsx)("span",{children:(0,I.formatNumber)(D)})]}),P&&(0,t.jsx)("span",{children:y("highlights.timestamp-ago","{{timestamp}} ago",{timestamp:P})})]})]})})})}function F(e){var a,r,o,n,c,d;let{className:h,story:u}=e,{t:m}=(0,H.useTranslation)("chat"),f=(0,S.useLogEvent)(),j=(0,_.useRef)(null),k=(0,_.useRef)(!1),w=(0,L.useHighlightsStore)(e=>e.storyReactions),C="HIGHLIGHTS_SOURCE_PHOENIX"===u.source,{discussionPosts:T,isLoading:E,hasMore:P,loadMore:B}=D(u.storyId,u.source),O=(0,_.useRef)(null),F=w[u.storyId||""],{data:G=[],isLoading:X}=R(u.storyId,u.source),{data:V=[]}=M(u.storyId,u.source),W=(0,_.useMemo)(()=>{var e,t;let s=new Set;return null==(t=u.article)||null==(e=t.cardAttachments)||e.forEach(e=>{try{let t=JSON.parse(e);"x_posts_card"===t.cardType&&Array.isArray(t.post_ids)&&t.post_ids.forEach(e=>s.add(e))}catch(e){}}),s},[null==(a=u.article)?void 0:a.cardAttachments]),q=(0,_.useMemo)(()=>[...G].filter(e=>!e.postId||!W.has(e.postId)).sort((e,t)=>{var s,i;return((null==(s=t.publicMetrics)?void 0:s.likeCount)||0)-((null==(i=e.publicMetrics)?void 0:i.likeCount)||0)}),[G,W]),Q=(0,_.useRef)(null),[K,Y]=(0,_.useState)(!0),[J,Z]=(0,_.useState)(!1),[$,ee]=(0,_.useState)(!1),[et,es]=(0,_.useState)(!1);(0,_.useEffect)(()=>{Q.current&&q.length>0&&Z(Q.current.scrollHeight>392)},[q]);let ei=u.updateTime?(0,x.formatCompactTime)(u.updateTime):void 0,el=(0,_.useMemo)(()=>{let e=new Set(G.map(e=>e.postId).filter(Boolean));return V.filter(t=>!e.has(t.postId))},[V,G]),ea=(0,_.useMemo)(()=>{let e=[...el,...T],t=new Set;return e.filter(e=>!(!e.postId||t.has(e.postId))&&(t.add(e.postId),!0))},[el,T]),er=(0,_.useCallback)(e=>{O.current&&O.current.disconnect(),e&&(O.current=new IntersectionObserver(e=>{let[t]=e;t&&t.isIntersecting&&P&&!E&&B().catch((0,b.createLogError)("highlights-story-card:loadMoreDiscussionPosts"))},{threshold:.1,rootMargin:"0px 0px 200px 0px"}),O.current.observe(e))},[P,E,B]);(0,_.useEffect)(()=>()=>{O.current&&O.current.disconnect()},[]);let eo=u.coverImageUrl;(0,_.useEffect)(()=>{ee(!1)},[eo]);let en=(0,_.useMemo)(()=>G.reduce((e,t)=>{var s;return e+((null==(s=t.publicMetrics)?void 0:s.viewCount)||t.viewCount||0)},0),[G]);(0,_.useEffect)(()=>{let e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&!k.current&&(k.current=!0,f("highlights_story_impression",u.storyId||"",{location:"highlights-section:HighlightsSection:impression",storyId:u.storyId||"",title:u.title||""}))})},{threshold:0});return j.current&&e.observe(j.current),()=>{e.disconnect()}},[u.storyId,u.title,f]);let ec=(0,_.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!u.storyId)return;let t=L.useHighlightsStore.getState();f("highlight_story_liked",u.storyId,{location:"highlights-section:HighlightsSection:handleLike",storyId:u.storyId,title:u.title||"",wasAlreadyLiked:String("liked"===F)}),t.likeStory(u.storyId)},[u.storyId,u.title,F,f]),ed=(0,_.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!u.storyId)return;let t=L.useHighlightsStore.getState();f("highlight_story_disliked",u.storyId,{location:"highlights-section:HighlightsSection:handleDislike",storyId:u.storyId,title:u.title||"",wasAlreadyDisliked:String("disliked"===F)}),t.dislikeStory(u.storyId)},[u.storyId,u.title,F,f]),eh=(0,_.useCallback)(e=>{f("highlights_post_link_clicked",e,{location:"highlights-section:HighlightsSection:handlePostClick",storyId:u.storyId||"",postId:e})},[u.storyId,f]);return(0,t.jsxs)("section",{ref:j,id:u.storyId||void 0,className:(0,N.cn)("w-full scroll-mt-4",g.QUERY_BAR_MAX_WIDTH_CLASS,h),children:[(eo||X)&&!et&&(0,t.jsxs)("div",{className:"relative w-full mb-4 rounded-2xl overflow-hidden",children:[X&&!eo?(0,t.jsx)(l.DelayedRender,{children:(0,t.jsx)(y.Skeleton,{className:"w-full aspect-video"})}):null,eo&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("img",{src:eo,alt:"","aria-hidden":"true",className:(0,N.cn)("absolute inset-0 w-full h-full object-cover blur-3xl scale-110 opacity-60",!$&&"invisible")}),(0,t.jsx)("img",{src:eo,alt:u.title||m("highlights-story-image","Story image"),className:(0,N.cn)("relative w-full h-auto max-h-[500px] object-contain",!$&&"invisible absolute"),onLoad:()=>ee(!0),onError:()=>es(!0)})]})]}),(0,t.jsx)("h2",{className:"text-primary font-semibold text-2xl mb-2 m-0",children:u.title}),el.length>0&&(0,t.jsx)("div",{className:"mb-4 space-y-3",children:u.summary&&(0,t.jsx)("p",{className:"mb-4 m-0",children:u.summary})}),!el.length&&u.summary&&(0,t.jsx)("p",{className:"mb-4 m-0",children:u.summary}),(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(U,{type:"like",isActive:"liked"===F,onClick:ec,tooltipLabel:m("highlights.love-this","Love this")}),(0,t.jsx)(U,{type:"dislike",isActive:"disliked"===F,onClick:ed,tooltipLabel:m("highlights.not-a-fan","Not a fan")}),(0,t.jsx)(z,{})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1 text-secondary text-sm",children:[en>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:m("highlights-views",{count:en,formattedCount:(0,I.formatNumber)(en),defaultValue_one:"{{formattedCount}} view",defaultValue_other:"{{formattedCount}} views"})}),(0,t.jsx)("span",{children:"Â·"})]}),ei&&(0,t.jsx)("span",{children:m("highlights.timestamp-ago","{{timestamp}} ago",{timestamp:ei})})]})]}),(C?u.grokAnalysis:null==(r=u.article)?void 0:r.content)&&(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(A.MessageBubble,{isUser:!1,children:(0,t.jsx)(s.MemoizedMarkdown,{sender:"assistant",shouldRenderHtml:!0,webSearchResults:null==(o=u.article)?void 0:o.webResults,xposts:null==(n=u.article)?void 0:n.xPosts,cardAttachmentsJson:null==(c=u.article)?void 0:c.cardAttachments,children:C?u.grokAnalysis||"":(null==(d=u.article)?void 0:d.content)||""})})}),q.length>0&&(0,t.jsxs)("div",{className:(0,N.cn)("mb-8",K&&J&&"max-h-96 overflow-hidden relative"),ref:Q,children:[(0,t.jsx)("div",{className:"flex flex-col overflow-hidden items-center",children:(0,t.jsx)(i.XPostFeed,{xPosts:q,mode:"card",disabled:K,onPostClick:e=>{K?Y(!1):eh(e)}})}),K&&J&&(0,t.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-surface-base to-transparent flex items-end justify-center pb-2",children:(0,t.jsx)(p.Button,{variant:"secondary",size:"sm",onClick:()=>Y(!1),children:m("highlights.show-more","Show more")})})]}),ea.length>0&&(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h3",{className:"text-primary font-semibold text-lg mb-4",children:m("highlights-what-the-world-is-saying","What the world is saying")}),(0,t.jsxs)("div",{className:"flex flex-col overflow-hidden",children:[(0,t.jsx)(i.XPostFeed,{xPosts:ea,mode:"card",onPostClick:e=>eh(e)}),(0,t.jsx)("div",{ref:er,className:"w-full h-1"}),E&&(0,t.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,t.jsx)(v.Spinner,{size:"sm"})})]})]})]})}function G(e){var a,r,o,n,c,d,h,u;let{className:m,story:p,isArticleLoading:f=!1}=e,{t:v}=(0,H.useTranslation)("chat"),j=(0,S.useLogEvent)(),b=(0,_.useRef)(null),I=(0,_.useRef)(!1),k=(0,L.useHighlightsStore)(e=>e.storyReactions),w="HIGHLIGHTS_SOURCE_PHOENIX"===p.source,C=k[p.storyId||""],{data:T=[],isLoading:E}=R(p.storyId,p.source),P=(0,_.useMemo)(()=>{var e,t;let s=new Set;return null==(t=p.article)||null==(e=t.cardAttachments)||e.forEach(e=>{try{let t=JSON.parse(e);"x_posts_card"===t.cardType&&Array.isArray(t.post_ids)&&t.post_ids.forEach(e=>s.add(e))}catch(e){}}),s},[null==(a=p.article)?void 0:a.cardAttachments]),M=(0,_.useMemo)(()=>[...T].filter(e=>!e.postId||!P.has(e.postId)).sort((e,t)=>{var s,i;return((null==(s=t.publicMetrics)?void 0:s.likeCount)||0)-((null==(i=e.publicMetrics)?void 0:i.likeCount)||0)}),[T,P]),[D,B]=(0,_.useState)(!1),[O,F]=(0,_.useState)(!1),G=p.updateTime?(0,x.formatCompactTime)(p.updateTime):void 0,V=p.coverImageUrl;(0,_.useEffect)(()=>{B(!1)},[V]),(0,_.useEffect)(()=>{let e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&!I.current&&(I.current=!0,j("highlights_story_impression",p.storyId||"",{location:"highlights-section:HighlightsSectionV2:impression",storyId:p.storyId||"",title:p.title||""}))})},{threshold:0});return b.current&&e.observe(b.current),()=>{e.disconnect()}},[p.storyId,p.title,j]);let W=(0,_.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!p.storyId)return;let t=L.useHighlightsStore.getState();j("highlight_story_liked",p.storyId,{location:"highlights-section:HighlightsSectionV2:handleLike",storyId:p.storyId,title:p.title||"",wasAlreadyLiked:String("liked"===C)}),t.likeStory(p.storyId)},[p.storyId,p.title,C,j]),q=(0,_.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!p.storyId)return;let t=L.useHighlightsStore.getState();j("highlight_story_disliked",p.storyId,{location:"highlights-section:HighlightsSectionV2:handleDislike",storyId:p.storyId,title:p.title||"",wasAlreadyDisliked:String("disliked"===C)}),t.dislikeStory(p.storyId)},[p.storyId,p.title,C,j]),Q=(0,_.useCallback)(e=>{j("highlights_post_link_clicked",e,{location:"highlights-section:HighlightsSectionV2:handlePostClick",storyId:p.storyId||"",postId:e})},[p.storyId,j]);return(0,t.jsxs)("section",{ref:b,id:p.storyId||void 0,className:(0,N.cn)("w-full scroll-mt-4",g.QUERY_BAR_MAX_WIDTH_CLASS,m),children:[(0,t.jsx)("h2",{className:"text-primary font-semibold text-3xl mb-2 m-0",children:p.title}),p.summary&&(0,t.jsx)("p",{className:"mb-4 m-0",children:p.summary}),(V||E)&&!O&&(0,t.jsxs)("div",{className:"relative w-full mb-4 rounded-2xl overflow-hidden",children:[E&&!V?(0,t.jsx)(l.DelayedRender,{children:(0,t.jsx)(y.Skeleton,{className:"w-full aspect-video"})}):null,V&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("img",{src:V,alt:"","aria-hidden":"true",className:(0,N.cn)("absolute inset-0 w-full h-full object-cover blur-3xl scale-110 opacity-60",!D&&"invisible")}),(0,t.jsx)("img",{src:V,alt:p.title||v("highlights-story-image","Story image"),className:(0,N.cn)("relative w-full h-auto max-h-[500px] object-contain",!D&&"invisible absolute"),onLoad:()=>B(!0),onError:()=>F(!0)})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsx)("div",{className:"flex items-center gap-1 text-secondary text-sm",children:G&&(0,t.jsx)("span",{children:v("highlights.timestamp-ago","{{timestamp}} ago",{timestamp:G})})}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(U,{type:"like",isActive:"liked"===C,onClick:W,tooltipLabel:v("highlights.love-this","Love this")}),(0,t.jsx)(U,{type:"dislike",isActive:"disliked"===C,onClick:q,tooltipLabel:v("highlights.not-a-fan","Not a fan")}),(0,t.jsx)(z,{})]})]}),f?(0,t.jsx)(l.DelayedRender,{children:(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(A.MessageBubble,{isUser:!1,children:(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(y.Skeleton,{className:"h-5 w-full"}),(0,t.jsx)(y.Skeleton,{className:"h-5 w-full"}),(0,t.jsx)(y.Skeleton,{className:"h-5 w-4/5"}),(0,t.jsx)(y.Skeleton,{className:"h-5 w-full"}),(0,t.jsx)(y.Skeleton,{className:"h-5 w-3/4"}),(0,t.jsx)(y.Skeleton,{className:"h-5 w-full"}),(0,t.jsx)(y.Skeleton,{className:"h-5 w-full"}),(0,t.jsx)(y.Skeleton,{className:"h-5 w-2/3"}),(0,t.jsx)(y.Skeleton,{className:"h-5 w-full"}),(0,t.jsx)(y.Skeleton,{className:"h-5 w-4/5"}),(0,t.jsx)(y.Skeleton,{className:"h-5 w-full"}),(0,t.jsx)(y.Skeleton,{className:"h-5 w-3/4"})]})})})}):(null==(r=p.article)?void 0:r.content)||p.grokAnalysis?(0,t.jsx)("div",{className:"mb-4",children:(0,t.jsx)(A.MessageBubble,{isUser:!1,children:(0,t.jsx)(s.MemoizedMarkdown,{sender:"assistant",shouldRenderHtml:!0,webSearchResults:null==(o=p.article)?void 0:o.webResults,xposts:null==(n=p.article)?void 0:n.xPosts,cardAttachmentsJson:null==(c=p.article)?void 0:c.cardAttachments,children:(null==(d=p.article)?void 0:d.content)||p.grokAnalysis||""})})}):null,M.length>0&&(0,t.jsxs)("div",{className:"flex flex-col gap-4 items-center",children:[!w&&(null==(h=p.article)?void 0:h.content)&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("hr",{className:"w-full my-2 border-border-l1"}),(0,t.jsx)("h3",{className:"text-xl font-bold",children:v("highlights.more-on-this-story","More on this story")})]}),(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsx)("div",{className:"flex flex-col overflow-hidden items-center",children:(0,t.jsx)(i.XPostFeed,{xPosts:M,mode:"card",onPostClick:e=>Q(e)})})})]}),(null==(u=p.article)?void 0:u.followUpSuggestions)&&p.article.followUpSuggestions.length>0&&(0,t.jsx)(X,{followups:p.article.followUpSuggestions,storyId:p.storyId})]})}function X(e){let{followups:s,storyId:i}=e,{t:l}=(0,H.useTranslation)("chat"),a=(0,S.useLogEvent)(),r=(0,_.useCallback)((e,t)=>{a("highlights_followup_clicked",String(t),{location:"highlights-story-card:HighlightsFollowups:click",storyId:i||"",label:e.label||""}),window.dispatchEvent(new CustomEvent("highlightFollowupClicked",{detail:{followup:e,storyId:i}}))},[a,i]);return(0,t.jsxs)("div",{className:"mt-8 mb-6",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-secondary mb-3",children:l("highlights.followups-title","Related questions")}),(0,t.jsx)("div",{className:"flex flex-col gap-1 items-start w-full",children:s.map((e,s)=>(0,t.jsxs)(p.Button,{variant:"ghost",className:"-ms-4",onClick:()=>r(e,s),children:[(0,t.jsx)(o.CornerDownRight,{size:16,className:"text-secondary opacity-60"}),(0,t.jsx)("span",{className:"line-clamp-1",children:e.label})]},"followup-".concat(s)))})]})}},796066,e=>{"use strict";e.s(["useLoadHighlights",()=>l]);var t=e.i(421593),s=e.i(572848),i=e.i(676452);function l(){let e=(0,s.useSession)().user,l=(0,i.useHighlightsStore)(e=>e.isLoading),a=(0,i.useHighlightsStore)(e=>e.error),r=(0,i.useHighlightsStore)(e=>e.accessDenied);return(0,t.useEffect)(()=>{let t=i.useHighlightsStore.getState();t.accessDenied||t.stories.length>=10||t.isLoading||!e||t.fetchStories(10).catch(()=>{})},[e]),{isLoading:l,error:a,accessDenied:r}}},829735,844858,e=>{"use strict";e.s(["HighlightsAllStoriesPage",()=>G,"default",()=>F],829735);var t=e.i(247276),s=e.i(421593);e.i(18545);var i=e.i(116212),l=e.i(211959),a=e.i(486492),r=e.i(920958),o=e.i(235289),n=e.i(676452),c=e.i(796066),d=e.i(398459),h=e.i(724499),u=e.i(258722);e.i(685846);var g=e.i(680491),m=e.i(763578),x=e.i(380619),p=e.i(246429),f=e.i(389052),y=e.i(892621),v=e.i(186679);e.s(["ArrowLeft",()=>j.default],844858);var j=e.i(935622),j=j,S=e.i(402299),b=e.i(383274),I=e.i(572848),k=e.i(443696),N=e.i(410289),w=e.i(938270),C=e.i(713087),_=e.i(50636),H=e.i(489843),A=e.i(328788),L=e.i(243634),T=e.i(157695),E=e.i(230433),P=e.i(805546),R=e.i(470753),M=e.i(712548),D=e.i(189394),B=e.i(112089),U=e.i(19862);function z(){var e;let{t:c}=(0,i.useTranslation)("chat"),g=(0,M.useParams)(),{route:m}=(0,h.useRouting)(),z=(0,n.useHighlightsStore)(e=>e.accessDenied),O=("highlights"===m.page||"trends"===m.page)&&m.storyId||(null==g?void 0:g.id),F="trends"===m.page?"HIGHLIGHTS_SOURCE_PHOENIX":"HIGHLIGHTS_SOURCE_HIGHLIGHTS",G="HIGHLIGHTS_SOURCE_HIGHLIGHTS"===F,X=(0,r.useLogEvent)(),{user:V}=(0,I.useSession)(),W=(0,b.useMaybeRefreshAnonSession)(),{signInWithReturnTo:q}=(0,C.useGrokRouter)(),Q=(0,L.useForceSignInModels)(),K=(0,_.useFeatureFlags)(),Y=(0,R.useSettingsStore)(e=>e.isIncognito),J=(0,A.useMobileSize)(),Z=(0,A.useMobileSize)(800),{bestSubscription:$}=(0,E.useSubscriptions)(),ee=(0,P.useIsFirstTimeUser)(),et=(0,n.useHighlightsStore)((0,s.useCallback)(e=>e.mergedStoryIds[O]||O,[O])),es=(0,n.useHighlightsStore)((0,s.useCallback)(e=>e.stories.find(e=>e.storyId===et),[et]));(0,s.useEffect)(()=>{if(et&&et!==O){let e="trends"===m.page?"/trends":"/highlights";window.history.replaceState(null,"","".concat(e,"/").concat(et))}},[et,O,m.page]);let ei=(0,n.useHighlightsStore)(e=>e.getStory),el=(0,s.useMemo)(()=>O?ei(O,F):void 0,[ei,O,F]),{isLoading:ea,isUninitialized:er}=(0,T.usePromise)(el),eo=(ea||er)&&!es,en=G&&(ea||er)&&!(null==es||null==(e=es.article)?void 0:e.content),{data:ec=[]}=(0,B.useSourcePosts)(O,F),{sessionStartTime:ed,conversationDepth:eh}=(0,y.useTimeToValueAnalytics)();(0,s.useEffect)(()=>{if(es){let e=Date.now();return X("highlight_story_page_view",O,{location:"highlight-story-page",storyId:O,title:es.title||""}),()=>{let t=Date.now()-e;X("highlight_story_read_time",O,{location:"highlight-story-page",storyId:O,title:es.title||"",timeSpentMs:String(t),timeSpentSeconds:String(Math.round(t/1e3))})}}},[es,O,X]);let eu=(0,s.useCallback)(e=>{let{query:t,fileAttachmentIds:s,toolOverrides:i,workspaceIds:l,persona:r,isIncognitoOverride:o,disableMemory:n,modelIdOverride:c}=e;if(!t||!t.trim()||!es)return Promise.resolve(!1);let d=p.useChatPageStore.getState(),h=R.useSettingsStore.getState(),g=u.useRoutingStore.getState();return!V&&Q.includes(d.activeModelId)?(X("sign_in","highlight-story-page",{location:"highlight-story-page:handleSend"}),q(t),Promise.resolve(!1)):W().then(()=>{var e;let u=(0,f.toAnalytics)({activeModelId:c||d.activeModelId,modelMode:c?"":void 0,query:t,fileAttachmentIds:s,location:"highlight-story-page",personalityId:h.userSettings.preferences.selectedSystemPromptId||"",personaId:"",sessionStartTime:ed,conversationDepth:eh,isMobile:J,bestSubscription:$,user:!!V,workspaceCount:(null==l?void 0:l.length)||0,toolOverrides:i,parentResponseId:"",isFirstTimeUser:ee}),m=(null==(e=es.article)?void 0:e.content)||es.grokAnalysis||"",x=(0,D.cleanMessage)(m),p=ec.map(e=>e.postId).filter(Boolean),y=[es.title&&"Story: ".concat(es.title),p.length>0&&"Source X Posts: ".concat(p.join(", ")),x&&"Article:\n".concat(x,"\n\n---"),t].filter(Boolean).join("\n\n");X("send_query","",u);let v=null!=o?o:Y,j={storyId:es.storyId||"",title:es.title,thumbnailImageUrl:es.thumbnailImageUrl||es.coverImageUrl,userQuery:t,fullMessage:y};return d.establishNewConversation({message:t,highlightsStory:j,fileAttachmentIds:s,toolOverrides:i,temporary:v,enableRetries:!0,ff:K,persona:r,disableMemory:n,onOptimisticConversation:()=>{g.push({page:"main"})}}).catch((0,a.createLogError)("highlight-story-page:establishNewConversation")).then(e=>!!e)})},[V,Q,W,X,q,ed,eh,J,$,ee,ec,es,Y,K]);(0,s.useEffect)(()=>{let e=e=>{let{followup:t}=e.detail,s=t.label;s&&eu({query:s}).catch(()=>{})};return window.addEventListener("highlightFollowupClicked",e),()=>{window.removeEventListener("highlightFollowupClicked",e)}},[eu]);let eg=(0,s.useCallback)(()=>{(0,u.useRoutingStore.getState().push)({page:"main"})},[]),em=(0,s.useCallback)(()=>{u.useRoutingStore.getState().requestMainPageReset(),u.useRoutingStore.getState().push({page:"main"})},[]);(0,H.useHotkeys)(w.KBD_NEW_CHAT,em,[em]);let ex=(0,s.useCallback)(()=>{V&&(R.useSettingsStore.getState().setIsIncognito(!0),em())},[V,em]);(0,H.useHotkeys)(w.KBD_NEW_INCOGNITO_CHAT,ex,[ex]);let ep=(0,t.jsx)("div",{className:(0,l.cn)("sticky top-0 z-10 w-full",Z&&["bg-gradient-to-b","from-surface-base via-surface-base/75 via-25% to-transparent"]),children:(0,t.jsx)("div",{className:"px-3 py-3",children:Z?(0,t.jsx)(k.Button,{variant:"tertiary",size:"md",shape:"circle",onClick:eg,className:"bg-surface-l1 hover:bg-surface-l2","aria-label":c("highlights-detail-page.back","Back"),children:(0,t.jsx)(j.default,{size:20})}):(0,t.jsxs)(k.Button,{variant:"textsecondary",size:"none",shape:"rectangle",onClick:eg,className:"gap-1 py-1 px-1","aria-label":c("highlights-detail-page.back","Back"),children:[(0,t.jsx)(j.default,{size:16}),(0,t.jsx)("span",{children:c("highlights-detail-page.back","Back")})]})})}),ef=(0,t.jsx)("div",{className:(0,l.cn)("w-full",o.QUERY_BAR_MAX_WIDTH_CLASS,"mx-auto px-4"),children:(0,t.jsxs)("div",{className:"pt-2",children:[(0,t.jsx)(N.Skeleton,{className:"w-full aspect-video rounded-2xl mb-6"}),(0,t.jsx)(N.Skeleton,{className:"h-8 w-4/5 mb-2"}),(0,t.jsxs)("div",{className:"space-y-1.5 mb-4",children:[(0,t.jsx)(N.Skeleton,{className:"h-5 w-full"}),(0,t.jsx)(N.Skeleton,{className:"h-5 w-3/4"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(N.Skeleton,{className:"size-8 rounded-full"}),(0,t.jsx)(N.Skeleton,{className:"size-8 rounded-full"})]}),(0,t.jsx)(N.Skeleton,{className:"h-4 w-32"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(N.Skeleton,{className:"w-full h-32 rounded-xl"}),(0,t.jsx)(N.Skeleton,{className:"w-full h-32 rounded-xl"})]})]})});return z?(0,t.jsx)(U.default,{}):es?(0,t.jsxs)("div",{className:(0,l.cn)("flex flex-col items-center w-full h-[100vh]",x.CHAT_CONTAINER_CLASSES),children:[(0,t.jsxs)("div",{className:"flex-1 w-full overflow-y-auto",children:[ep,(0,t.jsxs)("div",{className:(0,l.cn)("w-full",o.QUERY_BAR_MAX_WIDTH_CLASS,"mx-auto px-4 relative"),children:[(0,t.jsx)(d.HighlightsSectionSimple,{className:"pt-2",story:es,isArticleLoading:en}),(0,t.jsx)("div",{className:"h-32"})]})]}),(0,t.jsxs)("div",{className:(0,l.cn)("absolute bottom-4 w-full"),children:[(0,t.jsx)(S.QueryBar,{placeholder:c("highlights-story-page-query-bar.input-placeholder","Ask about the story..."),onQuery:eu,onFrontPage:!0,isIncognito:Y,textAreaClassName:"min-h-14 py-4 my-0 mb-0"}),(0,t.jsx)("div",{className:"absolute -bottom-4 h-14 w-full",children:(0,t.jsx)("div",{className:(0,l.cn)("chat-input-backdrop w-full h-full","bg-gradient-to-b from-surface-base via-surface-base/94 to-surface-base/80")})})]})]}):eo?(0,t.jsx)("div",{className:(0,l.cn)("flex flex-col items-center w-full h-[100vh]",x.CHAT_CONTAINER_CLASSES),children:(0,t.jsxs)("div",{className:"flex-1 w-full overflow-y-auto",children:[ep,(0,t.jsx)(v.DelayedRender,{delayMs:500,children:ef})]})}):(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8 gap-4",children:[(0,t.jsx)("p",{className:"text-secondary text-center",children:c("highlight-not-found","Story not found.")}),(0,t.jsx)(k.Button,{variant:"secondary",size:"md",shape:"pill",onClick:eg,children:c("highlight-not-found.go-back","Go Back")})]})}function O(e){let{children:s}=e,i=(0,u.useRoutingStore)(e=>e.push);return(0,t.jsxs)("div",{className:(0,l.cn)("flex flex-col items-center w-full h-[100vh] overflow-y-auto",x.CHAT_CONTAINER_CLASSES),children:[(0,t.jsx)(m.Button,{variant:"outline",size:"iconMd",rounded:!0,onClick:()=>i({page:"main"}),className:"shrink-0 mt-2 ms-2 self-start sticky top-2",children:(0,t.jsx)(g.ChevronLeft,{className:"size-4"})}),(0,t.jsx)("div",{className:(0,l.cn)("w-full",o.QUERY_BAR_MAX_WIDTH_CLASS),children:s})]})}function F(){let{route:e}=(0,h.useRouting)();return("highlights"===e.page||"trends"===e.page)&&e.storyId?(0,t.jsx)(z,{}):(0,t.jsx)(G,{})}function G(){let{t:e}=(0,i.useTranslation)("chat"),{route:l}=(0,h.useRouting)(),o=(0,n.useHighlightsStore)(e=>e.stories),{isLoading:u,error:g,accessDenied:m}=(0,c.useLoadHighlights)(),x=(0,r.useLogEvent)();return((0,s.useEffect)(()=>{o.length>0&&x("highlights_shown",String(o.length),{location:"highlights-page:HighlightsAllStoriesView",storyCount:String(o.length)})},[o.length,x]),(0,s.useEffect)(()=>{if(("highlights"===l.page||"trends"===l.page)&&l.storyId){let e=setTimeout(()=>{let e=l.storyId;if(e){let t=document.getElementById(e);t?t.scrollIntoView({behavior:"smooth",block:"start"}):(0,a.logError)("highlights-page:scroll",Error("Story element not found: ".concat(e)))}},100);return()=>clearTimeout(e)}},[l]),m)?(0,t.jsx)(U.default,{}):u&&0===o.length?(0,t.jsx)(O,{children:(0,t.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,t.jsx)("p",{className:"text-secondary text-center",children:e("highlights-loading","Loading highlights...")})})}):g?(0,t.jsx)(O,{children:(0,t.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,t.jsx)("p",{className:"text-secondary text-center",children:e("highlights-error","Failed to load highlights. Please try again later.")})})}):0===o.length?(0,t.jsx)(O,{children:(0,t.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,t.jsx)("p",{className:"text-secondary text-center",children:e("highlights-empty","No highlights available at the moment.")})})}):(0,t.jsx)(O,{children:(0,t.jsx)("div",{className:"flex flex-col gap-10",children:o.map(e=>(0,t.jsx)(d.HighlightsSection,{story:e},e.storyId))})})}}]);

//# sourceMappingURL=a48bb4dea1a8b7ff.js.map
//# debugId=4e1b6f3d-352a-5ae5-ba8d-4f3546e08a52
