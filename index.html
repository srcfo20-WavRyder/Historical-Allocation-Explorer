<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Comparison Tool</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
        </head>
<body>

<div class="update-data-section" id="updateDataSection" style="display: none; text-align: center; margin: 20px 0px; padding: 20px; background: rgb(248, 249, 250); border-radius: 8px;">
            <h3 style="color: #495057; margin-bottom: 15px;">Update Tool Data</h3>
            <p style="color: #6c757d; margin-bottom: 15px;">Upload a new Excel file to update all models and data in this tool</p>
            <input type="file" id="updateDataInput" accept=".xlsx,.xls" style="display: none;">
            <button onclick="document.getElementById('updateDataInput').click()" class="btn-primary">
                üìä Upload New Data File
            </button>
            <div id="updateStatus" style="margin-top: 15px; font-weight: bold; display: none;"></div>
        </div>


    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;600;700&amp;display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Load performance data from external file -->
    <script>
// Auto-generated from performance_data.xlsx
const EXCEL_DATA = [
  [
    "Option",
    null,
    "A",
    "B",
    "C",
    "D",
    "E",
    "F",
    "G",
    "H",
    "I",
    "J",
    "K",
    "L",
    "M",
    "N",
    "O",
    "P",
    "Q",
    "R"
  ],
  [
    "Performance Measure",
    null,
    "60/40",
    "WavRyder QQQ",
    "WavRyder SP500",
    "WavRyder(H)",
    "WavRyder(M)",
    "WavRyder(L)",
    "WavRyder QQQ (Leveraged)",
    "WavRyder SP500 (Leveraged)",
    "WavRyder QQQ/SP500 Leveraged)",
    "QQQ (Leveraged) W/O WavRyder",
    "SP 500",
    "AGG",
    "WavRyder AGG",
    "VEA",
    "WavRyder VEA",
    "QQQ",
    "SPY",
    "WavRyder SPY"
  ],
  [
    "Total Return",
    "1 year",
    0.13478289285581346,
    0.1755558345823689,
    0.1500984966064436,
    0.14446026845364224,
    0.16306143835477638,
    0.15533947507090806,
    0.3600802462787316,
    0.3600802462787316,
    0.3600802462787316,
    0.2638826792924889,
    0.09623333431267755,
    0.0743001063121318,
    0.07204148844041747,
    0.3474626822676845,
    0.23492556670435416,
    0.1840145170095442,
    0.16143345656192087,
    0.1500984966064436
  ],
  [
    "Total Return",
    "YTD",
    0.005845927172144716,
    0.17490936156735293,
    0.14946602333652814,
    0.0002859475348011564,
    0.1624218363787724,
    0.15470411963151198,
    0.3593322978175786,
    0.3593322978175786,
    0.3593322978175786,
    0.4095494272678759,
    0.17715053440658535,
    0.07363484433270728,
    0.07145194103410457,
    0.3590157170341228,
    0.23424644451301124,
    0.2265596637279068,
    0.19167417738414572,
    0.14946602333652814
  ],
  [
    "CAGR",
    "5 Year",
    0.08853338923317944,
    0.10452174579562423,
    0.09778825230799693,
    0.10246994140123711,
    0.10168211138720884,
    0.099473155483087,
    0.20583394573438207,
    0.20583394573438207,
    0.20583394573438207,
    0.20787345614101205,
    0.1318018589326304,
    -0.003341552200764264,
    0.02483725167382067,
    0.09410402157004549,
    0.052638021631999266,
    0.15507161028161898,
    0.14720198027767672,
    0.09778825230799693
  ],
  [
    "CAGR",
    "10 Year",
    0.09985991826404361,
    0.1514020320183065,
    0.12067335018460312,
    0.14472912965606533,
    0.13636857488789333,
    0.12702990217666899,
    0.36408155855902913,
    0.36408155855902913,
    0.36408155855902913,
    0.3734403360399954,
    0.14469481410365326,
    0.019912976507280744,
    0.038779274086202076,
    0.08715480173850243,
    0.08040465034534994,
    0.19544936041992722,
    0.14780635737728853,
    0.12067335018460312
  ],
  [
    "CAGR",
    "15 Year",
    0.09466132093415092,
    0.12807838607348154,
    0.10092326392916484,
    0.12089101435539074,
    0.11477927616801487,
    0.10653174331546889,
    0.3075958747086125,
    0.3075958747086125,
    0.3075958747086125,
    0.3954994701202532,
    0.1353363262367564,
    0.02400024610020135,
    0.034956859343680646,
    0.07069442459595554,
    0.0547897766452341,
    0.1864064668867551,
    0.14046367211624777,
    0.10092326392916484
  ],
  [
    "CAGR",
    "20 Year",
    0.0814670041020702,
    0.12427253755029244,
    0.0953211493896522,
    0.1117653973750059,
    0.11008882126271935,
    0.10129718649640762,
    0.2783300098727388,
    0.2783300098727388,
    0.2783300098727388,
    0.3469592078853829,
    0.10521271732857285,
    0.03141720097010392,
    0.04204064362146509,
    0.05404327478725124,
    0.06076962850322465,
    0.15471284756328063,
    0.10936063754732261,
    0.0953211493896522
  ],
  [],
  [],
  [
    "const00K Investment Growth",
    "20 Year",
    478922.753025214,
    1040955.2187866488,
    617773.7768892092,
    832267.7348264777,
    806367.9292071358,
    687886.1412265772,
    13533147.851294626,
    13533147.851294626,
    13533147.851294626,
    38487250.90564725,
    738452.0870592844,
    185568.1187366363,
    227744.64488165607,
    286322.648921958,
    325140.1191067703,
    1772654.7125073008,
    795861.7044993716,
    617003.7527443555
  ],
  [],
  [],
  [
    "Worst Annual Drawdown%",
    "20 Year",
    -0.19061453613527835,
    -0.09572172918412059,
    -0.08463731735187463,
    -0.09031353870693348,
    -0.08217694754550631,
    -0.08146880362524733,
    -0.2618634015601986,
    -0.2618634015601986,
    -0.2618634015601986,
    -0.7909001278779242,
    -0.36997611132718566,
    -0.13021651691583458,
    -0.033208122709457166,
    -0.40623204383435196,
    -0.15020561241625574,
    -0.4172716255522949,
    -0.3679500303113997,
    -0.08463731735187463
  ],
  [],
  [
    100000
  ],
  [
    20
  ],
  [],
  [],
  [
    null,
    "Year"
  ],
  [
    "Total Return",
    1,
    0.11039403783585588,
    0.14283881637958684,
    0.16423536018966356,
    0.022948335634813022,
    0.15430656346437943,
    0.16044909477256764,
    0.1588216757855454,
    0.1588216757855454,
    0.1588216757855454,
    0.1150192778810828,
    0.15794461193725562,
    0.0389650907962078,
    0.05753085698825666,
    0.1696127967415515,
    0.16442822599454554,
    0.07144044374185077,
    0.15845259514833843,
    0.16423536018966356
  ],
  [
    "Total Return",
    2,
    0.057082190428648705,
    0.19256594171615782,
    0.03559244690897145,
    0.1580699189960051,
    0.11182016705577658,
    0.06555461887426417,
    0.20854254569951913,
    0.20854254569951913,
    0.20854254569951913,
    0.12066537916995723,
    0.05493731118195888,
    0.06594822173447668,
    0.07139015216818279,
    0.08923609792958342,
    0.11682289683516478,
    0.19027997796682605,
    0.051462156336747444,
    0.03559244690897145
  ],
  [
    "Total Return",
    3,
    -0.19061453613527835,
    0.1498029927279101,
    0.0872030849356289,
    0.1370430162403533,
    0.1183904672527687,
    0.09965036746424838,
    0.16304845541853452,
    0.16304845541853452,
    0.16304845541853452,
    -0.39282170027907437,
    -0.36997611132718566,
    0.07900006306508467,
    0.17689350858521036,
    -0.40623204383435196,
    0.09869966679707765,
    -0.4172716255522949,
    -0.3679500303113997,
    0.0872030849356289
  ],
  [
    "Total Return",
    4,
    0.16303867134354477,
    -0.0185300909582935,
    0.034524320114372564,
    -0.010178438464917727,
    0.00806981004897045,
    0.023962626763297745,
    -0.004514816331647742,
    -0.004514816331647742,
    -0.004514816331647742,
    0.4040000388004261,
    0.264642338297876,
    0.029693929804595065,
    0.005255944335200269,
    0.27507327304801943,
    0.04868736318732947,
    0.5468405175753084,
    0.2635173081475055,
    0.034524320114372564
  ],
  [
    "Total Return",
    5,
    0.11624689959080481,
    0.12105797297878929,
    0.08611033279024793,
    0.10119535929040313,
    0.1037095453998147,
    0.09317937202805404,
    0.49944746071607926,
    0.49944746071607926,
    0.49944746071607926,
    0.1759039547473844,
    0.1506340348639459,
    0.06362036229624168,
    0.021578615221991226,
    0.08354358718490418,
    -0.00851190705534155,
    0.2014384230365669,
    0.15056174792422494,
    0.08611033279024793
  ],
  [
    "Total Return",
    6,
    0.042462825447058705,
    0.04814215624201701,
    0.0570870296680166,
    0.050049747135175515,
    0.0527068482037476,
    0.055357280823195465,
    -0.008236796723226303,
    -0.008236796723226303,
    -0.008236796723226303,
    0.026901004754602775,
    0.021118153857238253,
    0.07696712084053026,
    0.09706457046610462,
    -0.12314572230261056,
    0.0010752326237901677,
    0.03475766098084043,
    0.018949928514852665,
    0.0570870296680166
  ],
  [
    "Total Return",
    7,
    0.1102160797991456,
    0.15551414997120228,
    0.13617666387598693,
    0.15187320770273494,
    0.14623601995752122,
    0.14029344955916634,
    0.27692032146189116,
    0.27692032146189116,
    0.27692032146189116,
    0.17050978218817048,
    0.16003224238602765,
    0.03754892670638044,
    0.09684341500834992,
    0.1856053052527893,
    0.12166817724917012,
    0.18112548698889497,
    0.1599029285130973,
    0.13617666387598693
  ],
  [
    "Total Return",
    8,
    0.18465075090714222,
    0.292764017775748,
    0.26080510265980816,
    0.28649707010734904,
    0.27710634315196714,
    0.2674008870965081,
    1.143566785241899,
    1.143566785241899,
    1.143566785241899,
    0.3446876391344167,
    0.3238848466970623,
    -0.019776787112616656,
    -0.033208122709457166,
    0.2180651123012045,
    0.18282810446590303,
    0.36634180917950654,
    0.3230786471313738,
    0.26080510265980816
  ],
  [
    "Total Return",
    9,
    0.1042517064486359,
    0.026872124168275002,
    -0.02404169974907766,
    0.016604564018459556,
    0.0012799527142683953,
    -0.013945890944580985,
    0.15819977416437792,
    0.15819977416437792,
    0.15819977416437792,
    0.1632151568545468,
    0.13688358376182075,
    0.05998575399926809,
    -0.020629371376090777,
    -0.0596740621783014,
    -0.15020561241625574,
    0.19181409801244942,
    0.13463785464442046,
    -0.02404169974907766
  ],
  [
    "Total Return",
    10,
    0.009384163962939507,
    -0.06875823796704572,
    -0.08463731735187463,
    -0.0719712015484294,
    -0.07670916317846221,
    -0.08146880362524733,
    -0.19126874920449666,
    -0.19126874920449666,
    -0.19126874920449666,
    0.05337263021974459,
    0.013837640885861369,
    0.004807529874164551,
    0.000005480856025252834,
    -0.003731686170505122,
    -0.0987580854176413,
    0.09435945660210376,
    0.012342937428686751,
    -0.08463731735187463
  ],
  [
    "Total Return",
    11,
    0.0819911416073209,
    -0.0008905988514329444,
    0.0016488605404514356,
    -0.0003597900240145391,
    0.00040962705829405976,
    0.0011605015440672162,
    -0.03469655918615988,
    -0.03469655918615988,
    -0.03469655918615988,
    0.09524485743532929,
    0.11959913306315295,
    0.024137948970977208,
    0.011062759863883942,
    0.026340064463413748,
    0.06474504245040835,
    0.0709786180948071,
    0.1199786573675592,
    0.0016488605404514356
  ],
  [
    "Total Return",
    12,
    0.14432943721549019,
    0.2984309693345417,
    0.18653367166480161,
    0.27548084361229175,
    0.2416013228940621,
    0.20835151671784513,
    1.1082585418480155,
    1.1082585418480155,
    1.1082585418480155,
    0.2717948315480272,
    0.21831591555840868,
    0.0355271535359738,
    0.021736243529953292,
    0.2642050582339448,
    0.19332981151141837,
    0.32663541332799406,
    0.21705430268489923,
    0.18653367166480161
  ],
  [
    "Total Return",
    13,
    -0.026540367217998573,
    0.05763779780682232,
    0.06624045019195823,
    0.06194614474958837,
    0.062305799239056325,
    0.06475547865673636,
    0.024165129683128672,
    0.024165129683128672,
    0.024165129683128672,
    -0.023352004143146976,
    -0.043842333247032905,
    0.003407565345097119,
    0.03349550264437284,
    -0.1474532662537571,
    -0.04167095047975666,
    -0.0012619253233363548,
    -0.04569022272848022,
    0.06624045019195823
  ],
  [
    "Total Return",
    14,
    0.2211324209987624,
    0.23879180541511924,
    0.17432524132453397,
    0.2256656507941066,
    0.20628085092416315,
    0.18704100755190511,
    0.556188877477886,
    0.556188877477886,
    0.556188877477886,
    0.35090802412032707,
    0.3148636179238715,
    0.08455644431316389,
    0.1065779092265351,
    0.2262117470601237,
    0.12055955905511428,
    0.38961544865598197,
    0.31223883174763056,
    0.17432524132453397
  ],
  [
    "Total Return",
    15,
    0.14032135463687068,
    0.4669429079542302,
    0.31438372890572164,
    0.43244029946314977,
    0.3894257884703023,
    0.34410254195834034,
    1.7053069122550153,
    1.7053069122550153,
    1.7053069122550153,
    0.33329219844253055,
    0.18398831564768492,
    0.07476090042475958,
    0.09551295485360534,
    0.09713838640624717,
    0.23853336627781951,
    0.48406086417127137,
    0.18331629868868005,
    0.31438372890572164
  ],
  [
    "Total Return",
    16,
    0.1660288621521957,
    0.04061675606806747,
    0.07366548213266078,
    0.047785725602705886,
    0.057965364027131816,
    0.06758853553290445,
    0.0803695935334181,
    0.0803695935334181,
    0.0803695935334181,
    0.28070493528718576,
    0.28705369259328073,
    -0.017660378398383303,
    -0.03119830723582484,
    0.1166407749905305,
    -0.04720009518805979,
    0.27419733789440026,
    0.28728740938940045,
    0.07366548213266078
  ],
  [
    "Total Return",
    17,
    -0.1602470542058062,
    -0.09572172918412059,
    -0.06855377204992374,
    -0.09031353870693348,
    -0.08217694754550631,
    -0.07401243774277833,
    -0.2618634015601986,
    -0.2618634015601986,
    -0.2618634015601986,
    -0.2536289362862124,
    -0.18110888886303056,
    -0.13021651691583458,
    -0.02012605943820811,
    -0.15341864638316305,
    -0.04015918172731581,
    -0.32577005901822353,
    -0.18175359611134545,
    -0.06855377204992374
  ],
  [
    "Total Return",
    18,
    0.1804838434194902,
    0.22156177601373916,
    0.16594603064765456,
    0.2107451189067462,
    0.19421592758891038,
    0.1773642464713019,
    0.5689517091686349,
    0.5689517091686349,
    0.5689517091686349,
    0.40552035833500977,
    0.26287659524670337,
    0.0565530750370844,
    0.07127871491392757,
    0.17933365081746167,
    0.1373274335967798,
    0.548556055008738,
    0.26175794848840206,
    0.16594603064765456
  ],
  [
    "Total Return",
    19,
    0.15454644818603303,
    0.21609543256174124,
    0.19184189001727714,
    0.21160461258843255,
    0.2045161079048896,
    0.19704266104117796,
    0.49456006935294905,
    0.49456006935294905,
    0.49456006935294905,
    0.25164338808851805,
    0.25019681916030745,
    0.013092501993107186,
    0.037333329898712186,
    0.03149637874015632,
    -0.0011424346169758293,
    0.2557826053805423,
    0.24886459611702305,
    0.19184189001727714
  ],
  [
    "Total Return",
    20,
    0.13441444186193752,
    0.17490936156735293,
    0.14946602333652814,
    0.16216191327418095,
    0.1624218363787724,
    0.15470411963151198,
    0.3593322978175786,
    0.3593322978175786,
    0.3593322978175786,
    0.20906973265254902,
    0.11391996522214609,
    0.07363484433270728,
    0.07145194103410457,
    0.3590157170341228,
    0.23424644451301124,
    0.2265596637279068,
    0.19167417738414572,
    0.14946602333652814
  ]
];
</script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto Slab', serif;
            background: #f8f9fa;
            padding: 40px 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .upload-section {
            text-align: center;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 2px dashed #dee2e6;
        }
        
        .upload-row {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        
        /* Portfolio Container Styles */
        .portfolio-container {
            border: 3px solid #4472C4;
            border-radius: 0px;
            padding: 20px;
            background: #F0F4FF;
            box-shadow: none;
            max-width: 400px;
            width: 100%;
            box-sizing: border-box;
            margin: 0 auto 25px auto;
        }
        
        .portfolio-container.portfolio-2 {
            border-color: #28a745;
            background: #F0FFF4;
            box-shadow: none;
        }
        
        .portfolio-header {
            font-size: 16px;
            font-weight: 700;
            color: #000000;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .portfolio-container.portfolio-2 .portfolio-header {
            color: #000000;
            font-weight: 700;
        }
        
        
        /* Models Label */
        .models-label {
            font-size: 12px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 5px;
        }
        
        /* Selector row - model (70%) + allocation (30%) pairs */
        .selector-row-even {
            display: grid;
            grid-template-columns: 2.3fr 1fr 2.3fr 1fr 2.3fr 1fr 2.3fr 1fr;
            gap: 8px;
            align-items: end;
        }
        
        /* Even selector groups - all same width */
        .selector-group-even {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        /* Even labels - compact */
        .selector-label-even {
            font-size: 11px;
            font-weight: 600;
            color: #495057;
        }
        
        /* Even selects - all same size */
        .select-even {
            width: 100%;
            padding: 8px;
            border: 1.5px solid #ced4da;
            border-radius: 6px;
            font-size: 13px;
            background: white;
            cursor: pointer;
            transition: border-color 0.2s ease;
        }
        
        
        /* Smaller allocation selects */
        .select-alloc {
            font-size: 12px;
            padding: 6px 4px;
            text-align: center;
        }

        .select-even:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .portfolio-container.portfolio-2 .select-even:focus {
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }

        
        /* 2-column layout - 2 models per row */
        
        /* Stacked layout - one row per model */
        .selector-row-stack {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            margin-left: 5px;
            margin-right: 5px;
        }
        
        .selector-label-stack {
            font-size: 14px;
            font-weight: 600;
            color: #000000;
            white-space: nowrap;
            text-align: left;
            width: 20px;
            flex-shrink: 0;
        }
        
        .select-stack {
            padding: 6px 8px;
            border: 1px solid #000000;
            border-radius: 0px;
            font-size: 16px;
            font-weight: 700;
            background: white;
            cursor: pointer;
            transition: border-color 0.2s ease;
            box-sizing: border-box;
            flex: 1;
            min-width: 0;
            max-width: 180px;
            text-align: left;
        }
        
        .select-alloc-stack {
            flex: 0 0 55px;
            width: 55px;
            text-align: center;
            font-size: 16px;
            font-weight: 700;
            padding: 6px 4px;
            box-sizing: border-box;
        }
        
        .select-stack:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .portfolio-container.portfolio-2 .select-stack:focus {
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }

        .selector-row-2col {
            display: grid;
            grid-template-columns: 15ch 8ch 15ch 8ch;
            gap: 1ch;
            align-items: end;
            max-width: 100%;
            margin-bottom: 20px;
        }
        
        .selector-group-2col {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .selector-label-2col {
            font-size: 11px;
            font-weight: 600;
            color: #495057;
        }
        
        .select-2col {
            width: 15ch;
            max-width: 15ch;
            padding: 6px 4px;
            border: 1.5px solid #ced4da;
            border-radius: 6px;
            font-size: 13px;
            background: white;
            cursor: pointer;
            transition: border-color 0.2s ease;
            box-sizing: border-box;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .select-alloc-2col {
            font-size: 13px;
            text-align: center;
            padding: 4px 2px;
            width: 8ch;
            max-width: 8ch;
        }
        
        .select-2col:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .portfolio-container.portfolio-2 .select-2col:focus {
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }

        .selector-group-compact {
            display: flex;
            flex-direction: column;
            gap: 3px;
            min-width: 80px;
        }
        
        /* Make model selectors wider than allocation dropdowns */
        .selector-group-compact:nth-child(odd) {
            flex: 2;
        }
        
        .selector-group-compact:nth-child(even) {
            flex: 1;
            max-width: 70px;
        }
        
        .selector-label-compact {
            font-size: 11px;
            font-weight: 600;
            color: #495057;
        }
        
        .select-compact {
            padding: 6px 8px;
            border: 1.5px solid #ced4da;
            border-radius: 6px;
            font-size: 12px;
            background: white;
            cursor: pointer;
            transition: border-color 0.2s ease;
        }
        
        .select-compact:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .portfolio-container.portfolio-2 .select-compact:focus {
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }
        
.selector-row {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .selector-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .selector-label {
            font-weight: 600;
            color: #495057;
            font-size: 13px;
        }
        
        select {
            padding: 8px 12px;
            font-size: 14px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-family: 'Roboto Slab', serif;
            min-width: 250px;
        }
        
        select:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .upload-button {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }
        
        #fileInput {
            display: none;
        }
        
        .message {
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            display: none;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
        }
        
        #reportContent {
            display: none;
        }
        
        .copy-button-container {
            text-align: center;
            margin: 20px 0 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .copy-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .copy-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(40,167,69,0.3);
        }
        
        .copy-status {
            margin-top: 10px;
            font-size: 14px;
            color: #28a745;
            font-weight: 600;
            display: none;
        }
        
        #presentationContent {
            width: 60%;
            margin: 0 auto;
        }
        
        .header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .header > div:first-child {
            flex-shrink: 0;
        }
        
        .header > div:last-child {
            flex: 1;
        }
        
        h1 {
            font-size: 42px;
            color: #1a1a1a;
            margin-bottom: 3px;
            font-weight: 900;
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: none;
            max-width: 300px;
            line-height: 1.1;
        }
        
        .subtitle {
            font-size: 16px;
            color: #666;
            font-style: italic;
        }
        
        .section-header {
            font-size: 20px;
            font-weight: 700;
            color: #1a1a1a;
            margin: 10px 0 6px 0;
            padding-bottom: 4px;
            border-bottom: 3px solid #007bff;
            text-align: center;
        }
        
        .performance-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        .performance-table thead tr {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }
        
        .performance-table th {
            padding: 4px 5px;
            text-align: center;
            font-weight: 600;
            font-size: 17px;
        }
        
        .performance-table th:nth-child(2),
        .performance-table td:nth-child(2) {
            width: 80px;
            white-space: nowrap;
        }
        
        .performance-table th:first-child {
            border-top-left-radius: 8px;
        }
        
        .performance-table th:last-child {
            border-top-right-radius: 8px;
        }
        
        .performance-table td {
            padding: 3px 5px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            font-size: 17px;
        }
        
        .performance-table tbody tr:hover {
            background-color: #f8f9fa;
        }
        
        .performance-table tbody tr:nth-child(even) {
            background-color: #f5f6f7;
        }
        
        .performance-table tbody tr:last-child td {
            border-bottom: none;
        }
        
        .performance-table tbody tr:last-child td:first-child {
            border-bottom-left-radius: 8px;
        }
        
        .performance-table tbody tr:last-child td:last-child {
            border-bottom-right-radius: 8px;
        }
        
        .performance-table td:nth-child(3),
        .performance-table td:nth-child(4),
        .performance-table td:nth-child(5) {
            font-weight: 600;
        }
        
        .performance-table .positive {
            color: #28a745;
        }
        
        .performance-table .negative {
            color: #dc3545;
        }
        
        .metrics-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin: 8px 0;
            max-width: 100%;
        }
        
        .metric-card {
            background: #f8f9fa;
            padding: 6px 8px;
            border-radius: 8px;
            text-align: center;
        }
        
        .metric-title {
            font-size: 15px;
            color: #666;
            margin-bottom: 3px;
            font-weight: 700;
        }
        
        .metric-table {
            width: 100%;
            margin-top: 2px;
        }
        
        .metric-table td {
            padding: 1px 4px;
            font-size: 14px;
            text-align: left;
        }
        
        .metric-table td:first-child {
            color: #666;
            font-weight: 500;
        }
        
        .metric-table td:last-child {
            font-weight: 700;
            text-align: right;
        }
        
        .metric-table .positive {
            color: #28a745;
        }
        
        .metric-table .negative {
            color: #dc3545;
        }
        
        .metric-table .neutral {
            color: #1a1a1a;
        }
    
        /* Update Data Section Styles */
        .update-data-section {
            animation: fadeIn 0.5s ease-in;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(102, 126, 234, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(40, 167, 69, 0.3);
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(40, 167, 69, 0.4);
        }
        
        .btn-secondary:active {
            transform: translateY(0);
        }
        
        #updateStatus {
            min-height: 24px;
            font-size: 14px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }


        /* LOCAL TESTING BANNER */
        .testing-banner {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 3px solid #e91e63;
        }
        
        .testing-banner-subtitle {
            font-size: 14px;
            margin-top: 5px;
            opacity: 0.95;
        }

        /* Pie Chart Container */
        .pie-charts-container {
            display: flex;
            justify-content: space-around;
            align-items: flex-start;
            margin: 20px 0 30px 0;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .pie-chart-wrapper {
            flex: 1;
            min-width: 280px;
            max-width: 400px;
            text-align: center;
        }
        
        .pie-chart-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .pie-chart-canvas {
            max-width: 100%;
            height: auto;
        }

        /* PDF Download Button - inline styles in HTML for simplicity */
        #pdfDownloadButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.4) !important;
        }
        
        #pdfDownloadButton:active {
            transform: translateY(0);
        }

        /* Mobile Responsive Styles */
        @media screen and (max-width: 768px) {
            body {
                font-size: 14px;
            }
            
            .container {
                padding: 5px;
                margin: 5px auto;
            }
            
            #presentationContent {
                width: 100% !important;
                margin: 0 auto;
                padding: 0;
            }
            
            .header h1 {
                font-size: 32px;
                line-height: 1.1;
                max-width: 250px;
            }
            
            .portfolio-container {
                padding: 15px;
                margin: 10px auto;
                max-width: 100%;
            }
            
            .portfolio-header {
                font-size: 18px;
                padding: 12px;
            }
            
            /* Keep horizontal layout on mobile - same as desktop */
            .selector-row-stack {
                gap: 6px;
                margin-left: 3px;
                margin-right: 3px;
            }
            
            .selector-label-stack {
                font-size: 13px;
            }
            
            .select-stack {
                font-size: 14px;
                padding: 6px 6px;
            }
            
            .select-alloc-stack {
                font-size: 14px;
                padding: 6px 3px;
            }
            
            .update-button {
                width: 100%;
                padding: 15px;
                font-size: 16px;
            }
            
            .performance-table {
                font-size: 11px;
                display: block;
                overflow-x: auto;
                white-space: nowrap;
                width: 100%;
                margin: 0 auto;
            }
            
            .performance-table th,
            .performance-table td {
                padding: 6px 4px;
            }
            
            .section-header {
                font-size: 18px;
                padding: 8px 5px;
                margin: 0 auto;
                text-align: center;
            }
            
            #portfolioKey {
                padding: 0 5px;
                text-align: center;
            }
            
            .metrics-container {
                flex-direction: column;
            }
            
            .metric-card {
                margin: 10px 0;
            }
            
            .chart-container {
                padding: 15px;
            }
            
            canvas {
                max-height: 250px !important;
            }
            
            .copy-button {
                padding: 10px 16px;
                font-size: 14px;
                margin: 5px;
            }
            
            .pie-charts-container {
                flex-direction: column;
                align-items: center;
            }
            
            .pie-chart-wrapper {
                width: 100%;
                max-width: 320px;
            }
        }
        
        @media screen and (max-width: 480px) {
            .container {
                padding: 3px;
                margin: 3px auto;
            }
            
            .header h1 {
                font-size: 28px;
                line-height: 1.1;
                max-width: 220px;
            }
            
            .performance-table {
                font-size: 10px;
            }
            
            .performance-table th,
            .performance-table td {
                padding: 5px 3px;
            }
            
            .section-header {
                font-size: 16px;
                padding: 6px 3px;
            }
            
            .metric-title {
                font-size: 14px;
            }
            
            .metric-table {
                font-size: 12px;
            }
        }

</style>


    <div class="container">
        <div class="upload-section">
            <h3 style="margin-bottom: 15px; color: #495057;">Select Portfolio Combinations</h3>
            <div class="upload-row" style="display: none;">
                <button class="upload-button" onclick="document.getElementById('fileInput').click()">
                    üìÅ Select Excel File
                </button>
                <input type="file" id="fileInput" accept=".xlsx, .xls">
            </div>
            
                        <!-- Portfolio 1 Container -->
            <div class="portfolio-container" id="portfolio1Container" style="display: block;">
                <div class="portfolio-header">Portfolio 1</div>
                
                <!-- A row -->
                <div class="selector-row-stack">
                    <label class="selector-label-stack">A:</label>
                    <select id="option1Select" class="select-stack"><option value="">--</option><option value="2">60/40</option><option value="3">WavRyder QQQ</option><option value="4">WavRyder SP500</option><option value="5">WavRyder(H)</option><option value="6">WavRyder(M)</option><option value="7">WavRyder(L)</option><option value="8">WavRyder QQQ (Leveraged)</option><option value="9">WavRyder SP500 (Leveraged)</option><option value="10">WavRyder QQQ/SP500 Leveraged)</option><option value="11">QQQ (Leveraged) W/O WavRyder</option><option value="12">SP 500</option><option value="13">AGG</option><option value="14">WavRyder AGG</option><option value="15">VEA</option><option value="16">WavRyder VEA</option><option value="17">QQQ</option><option value="18">SPY</option><option value="19">WavRyder SPY</option></select>
                    <label class="selector-label-stack">%:</label>
                    <select id="allocation1Select" class="select-stack select-alloc-stack">
                        <option value="0">0</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="25">25</option>
                        <option value="30">30</option>
                        <option value="35">35</option>
                        <option value="40">40</option>
                        <option value="45">45</option>
                        <option value="50">50</option>
                        <option value="55">55</option>
                        <option value="60">60</option>
                        <option value="65">65</option>
                        <option value="70">70</option>
                        <option value="75">75</option>
                        <option value="80">80</option>
                        <option value="85">85</option>
                        <option value="90">90</option>
                        <option value="95">95</option>
                        <option value="100">100</option>
                    </select>
                </div>
                
                <!-- B row -->
                <div class="selector-row-stack">
                    <label class="selector-label-stack">B:</label>
                    <select id="option2Select" class="select-stack"><option value="">--</option><option value="2">60/40</option><option value="3">WavRyder QQQ</option><option value="4">WavRyder SP500</option><option value="5">WavRyder(H)</option><option value="6">WavRyder(M)</option><option value="7">WavRyder(L)</option><option value="8">WavRyder QQQ (Leveraged)</option><option value="9">WavRyder SP500 (Leveraged)</option><option value="10">WavRyder QQQ/SP500 Leveraged)</option><option value="11">QQQ (Leveraged) W/O WavRyder</option><option value="12">SP 500</option><option value="13">AGG</option><option value="14">WavRyder AGG</option><option value="15">VEA</option><option value="16">WavRyder VEA</option><option value="17">QQQ</option><option value="18">SPY</option><option value="19">WavRyder SPY</option></select>
                    <label class="selector-label-stack">%:</label>
                    <select id="allocation2Select" class="select-stack select-alloc-stack">
                        <option value="0">0</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="25">25</option>
                        <option value="30">30</option>
                        <option value="35">35</option>
                        <option value="40">40</option>
                        <option value="45">45</option>
                        <option value="50">50</option>
                        <option value="55">55</option>
                        <option value="60">60</option>
                        <option value="65">65</option>
                        <option value="70">70</option>
                        <option value="75">75</option>
                        <option value="80">80</option>
                        <option value="85">85</option>
                        <option value="90">90</option>
                        <option value="95">95</option>
                        <option value="100">100</option>
                    </select>
                </div>
                
                <!-- C row -->
                <div class="selector-row-stack">
                    <label class="selector-label-stack">C:</label>
                    <select id="option5Select" class="select-stack"><option value="">--</option><option value="2">60/40</option><option value="3">WavRyder QQQ</option><option value="4">WavRyder SP500</option><option value="5">WavRyder(H)</option><option value="6">WavRyder(M)</option><option value="7">WavRyder(L)</option><option value="8">WavRyder QQQ (Leveraged)</option><option value="9">WavRyder SP500 (Leveraged)</option><option value="10">WavRyder QQQ/SP500 Leveraged)</option><option value="11">QQQ (Leveraged) W/O WavRyder</option><option value="12">SP 500</option><option value="13">AGG</option><option value="14">WavRyder AGG</option><option value="15">VEA</option><option value="16">WavRyder VEA</option><option value="17">QQQ</option><option value="18">SPY</option><option value="19">WavRyder SPY</option></select>
                    <label class="selector-label-stack">%:</label>
                    <select id="allocation5Select" class="select-stack select-alloc-stack">
                        <option value="0">0</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="25">25</option>
                        <option value="30">30</option>
                        <option value="35">35</option>
                        <option value="40">40</option>
                        <option value="45">45</option>
                        <option value="50">50</option>
                        <option value="55">55</option>
                        <option value="60">60</option>
                        <option value="65">65</option>
                        <option value="70">70</option>
                        <option value="75">75</option>
                        <option value="80">80</option>
                        <option value="85">85</option>
                        <option value="90">90</option>
                        <option value="95">95</option>
                        <option value="100">100</option>
                    </select>
                </div>
                
                <!-- D row -->
                <div class="selector-row-stack">
                    <label class="selector-label-stack">D:</label>
                    <select id="option6Select" class="select-stack"><option value="">--</option><option value="2">60/40</option><option value="3">WavRyder QQQ</option><option value="4">WavRyder SP500</option><option value="5">WavRyder(H)</option><option value="6">WavRyder(M)</option><option value="7">WavRyder(L)</option><option value="8">WavRyder QQQ (Leveraged)</option><option value="9">WavRyder SP500 (Leveraged)</option><option value="10">WavRyder QQQ/SP500 Leveraged)</option><option value="11">QQQ (Leveraged) W/O WavRyder</option><option value="12">SP 500</option><option value="13">AGG</option><option value="14">WavRyder AGG</option><option value="15">VEA</option><option value="16">WavRyder VEA</option><option value="17">QQQ</option><option value="18">SPY</option><option value="19">WavRyder SPY</option></select>
                    <label class="selector-label-stack">%:</label>
                    <select id="allocation6Select" class="select-stack select-alloc-stack">
                        <option value="0">0</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="25">25</option>
                        <option value="30">30</option>
                        <option value="35">35</option>
                        <option value="40">40</option>
                        <option value="45">45</option>
                        <option value="50">50</option>
                        <option value="55">55</option>
                        <option value="60">60</option>
                        <option value="65">65</option>
                        <option value="70">70</option>
                        <option value="75">75</option>
                        <option value="80">80</option>
                        <option value="85">85</option>
                        <option value="90">90</option>
                        <option value="95">95</option>
                        <option value="100">100</option>
                    </select>
                </div>
            </div>

                        <!-- Portfolio 2 Container -->
            <div class="portfolio-container portfolio-2" id="portfolio2Container" style="display: block;">
                <div class="portfolio-header">Portfolio 2</div>
                
                <!-- A row -->
                <div class="selector-row-stack">
                    <label class="selector-label-stack">A:</label>
                    <select id="option3Select" class="select-stack"><option value="">--</option><option value="2">60/40</option><option value="3">WavRyder QQQ</option><option value="4">WavRyder SP500</option><option value="5">WavRyder(H)</option><option value="6">WavRyder(M)</option><option value="7">WavRyder(L)</option><option value="8">WavRyder QQQ (Leveraged)</option><option value="9">WavRyder SP500 (Leveraged)</option><option value="10">WavRyder QQQ/SP500 Leveraged)</option><option value="11">QQQ (Leveraged) W/O WavRyder</option><option value="12">SP 500</option><option value="13">AGG</option><option value="14">WavRyder AGG</option><option value="15">VEA</option><option value="16">WavRyder VEA</option><option value="17">QQQ</option><option value="18">SPY</option><option value="19">WavRyder SPY</option></select>
                    <label class="selector-label-stack">%:</label>
                    <select id="allocation3Select" class="select-stack select-alloc-stack">
                        <option value="0">0</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="25">25</option>
                        <option value="30">30</option>
                        <option value="35">35</option>
                        <option value="40">40</option>
                        <option value="45">45</option>
                        <option value="50">50</option>
                        <option value="55">55</option>
                        <option value="60">60</option>
                        <option value="65">65</option>
                        <option value="70">70</option>
                        <option value="75">75</option>
                        <option value="80">80</option>
                        <option value="85">85</option>
                        <option value="90">90</option>
                        <option value="95">95</option>
                        <option value="100">100</option>
                    </select>
                </div>
                
                <!-- B row -->
                <div class="selector-row-stack">
                    <label class="selector-label-stack">B:</label>
                    <select id="option4Select" class="select-stack"><option value="">--</option><option value="2">60/40</option><option value="3">WavRyder QQQ</option><option value="4">WavRyder SP500</option><option value="5">WavRyder(H)</option><option value="6">WavRyder(M)</option><option value="7">WavRyder(L)</option><option value="8">WavRyder QQQ (Leveraged)</option><option value="9">WavRyder SP500 (Leveraged)</option><option value="10">WavRyder QQQ/SP500 Leveraged)</option><option value="11">QQQ (Leveraged) W/O WavRyder</option><option value="12">SP 500</option><option value="13">AGG</option><option value="14">WavRyder AGG</option><option value="15">VEA</option><option value="16">WavRyder VEA</option><option value="17">QQQ</option><option value="18">SPY</option><option value="19">WavRyder SPY</option></select>
                    <label class="selector-label-stack">%:</label>
                    <select id="allocation4Select" class="select-stack select-alloc-stack">
                        <option value="0">0</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="25">25</option>
                        <option value="30">30</option>
                        <option value="35">35</option>
                        <option value="40">40</option>
                        <option value="45">45</option>
                        <option value="50">50</option>
                        <option value="55">55</option>
                        <option value="60">60</option>
                        <option value="65">65</option>
                        <option value="70">70</option>
                        <option value="75">75</option>
                        <option value="80">80</option>
                        <option value="85">85</option>
                        <option value="90">90</option>
                        <option value="95">95</option>
                        <option value="100">100</option>
                    </select>
                </div>
                
                <!-- C row -->
                <div class="selector-row-stack">
                    <label class="selector-label-stack">C:</label>
                    <select id="option7Select" class="select-stack"><option value="">--</option><option value="2">60/40</option><option value="3">WavRyder QQQ</option><option value="4">WavRyder SP500</option><option value="5">WavRyder(H)</option><option value="6">WavRyder(M)</option><option value="7">WavRyder(L)</option><option value="8">WavRyder QQQ (Leveraged)</option><option value="9">WavRyder SP500 (Leveraged)</option><option value="10">WavRyder QQQ/SP500 Leveraged)</option><option value="11">QQQ (Leveraged) W/O WavRyder</option><option value="12">SP 500</option><option value="13">AGG</option><option value="14">WavRyder AGG</option><option value="15">VEA</option><option value="16">WavRyder VEA</option><option value="17">QQQ</option><option value="18">SPY</option><option value="19">WavRyder SPY</option></select>
                    <label class="selector-label-stack">%:</label>
                    <select id="allocation7Select" class="select-stack select-alloc-stack">
                        <option value="0">0</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="25">25</option>
                        <option value="30">30</option>
                        <option value="35">35</option>
                        <option value="40">40</option>
                        <option value="45">45</option>
                        <option value="50">50</option>
                        <option value="55">55</option>
                        <option value="60">60</option>
                        <option value="65">65</option>
                        <option value="70">70</option>
                        <option value="75">75</option>
                        <option value="80">80</option>
                        <option value="85">85</option>
                        <option value="90">90</option>
                        <option value="95">95</option>
                        <option value="100">100</option>
                    </select>
                </div>
                
                <!-- D row -->
                <div class="selector-row-stack">
                    <label class="selector-label-stack">D:</label>
                    <select id="option8Select" class="select-stack"><option value="">--</option><option value="2">60/40</option><option value="3">WavRyder QQQ</option><option value="4">WavRyder SP500</option><option value="5">WavRyder(H)</option><option value="6">WavRyder(M)</option><option value="7">WavRyder(L)</option><option value="8">WavRyder QQQ (Leveraged)</option><option value="9">WavRyder SP500 (Leveraged)</option><option value="10">WavRyder QQQ/SP500 Leveraged)</option><option value="11">QQQ (Leveraged) W/O WavRyder</option><option value="12">SP 500</option><option value="13">AGG</option><option value="14">WavRyder AGG</option><option value="15">VEA</option><option value="16">WavRyder VEA</option><option value="17">QQQ</option><option value="18">SPY</option><option value="19">WavRyder SPY</option></select>
                    <label class="selector-label-stack">%:</label>
                    <select id="allocation8Select" class="select-stack select-alloc-stack">
                        <option value="0">0</option>
                        <option value="5">5</option>
                        <option value="10">10</option>
                        <option value="15">15</option>
                        <option value="20">20</option>
                        <option value="25">25</option>
                        <option value="30">30</option>
                        <option value="35">35</option>
                        <option value="40">40</option>
                        <option value="45">45</option>
                        <option value="50">50</option>
                        <option value="55">55</option>
                        <option value="60">60</option>
                        <option value="65">65</option>
                        <option value="70">70</option>
                        <option value="75">75</option>
                        <option value="80">80</option>
                        <option value="85">85</option>
                        <option value="90">90</option>
                        <option value="95">95</option>
                        <option value="100">100</option>
                    </select>
                </div>
                
                <button class="upload-button" style="padding: 8px 20px; font-size: 14px; margin-top: 15px;" onclick="updateComparison()">
                    üîÑ Update
                </button>
            </div>
            
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage" style="display: block;">‚úì Performance data loaded successfully!</div>
        </div>

        <div id="reportContent" style="display: none;">
            <div class="copy-button-container" id="copyButtonsContainer" style="display: none;">
                <button class="copy-button" onclick="copyAllAsImage()" style="background: linear-gradient(135deg, #28a745, #218838);">
                    üìë Copy All
                </button>
                <button class="copy-button" onclick="copyReportAsImage()">
                    üìã Copy Performance Report
                </button>
                <button class="copy-button" onclick="copyGrowthChartAsImage()" style="background: linear-gradient(135deg, #17a2b8, #138496);">
                    üìà Copy Growth Chart
                </button>
                <button class="copy-button" onclick="copyRiskMetricsAsImage()" style="background: linear-gradient(135deg, #dc3545, #c82333);">
                    üìä Copy Risk Metrics
                </button>
                <div class="copy-status" id="copyStatus"></div>
            </div>

            <div id="presentationContent">
                <div class="header">
                    <div style="text-align: center; margin-bottom: 15px;">
                        <img src="data:image/png;base64,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" alt="WavRyder Logo" style="max-width: 180px; height: auto;">
                    </div>
                    <h1>Historical Performance Comparison</h1>
                </div>

                <div class="section-header">Performance Metrics</div>
                <div id="portfolioKey" style="text-align: center; font-size: 13px; color: #666; font-style: italic; margin-top: 3px; margin-bottom: 8px;">
                    <span id="portfolio1Description">Portfolio 1</span> vs <span id="portfolio2Description">Portfolio 2</span>
                </div>
                
                <!-- Pie Charts for Portfolio Allocation -->
                <div id="pieChartsSection" class="pie-charts-container" style="display: none;">
                    <div class="pie-chart-wrapper">
                        <div class="pie-chart-title" id="pieChart1Title">Portfolio 1 Allocation</div>
                        <canvas id="pieChart1" class="pie-chart-canvas"></canvas>
                    </div>
                    <div class="pie-chart-wrapper">
                        <div class="pie-chart-title" id="pieChart2Title">Portfolio 2 Allocation</div>
                        <canvas id="pieChart2" class="pie-chart-canvas"></canvas>
                    </div>
                </div>
                
                <table class="performance-table">
                    <thead>
                        <tr>
                            <th>Return Type</th>
                            <th>Period</th>
                            <th id="col1HeaderTable">Option 1</th>
                            <th id="col2HeaderTable">Option 2</th>
                            <th>Difference</th>
                        </tr>
                    </thead>
                    <tbody id="performanceTableBody">
                    </tbody>
                </table>

                <div class="section-header">20-Year Investment Lookback Analysis</div>
                <div class="metrics-container">
                    <div class="metric-card">
                        <div class="metric-title">$100k Investment Growth</div>
                        <table class="metric-table">
                            <tbody><tr>
                                <td id="col1Label1">Option 1:</td>
                                <td class="neutral" id="option1_100k">$0</td>
                            </tr>
                            <tr>
                                <td id="col2Label1">Option 2:</td>
                                <td class="neutral" id="option2_100k">$0</td>
                            </tr>
                            <tr>
                                <td>Difference:</td>
                                <td class="positive" id="diff100k">$0</td>
                            </tr>
                        </tbody></table>
                    </div>

                    <div class="metric-card">
                        <div class="metric-title">Max Annual Drawdown</div>
                        <table class="metric-table">
                            <tbody><tr>
                                <td id="col1Label2">Option 1:</td>
                                <td class="neutral" id="option1Drawdown">0%</td>
                            </tr>
                            <tr>
                                <td id="col2Label2">Option 2:</td>
                                <td class="neutral" id="option2Drawdown">0%</td>
                            </tr>
                            <tr>
                                <td>Difference:</td>
                                <td class="positive" id="drawdownDiff">0%</td>
                            </tr>
                        </tbody></table>
                    </div>
                </div>
                <div style="text-align: center; font-size: 11px; color: #999; font-style: italic; margin-top: 6px;">
                    <strong>Methodology Notes:</strong>
                    <ul style="text-align: left; display: inline-block; margin: 5px 0;">
                        <li>Back-test CAGRs and growth from daily model</li>
                        <li><strong>Multi-model portfolios assume annual rebalancing to target allocations</strong></li>
                        <li>Max annual drawdown based on year-end values</li>
                        <li>Transaction costs, taxes, and slippage not included</li>
                        <li>20-year period is 19.99 years</li>
                    </ul>
                </div>
                
                <div class="section-header" style="margin-top: 15px;">Portfolio Growth Over Time</div>
                <div id="growthChartContent" style="background: #ffffff; padding: 15px; border-radius: 8px; margin-top: 6px;">
                    <div style="text-align: center; margin-bottom: 10px;">
                        <h3 style="font-size: 18px; color: #1a1a1a; font-weight: 600; margin-bottom: 3px;">$100K Growth Over 20 Years</h3>
                        <div id="chartSubtitle" style="font-size: 13px; color: #666; font-style: italic;">Portfolio Comparison</div>
                    </div>
                    <div style="position: relative; height: 400px;">
                        <canvas id="growthChart"></canvas>
                    </div>
                    <div style="text-align: center; font-size: 11px; color: #999; font-style: italic; margin-top: 8px;">
                        Growth calculated from annual returns with annual rebalancing.
                    </div>
                </div>
                
                <div class="section-header" style="margin-top: 15px;">Advanced Risk Metrics</div>
                <div style="text-align: center; font-size: 13px; color: #666; font-style: italic; margin-top: 3px; margin-bottom: 8px;">
                    <span id="portfolio1DescriptionRisk">Portfolio 1</span> vs <span id="portfolio2DescriptionRisk">Portfolio 2</span>
                </div>
                <div id="riskMetricsContent" style="background: #fafbfc; padding: 12px; border-radius: 8px; margin-top: 6px;">
                    <div class="metrics-container">
                        <div class="metric-card">
                            <div class="metric-title">Beta (vs S&amp;P 500)</div>
                            <table class="metric-table">
                                <tbody><tr>
                                    <td id="col1Label3">Portfolio 1:</td>
                                    <td class="neutral" id="option1Beta">0.00</td>
                                </tr>
                                <tr>
                                    <td id="col2Label3">Portfolio 2:</td>
                                    <td class="neutral" id="option2Beta">0.00</td>
                                </tr>
                                <tr>
                                    <td>Difference:</td>
                                    <td class="positive" id="betaDiff">0.00</td>
                                </tr>
                            </tbody></table>
                        </div>

                        <div class="metric-card">
                            <div class="metric-title">Expected Return</div>
                            <table class="metric-table">
                                <tbody><tr>
                                    <td id="col1Label4">Portfolio 1:</td>
                                    <td class="neutral" id="option1ExpReturn">0.0%</td>
                                </tr>
                                <tr>
                                    <td id="col2Label4">Portfolio 2:</td>
                                    <td class="neutral" id="option2ExpReturn">0.0%</td>
                                </tr>
                                <tr>
                                    <td>Difference:</td>
                                    <td class="positive" id="expReturnDiff">0.0%</td>
                                </tr>
                            </tbody></table>
                        </div>

                        <div class="metric-card">
                            <div class="metric-title">Alpha (vs S&amp;P 500)</div>
                            <table class="metric-table">
                                <tbody><tr>
                                    <td id="col1Label5">Portfolio 1:</td>
                                    <td class="neutral" id="option1Alpha">0.0%</td>
                                </tr>
                                <tr>
                                    <td id="col2Label5">Portfolio 2:</td>
                                    <td class="neutral" id="option2Alpha">0.0%</td>
                                </tr>
                                <tr>
                                    <td>Difference:</td>
                                    <td class="positive" id="alphaDiff">0.0%</td>
                                </tr>
                            </tbody></table>
                        </div>

                        <div class="metric-card">
                            <div class="metric-title">Sharpe Ratio</div>
                            <table class="metric-table">
                                <tbody><tr>
                                    <td id="col1Label6">Portfolio 1:</td>
                                    <td class="neutral" id="option1Sharpe">0.00</td>
                                </tr>
                                <tr>
                                    <td id="col2Label6">Portfolio 2:</td>
                                    <td class="neutral" id="option2Sharpe">0.00</td>
                                </tr>
                                <tr>
                                    <td>Difference:</td>
                                    <td class="positive" id="sharpeDiff">0.00</td>
                                </tr>
                            </tbody></table>
                        </div>

                        <div class="metric-card">
                            <div class="metric-title">Sortino Ratio</div>
                            <table class="metric-table">
                                <tbody><tr>
                                    <td id="col1Label7">Portfolio 1:</td>
                                    <td class="neutral" id="option1Sortino">0.00</td>
                                </tr>
                                <tr>
                                    <td id="col2Label7">Portfolio 2:</td>
                                    <td class="neutral" id="option2Sortino">0.00</td>
                                </tr>
                                <tr>
                                    <td>Difference:</td>
                                    <td class="positive" id="sortinoDiff">0.00</td>
                                </tr>
                            </tbody></table>
                        </div>

                        <div class="metric-card">
                            <div class="metric-title">Treynor Ratio</div>
                            <table class="metric-table">
                                <tbody><tr>
                                    <td id="col1Label8">Portfolio 1:</td>
                                    <td class="neutral" id="option1Treynor">0.000</td>
                                </tr>
                                <tr>
                                    <td id="col2Label8">Portfolio 2:</td>
                                    <td class="neutral" id="option2Treynor">0.000</td>
                                </tr>
                                <tr>
                                    <td>Difference:</td>
                                    <td class="positive" id="treynorDiff">0.000</td>
                                </tr>
                            </tbody></table>
                        </div>

                        <div class="metric-card">
                            <div class="metric-title">Volatility (Std Dev)</div>
                            <table class="metric-table">
                                <tbody><tr>
                                    <td id="col1Label9">Portfolio 1:</td>
                                    <td class="neutral" id="option1Vol">0.00%</td>
                                </tr>
                                <tr>
                                    <td id="col2Label9">Portfolio 2:</td>
                                    <td class="neutral" id="option2Vol">0.00%</td>
                                </tr>
                                <tr>
                                    <td>Difference:</td>
                                    <td class="positive" id="volDiff">0.00%</td>
                                </tr>
                            </tbody></table>
                        </div>

                        <div class="metric-card">
                            <div class="metric-title">Win Rate</div>
                            <table class="metric-table">
                                <tbody><tr>
                                    <td id="col1Label10">Portfolio 1:</td>
                                    <td class="neutral" id="option1WinRate">0.0%</td>
                                </tr>
                                <tr>
                                    <td id="col2Label10">Portfolio 2:</td>
                                    <td class="neutral" id="option2WinRate">0.0%</td>
                                </tr>
                                <tr>
                                    <td>Difference:</td>
                                    <td class="positive" id="winRateDiff">0.0%</td>
                                </tr>
                            </tbody></table>
                        </div>
                    </div>
                    <div style="text-align: center; font-size: 11px; color: #999; font-style: italic; margin-top: 6px;">
                        Sharpe, Sortino, Alpha &amp; Beta use 3% risk-free rate. S&amp;P 500 benchmark. Calculated from annual returns.
                    </div>
                    
                    <div style="margin-top: 12px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 12px; line-height: 1.5;">
                        <div style="font-weight: 600; color: #1a1a1a; margin-bottom: 6px;">Ratio Definitions:</div>
                        <div style="color: #495057;">
                            <strong>Beta:</strong> Volatility vs S&amp;P 500; &lt;1.0 = less volatile, &gt;1.0 = more volatile.<br>
                            <strong>Expected Return:</strong> Return predicted by CAPM given the portfolio's risk level (Beta).<br>
                            <strong>Alpha:</strong> Excess return vs risk-adjusted benchmark; positive means outperformance.<br>
                            <strong>Sharpe:</strong> Risk-adjusted return using total volatility; higher is better.<br>
                            <strong>Sortino:</strong> Like Sharpe but only penalizes downside volatility; higher is better.<br>
                            <strong>Treynor:</strong> Return per unit of market risk (Beta); higher is better.<br>
                            <strong>Volatility:</strong> Standard deviation of returns; lower means more stable.<br>
                            <strong>Win Rate:</strong> Percentage of positive years; higher means more consistent gains.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================================================
        // DATA FLOW EXPLANATION (SIMPLIFIED):
        // 1. On page load: excelData is initialized from EXCEL_DATA (hard-coded in HTML)
        // 2. User visits URL#update: "Update Tool Data" section becomes visible
        // 3. User uploads new Excel: 
        //    - File is parsed and validated
        //    - New EXCEL_DATA is immediately baked into HTML code
        //    - Updated index.html auto-downloads
        //    - User replaces file and refreshes
        // 4. Page reloads with new EXCEL_DATA baked in
        // 
        // KEY POINT: No temporary memory storage - data goes straight into HTML code!
        // ============================================================================
        
        const DATA_FILE_LOADED = typeof EXCEL_DATA !== 'undefined';
        
        // Initialize working data from hard-coded EXCEL_DATA
        let excelData = EXCEL_DATA;
        let columnHeaders = [];
        let yearsValue = 20; // Default, will be read from A17
        let growthChart = null; // Chart.js instance
        
        // Function to process Excel data (used by both file upload and data file)
        function processExcelData(jsonData) {
            excelData = jsonData;
            
            // Read years value from A17 (row 17, column 0)
            if (jsonData[16] && jsonData[16][0]) {
                yearsValue = parseFloat(jsonData[16][0]);
            }
            
            // Parse headers - create array of objects with index and name
            columnHeaders = [];
            const nameRow = jsonData[1]; // Row with names like "60/40", "WavRyder QQQ", etc.
            
            // Add options from column headers (skip first two: "Performance Measure" and empty)
            for (let i = 2; i < nameRow.length; i++) {
                if (nameRow[i]) {
                    columnHeaders.push({
                        index: i,
                        name: nameRow[i]
                    });
                }
            }
            
            // Populate dropdowns
            const selectors = [
                document.getElementById('option1Select'),
                document.getElementById('option2Select'),
                document.getElementById('option3Select'),
                document.getElementById('option4Select'),
                document.getElementById('option5Select'),
                document.getElementById('option6Select'),
                document.getElementById('option7Select'),
                document.getElementById('option8Select')
            ];
            
            // Clear existing options except the first one
            selectors.forEach(select => {
                while (select.options.length > 1) {
                    select.remove(1);
                }
            });
            
            // Add options from column headers
            columnHeaders.forEach(header => {
                selectors.forEach(select => {
                    const option = document.createElement('option');
                    option.value = header.index;
                    option.textContent = header.name;
                    select.appendChild(option);
                });
            });
        }
        
        // Auto-load data from performance_data.js if available
        if (DATA_FILE_LOADED) {
            window.addEventListener('DOMContentLoaded', () => {
                processExcelData(EXCEL_DATA);
                
                // Show portfolio containers since data is loaded
                document.getElementById('portfolio1Container').style.display = 'block';
                document.getElementById('portfolio2Container').style.display = 'block';
                
                // Hide the upload button since data is already loaded
                const uploadRow = document.querySelector('.upload-row');
                if (uploadRow) {
                    uploadRow.style.display = 'none';
                }
                
                // Check if URL has #update - show update section only for admin
                if (window.location.hash === '#update') {
                    const updateSection = document.getElementById('updateDataSection');
                    if (updateSection) {
                        updateSection.style.display = 'block';
                    }
                }
                
                // Check if URL has #local - show copy buttons for local testing
                if (window.location.hash === '#local') {
                    const copyButtons = document.getElementById('copyButtonsContainer');
                    if (copyButtons) {
                        copyButtons.style.display = 'block';
                    }
                }
                
                const successMsg = document.getElementById('successMessage');
                successMsg.textContent = '‚úì Performance data loaded successfully!';
                successMsg.style.display = 'block';
            });
        }
        
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const errorMsg = document.getElementById('errorMessage');
            const successMsg = document.getElementById('successMessage');
            
            errorMsg.style.display = 'none';
            successMsg.style.display = 'none';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                    
                    if (jsonData.length < 2) {
                        throw new Error('Excel file must have at least 2 rows');
                    }
                    
                    excelData = jsonData;
                    
                    // Read years value from A17 (row 17, column A = index [16][0])
                    if (jsonData[16] && jsonData[16][0]) {
                        yearsValue = parseFloat(jsonData[16][0]);
                        if (isNaN(yearsValue) || yearsValue <= 0) {
                            yearsValue = 20; // Fallback to 20 if invalid
                        }
                    }
                    
                    // Parse headers - automatically detect all available columns
                    columnHeaders = [];
                    const letterRow = jsonData[0];
                    const nameRow = jsonData[1];
                    
                    // Start from column 2 (index 2) and check all columns until we hit empty ones
                    for (let i = 2; i < letterRow.length; i++) {
                        // Include column if it has either a letter OR a name (more flexible)
                        if (letterRow[i] || nameRow[i]) {
                            columnHeaders.push({
                                letter: letterRow[i] || `Col${i}`,
                                name: nameRow[i] || letterRow[i] || `Column ${i}`,
                                index: i
                            });
                        }
                    }
                    
                    // Also check if there are more columns beyond the current length
                    // by looking at the data rows to find the actual last column with data
                    let maxCol = letterRow.length;
                    for (let rowIdx = 2; rowIdx < Math.min(15, jsonData.length); rowIdx++) {
                        if (jsonData[rowIdx] && jsonData[rowIdx].length > maxCol) {
                            maxCol = jsonData[rowIdx].length;
                        }
                    }
                    
                    // Add any additional columns found in data rows
                    for (let i = letterRow.length; i < maxCol; i++) {
                        // Check if this column has data in any of the first few data rows
                        let hasData = false;
                        for (let rowIdx = 2; rowIdx < Math.min(15, jsonData.length); rowIdx++) {
                            if (jsonData[rowIdx] && jsonData[rowIdx][i]) {
                                hasData = true;
                                break;
                            }
                        }
                        
                        if (hasData) {
                            columnHeaders.push({
                                letter: `Col${String.fromCharCode(65 + i - 2)}`,
                                name: `Column ${String.fromCharCode(65 + i - 2)}`,
                                index: i
                            });
                        }
                    }
                    
                    if (columnHeaders.length === 0) {
                        throw new Error('No valid options found in Excel file');
                    }
                    
                    populateSelectors();
                    
                    successMsg.textContent = `‚úì File loaded! Found ${columnHeaders.length} options.`;
                    successMsg.style.display = 'block';
                    document.getElementById('selectorRow').style.display = 'flex';
                    document.getElementById('selectorRow2').style.display = 'flex';
                    
                    setTimeout(() => {
                        successMsg.style.display = 'none';
                    }, 3000);
                    
                } catch (error) {
                    errorMsg.textContent = '‚ùå Error: ' + error.message;
                    errorMsg.style.display = 'block';
                }
            };
            
            reader.onerror = function() {
                errorMsg.textContent = '‚ùå Error reading file';
                errorMsg.style.display = 'block';
            };
            
            reader.readAsArrayBuffer(file);
        });
        
        function populateSelectors() {
            const option1Select = document.getElementById('option1Select');
            const option2Select = document.getElementById('option2Select');
            const option3Select = document.getElementById('option3Select');
            const option4Select = document.getElementById('option4Select');
            
            option1Select.innerHTML = '<option value="">-- Select --</option>';
            option2Select.innerHTML = '<option value="">-- Select --</option>';
            option3Select.innerHTML = '<option value="">-- Select --</option>';
            option4Select.innerHTML = '<option value="">-- Select --</option>';
            
            columnHeaders.forEach((header) => {
                const opt1 = document.createElement('option');
                opt1.value = header.index;
                opt1.textContent = `${header.letter} - ${header.name}`;
                option1Select.appendChild(opt1);
                
                const opt2 = document.createElement('option');
                opt2.value = header.index;
                opt2.textContent = `${header.letter} - ${header.name}`;
                option2Select.appendChild(opt2);
                
                const opt3 = document.createElement('option');
                opt3.value = header.index;
                opt3.textContent = `${header.letter} - ${header.name}`;
                option3Select.appendChild(opt3);
                
                const opt4 = document.createElement('option');
                opt4.value = header.index;
                opt4.textContent = `${header.letter} - ${header.name}`;
                option4Select.appendChild(opt4);
            });
        }
        
        function calculateCAGRFromAnnualReturns(colIndex, startYear, endYear) {
            // Annual returns start at row 21 (index 20) for Year 1
            // Calculate compound annual growth rate from individual year returns
            let compoundedValue = 1.0;
            
            for (let year = startYear; year <= endYear; year++) {
                const rowIndex = 19 + year; // Row 21 = Year 1, so index 20 = 19 + 1
                const row = excelData[rowIndex];
                if (row && row[colIndex] !== null && row[colIndex] !== undefined) {
                    const yearReturn = typeof row[colIndex] === 'number' ? row[colIndex] : parseValue(row[colIndex]);
                    compoundedValue *= (1 + yearReturn);
                }
            }
            
            // Convert to CAGR: (Final/Initial)^(1/years) - 1
            const years = endYear - startYear + 1;
            const cagr = Math.pow(compoundedValue, 1/years) - 1;
            return cagr;
        }
        
        function calculateBlendedCAGR(col1, alloc1, col2, alloc2, col3, alloc3, col4, alloc4, col5, alloc5, col6, alloc6, col7, alloc7, col8, alloc8, startYear, endYear) {
            // Calculate blended annual returns year by year, then derive CAGR
            let compoundedValue = 1.0;
            
            for (let year = startYear; year <= endYear; year++) {
                const rowIndex = 19 + year;
                const row = excelData[rowIndex];
                
                let blendedReturn = 0;
                if (col1 && alloc1 > 0 && row && row[col1] !== null) {
                    const ret1 = typeof row[col1] === 'number' ? row[col1] : parseValue(row[col1]);
                    blendedReturn += ret1 * (alloc1 / 100);
                }
                if (col2 && alloc2 > 0 && row && row[col2] !== null) {
                    const ret2 = typeof row[col2] === 'number' ? row[col2] : parseValue(row[col2]);
                    blendedReturn += ret2 * (alloc2 / 100);
                }
                if (col3 && alloc3 > 0 && row && row[col3] !== null) {
                    const ret3 = typeof row[col3] === 'number' ? row[col3] : parseValue(row[col3]);
                    blendedReturn += ret3 * (alloc3 / 100);
                }
                if (col4 && alloc4 > 0 && row && row[col4] !== null) {
                    const ret4 = typeof row[col4] === 'number' ? row[col4] : parseValue(row[col4]);
                    blendedReturn += ret4 * (alloc4 / 100);
                }
                if (col5 && alloc5 > 0 && row && row[col5] !== null) {
                    const ret5 = typeof row[col5] === 'number' ? row[col5] : parseValue(row[col5]);
                    blendedReturn += ret5 * (alloc5 / 100);
                }
                if (col6 && alloc6 > 0 && row && row[col6] !== null) {
                    const ret6 = typeof row[col6] === 'number' ? row[col6] : parseValue(row[col6]);
                    blendedReturn += ret6 * (alloc6 / 100);
                }
                if (col7 && alloc7 > 0 && row && row[col7] !== null) {
                    const ret7 = typeof row[col7] === 'number' ? row[col7] : parseValue(row[col7]);
                    blendedReturn += ret7 * (alloc7 / 100);
                }
                if (col8 && alloc8 > 0 && row && row[col8] !== null) {
                    const ret8 = typeof row[col8] === 'number' ? row[col8] : parseValue(row[col8]);
                    blendedReturn += ret8 * (alloc8 / 100);
                }
                
                compoundedValue *= (1 + blendedReturn);
            }
            
            const years = endYear - startYear + 1;
            const cagr = Math.pow(compoundedValue, 1/years) - 1;
            return cagr;
        }
        
        function calculateMaxDrawdown(col1, alloc1, col2, alloc2, col3, alloc3, col4, alloc4) {
            // Calculate true maximum drawdown from annual returns
            let portfolioValue = 100000;
            let peak = portfolioValue;
            let maxDrawdown = 0;
            
            const years = Math.round(yearsValue); // Use value from A17
            
            for (let year = 1; year <= years; year++) {
                const rowIndex = 19 + year;
                const row = excelData[rowIndex];
                
                let blendedReturn = 0;
                if (col1 && alloc1 > 0 && row && row[col1] !== null) {
                    const ret1 = typeof row[col1] === 'number' ? row[col1] : parseValue(row[col1]);
                    blendedReturn += ret1 * (alloc1 / 100);
                }
                if (col2 && alloc2 > 0 && row && row[col2] !== null) {
                    const ret2 = typeof row[col2] === 'number' ? row[col2] : parseValue(row[col2]);
                    blendedReturn += ret2 * (alloc2 / 100);
                }
                if (col3 && alloc3 > 0 && row && row[col3] !== null) {
                    const ret3 = typeof row[col3] === 'number' ? row[col3] : parseValue(row[col3]);
                    blendedReturn += ret3 * (alloc3 / 100);
                }
                if (col4 && alloc4 > 0 && row && row[col4] !== null) {
                    const ret4 = typeof row[col4] === 'number' ? row[col4] : parseValue(row[col4]);
                    blendedReturn += ret4 * (alloc4 / 100);
                }
                
                portfolioValue *= (1 + blendedReturn);
                
                if (portfolioValue > peak) {
                    peak = portfolioValue;
                }
                
                const drawdown = (portfolioValue - peak) / peak;
                if (drawdown < maxDrawdown) {
                    maxDrawdown = drawdown;
                }
            }
            
            return maxDrawdown;
        }
        
        function calculateInvestmentGrowth(col1, alloc1, col2, alloc2, col3, alloc3, col4, alloc4) {
            // Calculate actual compounded growth from annual returns with rebalancing
            let portfolioValue = 100000;
            
            const years = Math.round(yearsValue); // Use value from A17
            
            for (let year = 1; year <= years; year++) {
                const rowIndex = 19 + year;
                const row = excelData[rowIndex];
                
                let blendedReturn = 0;
                if (col1 && alloc1 > 0 && row && row[col1] !== null) {
                    const ret1 = typeof row[col1] === 'number' ? row[col1] : parseValue(row[col1]);
                    blendedReturn += ret1 * (alloc1 / 100);
                }
                if (col2 && alloc2 > 0 && row && row[col2] !== null) {
                    const ret2 = typeof row[col2] === 'number' ? row[col2] : parseValue(row[col2]);
                    blendedReturn += ret2 * (alloc2 / 100);
                }
                if (col3 && alloc3 > 0 && row && row[col3] !== null) {
                    const ret3 = typeof row[col3] === 'number' ? row[col3] : parseValue(row[col3]);
                    blendedReturn += ret3 * (alloc3 / 100);
                }
                if (col4 && alloc4 > 0 && row && row[col4] !== null) {
                    const ret4 = typeof row[col4] === 'number' ? row[col4] : parseValue(row[col4]);
                    blendedReturn += ret4 * (alloc4 / 100);
                }
                
                portfolioValue *= (1 + blendedReturn);
            }
            
            return portfolioValue;
        }

        function calculateRiskMetrics(col1, alloc1, col2, alloc2, col3, alloc3, col4, alloc4) {
            const years = Math.round(yearsValue);
            const returns = [];
            const sp500Returns = [];
            const sp500ColIndex = 12; // Column M (S&P 500) - 0-based index
            
            // Collect blended annual returns and S&P 500 returns
            for (let year = 1; year <= years; year++) {
                const rowIndex = 19 + year;
                const row = excelData[rowIndex];
                
                let blendedReturn = 0;
                if (col1 && alloc1 > 0 && row && row[col1] !== null) {
                    const ret1 = typeof row[col1] === 'number' ? row[col1] : parseValue(row[col1]);
                    blendedReturn += ret1 * (alloc1 / 100);
                }
                if (col2 && alloc2 > 0 && row && row[col2] !== null) {
                    const ret2 = typeof row[col2] === 'number' ? row[col2] : parseValue(row[col2]);
                    blendedReturn += ret2 * (alloc2 / 100);
                }
                if (col3 && alloc3 > 0 && row && row[col3] !== null) {
                    const ret3 = typeof row[col3] === 'number' ? row[col3] : parseValue(row[col3]);
                    blendedReturn += ret3 * (alloc3 / 100);
                }
                if (col4 && alloc4 > 0 && row && row[col4] !== null) {
                    const ret4 = typeof row[col4] === 'number' ? row[col4] : parseValue(row[col4]);
                    blendedReturn += ret4 * (alloc4 / 100);
                }
                
                returns.push(blendedReturn);
                
                // Get S&P 500 return
                if (row && row[sp500ColIndex] !== null && row[sp500ColIndex] !== undefined) {
                    const spRet = typeof row[sp500ColIndex] === 'number' ? row[sp500ColIndex] : parseValue(row[sp500ColIndex]);
                    sp500Returns.push(spRet);
                }
            }
            
            // Calculate mean (Expected Return)
            const mean = returns.reduce((sum, r) => sum + r, 0) / returns.length;
            const sp500Mean = sp500Returns.reduce((sum, r) => sum + r, 0) / sp500Returns.length;
            
            // Calculate standard deviation
            const squaredDiffs = returns.map(r => Math.pow(r - mean, 2));
            const variance = squaredDiffs.reduce((sum, sq) => sum + sq, 0) / (returns.length - 1);
            const stdDev = Math.sqrt(variance);
            
            // Sharpe Ratio (3% risk-free rate)
            const riskFree = 0.03;
            const sharpe = (mean - riskFree) / stdDev;
            
            // Sortino Ratio (downside deviation)
            const downsideReturns = returns.filter(r => r < 0);
            let sortino = 0;
            if (downsideReturns.length > 1) {
                const downsideMean = 0;
                const downsideSquaredDiffs = downsideReturns.map(r => Math.pow(r - downsideMean, 2));
                const downsideVariance = downsideSquaredDiffs.reduce((sum, sq) => sum + sq, 0) / (downsideReturns.length - 1);
                const downsideDev = Math.sqrt(downsideVariance);
                sortino = (mean - riskFree) / downsideDev;
            } else {
                sortino = sharpe; // Fallback if insufficient downside data
            }
            
            // Win Rate
            const positiveYears = returns.filter(r => r > 0).length;
            const winRate = positiveYears / returns.length;
            
            // Calculate CAGR for Alpha (compound annual growth rate)
            let compoundedValue = 1.0;
            for (let i = 0; i < returns.length; i++) {
                compoundedValue *= (1 + returns[i]);
            }
            const cagr = Math.pow(compoundedValue, 1/returns.length) - 1;
            
            // Beta calculation
            const covariance = returns.reduce((sum, ret, i) => 
                sum + (ret - mean) * (sp500Returns[i] - sp500Mean), 0) / (returns.length - 1);
            const sp500Variance = sp500Returns.reduce((sum, ret) => 
                sum + Math.pow(ret - sp500Mean, 2), 0) / (sp500Returns.length - 1);
            const beta = sp500Variance !== 0 ? covariance / sp500Variance : 0;
            
            // Expected Return (CAPM) = Risk-Free + Beta * (Market Return - Risk-Free)
            const expectedReturn = riskFree + beta * (sp500Mean - riskFree);
            
            // Alpha = Arithmetic Mean - Expected Return (not CAGR, because it's based on Beta/regression)
            const alpha = mean - expectedReturn;
            
            // Treynor Ratio = (Arithmetic Mean - Risk-Free) / Beta (uses mean because it's based on Beta)
            const treynor = beta !== 0 ? (mean - riskFree) / beta : 0;
            
            return {
                sharpe: sharpe,
                sortino: sortino,
                volatility: stdDev,
                winRate: winRate,
                expectedReturn: expectedReturn,
                beta: beta,
                alpha: alpha,
                treynor: treynor
            };
        }

        function updateComparison() {
            const option1Index = parseInt(document.getElementById('option1Select').value) || 0;
            const option2Index = parseInt(document.getElementById('option2Select').value) || 0;
            const option3Index = parseInt(document.getElementById('option3Select').value) || 0;
            const option4Index = parseInt(document.getElementById('option4Select').value) || 0;
            const option5Index = parseInt(document.getElementById('option5Select').value) || 0;
            const option6Index = parseInt(document.getElementById('option6Select').value) || 0;
            const option7Index = parseInt(document.getElementById('option7Select').value) || 0;
            const option8Index = parseInt(document.getElementById('option8Select').value) || 0;
            
            const alloc1 = parseInt(document.getElementById('allocation1Select').value);
            const alloc2 = parseInt(document.getElementById('allocation2Select').value);
            const alloc3 = parseInt(document.getElementById('allocation3Select').value);
            const alloc4 = parseInt(document.getElementById('allocation4Select').value);
            const alloc5 = parseInt(document.getElementById('allocation5Select').value);
            const alloc6 = parseInt(document.getElementById('allocation6Select').value);
            const alloc7 = parseInt(document.getElementById('allocation7Select').value);
            const alloc8 = parseInt(document.getElementById('allocation8Select').value);
            
            // Validate Portfolio 1
            if (!option1Index && !option2Index && !option5Index && !option6Index) {
                alert('Please select at least one model for Portfolio 1');
                return;
            }
            
            if (alloc1 + alloc2 + alloc5 + alloc6 !== 100) {
                alert('Portfolio 1 allocations must total 100%');
                return;
            }
            
            // Validate Portfolio 2
            if (!option3Index && !option4Index && !option7Index && !option8Index) {
                alert('Please select at least one model for Portfolio 2');
                return;
            }
            
            if (alloc3 + alloc4 + alloc7 + alloc8 !== 100) {
                alert('Portfolio 2 allocations must total 100%');
                return;
            }
            
            generateComparison(option1Index, alloc1, option2Index, alloc2, option5Index, alloc5, option6Index, alloc6,
                             option3Index, alloc3, option4Index, alloc4, option7Index, alloc7, option8Index, alloc8);
        }
        
        function generateComparison(col1, alloc1, col2, alloc2, col5, alloc5, col6, alloc6, 
                                      col3, alloc3, col4, alloc4, col7, alloc7, col8, alloc8) {
            // Get headers
            const header1 = col1 ? columnHeaders.find(h => h.index === col1) : null;
            const header2 = col2 ? columnHeaders.find(h => h.index === col2) : null;
            const header3 = col3 ? columnHeaders.find(h => h.index === col3) : null;
            const header4 = col4 ? columnHeaders.find(h => h.index === col4) : null;
            const header5 = col5 ? columnHeaders.find(h => h.index === col5) : null;
            const header6 = col6 ? columnHeaders.find(h => h.index === col6) : null;
            const header7 = col7 ? columnHeaders.find(h => h.index === col7) : null;
            const header8 = col8 ? columnHeaders.find(h => h.index === col8) : null;
            
            // Build portfolio names
            let portfolio1Name = '';
            if (header1 && alloc1 > 0) portfolio1Name += `${alloc1}% ${header1.name}`;
            if (header2 && alloc2 > 0) {
                if (portfolio1Name) portfolio1Name += ' / ';
                portfolio1Name += `${alloc2}% ${header2.name}`;
            }
            if (header5 && alloc5 > 0) {
                if (portfolio1Name) portfolio1Name += ' / ';
                portfolio1Name += `${alloc5}% ${header5.name}`;
            }
            if (header6 && alloc6 > 0) {
                if (portfolio1Name) portfolio1Name += ' / ';
                portfolio1Name += `${alloc6}% ${header6.name}`;
            }
            
            let portfolio2Name = '';
            if (header3 && alloc3 > 0) portfolio2Name += `${alloc3}% ${header3.name}`;
            if (header4 && alloc4 > 0) {
                if (portfolio2Name) portfolio2Name += ' / ';
                portfolio2Name += `${alloc4}% ${header4.name}`;
            }
            if (header7 && alloc7 > 0) {
                if (portfolio2Name) portfolio2Name += ' / ';
                portfolio2Name += `${alloc7}% ${header7.name}`;
            }
            if (header8 && alloc8 > 0) {
                if (portfolio2Name) portfolio2Name += ' / ';
                portfolio2Name += `${alloc8}% ${header8.name}`;
            }
            
            // Update headers
            document.getElementById('col1HeaderTable').textContent = 'Portfolio 1';
            document.getElementById('col2HeaderTable').textContent = 'Portfolio 2';
            
            // Update portfolio description keys
            document.getElementById('portfolio1Description').textContent = portfolio1Name;
            document.getElementById('portfolio2Description').textContent = portfolio2Name;
            document.getElementById('portfolio1DescriptionRisk').textContent = portfolio1Name;
            document.getElementById('portfolio2DescriptionRisk').textContent = portfolio2Name;
            
            // Short names for labels (use "Portfolio 1/2" for simplicity)
            const shortName1 = 'Portfolio 1';
            const shortName2 = 'Portfolio 2';
            
            // Update labels
            document.getElementById('col1Label1').textContent = 'Portfolio 1:';
            document.getElementById('col1Label2').textContent = 'Portfolio 1:';
            document.getElementById('col2Label1').textContent = 'Portfolio 2:';
            document.getElementById('col2Label2').textContent = 'Portfolio 2:';
            
            // Generate performance table - calculate CAGRs from annual returns
            const tbody = document.getElementById('performanceTableBody');
            tbody.innerHTML = '';
            
            // Row 3: 1 Year (just year 20)
            const oneYearRow = excelData[2];
            if (oneYearRow && oneYearRow[0] === 'Total Return' && oneYearRow[1] === '1 year') {
                let value1 = 0;
                if (col1 && alloc1 > 0) value1 += parseValue(oneYearRow[col1]) * (alloc1 / 100);
                if (col2 && alloc2 > 0) value1 += parseValue(oneYearRow[col2]) * (alloc2 / 100);
                if (col5 && alloc5 > 0) value1 += parseValue(oneYearRow[col5]) * (alloc5 / 100);
                if (col6 && alloc6 > 0) value1 += parseValue(oneYearRow[col6]) * (alloc6 / 100);
                
                let value2 = 0;
                if (col3 && alloc3 > 0) value2 += parseValue(oneYearRow[col3]) * (alloc3 / 100);
                if (col4 && alloc4 > 0) value2 += parseValue(oneYearRow[col4]) * (alloc4 / 100);
                if (col7 && alloc7 > 0) value2 += parseValue(oneYearRow[col7]) * (alloc7 / 100);
                if (col8 && alloc8 > 0) value2 += parseValue(oneYearRow[col8]) * (alloc8 / 100);
                
                const diff = value1 - value2;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>Total Return</td>
                    <td>1 year</td>
                    <td>${formatPercent(value1)}</td>
                    <td>${formatPercent(value2)}</td>
                    <td class="${diff >= 0 ? 'positive' : 'negative'}">${formatPercent(diff)}</td>
                `;
                tbody.appendChild(tr);
            }
            
            // Row 4: YTD
            const ytdRow = excelData[3];
            if (ytdRow && ytdRow[0] === 'Total Return' && ytdRow[1] === 'YTD') {
                let value1 = 0;
                if (col1 && alloc1 > 0) value1 += parseValue(ytdRow[col1]) * (alloc1 / 100);
                if (col2 && alloc2 > 0) value1 += parseValue(ytdRow[col2]) * (alloc2 / 100);
                if (col5 && alloc5 > 0) value1 += parseValue(ytdRow[col5]) * (alloc5 / 100);
                if (col6 && alloc6 > 0) value1 += parseValue(ytdRow[col6]) * (alloc6 / 100);
                
                let value2 = 0;
                if (col3 && alloc3 > 0) value2 += parseValue(ytdRow[col3]) * (alloc3 / 100);
                if (col4 && alloc4 > 0) value2 += parseValue(ytdRow[col4]) * (alloc4 / 100);
                if (col7 && alloc7 > 0) value2 += parseValue(ytdRow[col7]) * (alloc7 / 100);
                if (col8 && alloc8 > 0) value2 += parseValue(ytdRow[col8]) * (alloc8 / 100);
                
                const diff = value1 - value2;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>Total Return</td>
                    <td>YTD</td>
                    <td>${formatPercent(value1)}</td>
                    <td>${formatPercent(value2)}</td>
                    <td class="${diff >= 0 ? 'positive' : 'negative'}">${formatPercent(diff)}</td>
                `;
                tbody.appendChild(tr);
            }
            
            // Display CAGRs from summary rows (calculated from daily model)
            // Row 5 = 5 Year, Row 6 = 10 Year, Row 7 = 15 Year, Row 8 = 20 Year
            // Calculate true CAGRs from annual returns (not weighted average of pre-calculated CAGRs)
            const cagrPeriods = [
                {label: '5 Year', startYear: Math.round(yearsValue) - 4, endYear: Math.round(yearsValue)},
                {label: '10 Year', startYear: Math.round(yearsValue) - 9, endYear: Math.round(yearsValue)},
                {label: '15 Year', startYear: Math.round(yearsValue) - 14, endYear: Math.round(yearsValue)},
                {label: `${Math.round(yearsValue)} Year`, startYear: 1, endYear: Math.round(yearsValue)}
            ];
            
            cagrPeriods.forEach(period => {
                // Calculate CAGR from actual compounded annual returns
                // Portfolio 1: slots 1,2,5,6 active, others zero
                const cagr1 = calculateBlendedCAGR(col1, alloc1, col2, alloc2, 0, 0, 0, 0, col5, alloc5, col6, alloc6, 0, 0, 0, 0, period.startYear, period.endYear);
                // Portfolio 2: slots 3,4,7,8 active, others zero
                const cagr2 = calculateBlendedCAGR(0, 0, 0, 0, col3, alloc3, col4, alloc4, 0, 0, 0, 0, col7, alloc7, col8, alloc8, period.startYear, period.endYear);
                
                const diff = cagr1 - cagr2;
                
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>CAGR</td>
                    <td>${period.label}</td>
                    <td>${formatPercent(cagr1)}</td>
                    <td>${formatPercent(cagr2)}</td>
                    <td class="${diff >= 0 ? 'positive' : 'negative'}">${formatPercent(diff)}</td>
                `;
                tbody.appendChild(tr);
            });
            
            // Calculate $100K Investment Growth using actual year-by-year compounding
            const fv1 = calculateInvestmentGrowth(col1, alloc1, col2, alloc2, col5, alloc5, col6, alloc6);
            const fv2 = calculateInvestmentGrowth(col3, alloc3, col4, alloc4, col7, alloc7, col8, alloc8);
            const fvDiff = fv1 - fv2;
            
            document.getElementById('option1_100k').textContent = formatCurrency(fv1);
            document.getElementById('option2_100k').textContent = formatCurrency(fv2);
            const diffEl = document.getElementById('diff100k');
            diffEl.textContent = formatCurrency(fvDiff);
            diffEl.className = fvDiff >= 0 ? 'positive' : 'negative';
            
            // Calculate true maximum drawdown from annual returns
            const dd1 = calculateMaxDrawdown(col1, alloc1, col2, alloc2, col5, alloc5, col6, alloc6);
            const dd2 = calculateMaxDrawdown(col3, alloc3, col4, alloc4, col7, alloc7, col8, alloc8);
            const ddDiff = dd1 - dd2;
            
            document.getElementById('option1Drawdown').textContent = formatPercent(dd1);
            document.getElementById('option2Drawdown').textContent = formatPercent(dd2);
            const ddDiffEl = document.getElementById('drawdownDiff');
            ddDiffEl.textContent = formatPercent(ddDiff);
            ddDiffEl.className = ddDiff >= 0 ? 'positive' : 'negative';
            
            // Calculate and display risk metrics
            const risk1 = calculateRiskMetrics(col1, alloc1, col2, alloc2, col5, alloc5, col6, alloc6);
            const risk2 = calculateRiskMetrics(col3, alloc3, col4, alloc4, col7, alloc7, col8, alloc8);
            
            // Update labels for risk metrics
            document.getElementById('col1Label3').textContent = shortName1 + ':';
            document.getElementById('col1Label4').textContent = shortName1 + ':';
            document.getElementById('col1Label5').textContent = shortName1 + ':';
            document.getElementById('col1Label6').textContent = shortName1 + ':';
            document.getElementById('col1Label7').textContent = shortName1 + ':';
            document.getElementById('col1Label8').textContent = shortName1 + ':';
            document.getElementById('col1Label9').textContent = shortName1 + ':';
            document.getElementById('col1Label10').textContent = shortName1 + ':';
            document.getElementById('col2Label3').textContent = shortName2 + ':';
            document.getElementById('col2Label4').textContent = shortName2 + ':';
            document.getElementById('col2Label5').textContent = shortName2 + ':';
            document.getElementById('col2Label6').textContent = shortName2 + ':';
            document.getElementById('col2Label7').textContent = shortName2 + ':';
            document.getElementById('col2Label8').textContent = shortName2 + ':';
            document.getElementById('col2Label9').textContent = shortName2 + ':';
            document.getElementById('col2Label10').textContent = shortName2 + ':';
            
            // Beta (now position 3)
            document.getElementById('option1Beta').textContent = risk1.beta.toFixed(3);
            document.getElementById('option2Beta').textContent = risk2.beta.toFixed(3);
            const betaDiff = risk1.beta - risk2.beta;
            const betaDiffEl = document.getElementById('betaDiff');
            betaDiffEl.textContent = betaDiff.toFixed(3);
            betaDiffEl.className = betaDiff <= 0 ? 'positive' : 'negative';
            
            // Expected Return (now position 4)
            document.getElementById('option1ExpReturn').textContent = formatPercent(risk1.expectedReturn);
            document.getElementById('option2ExpReturn').textContent = formatPercent(risk2.expectedReturn);
            const expReturnDiff = risk1.expectedReturn - risk2.expectedReturn;
            const expReturnDiffEl = document.getElementById('expReturnDiff');
            expReturnDiffEl.textContent = formatPercent(expReturnDiff);
            expReturnDiffEl.className = expReturnDiff >= 0 ? 'positive' : 'negative';
            
            // Alpha (now position 5)
            document.getElementById('option1Alpha').textContent = formatPercent(risk1.alpha);
            document.getElementById('option2Alpha').textContent = formatPercent(risk2.alpha);
            const alphaDiff = risk1.alpha - risk2.alpha;
            const alphaDiffEl = document.getElementById('alphaDiff');
            alphaDiffEl.textContent = formatPercent(alphaDiff);
            alphaDiffEl.className = alphaDiff >= 0 ? 'positive' : 'negative';
            
            // Sharpe Ratio (now position 6)
            document.getElementById('option1Sharpe').textContent = risk1.sharpe.toFixed(3);
            document.getElementById('option2Sharpe').textContent = risk2.sharpe.toFixed(3);
            const sharpeDiff = risk1.sharpe - risk2.sharpe;
            const sharpeDiffEl = document.getElementById('sharpeDiff');
            sharpeDiffEl.textContent = sharpeDiff.toFixed(3);
            sharpeDiffEl.className = sharpeDiff >= 0 ? 'positive' : 'negative';
            
            // Sortino Ratio (now position 7)
            document.getElementById('option1Sortino').textContent = risk1.sortino.toFixed(3);
            document.getElementById('option2Sortino').textContent = risk2.sortino.toFixed(3);
            const sortinoDiff = risk1.sortino - risk2.sortino;
            const sortinoDiffEl = document.getElementById('sortinoDiff');
            sortinoDiffEl.textContent = sortinoDiff.toFixed(3);
            sortinoDiffEl.className = sortinoDiff >= 0 ? 'positive' : 'negative';
            
            // Treynor Ratio (now position 8)
            document.getElementById('option1Treynor').textContent = risk1.treynor.toFixed(3);
            document.getElementById('option2Treynor').textContent = risk2.treynor.toFixed(3);
            const treynorDiff = risk1.treynor - risk2.treynor;
            const treynorDiffEl = document.getElementById('treynorDiff');
            treynorDiffEl.textContent = treynorDiff.toFixed(3);
            treynorDiffEl.className = treynorDiff >= 0 ? 'positive' : 'negative';
            
            // Volatility (now position 9)
            document.getElementById('option1Vol').textContent = formatPercent(risk1.volatility);
            document.getElementById('option2Vol').textContent = formatPercent(risk2.volatility);
            const volDiff = risk1.volatility - risk2.volatility;
            const volDiffEl = document.getElementById('volDiff');
            volDiffEl.textContent = formatPercent(volDiff);
            volDiffEl.className = volDiff <= 0 ? 'positive' : 'negative';
            
            // Win Rate (now position 10)
            document.getElementById('option1WinRate').textContent = (risk1.winRate * 100).toFixed(1) + '%';
            document.getElementById('option2WinRate').textContent = (risk2.winRate * 100).toFixed(1) + '%';
            const winRateDiff = risk1.winRate - risk2.winRate;
            const winRateDiffEl = document.getElementById('winRateDiff');
            winRateDiffEl.textContent = (winRateDiff * 100).toFixed(1) + '%';
            winRateDiffEl.className = winRateDiff >= 0 ? 'positive' : 'negative';
            
            // Create growth chart
            createGrowthChart(col1, alloc1, col2, alloc2, col5, alloc5, col6, alloc6, col3, alloc3, col4, alloc4, col7, alloc7, col8, alloc8, portfolio1Name, portfolio2Name);
            
            // Create pie charts for allocation visualization (currently hidden)
            // createPieCharts(col1, alloc1, col2, alloc2, col5, alloc5, col6, alloc6, col3, alloc3, col4, alloc4, col7, alloc7, col8, alloc8, portfolio1Name, portfolio2Name);
            
            // Show PDF download button (currently hidden)
            // document.getElementById('pdfDownloadButton').style.display = 'inline-block';
            
            document.getElementById('reportContent').style.display = 'block';
        }
        
        function createGrowthChart(col1, alloc1, col2, alloc2, col5, alloc5, col6, alloc6, col3, alloc3, col4, alloc4, col7, alloc7, col8, alloc8, portfolio1Name, portfolio2Name) {
            const years = Math.round(yearsValue);
            
            // Calculate year-by-year growth for both portfolios
            const portfolio1Values = [100000]; // Start with $100K
            const portfolio2Values = [100000];
            const labels = ['Year 0'];
            
            let value1 = 100000;
            let value2 = 100000;
            
            for (let year = 1; year <= years; year++) {
                const rowIndex = 19 + year;
                const row = excelData[rowIndex];
                
                // Portfolio 1 blended return
                let return1 = 0;
                if (col1 && alloc1 > 0 && row && row[col1] !== null) {
                    const ret = typeof row[col1] === 'number' ? row[col1] : parseValue(row[col1]);
                    return1 += ret * (alloc1 / 100);
                }
                if (col2 && alloc2 > 0 && row && row[col2] !== null) {
                    const ret = typeof row[col2] === 'number' ? row[col2] : parseValue(row[col2]);
                    return1 += ret * (alloc2 / 100);
                }
                if (col5 && alloc5 > 0 && row && row[col5] !== null) {
                    const ret = typeof row[col5] === 'number' ? row[col5] : parseValue(row[col5]);
                    return1 += ret * (alloc5 / 100);
                }
                if (col6 && alloc6 > 0 && row && row[col6] !== null) {
                    const ret = typeof row[col6] === 'number' ? row[col6] : parseValue(row[col6]);
                    return1 += ret * (alloc6 / 100);
                }
                
                // Portfolio 2 blended return
                let return2 = 0;
                if (col3 && alloc3 > 0 && row && row[col3] !== null) {
                    const ret = typeof row[col3] === 'number' ? row[col3] : parseValue(row[col3]);
                    return2 += ret * (alloc3 / 100);
                }
                if (col4 && alloc4 > 0 && row && row[col4] !== null) {
                    const ret = typeof row[col4] === 'number' ? row[col4] : parseValue(row[col4]);
                    return2 += ret * (alloc4 / 100);
                }
                if (col7 && alloc7 > 0 && row && row[col7] !== null) {
                    const ret = typeof row[col7] === 'number' ? row[col7] : parseValue(row[col7]);
                    return2 += ret * (alloc7 / 100);
                }
                if (col8 && alloc8 > 0 && row && row[col8] !== null) {
                    const ret = typeof row[col8] === 'number' ? row[col8] : parseValue(row[col8]);
                    return2 += ret * (alloc8 / 100);
                }
                
                value1 *= (1 + return1);
                value2 *= (1 + return2);
                
                portfolio1Values.push(value1);
                portfolio2Values.push(value2);
                labels.push(`Year ${year}`);
            }
            
            // Update chart subtitle
            document.getElementById('chartSubtitle').textContent = `${portfolio1Name} vs ${portfolio2Name}`;
            
            // Destroy existing chart if it exists
            if (growthChart) {
                growthChart.destroy();
            }
            
            // Create new chart
            const ctx = document.getElementById('growthChart').getContext('2d');
            growthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: portfolio1Name,
                            data: portfolio1Values,
                            borderColor: '#007bff',
                            backgroundColor: 'rgba(0, 123, 255, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.1,
                            pointRadius: 2,
                            pointHoverRadius: 5
                        },
                        {
                            label: portfolio2Name,
                            data: portfolio2Values,
                            borderColor: '#28a745',
                            backgroundColor: 'rgba(40, 167, 69, 0.1)',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.1,
                            pointRadius: 2,
                            pointHoverRadius: 5
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                font: {
                                    size: 14,
                                    family: "'Roboto Slab', serif",
                                    weight: 600
                                },
                                padding: 15,
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleFont: {
                                size: 14,
                                family: "'Roboto Slab', serif"
                            },
                            bodyFont: {
                                size: 13,
                                family: "'Roboto Slab', serif"
                            },
                            padding: 12,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += '$' + Math.round(context.parsed.y).toLocaleString();
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 11,
                                    family: "'Roboto Slab', serif"
                                },
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    family: "'Roboto Slab', serif"
                                },
                                callback: function(value) {
                                    if (value >= 1000000) {
                                        return '$' + (value / 1000000).toFixed(1) + 'M';
                                    }
                                    return '$' + (value / 1000).toFixed(0) + 'K';
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
        }
        
        function calculateDifference(val1, val2, isCurrency = false) {
            const num1 = parseValue(val1);
            const num2 = parseValue(val2);
            
            if (isNaN(num1) || isNaN(num2)) return 0;
            
            return num1 - num2;
        }
        
        function parseValue(value) {
            if (typeof value === 'number') return value;
            if (typeof value === 'string') {
                const cleaned = value.replace(/[$,%,\s]/g, '');
                const num = parseFloat(cleaned);
                
                if (value.includes('%')) {
                    return num / 100;
                }
                return num;
            }
            return 0;
        }
        
        function formatValue(value) {
            if (value === null || value === undefined) return 'N/A';
            if (typeof value === 'string') return value;
            if (typeof value === 'number') {
                if (Math.abs(value) <= 1) {
                    return formatPercent(value);
                }
                return formatCurrency(value);
            }
            return value;
        }
        
        function formatPercent(value) {
            if (value === null || value === undefined || isNaN(value)) return '0.00%';
            if (typeof value === 'number') {
                return (value * 100).toFixed(2) + '%';
            }
            if (typeof value === 'string' && value.includes('%')) {
                return value;
            }
            return value + '%';
        }
        
        function formatCurrency(value) {
            if (value === null || value === undefined || isNaN(value)) return '$0';
            if (typeof value === 'number') {
                return '$' + value.toLocaleString('en-US', {
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                });
            }
            if (typeof value === 'string' && value.includes('$')) {
                return value;
            }
            return '$' + value;
        }
        
        async function copyAllAsImage() {
            const copyStatus = document.getElementById('copyStatus');
            const buttons = document.querySelectorAll('.copy-button');
            
            buttons[0].disabled = true;
            buttons[0].textContent = '‚è≥ Generating...';
            
            try {
                // Create a temporary container with everything
                const tempDiv = document.createElement('div');
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                tempDiv.style.width = '540px'; // 60% of 900px to match display
                tempDiv.style.background = '#ffffff';
                tempDiv.style.padding = '20px';
                document.body.appendChild(tempDiv);
                
                // Add main header
                const mainHeader = document.createElement('div');
                mainHeader.className = 'header';
                const h1 = document.createElement('h1');
                h1.textContent = 'Performance Comparison';
                h1.style.fontSize = '28px';
                h1.style.fontWeight = '700';
                h1.style.color = '#1a1a1a';
                h1.style.marginBottom = '5px';
                mainHeader.appendChild(h1);
                
                const subtitle = document.createElement('div');
                subtitle.className = 'subtitle';
                const p1 = document.getElementById('portfolio1Description').textContent; const p2 = document.getElementById('portfolio2Description').textContent; subtitle.textContent = `${p1} vs ${p2}`;
                subtitle.style.fontSize = '14px';
                subtitle.style.color = '#666';
                subtitle.style.fontStyle = 'italic';
                subtitle.style.marginBottom = '15px';
                mainHeader.appendChild(subtitle);
                tempDiv.appendChild(mainHeader);
                
                // Clone Performance Metrics section
                const perfHeader = document.querySelector('.section-header');
                if (perfHeader) {
                    tempDiv.appendChild(perfHeader.cloneNode(true));
                }
                
                // Clone portfolio key
                const portfolioKey = document.getElementById('portfolioKey');
                if (portfolioKey) {
                    tempDiv.appendChild(portfolioKey.cloneNode(true));
                }
                
                const perfTable = document.querySelector('.performance-table');
                if (perfTable) {
                    const tableClone = perfTable.cloneNode(true);
                    // Ensure tbody content is captured
                    const originalTbody = perfTable.querySelector('tbody');
                    const cloneTbody = tableClone.querySelector('tbody');
                    if (originalTbody && cloneTbody) {
                        cloneTbody.innerHTML = originalTbody.innerHTML;
                    }
                    tempDiv.appendChild(tableClone);
                }
                
                // Clone Investment Analysis section
                const invHeader = document.querySelectorAll('.section-header')[1];
                if (invHeader) {
                    tempDiv.appendChild(invHeader.cloneNode(true));
                }
                
                const metricsContainer = document.querySelector('.metrics-container');
                if (metricsContainer) {
                    tempDiv.appendChild(metricsContainer.cloneNode(true));
                }
                
                // Clone the note
                const note = document.querySelectorAll('#presentationContent > div[style*="font-size: 11px"]')[0];
                if (note) {
                    tempDiv.appendChild(note.cloneNode(true));
                }
                
                // Clone Portfolio Growth section
                const growthHeader = document.querySelectorAll('.section-header')[2];
                if (growthHeader) {
                    tempDiv.appendChild(growthHeader.cloneNode(true));
                }
                
                // Add chart content
                const chartContentDiv = document.createElement('div');
                chartContentDiv.style.background = '#ffffff';
                chartContentDiv.style.padding = '15px';
                chartContentDiv.style.borderRadius = '8px';
                chartContentDiv.style.marginTop = '6px';
                
                const titleDiv = document.createElement('div');
                titleDiv.style.textAlign = 'center';
                titleDiv.style.marginBottom = '10px';
                
                const h3 = document.createElement('h3');
                h3.textContent = '$100,000 Investment Growth';
                h3.style.fontSize = '18px';
                h3.style.color = '#1a1a1a';
                h3.style.fontWeight = '600';
                h3.style.marginBottom = '3px';
                titleDiv.appendChild(h3);
                
                const chartSubtitle = document.getElementById('chartSubtitle').cloneNode(true);
                titleDiv.appendChild(chartSubtitle);
                chartContentDiv.appendChild(titleDiv);
                
                const chartCanvas = document.getElementById('growthChart');
                if (chartCanvas) {
                    const canvasClone = document.createElement('canvas');
                    canvasClone.width = chartCanvas.width;
                    canvasClone.height = chartCanvas.height;
                    const ctx = canvasClone.getContext('2d');
                    ctx.drawImage(chartCanvas, 0, 0);
                    canvasClone.style.width = '100%';
                    canvasClone.style.height = 'auto';
                    chartContentDiv.appendChild(canvasClone);
                }
                
                const chartNote = document.createElement('div');
                chartNote.textContent = 'Growth calculated from annual returns with annual rebalancing.';
                chartNote.style.textAlign = 'center';
                chartNote.style.fontSize = '11px';
                chartNote.style.color = '#999';
                chartNote.style.fontStyle = 'italic';
                chartNote.style.marginTop = '8px';
                chartContentDiv.appendChild(chartNote);
                
                tempDiv.appendChild(chartContentDiv);
                
                // Clone Risk Metrics section
                const riskHeader = document.querySelectorAll('.section-header')[3];
                if (riskHeader) {
                    tempDiv.appendChild(riskHeader.cloneNode(true));
                }
                
                const riskContent = document.getElementById('riskMetricsContent');
                if (riskContent) {
                    tempDiv.appendChild(riskContent.cloneNode(true));
                }
                
                const canvas = await html2canvas(tempDiv, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    allowTaint: true
                });
                
                // Clean up
                document.body.removeChild(tempDiv);
                
                canvas.toBlob(async (blob) => {
                    try {
                        await navigator.clipboard.write([
                            new ClipboardItem({'image/png': blob})
                        ]);
                        
                        copyStatus.textContent = '‚úì All sections copied to clipboard!';
                        copyStatus.style.display = 'block';
                        
                        setTimeout(() => {
                            copyStatus.style.display = 'none';
                        }, 3000);
                        
                    } catch (err) {
                        const url = canvas.toDataURL('image/png');
                        const link = document.createElement('a');
                        link.download = 'portfolio-comparison-all.png';
                        link.href = url;
                        link.click();
                        
                        copyStatus.textContent = '‚úì All sections downloaded!';
                        copyStatus.style.display = 'block';
                        
                        setTimeout(() => {
                            copyStatus.style.display = 'none';
                        }, 3000);
                    }
                }, 'image/png');
                
            } catch (err) {
                alert('Failed to generate image: ' + err.message);
            } finally {
                buttons[0].disabled = false;
                buttons[0].textContent = 'üìë Copy All';
            }
        }
        
        async function copyReportAsImage() {
            const copyStatus = document.getElementById('copyStatus');
            const buttons = document.querySelectorAll('.copy-button');
            
            buttons[1].disabled = true;
            buttons[1].textContent = '‚è≥ Generating...';
            
            try {
                // Create a temporary container with just the performance metrics and investment analysis
                const tempDiv = document.createElement('div');
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                tempDiv.style.width = '540px'; // 60% of 900px to match display
                tempDiv.style.background = '#ffffff';
                tempDiv.style.padding = '20px';
                document.body.appendChild(tempDiv);
                
                // Add main header
                const mainHeader = document.createElement('div');
                mainHeader.className = 'header';
                const h1 = document.createElement('h1');
                h1.textContent = 'Performance Comparison';
                h1.style.fontSize = '28px';
                h1.style.fontWeight = '700';
                h1.style.color = '#1a1a1a';
                h1.style.marginBottom = '5px';
                mainHeader.appendChild(h1);
                
                const subtitle = document.createElement('div');
                subtitle.className = 'subtitle';
                const p1 = document.getElementById('portfolio1Description').textContent; const p2 = document.getElementById('portfolio2Description').textContent; subtitle.textContent = `${p1} vs ${p2}`;
                subtitle.style.fontSize = '14px';
                subtitle.style.color = '#666';
                subtitle.style.fontStyle = 'italic';
                subtitle.style.marginBottom = '15px';
                mainHeader.appendChild(subtitle);
                tempDiv.appendChild(mainHeader);
                
                // Clone the section header
                const perfHeader = document.querySelector('.section-header');
                if (perfHeader) {
                    tempDiv.appendChild(perfHeader.cloneNode(true));
                }
                
                // Clone portfolio key
                const portfolioKey = document.getElementById('portfolioKey');
                if (portfolioKey) {
                    tempDiv.appendChild(portfolioKey.cloneNode(true));
                }
                
                // Clone the performance table with all its content
                const perfTable = document.querySelector('.performance-table');
                if (perfTable) {
                    const tableClone = perfTable.cloneNode(true);
                    // Ensure tbody content is captured
                    const originalTbody = perfTable.querySelector('tbody');
                    const cloneTbody = tableClone.querySelector('tbody');
                    if (originalTbody && cloneTbody) {
                        cloneTbody.innerHTML = originalTbody.innerHTML;
                    }
                    tempDiv.appendChild(tableClone);
                }
                
                // Clone the Investment Analysis section
                const invHeader = document.querySelectorAll('.section-header')[1];
                if (invHeader) {
                    tempDiv.appendChild(invHeader.cloneNode(true));
                }
                
                const metricsContainer = document.querySelector('.metrics-container');
                if (metricsContainer) {
                    tempDiv.appendChild(metricsContainer.cloneNode(true));
                }
                
                // Clone the note
                const note = document.querySelectorAll('#presentationContent > div[style*="font-size: 11px"]')[0];
                if (note) {
                    tempDiv.appendChild(note.cloneNode(true));
                }
                
                const canvas = await html2canvas(tempDiv, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    allowTaint: true
                });
                
                // Clean up
                document.body.removeChild(tempDiv);
                
                canvas.toBlob(async (blob) => {
                    try {
                        await navigator.clipboard.write([
                            new ClipboardItem({'image/png': blob})
                        ]);
                        
                        copyStatus.textContent = '‚úì Performance data copied to clipboard!';
                        copyStatus.style.display = 'block';
                        
                        setTimeout(() => {
                            copyStatus.style.display = 'none';
                        }, 3000);
                        
                    } catch (err) {
                        const url = canvas.toDataURL('image/png');
                        const link = document.createElement('a');
                        link.download = 'performance-comparison.png';
                        link.href = url;
                        link.click();
                        
                        copyStatus.textContent = '‚úì Performance data downloaded!';
                        copyStatus.style.display = 'block';
                        
                        setTimeout(() => {
                            copyStatus.style.display = 'none';
                        }, 3000);
                    }
                }, 'image/png');
                
            } catch (err) {
                alert('Failed to generate image: ' + err.message);
            } finally {
                buttons[1].disabled = false;
                buttons[1].textContent = 'üìã Copy Performance Report';
            }
        }
        
        async function copyRiskMetricsAsImage() {
            const riskMetricsContent = document.getElementById('riskMetricsContent');
            const copyStatus = document.getElementById('copyStatus');
            const buttons = document.querySelectorAll('.copy-button');
            
            buttons[3].disabled = true;
            buttons[3].textContent = '‚è≥ Generating...';
            
            try {
                // Create temp container with 60% width to match display
                const tempDiv = document.createElement('div');
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                tempDiv.style.width = '540px'; // 60% of 900px container
                tempDiv.style.background = '#ffffff';
                tempDiv.style.padding = '20px';
                tempDiv.style.borderRadius = '8px';
                document.body.appendChild(tempDiv);
                
                // Add section header
                const header = document.createElement('div');
                header.className = 'section-header';
                header.style.marginTop = '0';
                header.textContent = 'Advanced Risk Metrics';
                tempDiv.appendChild(header);
                
                // Add portfolio key
                const portfolioKey = document.createElement('div');
                portfolioKey.style.textAlign = 'center';
                portfolioKey.style.fontSize = '13px';
                portfolioKey.style.color = '#666';
                portfolioKey.style.fontStyle = 'italic';
                portfolioKey.style.marginTop = '3px';
                portfolioKey.style.marginBottom = '8px';
                const portfolio1Name = document.getElementById('portfolio1DescriptionRisk').textContent;
                const portfolio2Name = document.getElementById('portfolio2DescriptionRisk').textContent;
                portfolioKey.innerHTML = `<span>${portfolio1Name}</span> vs <span>${portfolio2Name}</span>`;
                tempDiv.appendChild(portfolioKey);
                
                // Clone risk metrics content
                const riskContentClone = document.createElement('div');
                riskContentClone.innerHTML = riskMetricsContent.innerHTML;
                riskContentClone.style.background = '#fafbfc';
                riskContentClone.style.padding = '12px';
                riskContentClone.style.borderRadius = '8px';
                tempDiv.appendChild(riskContentClone);
                
                const canvas = await html2canvas(tempDiv, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    allowTaint: true
                });
                
                // Clean up
                document.body.removeChild(tempDiv);
                
                canvas.toBlob(async (blob) => {
                    try {
                        await navigator.clipboard.write([
                            new ClipboardItem({'image/png': blob})
                        ]);
                        
                        copyStatus.textContent = '‚úì Risk metrics copied to clipboard!';
                        copyStatus.style.display = 'block';
                        
                        setTimeout(() => {
                            copyStatus.style.display = 'none';
                        }, 3000);
                        
                    } catch (err) {
                        const url = canvas.toDataURL('image/png');
                        const link = document.createElement('a');
                        link.download = 'risk-metrics.png';
                        link.href = url;
                        link.click();
                        
                        copyStatus.textContent = '‚úì Risk metrics downloaded!';
                        copyStatus.style.display = 'block';
                        
                        setTimeout(() => {
                            copyStatus.style.display = 'none';
                        }, 3000);
                    }
                }, 'image/png');
                
            } catch (err) {
                alert('Failed to generate image: ' + err.message);
            } finally {
                buttons[3].disabled = false;
                buttons[3].textContent = 'üìä Copy Risk Metrics';
            }
        }
        
        async function copyGrowthChartAsImage() {
            const copyStatus = document.getElementById('copyStatus');
            const buttons = document.querySelectorAll('.copy-button');
            
            buttons[2].disabled = true;
            buttons[2].textContent = '‚è≥ Generating...';
            
            try {
                // Create temp container
                const tempDiv = document.createElement('div');
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                tempDiv.style.width = '540px'; // 60% of 900px
                tempDiv.style.background = '#ffffff';
                tempDiv.style.padding = '20px';
                document.body.appendChild(tempDiv);
                
                // Add Portfolio Growth section header
                const growthHeader = document.querySelectorAll('.section-header')[2];
                if (growthHeader) {
                    tempDiv.appendChild(growthHeader.cloneNode(true));
                }
                
                // Add chart content container
                const chartContentDiv = document.createElement('div');
                chartContentDiv.style.background = '#ffffff';
                chartContentDiv.style.padding = '15px';
                chartContentDiv.style.borderRadius = '8px';
                chartContentDiv.style.marginTop = '6px';
                
                // Add chart title and subtitle
                const titleDiv = document.createElement('div');
                titleDiv.style.textAlign = 'center';
                titleDiv.style.marginBottom = '10px';
                
                const h3 = document.createElement('h3');
                h3.textContent = '$100,000 Investment Growth';
                h3.style.fontSize = '18px';
                h3.style.color = '#1a1a1a';
                h3.style.fontWeight = '600';
                h3.style.marginBottom = '3px';
                titleDiv.appendChild(h3);
                
                const subtitle = document.getElementById('chartSubtitle').cloneNode(true);
                titleDiv.appendChild(subtitle);
                chartContentDiv.appendChild(titleDiv);
                
                // Add the chart canvas
                const chartCanvas = document.getElementById('growthChart');
                if (chartCanvas) {
                    const canvasClone = document.createElement('canvas');
                    canvasClone.width = chartCanvas.width;
                    canvasClone.height = chartCanvas.height;
                    const ctx = canvasClone.getContext('2d');
                    ctx.drawImage(chartCanvas, 0, 0);
                    canvasClone.style.width = '100%';
                    canvasClone.style.height = 'auto';
                    chartContentDiv.appendChild(canvasClone);
                }
                
                // Add chart note
                const chartNote = document.createElement('div');
                chartNote.textContent = 'Growth calculated from annual returns with annual rebalancing.';
                chartNote.style.textAlign = 'center';
                chartNote.style.fontSize = '11px';
                chartNote.style.color = '#999';
                chartNote.style.fontStyle = 'italic';
                chartNote.style.marginTop = '8px';
                chartContentDiv.appendChild(chartNote);
                
                tempDiv.appendChild(chartContentDiv);
                
                // Generate image using html2canvas
                const canvas = await html2canvas(tempDiv, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    allowTaint: true
                });
                
                // Clean up
                document.body.removeChild(tempDiv);
                
                // Convert to blob and copy
                canvas.toBlob(async (blob) => {
                    try {
                        await navigator.clipboard.write([
                            new ClipboardItem({'image/png': blob})
                        ]);
                        
                        copyStatus.textContent = '‚úì Growth chart copied to clipboard!';
                        copyStatus.style.display = 'block';
                        
                        setTimeout(() => {
                            copyStatus.style.display = 'none';
                        }, 3000);
                        
                    } catch (err) {
                        const url = canvas.toDataURL('image/png');
                        const link = document.createElement('a');
                        link.download = 'growth-chart.png';
                        link.href = url;
                        link.click();
                        
                        copyStatus.textContent = '‚úì Growth chart downloaded!';
                        copyStatus.style.display = 'block';
                        
                        setTimeout(() => {
                            copyStatus.style.display = 'none';
                        }, 3000);
                    }
                }, 'image/png');
                
            } catch (err) {
                alert('Failed to generate image: ' + err.message);
            } finally {
                buttons[2].disabled = false;
                buttons[2].textContent = 'üìà Copy Growth Chart';
            }
        }
    
        
        // ============================================================================
        // DATA UPDATE FUNCTIONALITY
        // ============================================================================
        
        document.getElementById('updateDataInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const statusDiv = document.getElementById('updateStatus');
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = '<span style="color: #007bff;">‚è≥ Reading file...</span>';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    // Parse Excel file
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, {type: 'array'});
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                    
                    if (jsonData.length < 40) {
                        throw new Error(`Excel file must have at least 40 rows (found ${jsonData.length})`);
                    }
                    
                    // Validate structure
                    const modelCount = jsonData[1].filter((cell, idx) => idx >= 2 && cell).length;
                    if (modelCount < 1) {
                        throw new Error('No model columns found in Excel file');
                    }
                    
                    statusDiv.innerHTML = '<span style="color: #007bff;">‚è≥ Generating updated HTML file...</span>';
                    
                    // IMMEDIATELY create updated HTML with new data baked in
                    try {
                        let htmlContent = document.documentElement.outerHTML;
                        const doctype = "<!DOCTYPE html>\n";
                        
                        // Prepare the new data string
                        const newDataString = 'const EXCEL_DATA = ' + JSON.stringify(jsonData, null, 2) + ';';
                        
                        // Replace EXCEL_DATA in the HTML code
                        const pattern = /(const|var|let)\s+EXCEL_DATA\s*=\s*\[[\s\S]*?\];/;
                        
                        if (!pattern.test(htmlContent)) {
                            throw new Error('Could not find EXCEL_DATA in HTML. Contact support.');
                        }
                        
                        htmlContent = htmlContent.replace(pattern, newDataString);
                        
                        // Auto-download the updated file
                        const blob = new Blob([doctype + htmlContent], { type: 'text/html' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'index.html';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        
                        statusDiv.innerHTML = `<span style="color: #28a745;">‚úÖ Success! Downloaded index.html with ${modelCount} models.<br><br><strong>Next Steps:</strong><br>1. Replace your current index.html with the downloaded file<br>2. Upload to GitHub and push changes<br>3. Refresh this page to see new data</span>`;
                        
                    } catch (error) {
                        throw new Error('Failed to generate HTML: ' + error.message);
                    }
                    
                } catch (error) {
                    statusDiv.innerHTML = `<span style="color: #dc3545;">‚ùå Error: ${error.message}</span>`;
                    console.error('Error updating data:', error);
                }
            };
            
            reader.onerror = function() {
                statusDiv.innerHTML = '<span style="color: #dc3545;">‚ùå Error reading file</span>';
            };
            
            reader.readAsArrayBuffer(file);
        });
        
        // Pie Chart Variables
        let pieChart1 = null;
        let pieChart2 = null;
        
        // Create Pie Charts for Portfolio Allocations
        function createPieCharts(col1, alloc1, col2, alloc2, col5, alloc5, col6, alloc6,
                                 col3, alloc3, col4, alloc4, col7, alloc7, col8, alloc8,
                                 portfolio1Name, portfolio2Name) {
            // Portfolio 1 Data
            const p1Data = [];
            const p1Labels = [];
            const p1Colors = ['#4472C4', '#ED7D31', '#A5A5A5', '#FFC000'];
            
            if (col1 && alloc1 > 0) {
                const header1 = columnHeaders.find(h => h.index === col1);
                p1Labels.push(header1.name);
                p1Data.push(alloc1);
            }
            if (col2 && alloc2 > 0) {
                const header2 = columnHeaders.find(h => h.index === col2);
                p1Labels.push(header2.name);
                p1Data.push(alloc2);
            }
            if (col5 && alloc5 > 0) {
                const header5 = columnHeaders.find(h => h.index === col5);
                p1Labels.push(header5.name);
                p1Data.push(alloc5);
            }
            if (col6 && alloc6 > 0) {
                const header6 = columnHeaders.find(h => h.index === col6);
                p1Labels.push(header6.name);
                p1Data.push(alloc6);
            }
            
            // Portfolio 2 Data
            const p2Data = [];
            const p2Labels = [];
            const p2Colors = ['#70AD47', '#FFC000', '#5B9BD5', '#FF6B6B'];
            
            if (col3 && alloc3 > 0) {
                const header3 = columnHeaders.find(h => h.index === col3);
                p2Labels.push(header3.name);
                p2Data.push(alloc3);
            }
            if (col4 && alloc4 > 0) {
                const header4 = columnHeaders.find(h => h.index === col4);
                p2Labels.push(header4.name);
                p2Data.push(alloc4);
            }
            if (col7 && alloc7 > 0) {
                const header7 = columnHeaders.find(h => h.index === col7);
                p2Labels.push(header7.name);
                p2Data.push(alloc7);
            }
            if (col8 && alloc8 > 0) {
                const header8 = columnHeaders.find(h => h.index === col8);
                p2Labels.push(header8.name);
                p2Data.push(alloc8);
            }
            
            // Destroy existing charts
            if (pieChart1) pieChart1.destroy();
            if (pieChart2) pieChart2.destroy();
            
            // Create Portfolio 1 Pie Chart
            const ctx1 = document.getElementById('pieChart1').getContext('2d');
            pieChart1 = new Chart(ctx1, {
                type: 'pie',
                data: {
                    labels: p1Labels,
                    datasets: [{
                        data: p1Data,
                        backgroundColor: p1Colors.slice(0, p1Data.length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { font: { size: 11 }, padding: 10 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed + '%';
                                }
                            }
                        }
                    }
                }
            });
            
            // Create Portfolio 2 Pie Chart
            const ctx2 = document.getElementById('pieChart2').getContext('2d');
            pieChart2 = new Chart(ctx2, {
                type: 'pie',
                data: {
                    labels: p2Labels,
                    datasets: [{
                        data: p2Data,
                        backgroundColor: p2Colors.slice(0, p2Data.length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { font: { size: 11 }, padding: 10 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed + '%';
                                }
                            }
                        }
                    }
                }
            });
            
            // Update titles
            document.getElementById('pieChart1Title').textContent = 'Portfolio 1: ' + portfolio1Name;
            document.getElementById('pieChart2Title').textContent = 'Portfolio 2: ' + portfolio2Name;
            
            // Show pie charts section
            document.getElementById('pieChartsSection').style.display = 'flex';
        }
        
        // Download Report as PDF
        async function downloadReportAsPDF() {
            const button = document.getElementById('pdfDownloadButton');
            const originalText = button.innerHTML;
            
            try {
                button.innerHTML = '‚è≥ Generating PDF...';
                button.disabled = true;
                
                // Get jsPDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'letter');
                
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const margin = 15;
                const contentWidth = pageWidth - (2 * margin);
                
                // Get report sections
                const header = document.querySelector('.header');
                const perfSection = document.querySelector('.performance-table');
                const pieSection = document.getElementById('pieChartsSection');
                const metricsSection = document.querySelector('.metrics-container');
                const chartSection = document.querySelector('.chart-container');
                const riskSection = document.querySelectorAll('.metrics-container')[1];
                
                let yPosition = margin;
                
                // Page 1: Header + Performance Table
                if (header) {
                    const canvas1 = await html2canvas(header, { scale: 2, backgroundColor: '#ffffff' });
                    const imgData1 = canvas1.toDataURL('image/png');
                    const imgHeight1 = (canvas1.height * contentWidth) / canvas1.width;
                    pdf.addImage(imgData1, 'PNG', margin, yPosition, contentWidth, imgHeight1);
                    yPosition += imgHeight1 + 5;
                }
                
                // Performance Table
                if (perfSection) {
                    const tableParent = perfSection.parentElement;
                    const sectionHeader = tableParent.querySelector('.section-header');
                    const portfolioKey = tableParent.querySelector('#portfolioKey');
                    
                    // Add section header
                    if (sectionHeader) {
                        pdf.setFontSize(16);
                        pdf.setFont(undefined, 'bold');
                        pdf.text(sectionHeader.textContent, margin, yPosition);
                        yPosition += 7;
                    }
                    
                    // Add portfolio key
                    if (portfolioKey) {
                        pdf.setFontSize(10);
                        pdf.setFont(undefined, 'italic');
                        pdf.setTextColor(102, 102, 102);
                        pdf.text(portfolioKey.textContent, pageWidth / 2, yPosition, { align: 'center' });
                        pdf.setTextColor(0, 0, 0);
                        yPosition += 8;
                    }
                    
                    const canvas2 = await html2canvas(perfSection, { scale: 2, backgroundColor: '#ffffff' });
                    const imgData2 = canvas2.toDataURL('image/png');
                    const imgHeight2 = (canvas2.height * contentWidth) / canvas2.width;
                    
                    if (yPosition + imgHeight2 > pageHeight - margin) {
                        pdf.addPage();
                        yPosition = margin;
                    }
                    
                    pdf.addImage(imgData2, 'PNG', margin, yPosition, contentWidth, imgHeight2);
                    yPosition += imgHeight2 + 10;
                }
                
                // Pie Charts
                if (pieSection && pieSection.style.display !== 'none') {
                    if (yPosition + 80 > pageHeight - margin) {
                        pdf.addPage();
                        yPosition = margin;
                    }
                    
                    const canvas3 = await html2canvas(pieSection, { scale: 2, backgroundColor: '#ffffff' });
                    const imgData3 = canvas3.toDataURL('image/png');
                    const imgHeight3 = (canvas3.height * contentWidth) / canvas3.width;
                    pdf.addImage(imgData3, 'PNG', margin, yPosition, contentWidth, imgHeight3);
                    yPosition += imgHeight3 + 10;
                }
                
                // Page 2: Investment Analysis
                if (metricsSection) {
                    pdf.addPage();
                    yPosition = margin;
                    
                    pdf.setFontSize(16);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('20-Year Investment Lookback Analysis', margin, yPosition);
                    yPosition += 10;
                    
                    const canvas4 = await html2canvas(metricsSection, { scale: 2, backgroundColor: '#ffffff' });
                    const imgData4 = canvas4.toDataURL('image/png');
                    const imgHeight4 = (canvas4.height * contentWidth) / canvas4.width;
                    pdf.addImage(imgData4, 'PNG', margin, yPosition, contentWidth, imgHeight4);
                }
                
                // Page 3: Growth Chart
                if (chartSection) {
                    pdf.addPage();
                    yPosition = margin;
                    
                    pdf.setFontSize(16);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('Portfolio Growth Over Time', margin, yPosition);
                    yPosition += 10;
                    
                    const canvas5 = await html2canvas(chartSection, { scale: 2, backgroundColor: '#ffffff' });
                    const imgData5 = canvas5.toDataURL('image/png');
                    const imgHeight5 = (canvas5.height * contentWidth) / canvas5.width;
                    pdf.addImage(imgData5, 'PNG', margin, yPosition, contentWidth, imgHeight5);
                }
                
                // Page 4: Risk Metrics
                if (riskSection) {
                    pdf.addPage();
                    yPosition = margin;
                    
                    pdf.setFontSize(16);
                    pdf.setFont(undefined, 'bold');
                    pdf.text('Advanced Risk Metrics', margin, yPosition);
                    yPosition += 10;
                    
                    const canvas6 = await html2canvas(riskSection, { scale: 2, backgroundColor: '#ffffff' });
                    const imgData6 = canvas6.toDataURL('image/png');
                    const imgHeight6 = (canvas6.height * contentWidth) / canvas6.width;
                    pdf.addImage(imgData6, 'PNG', margin, yPosition, contentWidth, imgHeight6);
                }
                
                // Save PDF
                const p1Name = document.getElementById('portfolio1Description').textContent.replace(/\s+/g, '_');
                const p2Name = document.getElementById('portfolio2Description').textContent.replace(/\s+/g, '_');
                const filename = `Performance_Report_${p1Name}_vs_${p2Name}.pdf`;
                pdf.save(filename);
                
                button.innerHTML = '‚úÖ Downloaded!';
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }, 2000);
                
            } catch (error) {
                console.error('PDF generation error:', error);
                button.innerHTML = '‚ùå Error';
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }, 2000);
            }
        }
        
</script>


</body></html>